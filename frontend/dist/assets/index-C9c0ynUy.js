var Vj=Object.defineProperty;var Uj=(e,t,i)=>t in e?Vj(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Ot=(e,t,i)=>Uj(e,typeof t!="symbol"?t+"":t,i);function $j(e,t){for(var i=0;i<t.length;i++){const o=t[i];if(typeof o!="string"&&!Array.isArray(o)){for(const h in o)if(h!=="default"&&!(h in e)){const m=Object.getOwnPropertyDescriptor(o,h);m&&Object.defineProperty(e,h,m.get?m:{enumerable:!0,get:()=>o[h]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const f of m.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function i(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(h){if(h.ep)return;h.ep=!0;const m=i(h);fetch(h.href,m)}})();var Gj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yC(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _C={exports:{}},t_={},vC={exports:{}},en={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Df=Symbol.for("react.element"),qj=Symbol.for("react.portal"),Wj=Symbol.for("react.fragment"),Zj=Symbol.for("react.strict_mode"),Hj=Symbol.for("react.profiler"),Kj=Symbol.for("react.provider"),Xj=Symbol.for("react.context"),Yj=Symbol.for("react.forward_ref"),Jj=Symbol.for("react.suspense"),Qj=Symbol.for("react.memo"),eN=Symbol.for("react.lazy"),NT=Symbol.iterator;function tN(e){return e===null||typeof e!="object"?null:(e=NT&&e[NT]||e["@@iterator"],typeof e=="function"?e:null)}var xC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bC=Object.assign,wC={};function Qh(e,t,i){this.props=e,this.context=t,this.refs=wC,this.updater=i||xC}Qh.prototype.isReactComponent={};Qh.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Qh.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function SC(){}SC.prototype=Qh.prototype;function jb(e,t,i){this.props=e,this.context=t,this.refs=wC,this.updater=i||xC}var Nb=jb.prototype=new SC;Nb.constructor=jb;bC(Nb,Qh.prototype);Nb.isPureReactComponent=!0;var LT=Array.isArray,TC=Object.prototype.hasOwnProperty,Lb={current:null},EC={key:!0,ref:!0,__self:!0,__source:!0};function PC(e,t,i){var o,h={},m=null,f=null;if(t!=null)for(o in t.ref!==void 0&&(f=t.ref),t.key!==void 0&&(m=""+t.key),t)TC.call(t,o)&&!EC.hasOwnProperty(o)&&(h[o]=t[o]);var c=arguments.length-2;if(c===1)h.children=i;else if(1<c){for(var E=Array(c),C=0;C<c;C++)E[C]=arguments[C+2];h.children=E}if(e&&e.defaultProps)for(o in c=e.defaultProps,c)h[o]===void 0&&(h[o]=c[o]);return{$$typeof:Df,type:e,key:m,ref:f,props:h,_owner:Lb.current}}function nN(e,t){return{$$typeof:Df,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function zb(e){return typeof e=="object"&&e!==null&&e.$$typeof===Df}function rN(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var zT=/\/+/g;function r0(e,t){return typeof e=="object"&&e!==null&&e.key!=null?rN(""+e.key):t.toString(36)}function Jg(e,t,i,o,h){var m=typeof e;(m==="undefined"||m==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(m){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case Df:case qj:f=!0}}if(f)return f=e,h=h(f),e=o===""?"."+r0(f,0):o,LT(h)?(i="",e!=null&&(i=e.replace(zT,"$&/")+"/"),Jg(h,t,i,"",function(C){return C})):h!=null&&(zb(h)&&(h=nN(h,i+(!h.key||f&&f.key===h.key?"":(""+h.key).replace(zT,"$&/")+"/")+e)),t.push(h)),1;if(f=0,o=o===""?".":o+":",LT(e))for(var c=0;c<e.length;c++){m=e[c];var E=o+r0(m,c);f+=Jg(m,t,i,E,h)}else if(E=tN(e),typeof E=="function")for(e=E.call(e),c=0;!(m=e.next()).done;)m=m.value,E=o+r0(m,c++),f+=Jg(m,t,i,E,h);else if(m==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return f}function wg(e,t,i){if(e==null)return e;var o=[],h=0;return Jg(e,o,"","",function(m){return t.call(i,m,h++)}),o}function iN(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var zi={current:null},Qg={transition:null},sN={ReactCurrentDispatcher:zi,ReactCurrentBatchConfig:Qg,ReactCurrentOwner:Lb};function CC(){throw Error("act(...) is not supported in production builds of React.")}en.Children={map:wg,forEach:function(e,t,i){wg(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return wg(e,function(){t++}),t},toArray:function(e){return wg(e,function(t){return t})||[]},only:function(e){if(!zb(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};en.Component=Qh;en.Fragment=Wj;en.Profiler=Hj;en.PureComponent=jb;en.StrictMode=Zj;en.Suspense=Jj;en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sN;en.act=CC;en.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=bC({},e.props),h=e.key,m=e.ref,f=e._owner;if(t!=null){if(t.ref!==void 0&&(m=t.ref,f=Lb.current),t.key!==void 0&&(h=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(E in t)TC.call(t,E)&&!EC.hasOwnProperty(E)&&(o[E]=t[E]===void 0&&c!==void 0?c[E]:t[E])}var E=arguments.length-2;if(E===1)o.children=i;else if(1<E){c=Array(E);for(var C=0;C<E;C++)c[C]=arguments[C+2];o.children=c}return{$$typeof:Df,type:e.type,key:h,ref:m,props:o,_owner:f}};en.createContext=function(e){return e={$$typeof:Xj,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Kj,_context:e},e.Consumer=e};en.createElement=PC;en.createFactory=function(e){var t=PC.bind(null,e);return t.type=e,t};en.createRef=function(){return{current:null}};en.forwardRef=function(e){return{$$typeof:Yj,render:e}};en.isValidElement=zb;en.lazy=function(e){return{$$typeof:eN,_payload:{_status:-1,_result:e},_init:iN}};en.memo=function(e,t){return{$$typeof:Qj,type:e,compare:t===void 0?null:t}};en.startTransition=function(e){var t=Qg.transition;Qg.transition={};try{e()}finally{Qg.transition=t}};en.unstable_act=CC;en.useCallback=function(e,t){return zi.current.useCallback(e,t)};en.useContext=function(e){return zi.current.useContext(e)};en.useDebugValue=function(){};en.useDeferredValue=function(e){return zi.current.useDeferredValue(e)};en.useEffect=function(e,t){return zi.current.useEffect(e,t)};en.useId=function(){return zi.current.useId()};en.useImperativeHandle=function(e,t,i){return zi.current.useImperativeHandle(e,t,i)};en.useInsertionEffect=function(e,t){return zi.current.useInsertionEffect(e,t)};en.useLayoutEffect=function(e,t){return zi.current.useLayoutEffect(e,t)};en.useMemo=function(e,t){return zi.current.useMemo(e,t)};en.useReducer=function(e,t,i){return zi.current.useReducer(e,t,i)};en.useRef=function(e){return zi.current.useRef(e)};en.useState=function(e){return zi.current.useState(e)};en.useSyncExternalStore=function(e,t,i){return zi.current.useSyncExternalStore(e,t,i)};en.useTransition=function(){return zi.current.useTransition()};en.version="18.3.1";vC.exports=en;var ze=vC.exports;const Ue=yC(ze),aN=$j({__proto__:null,default:Ue},[ze]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oN=ze,lN=Symbol.for("react.element"),cN=Symbol.for("react.fragment"),uN=Object.prototype.hasOwnProperty,hN=oN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dN={key:!0,ref:!0,__self:!0,__source:!0};function kC(e,t,i){var o,h={},m=null,f=null;i!==void 0&&(m=""+i),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(f=t.ref);for(o in t)uN.call(t,o)&&!dN.hasOwnProperty(o)&&(h[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps,t)h[o]===void 0&&(h[o]=t[o]);return{$$typeof:lN,type:e,key:m,ref:f,props:h,_owner:hN.current}}t_.Fragment=cN;t_.jsx=kC;t_.jsxs=kC;_C.exports=t_;var S=_C.exports,AC={exports:{}},bs={},IC={exports:{}},MC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ye,Pe){var at=Ye.length;Ye.push(Pe);e:for(;0<at;){var mt=at-1>>>1,Pt=Ye[mt];if(0<h(Pt,Pe))Ye[mt]=Pe,Ye[at]=Pt,at=mt;else break e}}function i(Ye){return Ye.length===0?null:Ye[0]}function o(Ye){if(Ye.length===0)return null;var Pe=Ye[0],at=Ye.pop();if(at!==Pe){Ye[0]=at;e:for(var mt=0,Pt=Ye.length,sn=Pt>>>1;mt<sn;){var an=2*(mt+1)-1,tn=Ye[an],fn=an+1,Yn=Ye[fn];if(0>h(tn,at))fn<Pt&&0>h(Yn,tn)?(Ye[mt]=Yn,Ye[fn]=at,mt=fn):(Ye[mt]=tn,Ye[an]=at,mt=an);else if(fn<Pt&&0>h(Yn,at))Ye[mt]=Yn,Ye[fn]=at,mt=fn;else break e}}return Pe}function h(Ye,Pe){var at=Ye.sortIndex-Pe.sortIndex;return at!==0?at:Ye.id-Pe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;e.unstable_now=function(){return m.now()}}else{var f=Date,c=f.now();e.unstable_now=function(){return f.now()-c}}var E=[],C=[],R=1,L=null,B=3,X=!1,W=!1,te=!1,G=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(Ye){for(var Pe=i(C);Pe!==null;){if(Pe.callback===null)o(C);else if(Pe.startTime<=Ye)o(C),Pe.sortIndex=Pe.expirationTime,t(E,Pe);else break;Pe=i(C)}}function le(Ye){if(te=!1,Q(Ye),!W)if(i(E)!==null)W=!0,wt(ve);else{var Pe=i(C);Pe!==null&&bt(le,Pe.startTime-Ye)}}function ve(Ye,Pe){W=!1,te&&(te=!1,J(we),we=-1),X=!0;var at=B;try{for(Q(Pe),L=i(E);L!==null&&(!(L.expirationTime>Pe)||Ye&&!ft());){var mt=L.callback;if(typeof mt=="function"){L.callback=null,B=L.priorityLevel;var Pt=mt(L.expirationTime<=Pe);Pe=e.unstable_now(),typeof Pt=="function"?L.callback=Pt:L===i(E)&&o(E),Q(Pe)}else o(E);L=i(E)}if(L!==null)var sn=!0;else{var an=i(C);an!==null&&bt(le,an.startTime-Pe),sn=!1}return sn}finally{L=null,B=at,X=!1}}var Ee=!1,_e=null,we=-1,Ge=5,Je=-1;function ft(){return!(e.unstable_now()-Je<Ge)}function At(){if(_e!==null){var Ye=e.unstable_now();Je=Ye;var Pe=!0;try{Pe=_e(!0,Ye)}finally{Pe?kt():(Ee=!1,_e=null)}}else Ee=!1}var kt;if(typeof H=="function")kt=function(){H(At)};else if(typeof MessageChannel<"u"){var gt=new MessageChannel,We=gt.port2;gt.port1.onmessage=At,kt=function(){We.postMessage(null)}}else kt=function(){G(At,0)};function wt(Ye){_e=Ye,Ee||(Ee=!0,kt())}function bt(Ye,Pe){we=G(function(){Ye(e.unstable_now())},Pe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ye){Ye.callback=null},e.unstable_continueExecution=function(){W||X||(W=!0,wt(ve))},e.unstable_forceFrameRate=function(Ye){0>Ye||125<Ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ge=0<Ye?Math.floor(1e3/Ye):5},e.unstable_getCurrentPriorityLevel=function(){return B},e.unstable_getFirstCallbackNode=function(){return i(E)},e.unstable_next=function(Ye){switch(B){case 1:case 2:case 3:var Pe=3;break;default:Pe=B}var at=B;B=Pe;try{return Ye()}finally{B=at}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ye,Pe){switch(Ye){case 1:case 2:case 3:case 4:case 5:break;default:Ye=3}var at=B;B=Ye;try{return Pe()}finally{B=at}},e.unstable_scheduleCallback=function(Ye,Pe,at){var mt=e.unstable_now();switch(typeof at=="object"&&at!==null?(at=at.delay,at=typeof at=="number"&&0<at?mt+at:mt):at=mt,Ye){case 1:var Pt=-1;break;case 2:Pt=250;break;case 5:Pt=1073741823;break;case 4:Pt=1e4;break;default:Pt=5e3}return Pt=at+Pt,Ye={id:R++,callback:Pe,priorityLevel:Ye,startTime:at,expirationTime:Pt,sortIndex:-1},at>mt?(Ye.sortIndex=at,t(C,Ye),i(E)===null&&Ye===i(C)&&(te?(J(we),we=-1):te=!0,bt(le,at-mt))):(Ye.sortIndex=Pt,t(E,Ye),W||X||(W=!0,wt(ve))),Ye},e.unstable_shouldYield=ft,e.unstable_wrapCallback=function(Ye){var Pe=B;return function(){var at=B;B=Pe;try{return Ye.apply(this,arguments)}finally{B=at}}}})(MC);IC.exports=MC;var pN=IC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fN=ze,_s=pN;function st(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var RC=new Set,nf={};function Hc(e,t){Vh(e,t),Vh(e+"Capture",t)}function Vh(e,t){for(nf[e]=t,e=0;e<t.length;e++)RC.add(t[e])}var oo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ax=Object.prototype.hasOwnProperty,mN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,OT={},FT={};function gN(e){return ax.call(FT,e)?!0:ax.call(OT,e)?!1:mN.test(e)?FT[e]=!0:(OT[e]=!0,!1)}function yN(e,t,i,o){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return o?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function _N(e,t,i,o){if(t===null||typeof t>"u"||yN(e,t,i,o))return!0;if(o)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Oi(e,t,i,o,h,m,f){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=o,this.attributeNamespace=h,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=m,this.removeEmptyString=f}var fi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){fi[e]=new Oi(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];fi[t]=new Oi(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){fi[e]=new Oi(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){fi[e]=new Oi(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){fi[e]=new Oi(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){fi[e]=new Oi(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){fi[e]=new Oi(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){fi[e]=new Oi(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){fi[e]=new Oi(e,5,!1,e.toLowerCase(),null,!1,!1)});var Ob=/[\-:]([a-z])/g;function Fb(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Ob,Fb);fi[t]=new Oi(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Ob,Fb);fi[t]=new Oi(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Ob,Fb);fi[t]=new Oi(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){fi[e]=new Oi(e,1,!1,e.toLowerCase(),null,!1,!1)});fi.xlinkHref=new Oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){fi[e]=new Oi(e,1,!1,e.toLowerCase(),null,!0,!0)});function Bb(e,t,i,o){var h=fi.hasOwnProperty(t)?fi[t]:null;(h!==null?h.type!==0:o||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(_N(t,i,h,o)&&(i=null),o||h===null?gN(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):h.mustUseProperty?e[h.propertyName]=i===null?h.type===3?!1:"":i:(t=h.attributeName,o=h.attributeNamespace,i===null?e.removeAttribute(t):(h=h.type,i=h===3||h===4&&i===!0?"":""+i,o?e.setAttributeNS(o,t,i):e.setAttribute(t,i))))}var po=fN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sg=Symbol.for("react.element"),gh=Symbol.for("react.portal"),yh=Symbol.for("react.fragment"),Vb=Symbol.for("react.strict_mode"),ox=Symbol.for("react.profiler"),DC=Symbol.for("react.provider"),jC=Symbol.for("react.context"),Ub=Symbol.for("react.forward_ref"),lx=Symbol.for("react.suspense"),cx=Symbol.for("react.suspense_list"),$b=Symbol.for("react.memo"),Yo=Symbol.for("react.lazy"),NC=Symbol.for("react.offscreen"),BT=Symbol.iterator;function Sp(e){return e===null||typeof e!="object"?null:(e=BT&&e[BT]||e["@@iterator"],typeof e=="function"?e:null)}var hr=Object.assign,i0;function Dp(e){if(i0===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);i0=t&&t[1]||""}return`
`+i0+e}var s0=!1;function a0(e,t){if(!e||s0)return"";s0=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(C){var o=C}Reflect.construct(e,[],t)}else{try{t.call()}catch(C){o=C}e.call(t.prototype)}else{try{throw Error()}catch(C){o=C}e()}}catch(C){if(C&&o&&typeof C.stack=="string"){for(var h=C.stack.split(`
`),m=o.stack.split(`
`),f=h.length-1,c=m.length-1;1<=f&&0<=c&&h[f]!==m[c];)c--;for(;1<=f&&0<=c;f--,c--)if(h[f]!==m[c]){if(f!==1||c!==1)do if(f--,c--,0>c||h[f]!==m[c]){var E=`
`+h[f].replace(" at new "," at ");return e.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",e.displayName)),E}while(1<=f&&0<=c);break}}}finally{s0=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?Dp(e):""}function vN(e){switch(e.tag){case 5:return Dp(e.type);case 16:return Dp("Lazy");case 13:return Dp("Suspense");case 19:return Dp("SuspenseList");case 0:case 2:case 15:return e=a0(e.type,!1),e;case 11:return e=a0(e.type.render,!1),e;case 1:return e=a0(e.type,!0),e;default:return""}}function ux(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case yh:return"Fragment";case gh:return"Portal";case ox:return"Profiler";case Vb:return"StrictMode";case lx:return"Suspense";case cx:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case jC:return(e.displayName||"Context")+".Consumer";case DC:return(e._context.displayName||"Context")+".Provider";case Ub:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case $b:return t=e.displayName||null,t!==null?t:ux(e.type)||"Memo";case Yo:t=e._payload,e=e._init;try{return ux(e(t))}catch{}}return null}function xN(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ux(t);case 8:return t===Vb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function gl(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function LC(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function bN(e){var t=LC(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var h=i.get,m=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return h.call(this)},set:function(f){o=""+f,m.call(this,f)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(f){o=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Tg(e){e._valueTracker||(e._valueTracker=bN(e))}function zC(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),o="";return e&&(o=LC(e)?e.checked?"true":"false":e.value),e=o,e!==i?(t.setValue(e),!0):!1}function yy(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function hx(e,t){var i=t.checked;return hr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function VT(e,t){var i=t.defaultValue==null?"":t.defaultValue,o=t.checked!=null?t.checked:t.defaultChecked;i=gl(t.value!=null?t.value:i),e._wrapperState={initialChecked:o,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function OC(e,t){t=t.checked,t!=null&&Bb(e,"checked",t,!1)}function dx(e,t){OC(e,t);var i=gl(t.value),o=t.type;if(i!=null)o==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?px(e,t.type,i):t.hasOwnProperty("defaultValue")&&px(e,t.type,gl(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function UT(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var o=t.type;if(!(o!=="submit"&&o!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function px(e,t,i){(t!=="number"||yy(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var jp=Array.isArray;function jh(e,t,i,o){if(e=e.options,t){t={};for(var h=0;h<i.length;h++)t["$"+i[h]]=!0;for(i=0;i<e.length;i++)h=t.hasOwnProperty("$"+e[i].value),e[i].selected!==h&&(e[i].selected=h),h&&o&&(e[i].defaultSelected=!0)}else{for(i=""+gl(i),t=null,h=0;h<e.length;h++){if(e[h].value===i){e[h].selected=!0,o&&(e[h].defaultSelected=!0);return}t!==null||e[h].disabled||(t=e[h])}t!==null&&(t.selected=!0)}}function fx(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(st(91));return hr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function $T(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(st(92));if(jp(i)){if(1<i.length)throw Error(st(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:gl(i)}}function FC(e,t){var i=gl(t.value),o=gl(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),o!=null&&(e.defaultValue=""+o)}function GT(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function BC(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mx(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?BC(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Eg,VC=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,o,h){MSApp.execUnsafeLocalFunction(function(){return e(t,i,o,h)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Eg=Eg||document.createElement("div"),Eg.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Eg.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function rf(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Vp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wN=["Webkit","ms","Moz","O"];Object.keys(Vp).forEach(function(e){wN.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Vp[t]=Vp[e]})});function UC(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||Vp.hasOwnProperty(e)&&Vp[e]?(""+t).trim():t+"px"}function $C(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var o=i.indexOf("--")===0,h=UC(i,t[i],o);i==="float"&&(i="cssFloat"),o?e.setProperty(i,h):e[i]=h}}var SN=hr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gx(e,t){if(t){if(SN[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(st(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(st(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(st(61))}if(t.style!=null&&typeof t.style!="object")throw Error(st(62))}}function yx(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _x=null;function Gb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var vx=null,Nh=null,Lh=null;function qT(e){if(e=Lf(e)){if(typeof vx!="function")throw Error(st(280));var t=e.stateNode;t&&(t=a_(t),vx(e.stateNode,e.type,t))}}function GC(e){Nh?Lh?Lh.push(e):Lh=[e]:Nh=e}function qC(){if(Nh){var e=Nh,t=Lh;if(Lh=Nh=null,qT(e),t)for(e=0;e<t.length;e++)qT(t[e])}}function WC(e,t){return e(t)}function ZC(){}var o0=!1;function HC(e,t,i){if(o0)return e(t,i);o0=!0;try{return WC(e,t,i)}finally{o0=!1,(Nh!==null||Lh!==null)&&(ZC(),qC())}}function sf(e,t){var i=e.stateNode;if(i===null)return null;var o=a_(i);if(o===null)return null;i=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(st(231,t,typeof i));return i}var xx=!1;if(oo)try{var Tp={};Object.defineProperty(Tp,"passive",{get:function(){xx=!0}}),window.addEventListener("test",Tp,Tp),window.removeEventListener("test",Tp,Tp)}catch{xx=!1}function TN(e,t,i,o,h,m,f,c,E){var C=Array.prototype.slice.call(arguments,3);try{t.apply(i,C)}catch(R){this.onError(R)}}var Up=!1,_y=null,vy=!1,bx=null,EN={onError:function(e){Up=!0,_y=e}};function PN(e,t,i,o,h,m,f,c,E){Up=!1,_y=null,TN.apply(EN,arguments)}function CN(e,t,i,o,h,m,f,c,E){if(PN.apply(this,arguments),Up){if(Up){var C=_y;Up=!1,_y=null}else throw Error(st(198));vy||(vy=!0,bx=C)}}function Kc(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function KC(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function WT(e){if(Kc(e)!==e)throw Error(st(188))}function kN(e){var t=e.alternate;if(!t){if(t=Kc(e),t===null)throw Error(st(188));return t!==e?null:e}for(var i=e,o=t;;){var h=i.return;if(h===null)break;var m=h.alternate;if(m===null){if(o=h.return,o!==null){i=o;continue}break}if(h.child===m.child){for(m=h.child;m;){if(m===i)return WT(h),e;if(m===o)return WT(h),t;m=m.sibling}throw Error(st(188))}if(i.return!==o.return)i=h,o=m;else{for(var f=!1,c=h.child;c;){if(c===i){f=!0,i=h,o=m;break}if(c===o){f=!0,o=h,i=m;break}c=c.sibling}if(!f){for(c=m.child;c;){if(c===i){f=!0,i=m,o=h;break}if(c===o){f=!0,o=m,i=h;break}c=c.sibling}if(!f)throw Error(st(189))}}if(i.alternate!==o)throw Error(st(190))}if(i.tag!==3)throw Error(st(188));return i.stateNode.current===i?e:t}function XC(e){return e=kN(e),e!==null?YC(e):null}function YC(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=YC(e);if(t!==null)return t;e=e.sibling}return null}var JC=_s.unstable_scheduleCallback,ZT=_s.unstable_cancelCallback,AN=_s.unstable_shouldYield,IN=_s.unstable_requestPaint,Sr=_s.unstable_now,MN=_s.unstable_getCurrentPriorityLevel,qb=_s.unstable_ImmediatePriority,QC=_s.unstable_UserBlockingPriority,xy=_s.unstable_NormalPriority,RN=_s.unstable_LowPriority,ek=_s.unstable_IdlePriority,n_=null,Sa=null;function DN(e){if(Sa&&typeof Sa.onCommitFiberRoot=="function")try{Sa.onCommitFiberRoot(n_,e,void 0,(e.current.flags&128)===128)}catch{}}var ta=Math.clz32?Math.clz32:LN,jN=Math.log,NN=Math.LN2;function LN(e){return e>>>=0,e===0?32:31-(jN(e)/NN|0)|0}var Pg=64,Cg=4194304;function Np(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function by(e,t){var i=e.pendingLanes;if(i===0)return 0;var o=0,h=e.suspendedLanes,m=e.pingedLanes,f=i&268435455;if(f!==0){var c=f&~h;c!==0?o=Np(c):(m&=f,m!==0&&(o=Np(m)))}else f=i&~h,f!==0?o=Np(f):m!==0&&(o=Np(m));if(o===0)return 0;if(t!==0&&t!==o&&!(t&h)&&(h=o&-o,m=t&-t,h>=m||h===16&&(m&4194240)!==0))return t;if(o&4&&(o|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=o;0<t;)i=31-ta(t),h=1<<i,o|=e[i],t&=~h;return o}function zN(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ON(e,t){for(var i=e.suspendedLanes,o=e.pingedLanes,h=e.expirationTimes,m=e.pendingLanes;0<m;){var f=31-ta(m),c=1<<f,E=h[f];E===-1?(!(c&i)||c&o)&&(h[f]=zN(c,t)):E<=t&&(e.expiredLanes|=c),m&=~c}}function wx(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tk(){var e=Pg;return Pg<<=1,!(Pg&4194240)&&(Pg=64),e}function l0(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function jf(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ta(t),e[t]=i}function FN(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<i;){var h=31-ta(i),m=1<<h;t[h]=0,o[h]=-1,e[h]=-1,i&=~m}}function Wb(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var o=31-ta(i),h=1<<o;h&t|e[o]&t&&(e[o]|=t),i&=~h}}var En=0;function nk(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var rk,Zb,ik,sk,ak,Sx=!1,kg=[],ol=null,ll=null,cl=null,af=new Map,of=new Map,el=[],BN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function HT(e,t){switch(e){case"focusin":case"focusout":ol=null;break;case"dragenter":case"dragleave":ll=null;break;case"mouseover":case"mouseout":cl=null;break;case"pointerover":case"pointerout":af.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":of.delete(t.pointerId)}}function Ep(e,t,i,o,h,m){return e===null||e.nativeEvent!==m?(e={blockedOn:t,domEventName:i,eventSystemFlags:o,nativeEvent:m,targetContainers:[h]},t!==null&&(t=Lf(t),t!==null&&Zb(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,h!==null&&t.indexOf(h)===-1&&t.push(h),e)}function VN(e,t,i,o,h){switch(t){case"focusin":return ol=Ep(ol,e,t,i,o,h),!0;case"dragenter":return ll=Ep(ll,e,t,i,o,h),!0;case"mouseover":return cl=Ep(cl,e,t,i,o,h),!0;case"pointerover":var m=h.pointerId;return af.set(m,Ep(af.get(m)||null,e,t,i,o,h)),!0;case"gotpointercapture":return m=h.pointerId,of.set(m,Ep(of.get(m)||null,e,t,i,o,h)),!0}return!1}function ok(e){var t=Rc(e.target);if(t!==null){var i=Kc(t);if(i!==null){if(t=i.tag,t===13){if(t=KC(i),t!==null){e.blockedOn=t,ak(e.priority,function(){ik(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ey(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=Tx(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);_x=o,i.target.dispatchEvent(o),_x=null}else return t=Lf(i),t!==null&&Zb(t),e.blockedOn=i,!1;t.shift()}return!0}function KT(e,t,i){ey(e)&&i.delete(t)}function UN(){Sx=!1,ol!==null&&ey(ol)&&(ol=null),ll!==null&&ey(ll)&&(ll=null),cl!==null&&ey(cl)&&(cl=null),af.forEach(KT),of.forEach(KT)}function Pp(e,t){e.blockedOn===t&&(e.blockedOn=null,Sx||(Sx=!0,_s.unstable_scheduleCallback(_s.unstable_NormalPriority,UN)))}function lf(e){function t(h){return Pp(h,e)}if(0<kg.length){Pp(kg[0],e);for(var i=1;i<kg.length;i++){var o=kg[i];o.blockedOn===e&&(o.blockedOn=null)}}for(ol!==null&&Pp(ol,e),ll!==null&&Pp(ll,e),cl!==null&&Pp(cl,e),af.forEach(t),of.forEach(t),i=0;i<el.length;i++)o=el[i],o.blockedOn===e&&(o.blockedOn=null);for(;0<el.length&&(i=el[0],i.blockedOn===null);)ok(i),i.blockedOn===null&&el.shift()}var zh=po.ReactCurrentBatchConfig,wy=!0;function $N(e,t,i,o){var h=En,m=zh.transition;zh.transition=null;try{En=1,Hb(e,t,i,o)}finally{En=h,zh.transition=m}}function GN(e,t,i,o){var h=En,m=zh.transition;zh.transition=null;try{En=4,Hb(e,t,i,o)}finally{En=h,zh.transition=m}}function Hb(e,t,i,o){if(wy){var h=Tx(e,t,i,o);if(h===null)_0(e,t,o,Sy,i),HT(e,o);else if(VN(h,e,t,i,o))o.stopPropagation();else if(HT(e,o),t&4&&-1<BN.indexOf(e)){for(;h!==null;){var m=Lf(h);if(m!==null&&rk(m),m=Tx(e,t,i,o),m===null&&_0(e,t,o,Sy,i),m===h)break;h=m}h!==null&&o.stopPropagation()}else _0(e,t,o,null,i)}}var Sy=null;function Tx(e,t,i,o){if(Sy=null,e=Gb(o),e=Rc(e),e!==null)if(t=Kc(e),t===null)e=null;else if(i=t.tag,i===13){if(e=KC(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Sy=e,null}function lk(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MN()){case qb:return 1;case QC:return 4;case xy:case RN:return 16;case ek:return 536870912;default:return 16}default:return 16}}var rl=null,Kb=null,ty=null;function ck(){if(ty)return ty;var e,t=Kb,i=t.length,o,h="value"in rl?rl.value:rl.textContent,m=h.length;for(e=0;e<i&&t[e]===h[e];e++);var f=i-e;for(o=1;o<=f&&t[i-o]===h[m-o];o++);return ty=h.slice(e,1<o?1-o:void 0)}function ny(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ag(){return!0}function XT(){return!1}function ws(e){function t(i,o,h,m,f){this._reactName=i,this._targetInst=h,this.type=o,this.nativeEvent=m,this.target=f,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(i=e[c],this[c]=i?i(m):m[c]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Ag:XT,this.isPropagationStopped=XT,this}return hr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Ag)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Ag)},persist:function(){},isPersistent:Ag}),t}var ed={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xb=ws(ed),Nf=hr({},ed,{view:0,detail:0}),qN=ws(Nf),c0,u0,Cp,r_=hr({},Nf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yb,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Cp&&(Cp&&e.type==="mousemove"?(c0=e.screenX-Cp.screenX,u0=e.screenY-Cp.screenY):u0=c0=0,Cp=e),c0)},movementY:function(e){return"movementY"in e?e.movementY:u0}}),YT=ws(r_),WN=hr({},r_,{dataTransfer:0}),ZN=ws(WN),HN=hr({},Nf,{relatedTarget:0}),h0=ws(HN),KN=hr({},ed,{animationName:0,elapsedTime:0,pseudoElement:0}),XN=ws(KN),YN=hr({},ed,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),JN=ws(YN),QN=hr({},ed,{data:0}),JT=ws(QN),eL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rL(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=nL[e])?!!t[e]:!1}function Yb(){return rL}var iL=hr({},Nf,{key:function(e){if(e.key){var t=eL[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ny(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?tL[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yb,charCode:function(e){return e.type==="keypress"?ny(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ny(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),sL=ws(iL),aL=hr({},r_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),QT=ws(aL),oL=hr({},Nf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yb}),lL=ws(oL),cL=hr({},ed,{propertyName:0,elapsedTime:0,pseudoElement:0}),uL=ws(cL),hL=hr({},r_,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),dL=ws(hL),pL=[9,13,27,32],Jb=oo&&"CompositionEvent"in window,$p=null;oo&&"documentMode"in document&&($p=document.documentMode);var fL=oo&&"TextEvent"in window&&!$p,uk=oo&&(!Jb||$p&&8<$p&&11>=$p),e2=" ",t2=!1;function hk(e,t){switch(e){case"keyup":return pL.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dk(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var _h=!1;function mL(e,t){switch(e){case"compositionend":return dk(t);case"keypress":return t.which!==32?null:(t2=!0,e2);case"textInput":return e=t.data,e===e2&&t2?null:e;default:return null}}function gL(e,t){if(_h)return e==="compositionend"||!Jb&&hk(e,t)?(e=ck(),ty=Kb=rl=null,_h=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return uk&&t.locale!=="ko"?null:t.data;default:return null}}var yL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n2(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!yL[e.type]:t==="textarea"}function pk(e,t,i,o){GC(o),t=Ty(t,"onChange"),0<t.length&&(i=new Xb("onChange","change",null,i,o),e.push({event:i,listeners:t}))}var Gp=null,cf=null;function _L(e){Tk(e,0)}function i_(e){var t=bh(e);if(zC(t))return e}function vL(e,t){if(e==="change")return t}var fk=!1;if(oo){var d0;if(oo){var p0="oninput"in document;if(!p0){var r2=document.createElement("div");r2.setAttribute("oninput","return;"),p0=typeof r2.oninput=="function"}d0=p0}else d0=!1;fk=d0&&(!document.documentMode||9<document.documentMode)}function i2(){Gp&&(Gp.detachEvent("onpropertychange",mk),cf=Gp=null)}function mk(e){if(e.propertyName==="value"&&i_(cf)){var t=[];pk(t,cf,e,Gb(e)),HC(_L,t)}}function xL(e,t,i){e==="focusin"?(i2(),Gp=t,cf=i,Gp.attachEvent("onpropertychange",mk)):e==="focusout"&&i2()}function bL(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return i_(cf)}function wL(e,t){if(e==="click")return i_(t)}function SL(e,t){if(e==="input"||e==="change")return i_(t)}function TL(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ra=typeof Object.is=="function"?Object.is:TL;function uf(e,t){if(ra(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var h=i[o];if(!ax.call(t,h)||!ra(e[h],t[h]))return!1}return!0}function s2(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function a2(e,t){var i=s2(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=t&&o>=t)return{node:i,offset:t-e};e=o}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=s2(i)}}function gk(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?gk(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function yk(){for(var e=window,t=yy();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=yy(e.document)}return t}function Qb(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function EL(e){var t=yk(),i=e.focusedElem,o=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&gk(i.ownerDocument.documentElement,i)){if(o!==null&&Qb(i)){if(t=o.start,e=o.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var h=i.textContent.length,m=Math.min(o.start,h);o=o.end===void 0?m:Math.min(o.end,h),!e.extend&&m>o&&(h=o,o=m,m=h),h=a2(i,m);var f=a2(i,o);h&&f&&(e.rangeCount!==1||e.anchorNode!==h.node||e.anchorOffset!==h.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(t=t.createRange(),t.setStart(h.node,h.offset),e.removeAllRanges(),m>o?(e.addRange(t),e.extend(f.node,f.offset)):(t.setEnd(f.node,f.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var PL=oo&&"documentMode"in document&&11>=document.documentMode,vh=null,Ex=null,qp=null,Px=!1;function o2(e,t,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Px||vh==null||vh!==yy(o)||(o=vh,"selectionStart"in o&&Qb(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),qp&&uf(qp,o)||(qp=o,o=Ty(Ex,"onSelect"),0<o.length&&(t=new Xb("onSelect","select",null,t,i),e.push({event:t,listeners:o}),t.target=vh)))}function Ig(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var xh={animationend:Ig("Animation","AnimationEnd"),animationiteration:Ig("Animation","AnimationIteration"),animationstart:Ig("Animation","AnimationStart"),transitionend:Ig("Transition","TransitionEnd")},f0={},_k={};oo&&(_k=document.createElement("div").style,"AnimationEvent"in window||(delete xh.animationend.animation,delete xh.animationiteration.animation,delete xh.animationstart.animation),"TransitionEvent"in window||delete xh.transitionend.transition);function s_(e){if(f0[e])return f0[e];if(!xh[e])return e;var t=xh[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in _k)return f0[e]=t[i];return e}var vk=s_("animationend"),xk=s_("animationiteration"),bk=s_("animationstart"),wk=s_("transitionend"),Sk=new Map,l2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xl(e,t){Sk.set(e,t),Hc(t,[e])}for(var m0=0;m0<l2.length;m0++){var g0=l2[m0],CL=g0.toLowerCase(),kL=g0[0].toUpperCase()+g0.slice(1);xl(CL,"on"+kL)}xl(vk,"onAnimationEnd");xl(xk,"onAnimationIteration");xl(bk,"onAnimationStart");xl("dblclick","onDoubleClick");xl("focusin","onFocus");xl("focusout","onBlur");xl(wk,"onTransitionEnd");Vh("onMouseEnter",["mouseout","mouseover"]);Vh("onMouseLeave",["mouseout","mouseover"]);Vh("onPointerEnter",["pointerout","pointerover"]);Vh("onPointerLeave",["pointerout","pointerover"]);Hc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lp));function c2(e,t,i){var o=e.type||"unknown-event";e.currentTarget=i,CN(o,t,void 0,e),e.currentTarget=null}function Tk(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],h=o.event;o=o.listeners;e:{var m=void 0;if(t)for(var f=o.length-1;0<=f;f--){var c=o[f],E=c.instance,C=c.currentTarget;if(c=c.listener,E!==m&&h.isPropagationStopped())break e;c2(h,c,C),m=E}else for(f=0;f<o.length;f++){if(c=o[f],E=c.instance,C=c.currentTarget,c=c.listener,E!==m&&h.isPropagationStopped())break e;c2(h,c,C),m=E}}}if(vy)throw e=bx,vy=!1,bx=null,e}function Hn(e,t){var i=t[Mx];i===void 0&&(i=t[Mx]=new Set);var o=e+"__bubble";i.has(o)||(Ek(t,e,2,!1),i.add(o))}function y0(e,t,i){var o=0;t&&(o|=4),Ek(i,e,o,t)}var Mg="_reactListening"+Math.random().toString(36).slice(2);function hf(e){if(!e[Mg]){e[Mg]=!0,RC.forEach(function(i){i!=="selectionchange"&&(AL.has(i)||y0(i,!1,e),y0(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Mg]||(t[Mg]=!0,y0("selectionchange",!1,t))}}function Ek(e,t,i,o){switch(lk(t)){case 1:var h=$N;break;case 4:h=GN;break;default:h=Hb}i=h.bind(null,t,i,e),h=void 0,!xx||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(h=!0),o?h!==void 0?e.addEventListener(t,i,{capture:!0,passive:h}):e.addEventListener(t,i,!0):h!==void 0?e.addEventListener(t,i,{passive:h}):e.addEventListener(t,i,!1)}function _0(e,t,i,o,h){var m=o;if(!(t&1)&&!(t&2)&&o!==null)e:for(;;){if(o===null)return;var f=o.tag;if(f===3||f===4){var c=o.stateNode.containerInfo;if(c===h||c.nodeType===8&&c.parentNode===h)break;if(f===4)for(f=o.return;f!==null;){var E=f.tag;if((E===3||E===4)&&(E=f.stateNode.containerInfo,E===h||E.nodeType===8&&E.parentNode===h))return;f=f.return}for(;c!==null;){if(f=Rc(c),f===null)return;if(E=f.tag,E===5||E===6){o=m=f;continue e}c=c.parentNode}}o=o.return}HC(function(){var C=m,R=Gb(i),L=[];e:{var B=Sk.get(e);if(B!==void 0){var X=Xb,W=e;switch(e){case"keypress":if(ny(i)===0)break e;case"keydown":case"keyup":X=sL;break;case"focusin":W="focus",X=h0;break;case"focusout":W="blur",X=h0;break;case"beforeblur":case"afterblur":X=h0;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=YT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=ZN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=lL;break;case vk:case xk:case bk:X=XN;break;case wk:X=uL;break;case"scroll":X=qN;break;case"wheel":X=dL;break;case"copy":case"cut":case"paste":X=JN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=QT}var te=(t&4)!==0,G=!te&&e==="scroll",J=te?B!==null?B+"Capture":null:B;te=[];for(var H=C,Q;H!==null;){Q=H;var le=Q.stateNode;if(Q.tag===5&&le!==null&&(Q=le,J!==null&&(le=sf(H,J),le!=null&&te.push(df(H,le,Q)))),G)break;H=H.return}0<te.length&&(B=new X(B,W,null,i,R),L.push({event:B,listeners:te}))}}if(!(t&7)){e:{if(B=e==="mouseover"||e==="pointerover",X=e==="mouseout"||e==="pointerout",B&&i!==_x&&(W=i.relatedTarget||i.fromElement)&&(Rc(W)||W[lo]))break e;if((X||B)&&(B=R.window===R?R:(B=R.ownerDocument)?B.defaultView||B.parentWindow:window,X?(W=i.relatedTarget||i.toElement,X=C,W=W?Rc(W):null,W!==null&&(G=Kc(W),W!==G||W.tag!==5&&W.tag!==6)&&(W=null)):(X=null,W=C),X!==W)){if(te=YT,le="onMouseLeave",J="onMouseEnter",H="mouse",(e==="pointerout"||e==="pointerover")&&(te=QT,le="onPointerLeave",J="onPointerEnter",H="pointer"),G=X==null?B:bh(X),Q=W==null?B:bh(W),B=new te(le,H+"leave",X,i,R),B.target=G,B.relatedTarget=Q,le=null,Rc(R)===C&&(te=new te(J,H+"enter",W,i,R),te.target=Q,te.relatedTarget=G,le=te),G=le,X&&W)t:{for(te=X,J=W,H=0,Q=te;Q;Q=sh(Q))H++;for(Q=0,le=J;le;le=sh(le))Q++;for(;0<H-Q;)te=sh(te),H--;for(;0<Q-H;)J=sh(J),Q--;for(;H--;){if(te===J||J!==null&&te===J.alternate)break t;te=sh(te),J=sh(J)}te=null}else te=null;X!==null&&u2(L,B,X,te,!1),W!==null&&G!==null&&u2(L,G,W,te,!0)}}e:{if(B=C?bh(C):window,X=B.nodeName&&B.nodeName.toLowerCase(),X==="select"||X==="input"&&B.type==="file")var ve=vL;else if(n2(B))if(fk)ve=SL;else{ve=bL;var Ee=xL}else(X=B.nodeName)&&X.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(ve=wL);if(ve&&(ve=ve(e,C))){pk(L,ve,i,R);break e}Ee&&Ee(e,B,C),e==="focusout"&&(Ee=B._wrapperState)&&Ee.controlled&&B.type==="number"&&px(B,"number",B.value)}switch(Ee=C?bh(C):window,e){case"focusin":(n2(Ee)||Ee.contentEditable==="true")&&(vh=Ee,Ex=C,qp=null);break;case"focusout":qp=Ex=vh=null;break;case"mousedown":Px=!0;break;case"contextmenu":case"mouseup":case"dragend":Px=!1,o2(L,i,R);break;case"selectionchange":if(PL)break;case"keydown":case"keyup":o2(L,i,R)}var _e;if(Jb)e:{switch(e){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else _h?hk(e,i)&&(we="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(we="onCompositionStart");we&&(uk&&i.locale!=="ko"&&(_h||we!=="onCompositionStart"?we==="onCompositionEnd"&&_h&&(_e=ck()):(rl=R,Kb="value"in rl?rl.value:rl.textContent,_h=!0)),Ee=Ty(C,we),0<Ee.length&&(we=new JT(we,e,null,i,R),L.push({event:we,listeners:Ee}),_e?we.data=_e:(_e=dk(i),_e!==null&&(we.data=_e)))),(_e=fL?mL(e,i):gL(e,i))&&(C=Ty(C,"onBeforeInput"),0<C.length&&(R=new JT("onBeforeInput","beforeinput",null,i,R),L.push({event:R,listeners:C}),R.data=_e))}Tk(L,t)})}function df(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Ty(e,t){for(var i=t+"Capture",o=[];e!==null;){var h=e,m=h.stateNode;h.tag===5&&m!==null&&(h=m,m=sf(e,i),m!=null&&o.unshift(df(e,m,h)),m=sf(e,t),m!=null&&o.push(df(e,m,h))),e=e.return}return o}function sh(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function u2(e,t,i,o,h){for(var m=t._reactName,f=[];i!==null&&i!==o;){var c=i,E=c.alternate,C=c.stateNode;if(E!==null&&E===o)break;c.tag===5&&C!==null&&(c=C,h?(E=sf(i,m),E!=null&&f.unshift(df(i,E,c))):h||(E=sf(i,m),E!=null&&f.push(df(i,E,c)))),i=i.return}f.length!==0&&e.push({event:t,listeners:f})}var IL=/\r\n?/g,ML=/\u0000|\uFFFD/g;function h2(e){return(typeof e=="string"?e:""+e).replace(IL,`
`).replace(ML,"")}function Rg(e,t,i){if(t=h2(t),h2(e)!==t&&i)throw Error(st(425))}function Ey(){}var Cx=null,kx=null;function Ax(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ix=typeof setTimeout=="function"?setTimeout:void 0,RL=typeof clearTimeout=="function"?clearTimeout:void 0,d2=typeof Promise=="function"?Promise:void 0,DL=typeof queueMicrotask=="function"?queueMicrotask:typeof d2<"u"?function(e){return d2.resolve(null).then(e).catch(jL)}:Ix;function jL(e){setTimeout(function(){throw e})}function v0(e,t){var i=t,o=0;do{var h=i.nextSibling;if(e.removeChild(i),h&&h.nodeType===8)if(i=h.data,i==="/$"){if(o===0){e.removeChild(h),lf(t);return}o--}else i!=="$"&&i!=="$?"&&i!=="$!"||o++;i=h}while(i);lf(t)}function ul(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function p2(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var td=Math.random().toString(36).slice(2),wa="__reactFiber$"+td,pf="__reactProps$"+td,lo="__reactContainer$"+td,Mx="__reactEvents$"+td,NL="__reactListeners$"+td,LL="__reactHandles$"+td;function Rc(e){var t=e[wa];if(t)return t;for(var i=e.parentNode;i;){if(t=i[lo]||i[wa]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=p2(e);e!==null;){if(i=e[wa])return i;e=p2(e)}return t}e=i,i=e.parentNode}return null}function Lf(e){return e=e[wa]||e[lo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function bh(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(st(33))}function a_(e){return e[pf]||null}var Rx=[],wh=-1;function bl(e){return{current:e}}function Kn(e){0>wh||(e.current=Rx[wh],Rx[wh]=null,wh--)}function Vn(e,t){wh++,Rx[wh]=e.current,e.current=t}var yl={},Ci=bl(yl),Ki=bl(!1),Uc=yl;function Uh(e,t){var i=e.type.contextTypes;if(!i)return yl;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===t)return o.__reactInternalMemoizedMaskedChildContext;var h={},m;for(m in i)h[m]=t[m];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=h),h}function Xi(e){return e=e.childContextTypes,e!=null}function Py(){Kn(Ki),Kn(Ci)}function f2(e,t,i){if(Ci.current!==yl)throw Error(st(168));Vn(Ci,t),Vn(Ki,i)}function Pk(e,t,i){var o=e.stateNode;if(t=t.childContextTypes,typeof o.getChildContext!="function")return i;o=o.getChildContext();for(var h in o)if(!(h in t))throw Error(st(108,xN(e)||"Unknown",h));return hr({},i,o)}function Cy(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||yl,Uc=Ci.current,Vn(Ci,e),Vn(Ki,Ki.current),!0}function m2(e,t,i){var o=e.stateNode;if(!o)throw Error(st(169));i?(e=Pk(e,t,Uc),o.__reactInternalMemoizedMergedChildContext=e,Kn(Ki),Kn(Ci),Vn(Ci,e)):Kn(Ki),Vn(Ki,i)}var to=null,o_=!1,x0=!1;function Ck(e){to===null?to=[e]:to.push(e)}function zL(e){o_=!0,Ck(e)}function wl(){if(!x0&&to!==null){x0=!0;var e=0,t=En;try{var i=to;for(En=1;e<i.length;e++){var o=i[e];do o=o(!0);while(o!==null)}to=null,o_=!1}catch(h){throw to!==null&&(to=to.slice(e+1)),JC(qb,wl),h}finally{En=t,x0=!1}}return null}var Sh=[],Th=0,ky=null,Ay=0,Ms=[],Rs=0,$c=null,no=1,ro="";function Ec(e,t){Sh[Th++]=Ay,Sh[Th++]=ky,ky=e,Ay=t}function kk(e,t,i){Ms[Rs++]=no,Ms[Rs++]=ro,Ms[Rs++]=$c,$c=e;var o=no;e=ro;var h=32-ta(o)-1;o&=~(1<<h),i+=1;var m=32-ta(t)+h;if(30<m){var f=h-h%5;m=(o&(1<<f)-1).toString(32),o>>=f,h-=f,no=1<<32-ta(t)+h|i<<h|o,ro=m+e}else no=1<<m|i<<h|o,ro=e}function ew(e){e.return!==null&&(Ec(e,1),kk(e,1,0))}function tw(e){for(;e===ky;)ky=Sh[--Th],Sh[Th]=null,Ay=Sh[--Th],Sh[Th]=null;for(;e===$c;)$c=Ms[--Rs],Ms[Rs]=null,ro=Ms[--Rs],Ms[Rs]=null,no=Ms[--Rs],Ms[Rs]=null}var gs=null,ms=null,rr=!1,ea=null;function Ak(e,t){var i=Ds(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function g2(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,gs=e,ms=ul(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,gs=e,ms=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=$c!==null?{id:no,overflow:ro}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Ds(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,gs=e,ms=null,!0):!1;default:return!1}}function Dx(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jx(e){if(rr){var t=ms;if(t){var i=t;if(!g2(e,t)){if(Dx(e))throw Error(st(418));t=ul(i.nextSibling);var o=gs;t&&g2(e,t)?Ak(o,i):(e.flags=e.flags&-4097|2,rr=!1,gs=e)}}else{if(Dx(e))throw Error(st(418));e.flags=e.flags&-4097|2,rr=!1,gs=e}}}function y2(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;gs=e}function Dg(e){if(e!==gs)return!1;if(!rr)return y2(e),rr=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ax(e.type,e.memoizedProps)),t&&(t=ms)){if(Dx(e))throw Ik(),Error(st(418));for(;t;)Ak(e,t),t=ul(t.nextSibling)}if(y2(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(st(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){ms=ul(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}ms=null}}else ms=gs?ul(e.stateNode.nextSibling):null;return!0}function Ik(){for(var e=ms;e;)e=ul(e.nextSibling)}function $h(){ms=gs=null,rr=!1}function nw(e){ea===null?ea=[e]:ea.push(e)}var OL=po.ReactCurrentBatchConfig;function kp(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(st(309));var o=i.stateNode}if(!o)throw Error(st(147,e));var h=o,m=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===m?t.ref:(t=function(f){var c=h.refs;f===null?delete c[m]:c[m]=f},t._stringRef=m,t)}if(typeof e!="string")throw Error(st(284));if(!i._owner)throw Error(st(290,e))}return e}function jg(e,t){throw e=Object.prototype.toString.call(t),Error(st(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _2(e){var t=e._init;return t(e._payload)}function Mk(e){function t(J,H){if(e){var Q=J.deletions;Q===null?(J.deletions=[H],J.flags|=16):Q.push(H)}}function i(J,H){if(!e)return null;for(;H!==null;)t(J,H),H=H.sibling;return null}function o(J,H){for(J=new Map;H!==null;)H.key!==null?J.set(H.key,H):J.set(H.index,H),H=H.sibling;return J}function h(J,H){return J=fl(J,H),J.index=0,J.sibling=null,J}function m(J,H,Q){return J.index=Q,e?(Q=J.alternate,Q!==null?(Q=Q.index,Q<H?(J.flags|=2,H):Q):(J.flags|=2,H)):(J.flags|=1048576,H)}function f(J){return e&&J.alternate===null&&(J.flags|=2),J}function c(J,H,Q,le){return H===null||H.tag!==6?(H=C0(Q,J.mode,le),H.return=J,H):(H=h(H,Q),H.return=J,H)}function E(J,H,Q,le){var ve=Q.type;return ve===yh?R(J,H,Q.props.children,le,Q.key):H!==null&&(H.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===Yo&&_2(ve)===H.type)?(le=h(H,Q.props),le.ref=kp(J,H,Q),le.return=J,le):(le=cy(Q.type,Q.key,Q.props,null,J.mode,le),le.ref=kp(J,H,Q),le.return=J,le)}function C(J,H,Q,le){return H===null||H.tag!==4||H.stateNode.containerInfo!==Q.containerInfo||H.stateNode.implementation!==Q.implementation?(H=k0(Q,J.mode,le),H.return=J,H):(H=h(H,Q.children||[]),H.return=J,H)}function R(J,H,Q,le,ve){return H===null||H.tag!==7?(H=Fc(Q,J.mode,le,ve),H.return=J,H):(H=h(H,Q),H.return=J,H)}function L(J,H,Q){if(typeof H=="string"&&H!==""||typeof H=="number")return H=C0(""+H,J.mode,Q),H.return=J,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case Sg:return Q=cy(H.type,H.key,H.props,null,J.mode,Q),Q.ref=kp(J,null,H),Q.return=J,Q;case gh:return H=k0(H,J.mode,Q),H.return=J,H;case Yo:var le=H._init;return L(J,le(H._payload),Q)}if(jp(H)||Sp(H))return H=Fc(H,J.mode,Q,null),H.return=J,H;jg(J,H)}return null}function B(J,H,Q,le){var ve=H!==null?H.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return ve!==null?null:c(J,H,""+Q,le);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Sg:return Q.key===ve?E(J,H,Q,le):null;case gh:return Q.key===ve?C(J,H,Q,le):null;case Yo:return ve=Q._init,B(J,H,ve(Q._payload),le)}if(jp(Q)||Sp(Q))return ve!==null?null:R(J,H,Q,le,null);jg(J,Q)}return null}function X(J,H,Q,le,ve){if(typeof le=="string"&&le!==""||typeof le=="number")return J=J.get(Q)||null,c(H,J,""+le,ve);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Sg:return J=J.get(le.key===null?Q:le.key)||null,E(H,J,le,ve);case gh:return J=J.get(le.key===null?Q:le.key)||null,C(H,J,le,ve);case Yo:var Ee=le._init;return X(J,H,Q,Ee(le._payload),ve)}if(jp(le)||Sp(le))return J=J.get(Q)||null,R(H,J,le,ve,null);jg(H,le)}return null}function W(J,H,Q,le){for(var ve=null,Ee=null,_e=H,we=H=0,Ge=null;_e!==null&&we<Q.length;we++){_e.index>we?(Ge=_e,_e=null):Ge=_e.sibling;var Je=B(J,_e,Q[we],le);if(Je===null){_e===null&&(_e=Ge);break}e&&_e&&Je.alternate===null&&t(J,_e),H=m(Je,H,we),Ee===null?ve=Je:Ee.sibling=Je,Ee=Je,_e=Ge}if(we===Q.length)return i(J,_e),rr&&Ec(J,we),ve;if(_e===null){for(;we<Q.length;we++)_e=L(J,Q[we],le),_e!==null&&(H=m(_e,H,we),Ee===null?ve=_e:Ee.sibling=_e,Ee=_e);return rr&&Ec(J,we),ve}for(_e=o(J,_e);we<Q.length;we++)Ge=X(_e,J,we,Q[we],le),Ge!==null&&(e&&Ge.alternate!==null&&_e.delete(Ge.key===null?we:Ge.key),H=m(Ge,H,we),Ee===null?ve=Ge:Ee.sibling=Ge,Ee=Ge);return e&&_e.forEach(function(ft){return t(J,ft)}),rr&&Ec(J,we),ve}function te(J,H,Q,le){var ve=Sp(Q);if(typeof ve!="function")throw Error(st(150));if(Q=ve.call(Q),Q==null)throw Error(st(151));for(var Ee=ve=null,_e=H,we=H=0,Ge=null,Je=Q.next();_e!==null&&!Je.done;we++,Je=Q.next()){_e.index>we?(Ge=_e,_e=null):Ge=_e.sibling;var ft=B(J,_e,Je.value,le);if(ft===null){_e===null&&(_e=Ge);break}e&&_e&&ft.alternate===null&&t(J,_e),H=m(ft,H,we),Ee===null?ve=ft:Ee.sibling=ft,Ee=ft,_e=Ge}if(Je.done)return i(J,_e),rr&&Ec(J,we),ve;if(_e===null){for(;!Je.done;we++,Je=Q.next())Je=L(J,Je.value,le),Je!==null&&(H=m(Je,H,we),Ee===null?ve=Je:Ee.sibling=Je,Ee=Je);return rr&&Ec(J,we),ve}for(_e=o(J,_e);!Je.done;we++,Je=Q.next())Je=X(_e,J,we,Je.value,le),Je!==null&&(e&&Je.alternate!==null&&_e.delete(Je.key===null?we:Je.key),H=m(Je,H,we),Ee===null?ve=Je:Ee.sibling=Je,Ee=Je);return e&&_e.forEach(function(At){return t(J,At)}),rr&&Ec(J,we),ve}function G(J,H,Q,le){if(typeof Q=="object"&&Q!==null&&Q.type===yh&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Sg:e:{for(var ve=Q.key,Ee=H;Ee!==null;){if(Ee.key===ve){if(ve=Q.type,ve===yh){if(Ee.tag===7){i(J,Ee.sibling),H=h(Ee,Q.props.children),H.return=J,J=H;break e}}else if(Ee.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===Yo&&_2(ve)===Ee.type){i(J,Ee.sibling),H=h(Ee,Q.props),H.ref=kp(J,Ee,Q),H.return=J,J=H;break e}i(J,Ee);break}else t(J,Ee);Ee=Ee.sibling}Q.type===yh?(H=Fc(Q.props.children,J.mode,le,Q.key),H.return=J,J=H):(le=cy(Q.type,Q.key,Q.props,null,J.mode,le),le.ref=kp(J,H,Q),le.return=J,J=le)}return f(J);case gh:e:{for(Ee=Q.key;H!==null;){if(H.key===Ee)if(H.tag===4&&H.stateNode.containerInfo===Q.containerInfo&&H.stateNode.implementation===Q.implementation){i(J,H.sibling),H=h(H,Q.children||[]),H.return=J,J=H;break e}else{i(J,H);break}else t(J,H);H=H.sibling}H=k0(Q,J.mode,le),H.return=J,J=H}return f(J);case Yo:return Ee=Q._init,G(J,H,Ee(Q._payload),le)}if(jp(Q))return W(J,H,Q,le);if(Sp(Q))return te(J,H,Q,le);jg(J,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,H!==null&&H.tag===6?(i(J,H.sibling),H=h(H,Q),H.return=J,J=H):(i(J,H),H=C0(Q,J.mode,le),H.return=J,J=H),f(J)):i(J,H)}return G}var Gh=Mk(!0),Rk=Mk(!1),Iy=bl(null),My=null,Eh=null,rw=null;function iw(){rw=Eh=My=null}function sw(e){var t=Iy.current;Kn(Iy),e._currentValue=t}function Nx(e,t,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,o!==null&&(o.childLanes|=t)):o!==null&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===i)break;e=e.return}}function Oh(e,t){My=e,rw=Eh=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Hi=!0),e.firstContext=null)}function Ns(e){var t=e._currentValue;if(rw!==e)if(e={context:e,memoizedValue:t,next:null},Eh===null){if(My===null)throw Error(st(308));Eh=e,My.dependencies={lanes:0,firstContext:e}}else Eh=Eh.next=e;return t}var Dc=null;function aw(e){Dc===null?Dc=[e]:Dc.push(e)}function Dk(e,t,i,o){var h=t.interleaved;return h===null?(i.next=i,aw(t)):(i.next=h.next,h.next=i),t.interleaved=i,co(e,o)}function co(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Jo=!1;function ow(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jk(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function io(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function hl(e,t,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,cn&2){var h=o.pending;return h===null?t.next=t:(t.next=h.next,h.next=t),o.pending=t,co(e,i)}return h=o.interleaved,h===null?(t.next=t,aw(o)):(t.next=h.next,h.next=t),o.interleaved=t,co(e,i)}function ry(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var o=t.lanes;o&=e.pendingLanes,i|=o,t.lanes=i,Wb(e,i)}}function v2(e,t){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var h=null,m=null;if(i=i.firstBaseUpdate,i!==null){do{var f={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};m===null?h=m=f:m=m.next=f,i=i.next}while(i!==null);m===null?h=m=t:m=m.next=t}else h=m=t;i={baseState:o.baseState,firstBaseUpdate:h,lastBaseUpdate:m,shared:o.shared,effects:o.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Ry(e,t,i,o){var h=e.updateQueue;Jo=!1;var m=h.firstBaseUpdate,f=h.lastBaseUpdate,c=h.shared.pending;if(c!==null){h.shared.pending=null;var E=c,C=E.next;E.next=null,f===null?m=C:f.next=C,f=E;var R=e.alternate;R!==null&&(R=R.updateQueue,c=R.lastBaseUpdate,c!==f&&(c===null?R.firstBaseUpdate=C:c.next=C,R.lastBaseUpdate=E))}if(m!==null){var L=h.baseState;f=0,R=C=E=null,c=m;do{var B=c.lane,X=c.eventTime;if((o&B)===B){R!==null&&(R=R.next={eventTime:X,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var W=e,te=c;switch(B=t,X=i,te.tag){case 1:if(W=te.payload,typeof W=="function"){L=W.call(X,L,B);break e}L=W;break e;case 3:W.flags=W.flags&-65537|128;case 0:if(W=te.payload,B=typeof W=="function"?W.call(X,L,B):W,B==null)break e;L=hr({},L,B);break e;case 2:Jo=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,B=h.effects,B===null?h.effects=[c]:B.push(c))}else X={eventTime:X,lane:B,tag:c.tag,payload:c.payload,callback:c.callback,next:null},R===null?(C=R=X,E=L):R=R.next=X,f|=B;if(c=c.next,c===null){if(c=h.shared.pending,c===null)break;B=c,c=B.next,B.next=null,h.lastBaseUpdate=B,h.shared.pending=null}}while(!0);if(R===null&&(E=L),h.baseState=E,h.firstBaseUpdate=C,h.lastBaseUpdate=R,t=h.shared.interleaved,t!==null){h=t;do f|=h.lane,h=h.next;while(h!==t)}else m===null&&(h.shared.lanes=0);qc|=f,e.lanes=f,e.memoizedState=L}}function x2(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var o=e[t],h=o.callback;if(h!==null){if(o.callback=null,o=i,typeof h!="function")throw Error(st(191,h));h.call(o)}}}var zf={},Ta=bl(zf),ff=bl(zf),mf=bl(zf);function jc(e){if(e===zf)throw Error(st(174));return e}function lw(e,t){switch(Vn(mf,t),Vn(ff,e),Vn(Ta,zf),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:mx(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=mx(t,e)}Kn(Ta),Vn(Ta,t)}function qh(){Kn(Ta),Kn(ff),Kn(mf)}function Nk(e){jc(mf.current);var t=jc(Ta.current),i=mx(t,e.type);t!==i&&(Vn(ff,e),Vn(Ta,i))}function cw(e){ff.current===e&&(Kn(Ta),Kn(ff))}var lr=bl(0);function Dy(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var b0=[];function uw(){for(var e=0;e<b0.length;e++)b0[e]._workInProgressVersionPrimary=null;b0.length=0}var iy=po.ReactCurrentDispatcher,w0=po.ReactCurrentBatchConfig,Gc=0,ur=null,$r=null,Yr=null,jy=!1,Wp=!1,gf=0,FL=0;function bi(){throw Error(st(321))}function hw(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!ra(e[i],t[i]))return!1;return!0}function dw(e,t,i,o,h,m){if(Gc=m,ur=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,iy.current=e===null||e.memoizedState===null?$L:GL,e=i(o,h),Wp){m=0;do{if(Wp=!1,gf=0,25<=m)throw Error(st(301));m+=1,Yr=$r=null,t.updateQueue=null,iy.current=qL,e=i(o,h)}while(Wp)}if(iy.current=Ny,t=$r!==null&&$r.next!==null,Gc=0,Yr=$r=ur=null,jy=!1,t)throw Error(st(300));return e}function pw(){var e=gf!==0;return gf=0,e}function ba(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yr===null?ur.memoizedState=Yr=e:Yr=Yr.next=e,Yr}function Ls(){if($r===null){var e=ur.alternate;e=e!==null?e.memoizedState:null}else e=$r.next;var t=Yr===null?ur.memoizedState:Yr.next;if(t!==null)Yr=t,$r=e;else{if(e===null)throw Error(st(310));$r=e,e={memoizedState:$r.memoizedState,baseState:$r.baseState,baseQueue:$r.baseQueue,queue:$r.queue,next:null},Yr===null?ur.memoizedState=Yr=e:Yr=Yr.next=e}return Yr}function yf(e,t){return typeof t=="function"?t(e):t}function S0(e){var t=Ls(),i=t.queue;if(i===null)throw Error(st(311));i.lastRenderedReducer=e;var o=$r,h=o.baseQueue,m=i.pending;if(m!==null){if(h!==null){var f=h.next;h.next=m.next,m.next=f}o.baseQueue=h=m,i.pending=null}if(h!==null){m=h.next,o=o.baseState;var c=f=null,E=null,C=m;do{var R=C.lane;if((Gc&R)===R)E!==null&&(E=E.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),o=C.hasEagerState?C.eagerState:e(o,C.action);else{var L={lane:R,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};E===null?(c=E=L,f=o):E=E.next=L,ur.lanes|=R,qc|=R}C=C.next}while(C!==null&&C!==m);E===null?f=o:E.next=c,ra(o,t.memoizedState)||(Hi=!0),t.memoizedState=o,t.baseState=f,t.baseQueue=E,i.lastRenderedState=o}if(e=i.interleaved,e!==null){h=e;do m=h.lane,ur.lanes|=m,qc|=m,h=h.next;while(h!==e)}else h===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function T0(e){var t=Ls(),i=t.queue;if(i===null)throw Error(st(311));i.lastRenderedReducer=e;var o=i.dispatch,h=i.pending,m=t.memoizedState;if(h!==null){i.pending=null;var f=h=h.next;do m=e(m,f.action),f=f.next;while(f!==h);ra(m,t.memoizedState)||(Hi=!0),t.memoizedState=m,t.baseQueue===null&&(t.baseState=m),i.lastRenderedState=m}return[m,o]}function Lk(){}function zk(e,t){var i=ur,o=Ls(),h=t(),m=!ra(o.memoizedState,h);if(m&&(o.memoizedState=h,Hi=!0),o=o.queue,fw(Bk.bind(null,i,o,e),[e]),o.getSnapshot!==t||m||Yr!==null&&Yr.memoizedState.tag&1){if(i.flags|=2048,_f(9,Fk.bind(null,i,o,h,t),void 0,null),Jr===null)throw Error(st(349));Gc&30||Ok(i,t,h)}return h}function Ok(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=ur.updateQueue,t===null?(t={lastEffect:null,stores:null},ur.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Fk(e,t,i,o){t.value=i,t.getSnapshot=o,Vk(t)&&Uk(e)}function Bk(e,t,i){return i(function(){Vk(t)&&Uk(e)})}function Vk(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!ra(e,i)}catch{return!0}}function Uk(e){var t=co(e,1);t!==null&&na(t,e,1,-1)}function b2(e){var t=ba();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yf,lastRenderedState:e},t.queue=e,e=e.dispatch=UL.bind(null,ur,e),[t.memoizedState,e]}function _f(e,t,i,o){return e={tag:e,create:t,destroy:i,deps:o,next:null},t=ur.updateQueue,t===null?(t={lastEffect:null,stores:null},ur.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,t.lastEffect=e)),e}function $k(){return Ls().memoizedState}function sy(e,t,i,o){var h=ba();ur.flags|=e,h.memoizedState=_f(1|t,i,void 0,o===void 0?null:o)}function l_(e,t,i,o){var h=Ls();o=o===void 0?null:o;var m=void 0;if($r!==null){var f=$r.memoizedState;if(m=f.destroy,o!==null&&hw(o,f.deps)){h.memoizedState=_f(t,i,m,o);return}}ur.flags|=e,h.memoizedState=_f(1|t,i,m,o)}function w2(e,t){return sy(8390656,8,e,t)}function fw(e,t){return l_(2048,8,e,t)}function Gk(e,t){return l_(4,2,e,t)}function qk(e,t){return l_(4,4,e,t)}function Wk(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Zk(e,t,i){return i=i!=null?i.concat([e]):null,l_(4,4,Wk.bind(null,t,e),i)}function mw(){}function Hk(e,t){var i=Ls();t=t===void 0?null:t;var o=i.memoizedState;return o!==null&&t!==null&&hw(t,o[1])?o[0]:(i.memoizedState=[e,t],e)}function Kk(e,t){var i=Ls();t=t===void 0?null:t;var o=i.memoizedState;return o!==null&&t!==null&&hw(t,o[1])?o[0]:(e=e(),i.memoizedState=[e,t],e)}function Xk(e,t,i){return Gc&21?(ra(i,t)||(i=tk(),ur.lanes|=i,qc|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Hi=!0),e.memoizedState=i)}function BL(e,t){var i=En;En=i!==0&&4>i?i:4,e(!0);var o=w0.transition;w0.transition={};try{e(!1),t()}finally{En=i,w0.transition=o}}function Yk(){return Ls().memoizedState}function VL(e,t,i){var o=pl(e);if(i={lane:o,action:i,hasEagerState:!1,eagerState:null,next:null},Jk(e))Qk(t,i);else if(i=Dk(e,t,i,o),i!==null){var h=Li();na(i,e,o,h),eA(i,t,o)}}function UL(e,t,i){var o=pl(e),h={lane:o,action:i,hasEagerState:!1,eagerState:null,next:null};if(Jk(e))Qk(t,h);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=t.lastRenderedReducer,m!==null))try{var f=t.lastRenderedState,c=m(f,i);if(h.hasEagerState=!0,h.eagerState=c,ra(c,f)){var E=t.interleaved;E===null?(h.next=h,aw(t)):(h.next=E.next,E.next=h),t.interleaved=h;return}}catch{}finally{}i=Dk(e,t,h,o),i!==null&&(h=Li(),na(i,e,o,h),eA(i,t,o))}}function Jk(e){var t=e.alternate;return e===ur||t!==null&&t===ur}function Qk(e,t){Wp=jy=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function eA(e,t,i){if(i&4194240){var o=t.lanes;o&=e.pendingLanes,i|=o,t.lanes=i,Wb(e,i)}}var Ny={readContext:Ns,useCallback:bi,useContext:bi,useEffect:bi,useImperativeHandle:bi,useInsertionEffect:bi,useLayoutEffect:bi,useMemo:bi,useReducer:bi,useRef:bi,useState:bi,useDebugValue:bi,useDeferredValue:bi,useTransition:bi,useMutableSource:bi,useSyncExternalStore:bi,useId:bi,unstable_isNewReconciler:!1},$L={readContext:Ns,useCallback:function(e,t){return ba().memoizedState=[e,t===void 0?null:t],e},useContext:Ns,useEffect:w2,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,sy(4194308,4,Wk.bind(null,t,e),i)},useLayoutEffect:function(e,t){return sy(4194308,4,e,t)},useInsertionEffect:function(e,t){return sy(4,2,e,t)},useMemo:function(e,t){var i=ba();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var o=ba();return t=i!==void 0?i(t):t,o.memoizedState=o.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},o.queue=e,e=e.dispatch=VL.bind(null,ur,e),[o.memoizedState,e]},useRef:function(e){var t=ba();return e={current:e},t.memoizedState=e},useState:b2,useDebugValue:mw,useDeferredValue:function(e){return ba().memoizedState=e},useTransition:function(){var e=b2(!1),t=e[0];return e=BL.bind(null,e[1]),ba().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var o=ur,h=ba();if(rr){if(i===void 0)throw Error(st(407));i=i()}else{if(i=t(),Jr===null)throw Error(st(349));Gc&30||Ok(o,t,i)}h.memoizedState=i;var m={value:i,getSnapshot:t};return h.queue=m,w2(Bk.bind(null,o,m,e),[e]),o.flags|=2048,_f(9,Fk.bind(null,o,m,i,t),void 0,null),i},useId:function(){var e=ba(),t=Jr.identifierPrefix;if(rr){var i=ro,o=no;i=(o&~(1<<32-ta(o)-1)).toString(32)+i,t=":"+t+"R"+i,i=gf++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=FL++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},GL={readContext:Ns,useCallback:Hk,useContext:Ns,useEffect:fw,useImperativeHandle:Zk,useInsertionEffect:Gk,useLayoutEffect:qk,useMemo:Kk,useReducer:S0,useRef:$k,useState:function(){return S0(yf)},useDebugValue:mw,useDeferredValue:function(e){var t=Ls();return Xk(t,$r.memoizedState,e)},useTransition:function(){var e=S0(yf)[0],t=Ls().memoizedState;return[e,t]},useMutableSource:Lk,useSyncExternalStore:zk,useId:Yk,unstable_isNewReconciler:!1},qL={readContext:Ns,useCallback:Hk,useContext:Ns,useEffect:fw,useImperativeHandle:Zk,useInsertionEffect:Gk,useLayoutEffect:qk,useMemo:Kk,useReducer:T0,useRef:$k,useState:function(){return T0(yf)},useDebugValue:mw,useDeferredValue:function(e){var t=Ls();return $r===null?t.memoizedState=e:Xk(t,$r.memoizedState,e)},useTransition:function(){var e=T0(yf)[0],t=Ls().memoizedState;return[e,t]},useMutableSource:Lk,useSyncExternalStore:zk,useId:Yk,unstable_isNewReconciler:!1};function Xs(e,t){if(e&&e.defaultProps){t=hr({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function Lx(e,t,i,o){t=e.memoizedState,i=i(o,t),i=i==null?t:hr({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var c_={isMounted:function(e){return(e=e._reactInternals)?Kc(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var o=Li(),h=pl(e),m=io(o,h);m.payload=t,i!=null&&(m.callback=i),t=hl(e,m,h),t!==null&&(na(t,e,h,o),ry(t,e,h))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var o=Li(),h=pl(e),m=io(o,h);m.tag=1,m.payload=t,i!=null&&(m.callback=i),t=hl(e,m,h),t!==null&&(na(t,e,h,o),ry(t,e,h))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Li(),o=pl(e),h=io(i,o);h.tag=2,t!=null&&(h.callback=t),t=hl(e,h,o),t!==null&&(na(t,e,o,i),ry(t,e,o))}};function S2(e,t,i,o,h,m,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,m,f):t.prototype&&t.prototype.isPureReactComponent?!uf(i,o)||!uf(h,m):!0}function tA(e,t,i){var o=!1,h=yl,m=t.contextType;return typeof m=="object"&&m!==null?m=Ns(m):(h=Xi(t)?Uc:Ci.current,o=t.contextTypes,m=(o=o!=null)?Uh(e,h):yl),t=new t(i,m),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=c_,e.stateNode=t,t._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=h,e.__reactInternalMemoizedMaskedChildContext=m),t}function T2(e,t,i,o){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,o),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,o),t.state!==e&&c_.enqueueReplaceState(t,t.state,null)}function zx(e,t,i,o){var h=e.stateNode;h.props=i,h.state=e.memoizedState,h.refs={},ow(e);var m=t.contextType;typeof m=="object"&&m!==null?h.context=Ns(m):(m=Xi(t)?Uc:Ci.current,h.context=Uh(e,m)),h.state=e.memoizedState,m=t.getDerivedStateFromProps,typeof m=="function"&&(Lx(e,t,m,i),h.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(t=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),t!==h.state&&c_.enqueueReplaceState(h,h.state,null),Ry(e,i,h,o),h.state=e.memoizedState),typeof h.componentDidMount=="function"&&(e.flags|=4194308)}function Wh(e,t){try{var i="",o=t;do i+=vN(o),o=o.return;while(o);var h=i}catch(m){h=`
Error generating stack: `+m.message+`
`+m.stack}return{value:e,source:t,stack:h,digest:null}}function E0(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function Ox(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var WL=typeof WeakMap=="function"?WeakMap:Map;function nA(e,t,i){i=io(-1,i),i.tag=3,i.payload={element:null};var o=t.value;return i.callback=function(){zy||(zy=!0,Hx=o),Ox(e,t)},i}function rA(e,t,i){i=io(-1,i),i.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var h=t.value;i.payload=function(){return o(h)},i.callback=function(){Ox(e,t)}}var m=e.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(i.callback=function(){Ox(e,t),typeof o!="function"&&(dl===null?dl=new Set([this]):dl.add(this));var f=t.stack;this.componentDidCatch(t.value,{componentStack:f!==null?f:""})}),i}function E2(e,t,i){var o=e.pingCache;if(o===null){o=e.pingCache=new WL;var h=new Set;o.set(t,h)}else h=o.get(t),h===void 0&&(h=new Set,o.set(t,h));h.has(i)||(h.add(i),e=az.bind(null,e,t,i),t.then(e,e))}function P2(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function C2(e,t,i,o,h){return e.mode&1?(e.flags|=65536,e.lanes=h,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=io(-1,1),t.tag=2,hl(i,t,1))),i.lanes|=1),e)}var ZL=po.ReactCurrentOwner,Hi=!1;function Ni(e,t,i,o){t.child=e===null?Rk(t,null,i,o):Gh(t,e.child,i,o)}function k2(e,t,i,o,h){i=i.render;var m=t.ref;return Oh(t,h),o=dw(e,t,i,o,m,h),i=pw(),e!==null&&!Hi?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~h,uo(e,t,h)):(rr&&i&&ew(t),t.flags|=1,Ni(e,t,o,h),t.child)}function A2(e,t,i,o,h){if(e===null){var m=i.type;return typeof m=="function"&&!Sw(m)&&m.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=m,iA(e,t,m,o,h)):(e=cy(i.type,null,o,t,t.mode,h),e.ref=t.ref,e.return=t,t.child=e)}if(m=e.child,!(e.lanes&h)){var f=m.memoizedProps;if(i=i.compare,i=i!==null?i:uf,i(f,o)&&e.ref===t.ref)return uo(e,t,h)}return t.flags|=1,e=fl(m,o),e.ref=t.ref,e.return=t,t.child=e}function iA(e,t,i,o,h){if(e!==null){var m=e.memoizedProps;if(uf(m,o)&&e.ref===t.ref)if(Hi=!1,t.pendingProps=o=m,(e.lanes&h)!==0)e.flags&131072&&(Hi=!0);else return t.lanes=e.lanes,uo(e,t,h)}return Fx(e,t,i,o,h)}function sA(e,t,i){var o=t.pendingProps,h=o.children,m=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vn(Ch,ds),ds|=i;else{if(!(i&1073741824))return e=m!==null?m.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Vn(Ch,ds),ds|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=m!==null?m.baseLanes:i,Vn(Ch,ds),ds|=o}else m!==null?(o=m.baseLanes|i,t.memoizedState=null):o=i,Vn(Ch,ds),ds|=o;return Ni(e,t,h,i),t.child}function aA(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Fx(e,t,i,o,h){var m=Xi(i)?Uc:Ci.current;return m=Uh(t,m),Oh(t,h),i=dw(e,t,i,o,m,h),o=pw(),e!==null&&!Hi?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~h,uo(e,t,h)):(rr&&o&&ew(t),t.flags|=1,Ni(e,t,i,h),t.child)}function I2(e,t,i,o,h){if(Xi(i)){var m=!0;Cy(t)}else m=!1;if(Oh(t,h),t.stateNode===null)ay(e,t),tA(t,i,o),zx(t,i,o,h),o=!0;else if(e===null){var f=t.stateNode,c=t.memoizedProps;f.props=c;var E=f.context,C=i.contextType;typeof C=="object"&&C!==null?C=Ns(C):(C=Xi(i)?Uc:Ci.current,C=Uh(t,C));var R=i.getDerivedStateFromProps,L=typeof R=="function"||typeof f.getSnapshotBeforeUpdate=="function";L||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(c!==o||E!==C)&&T2(t,f,o,C),Jo=!1;var B=t.memoizedState;f.state=B,Ry(t,o,f,h),E=t.memoizedState,c!==o||B!==E||Ki.current||Jo?(typeof R=="function"&&(Lx(t,i,R,o),E=t.memoizedState),(c=Jo||S2(t,i,c,o,B,E,C))?(L||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(t.flags|=4194308)):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=E),f.props=o,f.state=E,f.context=C,o=c):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),o=!1)}else{f=t.stateNode,jk(e,t),c=t.memoizedProps,C=t.type===t.elementType?c:Xs(t.type,c),f.props=C,L=t.pendingProps,B=f.context,E=i.contextType,typeof E=="object"&&E!==null?E=Ns(E):(E=Xi(i)?Uc:Ci.current,E=Uh(t,E));var X=i.getDerivedStateFromProps;(R=typeof X=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(c!==L||B!==E)&&T2(t,f,o,E),Jo=!1,B=t.memoizedState,f.state=B,Ry(t,o,f,h);var W=t.memoizedState;c!==L||B!==W||Ki.current||Jo?(typeof X=="function"&&(Lx(t,i,X,o),W=t.memoizedState),(C=Jo||S2(t,i,C,o,B,W,E)||!1)?(R||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(o,W,E),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(o,W,E)),typeof f.componentDidUpdate=="function"&&(t.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof f.componentDidUpdate!="function"||c===e.memoizedProps&&B===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&B===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=W),f.props=o,f.state=W,f.context=E,o=C):(typeof f.componentDidUpdate!="function"||c===e.memoizedProps&&B===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&B===e.memoizedState||(t.flags|=1024),o=!1)}return Bx(e,t,i,o,m,h)}function Bx(e,t,i,o,h,m){aA(e,t);var f=(t.flags&128)!==0;if(!o&&!f)return h&&m2(t,i,!1),uo(e,t,m);o=t.stateNode,ZL.current=t;var c=f&&typeof i.getDerivedStateFromError!="function"?null:o.render();return t.flags|=1,e!==null&&f?(t.child=Gh(t,e.child,null,m),t.child=Gh(t,null,c,m)):Ni(e,t,c,m),t.memoizedState=o.state,h&&m2(t,i,!0),t.child}function oA(e){var t=e.stateNode;t.pendingContext?f2(e,t.pendingContext,t.pendingContext!==t.context):t.context&&f2(e,t.context,!1),lw(e,t.containerInfo)}function M2(e,t,i,o,h){return $h(),nw(h),t.flags|=256,Ni(e,t,i,o),t.child}var Vx={dehydrated:null,treeContext:null,retryLane:0};function Ux(e){return{baseLanes:e,cachePool:null,transitions:null}}function lA(e,t,i){var o=t.pendingProps,h=lr.current,m=!1,f=(t.flags&128)!==0,c;if((c=f)||(c=e!==null&&e.memoizedState===null?!1:(h&2)!==0),c?(m=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(h|=1),Vn(lr,h&1),e===null)return jx(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(f=o.children,e=o.fallback,m?(o=t.mode,m=t.child,f={mode:"hidden",children:f},!(o&1)&&m!==null?(m.childLanes=0,m.pendingProps=f):m=d_(f,o,0,null),e=Fc(e,o,i,null),m.return=t,e.return=t,m.sibling=e,t.child=m,t.child.memoizedState=Ux(i),t.memoizedState=Vx,e):gw(t,f));if(h=e.memoizedState,h!==null&&(c=h.dehydrated,c!==null))return HL(e,t,f,o,c,h,i);if(m){m=o.fallback,f=t.mode,h=e.child,c=h.sibling;var E={mode:"hidden",children:o.children};return!(f&1)&&t.child!==h?(o=t.child,o.childLanes=0,o.pendingProps=E,t.deletions=null):(o=fl(h,E),o.subtreeFlags=h.subtreeFlags&14680064),c!==null?m=fl(c,m):(m=Fc(m,f,i,null),m.flags|=2),m.return=t,o.return=t,o.sibling=m,t.child=o,o=m,m=t.child,f=e.child.memoizedState,f=f===null?Ux(i):{baseLanes:f.baseLanes|i,cachePool:null,transitions:f.transitions},m.memoizedState=f,m.childLanes=e.childLanes&~i,t.memoizedState=Vx,o}return m=e.child,e=m.sibling,o=fl(m,{mode:"visible",children:o.children}),!(t.mode&1)&&(o.lanes=i),o.return=t,o.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=o,t.memoizedState=null,o}function gw(e,t){return t=d_({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ng(e,t,i,o){return o!==null&&nw(o),Gh(t,e.child,null,i),e=gw(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function HL(e,t,i,o,h,m,f){if(i)return t.flags&256?(t.flags&=-257,o=E0(Error(st(422))),Ng(e,t,f,o)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(m=o.fallback,h=t.mode,o=d_({mode:"visible",children:o.children},h,0,null),m=Fc(m,h,f,null),m.flags|=2,o.return=t,m.return=t,o.sibling=m,t.child=o,t.mode&1&&Gh(t,e.child,null,f),t.child.memoizedState=Ux(f),t.memoizedState=Vx,m);if(!(t.mode&1))return Ng(e,t,f,null);if(h.data==="$!"){if(o=h.nextSibling&&h.nextSibling.dataset,o)var c=o.dgst;return o=c,m=Error(st(419)),o=E0(m,o,void 0),Ng(e,t,f,o)}if(c=(f&e.childLanes)!==0,Hi||c){if(o=Jr,o!==null){switch(f&-f){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(o.suspendedLanes|f)?0:h,h!==0&&h!==m.retryLane&&(m.retryLane=h,co(e,h),na(o,e,h,-1))}return ww(),o=E0(Error(st(421))),Ng(e,t,f,o)}return h.data==="$?"?(t.flags|=128,t.child=e.child,t=oz.bind(null,e),h._reactRetry=t,null):(e=m.treeContext,ms=ul(h.nextSibling),gs=t,rr=!0,ea=null,e!==null&&(Ms[Rs++]=no,Ms[Rs++]=ro,Ms[Rs++]=$c,no=e.id,ro=e.overflow,$c=t),t=gw(t,o.children),t.flags|=4096,t)}function R2(e,t,i){e.lanes|=t;var o=e.alternate;o!==null&&(o.lanes|=t),Nx(e.return,t,i)}function P0(e,t,i,o,h){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:h}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=o,m.tail=i,m.tailMode=h)}function cA(e,t,i){var o=t.pendingProps,h=o.revealOrder,m=o.tail;if(Ni(e,t,o.children,i),o=lr.current,o&2)o=o&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&R2(e,i,t);else if(e.tag===19)R2(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(Vn(lr,o),!(t.mode&1))t.memoizedState=null;else switch(h){case"forwards":for(i=t.child,h=null;i!==null;)e=i.alternate,e!==null&&Dy(e)===null&&(h=i),i=i.sibling;i=h,i===null?(h=t.child,t.child=null):(h=i.sibling,i.sibling=null),P0(t,!1,h,i,m);break;case"backwards":for(i=null,h=t.child,t.child=null;h!==null;){if(e=h.alternate,e!==null&&Dy(e)===null){t.child=h;break}e=h.sibling,h.sibling=i,i=h,h=e}P0(t,!0,i,null,m);break;case"together":P0(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ay(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function uo(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),qc|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(st(153));if(t.child!==null){for(e=t.child,i=fl(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=fl(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function KL(e,t,i){switch(t.tag){case 3:oA(t),$h();break;case 5:Nk(t);break;case 1:Xi(t.type)&&Cy(t);break;case 4:lw(t,t.stateNode.containerInfo);break;case 10:var o=t.type._context,h=t.memoizedProps.value;Vn(Iy,o._currentValue),o._currentValue=h;break;case 13:if(o=t.memoizedState,o!==null)return o.dehydrated!==null?(Vn(lr,lr.current&1),t.flags|=128,null):i&t.child.childLanes?lA(e,t,i):(Vn(lr,lr.current&1),e=uo(e,t,i),e!==null?e.sibling:null);Vn(lr,lr.current&1);break;case 19:if(o=(i&t.childLanes)!==0,e.flags&128){if(o)return cA(e,t,i);t.flags|=128}if(h=t.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),Vn(lr,lr.current),o)break;return null;case 22:case 23:return t.lanes=0,sA(e,t,i)}return uo(e,t,i)}var uA,$x,hA,dA;uA=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};$x=function(){};hA=function(e,t,i,o){var h=e.memoizedProps;if(h!==o){e=t.stateNode,jc(Ta.current);var m=null;switch(i){case"input":h=hx(e,h),o=hx(e,o),m=[];break;case"select":h=hr({},h,{value:void 0}),o=hr({},o,{value:void 0}),m=[];break;case"textarea":h=fx(e,h),o=fx(e,o),m=[];break;default:typeof h.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=Ey)}gx(i,o);var f;i=null;for(C in h)if(!o.hasOwnProperty(C)&&h.hasOwnProperty(C)&&h[C]!=null)if(C==="style"){var c=h[C];for(f in c)c.hasOwnProperty(f)&&(i||(i={}),i[f]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(nf.hasOwnProperty(C)?m||(m=[]):(m=m||[]).push(C,null));for(C in o){var E=o[C];if(c=h!=null?h[C]:void 0,o.hasOwnProperty(C)&&E!==c&&(E!=null||c!=null))if(C==="style")if(c){for(f in c)!c.hasOwnProperty(f)||E&&E.hasOwnProperty(f)||(i||(i={}),i[f]="");for(f in E)E.hasOwnProperty(f)&&c[f]!==E[f]&&(i||(i={}),i[f]=E[f])}else i||(m||(m=[]),m.push(C,i)),i=E;else C==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,c=c?c.__html:void 0,E!=null&&c!==E&&(m=m||[]).push(C,E)):C==="children"?typeof E!="string"&&typeof E!="number"||(m=m||[]).push(C,""+E):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(nf.hasOwnProperty(C)?(E!=null&&C==="onScroll"&&Hn("scroll",e),m||c===E||(m=[])):(m=m||[]).push(C,E))}i&&(m=m||[]).push("style",i);var C=m;(t.updateQueue=C)&&(t.flags|=4)}};dA=function(e,t,i,o){i!==o&&(t.flags|=4)};function Ap(e,t){if(!rr)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function wi(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(t)for(var h=e.child;h!==null;)i|=h.lanes|h.childLanes,o|=h.subtreeFlags&14680064,o|=h.flags&14680064,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)i|=h.lanes|h.childLanes,o|=h.subtreeFlags,o|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=o,e.childLanes=i,t}function XL(e,t,i){var o=t.pendingProps;switch(tw(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wi(t),null;case 1:return Xi(t.type)&&Py(),wi(t),null;case 3:return o=t.stateNode,qh(),Kn(Ki),Kn(Ci),uw(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(Dg(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ea!==null&&(Yx(ea),ea=null))),$x(e,t),wi(t),null;case 5:cw(t);var h=jc(mf.current);if(i=t.type,e!==null&&t.stateNode!=null)hA(e,t,i,o,h),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(t.stateNode===null)throw Error(st(166));return wi(t),null}if(e=jc(Ta.current),Dg(t)){o=t.stateNode,i=t.type;var m=t.memoizedProps;switch(o[wa]=t,o[pf]=m,e=(t.mode&1)!==0,i){case"dialog":Hn("cancel",o),Hn("close",o);break;case"iframe":case"object":case"embed":Hn("load",o);break;case"video":case"audio":for(h=0;h<Lp.length;h++)Hn(Lp[h],o);break;case"source":Hn("error",o);break;case"img":case"image":case"link":Hn("error",o),Hn("load",o);break;case"details":Hn("toggle",o);break;case"input":VT(o,m),Hn("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!m.multiple},Hn("invalid",o);break;case"textarea":$T(o,m),Hn("invalid",o)}gx(i,m),h=null;for(var f in m)if(m.hasOwnProperty(f)){var c=m[f];f==="children"?typeof c=="string"?o.textContent!==c&&(m.suppressHydrationWarning!==!0&&Rg(o.textContent,c,e),h=["children",c]):typeof c=="number"&&o.textContent!==""+c&&(m.suppressHydrationWarning!==!0&&Rg(o.textContent,c,e),h=["children",""+c]):nf.hasOwnProperty(f)&&c!=null&&f==="onScroll"&&Hn("scroll",o)}switch(i){case"input":Tg(o),UT(o,m,!0);break;case"textarea":Tg(o),GT(o);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(o.onclick=Ey)}o=h,t.updateQueue=o,o!==null&&(t.flags|=4)}else{f=h.nodeType===9?h:h.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=BC(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=f.createElement(i,{is:o.is}):(e=f.createElement(i),i==="select"&&(f=e,o.multiple?f.multiple=!0:o.size&&(f.size=o.size))):e=f.createElementNS(e,i),e[wa]=t,e[pf]=o,uA(e,t,!1,!1),t.stateNode=e;e:{switch(f=yx(i,o),i){case"dialog":Hn("cancel",e),Hn("close",e),h=o;break;case"iframe":case"object":case"embed":Hn("load",e),h=o;break;case"video":case"audio":for(h=0;h<Lp.length;h++)Hn(Lp[h],e);h=o;break;case"source":Hn("error",e),h=o;break;case"img":case"image":case"link":Hn("error",e),Hn("load",e),h=o;break;case"details":Hn("toggle",e),h=o;break;case"input":VT(e,o),h=hx(e,o),Hn("invalid",e);break;case"option":h=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},h=hr({},o,{value:void 0}),Hn("invalid",e);break;case"textarea":$T(e,o),h=fx(e,o),Hn("invalid",e);break;default:h=o}gx(i,h),c=h;for(m in c)if(c.hasOwnProperty(m)){var E=c[m];m==="style"?$C(e,E):m==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&VC(e,E)):m==="children"?typeof E=="string"?(i!=="textarea"||E!=="")&&rf(e,E):typeof E=="number"&&rf(e,""+E):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(nf.hasOwnProperty(m)?E!=null&&m==="onScroll"&&Hn("scroll",e):E!=null&&Bb(e,m,E,f))}switch(i){case"input":Tg(e),UT(e,o,!1);break;case"textarea":Tg(e),GT(e);break;case"option":o.value!=null&&e.setAttribute("value",""+gl(o.value));break;case"select":e.multiple=!!o.multiple,m=o.value,m!=null?jh(e,!!o.multiple,m,!1):o.defaultValue!=null&&jh(e,!!o.multiple,o.defaultValue,!0);break;default:typeof h.onClick=="function"&&(e.onclick=Ey)}switch(i){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return wi(t),null;case 6:if(e&&t.stateNode!=null)dA(e,t,e.memoizedProps,o);else{if(typeof o!="string"&&t.stateNode===null)throw Error(st(166));if(i=jc(mf.current),jc(Ta.current),Dg(t)){if(o=t.stateNode,i=t.memoizedProps,o[wa]=t,(m=o.nodeValue!==i)&&(e=gs,e!==null))switch(e.tag){case 3:Rg(o.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Rg(o.nodeValue,i,(e.mode&1)!==0)}m&&(t.flags|=4)}else o=(i.nodeType===9?i:i.ownerDocument).createTextNode(o),o[wa]=t,t.stateNode=o}return wi(t),null;case 13:if(Kn(lr),o=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(rr&&ms!==null&&t.mode&1&&!(t.flags&128))Ik(),$h(),t.flags|=98560,m=!1;else if(m=Dg(t),o!==null&&o.dehydrated!==null){if(e===null){if(!m)throw Error(st(318));if(m=t.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(st(317));m[wa]=t}else $h(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;wi(t),m=!1}else ea!==null&&(Yx(ea),ea=null),m=!0;if(!m)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(t.child.flags|=8192,t.mode&1&&(e===null||lr.current&1?Gr===0&&(Gr=3):ww())),t.updateQueue!==null&&(t.flags|=4),wi(t),null);case 4:return qh(),$x(e,t),e===null&&hf(t.stateNode.containerInfo),wi(t),null;case 10:return sw(t.type._context),wi(t),null;case 17:return Xi(t.type)&&Py(),wi(t),null;case 19:if(Kn(lr),m=t.memoizedState,m===null)return wi(t),null;if(o=(t.flags&128)!==0,f=m.rendering,f===null)if(o)Ap(m,!1);else{if(Gr!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(f=Dy(e),f!==null){for(t.flags|=128,Ap(m,!1),o=f.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=i,i=t.child;i!==null;)m=i,e=o,m.flags&=14680066,f=m.alternate,f===null?(m.childLanes=0,m.lanes=e,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=f.childLanes,m.lanes=f.lanes,m.child=f.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=f.memoizedProps,m.memoizedState=f.memoizedState,m.updateQueue=f.updateQueue,m.type=f.type,e=f.dependencies,m.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Vn(lr,lr.current&1|2),t.child}e=e.sibling}m.tail!==null&&Sr()>Zh&&(t.flags|=128,o=!0,Ap(m,!1),t.lanes=4194304)}else{if(!o)if(e=Dy(f),e!==null){if(t.flags|=128,o=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Ap(m,!0),m.tail===null&&m.tailMode==="hidden"&&!f.alternate&&!rr)return wi(t),null}else 2*Sr()-m.renderingStartTime>Zh&&i!==1073741824&&(t.flags|=128,o=!0,Ap(m,!1),t.lanes=4194304);m.isBackwards?(f.sibling=t.child,t.child=f):(i=m.last,i!==null?i.sibling=f:t.child=f,m.last=f)}return m.tail!==null?(t=m.tail,m.rendering=t,m.tail=t.sibling,m.renderingStartTime=Sr(),t.sibling=null,i=lr.current,Vn(lr,o?i&1|2:i&1),t):(wi(t),null);case 22:case 23:return bw(),o=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(t.flags|=8192),o&&t.mode&1?ds&1073741824&&(wi(t),t.subtreeFlags&6&&(t.flags|=8192)):wi(t),null;case 24:return null;case 25:return null}throw Error(st(156,t.tag))}function YL(e,t){switch(tw(t),t.tag){case 1:return Xi(t.type)&&Py(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return qh(),Kn(Ki),Kn(Ci),uw(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return cw(t),null;case 13:if(Kn(lr),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(st(340));$h()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Kn(lr),null;case 4:return qh(),null;case 10:return sw(t.type._context),null;case 22:case 23:return bw(),null;case 24:return null;default:return null}}var Lg=!1,Ti=!1,JL=typeof WeakSet=="function"?WeakSet:Set,xt=null;function Ph(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(o){_r(e,t,o)}else i.current=null}function Gx(e,t,i){try{i()}catch(o){_r(e,t,o)}}var D2=!1;function QL(e,t){if(Cx=wy,e=yk(),Qb(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var h=o.anchorOffset,m=o.focusNode;o=o.focusOffset;try{i.nodeType,m.nodeType}catch{i=null;break e}var f=0,c=-1,E=-1,C=0,R=0,L=e,B=null;t:for(;;){for(var X;L!==i||h!==0&&L.nodeType!==3||(c=f+h),L!==m||o!==0&&L.nodeType!==3||(E=f+o),L.nodeType===3&&(f+=L.nodeValue.length),(X=L.firstChild)!==null;)B=L,L=X;for(;;){if(L===e)break t;if(B===i&&++C===h&&(c=f),B===m&&++R===o&&(E=f),(X=L.nextSibling)!==null)break;L=B,B=L.parentNode}L=X}i=c===-1||E===-1?null:{start:c,end:E}}else i=null}i=i||{start:0,end:0}}else i=null;for(kx={focusedElem:e,selectionRange:i},wy=!1,xt=t;xt!==null;)if(t=xt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,xt=e;else for(;xt!==null;){t=xt;try{var W=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(W!==null){var te=W.memoizedProps,G=W.memoizedState,J=t.stateNode,H=J.getSnapshotBeforeUpdate(t.elementType===t.type?te:Xs(t.type,te),G);J.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var Q=t.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(st(163))}}catch(le){_r(t,t.return,le)}if(e=t.sibling,e!==null){e.return=t.return,xt=e;break}xt=t.return}return W=D2,D2=!1,W}function Zp(e,t,i){var o=t.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var h=o=o.next;do{if((h.tag&e)===e){var m=h.destroy;h.destroy=void 0,m!==void 0&&Gx(t,i,m)}h=h.next}while(h!==o)}}function u_(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var o=i.create;i.destroy=o()}i=i.next}while(i!==t)}}function qx(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function pA(e){var t=e.alternate;t!==null&&(e.alternate=null,pA(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[wa],delete t[pf],delete t[Mx],delete t[NL],delete t[LL])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function fA(e){return e.tag===5||e.tag===3||e.tag===4}function j2(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||fA(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Wx(e,t,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=Ey));else if(o!==4&&(e=e.child,e!==null))for(Wx(e,t,i),e=e.sibling;e!==null;)Wx(e,t,i),e=e.sibling}function Zx(e,t,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(Zx(e,t,i),e=e.sibling;e!==null;)Zx(e,t,i),e=e.sibling}var hi=null,Js=!1;function Ko(e,t,i){for(i=i.child;i!==null;)mA(e,t,i),i=i.sibling}function mA(e,t,i){if(Sa&&typeof Sa.onCommitFiberUnmount=="function")try{Sa.onCommitFiberUnmount(n_,i)}catch{}switch(i.tag){case 5:Ti||Ph(i,t);case 6:var o=hi,h=Js;hi=null,Ko(e,t,i),hi=o,Js=h,hi!==null&&(Js?(e=hi,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):hi.removeChild(i.stateNode));break;case 18:hi!==null&&(Js?(e=hi,i=i.stateNode,e.nodeType===8?v0(e.parentNode,i):e.nodeType===1&&v0(e,i),lf(e)):v0(hi,i.stateNode));break;case 4:o=hi,h=Js,hi=i.stateNode.containerInfo,Js=!0,Ko(e,t,i),hi=o,Js=h;break;case 0:case 11:case 14:case 15:if(!Ti&&(o=i.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){h=o=o.next;do{var m=h,f=m.destroy;m=m.tag,f!==void 0&&(m&2||m&4)&&Gx(i,t,f),h=h.next}while(h!==o)}Ko(e,t,i);break;case 1:if(!Ti&&(Ph(i,t),o=i.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=i.memoizedProps,o.state=i.memoizedState,o.componentWillUnmount()}catch(c){_r(i,t,c)}Ko(e,t,i);break;case 21:Ko(e,t,i);break;case 22:i.mode&1?(Ti=(o=Ti)||i.memoizedState!==null,Ko(e,t,i),Ti=o):Ko(e,t,i);break;default:Ko(e,t,i)}}function N2(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new JL),t.forEach(function(o){var h=lz.bind(null,e,o);i.has(o)||(i.add(o),o.then(h,h))})}}function Zs(e,t){var i=t.deletions;if(i!==null)for(var o=0;o<i.length;o++){var h=i[o];try{var m=e,f=t,c=f;e:for(;c!==null;){switch(c.tag){case 5:hi=c.stateNode,Js=!1;break e;case 3:hi=c.stateNode.containerInfo,Js=!0;break e;case 4:hi=c.stateNode.containerInfo,Js=!0;break e}c=c.return}if(hi===null)throw Error(st(160));mA(m,f,h),hi=null,Js=!1;var E=h.alternate;E!==null&&(E.return=null),h.return=null}catch(C){_r(h,t,C)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)gA(t,e),t=t.sibling}function gA(e,t){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Zs(t,e),va(e),o&4){try{Zp(3,e,e.return),u_(3,e)}catch(te){_r(e,e.return,te)}try{Zp(5,e,e.return)}catch(te){_r(e,e.return,te)}}break;case 1:Zs(t,e),va(e),o&512&&i!==null&&Ph(i,i.return);break;case 5:if(Zs(t,e),va(e),o&512&&i!==null&&Ph(i,i.return),e.flags&32){var h=e.stateNode;try{rf(h,"")}catch(te){_r(e,e.return,te)}}if(o&4&&(h=e.stateNode,h!=null)){var m=e.memoizedProps,f=i!==null?i.memoizedProps:m,c=e.type,E=e.updateQueue;if(e.updateQueue=null,E!==null)try{c==="input"&&m.type==="radio"&&m.name!=null&&OC(h,m),yx(c,f);var C=yx(c,m);for(f=0;f<E.length;f+=2){var R=E[f],L=E[f+1];R==="style"?$C(h,L):R==="dangerouslySetInnerHTML"?VC(h,L):R==="children"?rf(h,L):Bb(h,R,L,C)}switch(c){case"input":dx(h,m);break;case"textarea":FC(h,m);break;case"select":var B=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!m.multiple;var X=m.value;X!=null?jh(h,!!m.multiple,X,!1):B!==!!m.multiple&&(m.defaultValue!=null?jh(h,!!m.multiple,m.defaultValue,!0):jh(h,!!m.multiple,m.multiple?[]:"",!1))}h[pf]=m}catch(te){_r(e,e.return,te)}}break;case 6:if(Zs(t,e),va(e),o&4){if(e.stateNode===null)throw Error(st(162));h=e.stateNode,m=e.memoizedProps;try{h.nodeValue=m}catch(te){_r(e,e.return,te)}}break;case 3:if(Zs(t,e),va(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{lf(t.containerInfo)}catch(te){_r(e,e.return,te)}break;case 4:Zs(t,e),va(e);break;case 13:Zs(t,e),va(e),h=e.child,h.flags&8192&&(m=h.memoizedState!==null,h.stateNode.isHidden=m,!m||h.alternate!==null&&h.alternate.memoizedState!==null||(vw=Sr())),o&4&&N2(e);break;case 22:if(R=i!==null&&i.memoizedState!==null,e.mode&1?(Ti=(C=Ti)||R,Zs(t,e),Ti=C):Zs(t,e),va(e),o&8192){if(C=e.memoizedState!==null,(e.stateNode.isHidden=C)&&!R&&e.mode&1)for(xt=e,R=e.child;R!==null;){for(L=xt=R;xt!==null;){switch(B=xt,X=B.child,B.tag){case 0:case 11:case 14:case 15:Zp(4,B,B.return);break;case 1:Ph(B,B.return);var W=B.stateNode;if(typeof W.componentWillUnmount=="function"){o=B,i=B.return;try{t=o,W.props=t.memoizedProps,W.state=t.memoizedState,W.componentWillUnmount()}catch(te){_r(o,i,te)}}break;case 5:Ph(B,B.return);break;case 22:if(B.memoizedState!==null){z2(L);continue}}X!==null?(X.return=B,xt=X):z2(L)}R=R.sibling}e:for(R=null,L=e;;){if(L.tag===5){if(R===null){R=L;try{h=L.stateNode,C?(m=h.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(c=L.stateNode,E=L.memoizedProps.style,f=E!=null&&E.hasOwnProperty("display")?E.display:null,c.style.display=UC("display",f))}catch(te){_r(e,e.return,te)}}}else if(L.tag===6){if(R===null)try{L.stateNode.nodeValue=C?"":L.memoizedProps}catch(te){_r(e,e.return,te)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===e)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===e)break e;for(;L.sibling===null;){if(L.return===null||L.return===e)break e;R===L&&(R=null),L=L.return}R===L&&(R=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Zs(t,e),va(e),o&4&&N2(e);break;case 21:break;default:Zs(t,e),va(e)}}function va(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(fA(i)){var o=i;break e}i=i.return}throw Error(st(160))}switch(o.tag){case 5:var h=o.stateNode;o.flags&32&&(rf(h,""),o.flags&=-33);var m=j2(e);Zx(e,m,h);break;case 3:case 4:var f=o.stateNode.containerInfo,c=j2(e);Wx(e,c,f);break;default:throw Error(st(161))}}catch(E){_r(e,e.return,E)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function ez(e,t,i){xt=e,yA(e)}function yA(e,t,i){for(var o=(e.mode&1)!==0;xt!==null;){var h=xt,m=h.child;if(h.tag===22&&o){var f=h.memoizedState!==null||Lg;if(!f){var c=h.alternate,E=c!==null&&c.memoizedState!==null||Ti;c=Lg;var C=Ti;if(Lg=f,(Ti=E)&&!C)for(xt=h;xt!==null;)f=xt,E=f.child,f.tag===22&&f.memoizedState!==null?O2(h):E!==null?(E.return=f,xt=E):O2(h);for(;m!==null;)xt=m,yA(m),m=m.sibling;xt=h,Lg=c,Ti=C}L2(e)}else h.subtreeFlags&8772&&m!==null?(m.return=h,xt=m):L2(e)}}function L2(e){for(;xt!==null;){var t=xt;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ti||u_(5,t);break;case 1:var o=t.stateNode;if(t.flags&4&&!Ti)if(i===null)o.componentDidMount();else{var h=t.elementType===t.type?i.memoizedProps:Xs(t.type,i.memoizedProps);o.componentDidUpdate(h,i.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var m=t.updateQueue;m!==null&&x2(t,m,o);break;case 3:var f=t.updateQueue;if(f!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}x2(t,f,i)}break;case 5:var c=t.stateNode;if(i===null&&t.flags&4){i=c;var E=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&i.focus();break;case"img":E.src&&(i.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var C=t.alternate;if(C!==null){var R=C.memoizedState;if(R!==null){var L=R.dehydrated;L!==null&&lf(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(st(163))}Ti||t.flags&512&&qx(t)}catch(B){_r(t,t.return,B)}}if(t===e){xt=null;break}if(i=t.sibling,i!==null){i.return=t.return,xt=i;break}xt=t.return}}function z2(e){for(;xt!==null;){var t=xt;if(t===e){xt=null;break}var i=t.sibling;if(i!==null){i.return=t.return,xt=i;break}xt=t.return}}function O2(e){for(;xt!==null;){var t=xt;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{u_(4,t)}catch(E){_r(t,i,E)}break;case 1:var o=t.stateNode;if(typeof o.componentDidMount=="function"){var h=t.return;try{o.componentDidMount()}catch(E){_r(t,h,E)}}var m=t.return;try{qx(t)}catch(E){_r(t,m,E)}break;case 5:var f=t.return;try{qx(t)}catch(E){_r(t,f,E)}}}catch(E){_r(t,t.return,E)}if(t===e){xt=null;break}var c=t.sibling;if(c!==null){c.return=t.return,xt=c;break}xt=t.return}}var tz=Math.ceil,Ly=po.ReactCurrentDispatcher,yw=po.ReactCurrentOwner,js=po.ReactCurrentBatchConfig,cn=0,Jr=null,jr=null,pi=0,ds=0,Ch=bl(0),Gr=0,vf=null,qc=0,h_=0,_w=0,Hp=null,Zi=null,vw=0,Zh=1/0,Qa=null,zy=!1,Hx=null,dl=null,zg=!1,il=null,Oy=0,Kp=0,Kx=null,oy=-1,ly=0;function Li(){return cn&6?Sr():oy!==-1?oy:oy=Sr()}function pl(e){return e.mode&1?cn&2&&pi!==0?pi&-pi:OL.transition!==null?(ly===0&&(ly=tk()),ly):(e=En,e!==0||(e=window.event,e=e===void 0?16:lk(e.type)),e):1}function na(e,t,i,o){if(50<Kp)throw Kp=0,Kx=null,Error(st(185));jf(e,i,o),(!(cn&2)||e!==Jr)&&(e===Jr&&(!(cn&2)&&(h_|=i),Gr===4&&tl(e,pi)),Yi(e,o),i===1&&cn===0&&!(t.mode&1)&&(Zh=Sr()+500,o_&&wl()))}function Yi(e,t){var i=e.callbackNode;ON(e,t);var o=by(e,e===Jr?pi:0);if(o===0)i!==null&&ZT(i),e.callbackNode=null,e.callbackPriority=0;else if(t=o&-o,e.callbackPriority!==t){if(i!=null&&ZT(i),t===1)e.tag===0?zL(F2.bind(null,e)):Ck(F2.bind(null,e)),DL(function(){!(cn&6)&&wl()}),i=null;else{switch(nk(o)){case 1:i=qb;break;case 4:i=QC;break;case 16:i=xy;break;case 536870912:i=ek;break;default:i=xy}i=EA(i,_A.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function _A(e,t){if(oy=-1,ly=0,cn&6)throw Error(st(327));var i=e.callbackNode;if(Fh()&&e.callbackNode!==i)return null;var o=by(e,e===Jr?pi:0);if(o===0)return null;if(o&30||o&e.expiredLanes||t)t=Fy(e,o);else{t=o;var h=cn;cn|=2;var m=xA();(Jr!==e||pi!==t)&&(Qa=null,Zh=Sr()+500,Oc(e,t));do try{iz();break}catch(c){vA(e,c)}while(!0);iw(),Ly.current=m,cn=h,jr!==null?t=0:(Jr=null,pi=0,t=Gr)}if(t!==0){if(t===2&&(h=wx(e),h!==0&&(o=h,t=Xx(e,h))),t===1)throw i=vf,Oc(e,0),tl(e,o),Yi(e,Sr()),i;if(t===6)tl(e,o);else{if(h=e.current.alternate,!(o&30)&&!nz(h)&&(t=Fy(e,o),t===2&&(m=wx(e),m!==0&&(o=m,t=Xx(e,m))),t===1))throw i=vf,Oc(e,0),tl(e,o),Yi(e,Sr()),i;switch(e.finishedWork=h,e.finishedLanes=o,t){case 0:case 1:throw Error(st(345));case 2:Pc(e,Zi,Qa);break;case 3:if(tl(e,o),(o&130023424)===o&&(t=vw+500-Sr(),10<t)){if(by(e,0)!==0)break;if(h=e.suspendedLanes,(h&o)!==o){Li(),e.pingedLanes|=e.suspendedLanes&h;break}e.timeoutHandle=Ix(Pc.bind(null,e,Zi,Qa),t);break}Pc(e,Zi,Qa);break;case 4:if(tl(e,o),(o&4194240)===o)break;for(t=e.eventTimes,h=-1;0<o;){var f=31-ta(o);m=1<<f,f=t[f],f>h&&(h=f),o&=~m}if(o=h,o=Sr()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*tz(o/1960))-o,10<o){e.timeoutHandle=Ix(Pc.bind(null,e,Zi,Qa),o);break}Pc(e,Zi,Qa);break;case 5:Pc(e,Zi,Qa);break;default:throw Error(st(329))}}}return Yi(e,Sr()),e.callbackNode===i?_A.bind(null,e):null}function Xx(e,t){var i=Hp;return e.current.memoizedState.isDehydrated&&(Oc(e,t).flags|=256),e=Fy(e,t),e!==2&&(t=Zi,Zi=i,t!==null&&Yx(t)),e}function Yx(e){Zi===null?Zi=e:Zi.push.apply(Zi,e)}function nz(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var o=0;o<i.length;o++){var h=i[o],m=h.getSnapshot;h=h.value;try{if(!ra(m(),h))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function tl(e,t){for(t&=~_w,t&=~h_,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ta(t),o=1<<i;e[i]=-1,t&=~o}}function F2(e){if(cn&6)throw Error(st(327));Fh();var t=by(e,0);if(!(t&1))return Yi(e,Sr()),null;var i=Fy(e,t);if(e.tag!==0&&i===2){var o=wx(e);o!==0&&(t=o,i=Xx(e,o))}if(i===1)throw i=vf,Oc(e,0),tl(e,t),Yi(e,Sr()),i;if(i===6)throw Error(st(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Pc(e,Zi,Qa),Yi(e,Sr()),null}function xw(e,t){var i=cn;cn|=1;try{return e(t)}finally{cn=i,cn===0&&(Zh=Sr()+500,o_&&wl())}}function Wc(e){il!==null&&il.tag===0&&!(cn&6)&&Fh();var t=cn;cn|=1;var i=js.transition,o=En;try{if(js.transition=null,En=1,e)return e()}finally{En=o,js.transition=i,cn=t,!(cn&6)&&wl()}}function bw(){ds=Ch.current,Kn(Ch)}function Oc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,RL(i)),jr!==null)for(i=jr.return;i!==null;){var o=i;switch(tw(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&Py();break;case 3:qh(),Kn(Ki),Kn(Ci),uw();break;case 5:cw(o);break;case 4:qh();break;case 13:Kn(lr);break;case 19:Kn(lr);break;case 10:sw(o.type._context);break;case 22:case 23:bw()}i=i.return}if(Jr=e,jr=e=fl(e.current,null),pi=ds=t,Gr=0,vf=null,_w=h_=qc=0,Zi=Hp=null,Dc!==null){for(t=0;t<Dc.length;t++)if(i=Dc[t],o=i.interleaved,o!==null){i.interleaved=null;var h=o.next,m=i.pending;if(m!==null){var f=m.next;m.next=h,o.next=f}i.pending=o}Dc=null}return e}function vA(e,t){do{var i=jr;try{if(iw(),iy.current=Ny,jy){for(var o=ur.memoizedState;o!==null;){var h=o.queue;h!==null&&(h.pending=null),o=o.next}jy=!1}if(Gc=0,Yr=$r=ur=null,Wp=!1,gf=0,yw.current=null,i===null||i.return===null){Gr=1,vf=t,jr=null;break}e:{var m=e,f=i.return,c=i,E=t;if(t=pi,c.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var C=E,R=c,L=R.tag;if(!(R.mode&1)&&(L===0||L===11||L===15)){var B=R.alternate;B?(R.updateQueue=B.updateQueue,R.memoizedState=B.memoizedState,R.lanes=B.lanes):(R.updateQueue=null,R.memoizedState=null)}var X=P2(f);if(X!==null){X.flags&=-257,C2(X,f,c,m,t),X.mode&1&&E2(m,C,t),t=X,E=C;var W=t.updateQueue;if(W===null){var te=new Set;te.add(E),t.updateQueue=te}else W.add(E);break e}else{if(!(t&1)){E2(m,C,t),ww();break e}E=Error(st(426))}}else if(rr&&c.mode&1){var G=P2(f);if(G!==null){!(G.flags&65536)&&(G.flags|=256),C2(G,f,c,m,t),nw(Wh(E,c));break e}}m=E=Wh(E,c),Gr!==4&&(Gr=2),Hp===null?Hp=[m]:Hp.push(m),m=f;do{switch(m.tag){case 3:m.flags|=65536,t&=-t,m.lanes|=t;var J=nA(m,E,t);v2(m,J);break e;case 1:c=E;var H=m.type,Q=m.stateNode;if(!(m.flags&128)&&(typeof H.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(dl===null||!dl.has(Q)))){m.flags|=65536,t&=-t,m.lanes|=t;var le=rA(m,c,t);v2(m,le);break e}}m=m.return}while(m!==null)}wA(i)}catch(ve){t=ve,jr===i&&i!==null&&(jr=i=i.return);continue}break}while(!0)}function xA(){var e=Ly.current;return Ly.current=Ny,e===null?Ny:e}function ww(){(Gr===0||Gr===3||Gr===2)&&(Gr=4),Jr===null||!(qc&268435455)&&!(h_&268435455)||tl(Jr,pi)}function Fy(e,t){var i=cn;cn|=2;var o=xA();(Jr!==e||pi!==t)&&(Qa=null,Oc(e,t));do try{rz();break}catch(h){vA(e,h)}while(!0);if(iw(),cn=i,Ly.current=o,jr!==null)throw Error(st(261));return Jr=null,pi=0,Gr}function rz(){for(;jr!==null;)bA(jr)}function iz(){for(;jr!==null&&!AN();)bA(jr)}function bA(e){var t=TA(e.alternate,e,ds);e.memoizedProps=e.pendingProps,t===null?wA(e):jr=t,yw.current=null}function wA(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=YL(i,t),i!==null){i.flags&=32767,jr=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Gr=6,jr=null;return}}else if(i=XL(i,t,ds),i!==null){jr=i;return}if(t=t.sibling,t!==null){jr=t;return}jr=t=e}while(t!==null);Gr===0&&(Gr=5)}function Pc(e,t,i){var o=En,h=js.transition;try{js.transition=null,En=1,sz(e,t,i,o)}finally{js.transition=h,En=o}return null}function sz(e,t,i,o){do Fh();while(il!==null);if(cn&6)throw Error(st(327));i=e.finishedWork;var h=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(st(177));e.callbackNode=null,e.callbackPriority=0;var m=i.lanes|i.childLanes;if(FN(e,m),e===Jr&&(jr=Jr=null,pi=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||zg||(zg=!0,EA(xy,function(){return Fh(),null})),m=(i.flags&15990)!==0,i.subtreeFlags&15990||m){m=js.transition,js.transition=null;var f=En;En=1;var c=cn;cn|=4,yw.current=null,QL(e,i),gA(i,e),EL(kx),wy=!!Cx,kx=Cx=null,e.current=i,ez(i),IN(),cn=c,En=f,js.transition=m}else e.current=i;if(zg&&(zg=!1,il=e,Oy=h),m=e.pendingLanes,m===0&&(dl=null),DN(i.stateNode),Yi(e,Sr()),t!==null)for(o=e.onRecoverableError,i=0;i<t.length;i++)h=t[i],o(h.value,{componentStack:h.stack,digest:h.digest});if(zy)throw zy=!1,e=Hx,Hx=null,e;return Oy&1&&e.tag!==0&&Fh(),m=e.pendingLanes,m&1?e===Kx?Kp++:(Kp=0,Kx=e):Kp=0,wl(),null}function Fh(){if(il!==null){var e=nk(Oy),t=js.transition,i=En;try{if(js.transition=null,En=16>e?16:e,il===null)var o=!1;else{if(e=il,il=null,Oy=0,cn&6)throw Error(st(331));var h=cn;for(cn|=4,xt=e.current;xt!==null;){var m=xt,f=m.child;if(xt.flags&16){var c=m.deletions;if(c!==null){for(var E=0;E<c.length;E++){var C=c[E];for(xt=C;xt!==null;){var R=xt;switch(R.tag){case 0:case 11:case 15:Zp(8,R,m)}var L=R.child;if(L!==null)L.return=R,xt=L;else for(;xt!==null;){R=xt;var B=R.sibling,X=R.return;if(pA(R),R===C){xt=null;break}if(B!==null){B.return=X,xt=B;break}xt=X}}}var W=m.alternate;if(W!==null){var te=W.child;if(te!==null){W.child=null;do{var G=te.sibling;te.sibling=null,te=G}while(te!==null)}}xt=m}}if(m.subtreeFlags&2064&&f!==null)f.return=m,xt=f;else e:for(;xt!==null;){if(m=xt,m.flags&2048)switch(m.tag){case 0:case 11:case 15:Zp(9,m,m.return)}var J=m.sibling;if(J!==null){J.return=m.return,xt=J;break e}xt=m.return}}var H=e.current;for(xt=H;xt!==null;){f=xt;var Q=f.child;if(f.subtreeFlags&2064&&Q!==null)Q.return=f,xt=Q;else e:for(f=H;xt!==null;){if(c=xt,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:u_(9,c)}}catch(ve){_r(c,c.return,ve)}if(c===f){xt=null;break e}var le=c.sibling;if(le!==null){le.return=c.return,xt=le;break e}xt=c.return}}if(cn=h,wl(),Sa&&typeof Sa.onPostCommitFiberRoot=="function")try{Sa.onPostCommitFiberRoot(n_,e)}catch{}o=!0}return o}finally{En=i,js.transition=t}}return!1}function B2(e,t,i){t=Wh(i,t),t=nA(e,t,1),e=hl(e,t,1),t=Li(),e!==null&&(jf(e,1,t),Yi(e,t))}function _r(e,t,i){if(e.tag===3)B2(e,e,i);else for(;t!==null;){if(t.tag===3){B2(t,e,i);break}else if(t.tag===1){var o=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(dl===null||!dl.has(o))){e=Wh(i,e),e=rA(t,e,1),t=hl(t,e,1),e=Li(),t!==null&&(jf(t,1,e),Yi(t,e));break}}t=t.return}}function az(e,t,i){var o=e.pingCache;o!==null&&o.delete(t),t=Li(),e.pingedLanes|=e.suspendedLanes&i,Jr===e&&(pi&i)===i&&(Gr===4||Gr===3&&(pi&130023424)===pi&&500>Sr()-vw?Oc(e,0):_w|=i),Yi(e,t)}function SA(e,t){t===0&&(e.mode&1?(t=Cg,Cg<<=1,!(Cg&130023424)&&(Cg=4194304)):t=1);var i=Li();e=co(e,t),e!==null&&(jf(e,t,i),Yi(e,i))}function oz(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),SA(e,i)}function lz(e,t){var i=0;switch(e.tag){case 13:var o=e.stateNode,h=e.memoizedState;h!==null&&(i=h.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(st(314))}o!==null&&o.delete(t),SA(e,i)}var TA;TA=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ki.current)Hi=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Hi=!1,KL(e,t,i);Hi=!!(e.flags&131072)}else Hi=!1,rr&&t.flags&1048576&&kk(t,Ay,t.index);switch(t.lanes=0,t.tag){case 2:var o=t.type;ay(e,t),e=t.pendingProps;var h=Uh(t,Ci.current);Oh(t,i),h=dw(null,t,o,e,h,i);var m=pw();return t.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Xi(o)?(m=!0,Cy(t)):m=!1,t.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,ow(t),h.updater=c_,t.stateNode=h,h._reactInternals=t,zx(t,o,e,i),t=Bx(null,t,o,!0,m,i)):(t.tag=0,rr&&m&&ew(t),Ni(null,t,h,i),t=t.child),t;case 16:o=t.elementType;e:{switch(ay(e,t),e=t.pendingProps,h=o._init,o=h(o._payload),t.type=o,h=t.tag=uz(o),e=Xs(o,e),h){case 0:t=Fx(null,t,o,e,i);break e;case 1:t=I2(null,t,o,e,i);break e;case 11:t=k2(null,t,o,e,i);break e;case 14:t=A2(null,t,o,Xs(o.type,e),i);break e}throw Error(st(306,o,""))}return t;case 0:return o=t.type,h=t.pendingProps,h=t.elementType===o?h:Xs(o,h),Fx(e,t,o,h,i);case 1:return o=t.type,h=t.pendingProps,h=t.elementType===o?h:Xs(o,h),I2(e,t,o,h,i);case 3:e:{if(oA(t),e===null)throw Error(st(387));o=t.pendingProps,m=t.memoizedState,h=m.element,jk(e,t),Ry(t,o,null,i);var f=t.memoizedState;if(o=f.element,m.isDehydrated)if(m={element:o,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},t.updateQueue.baseState=m,t.memoizedState=m,t.flags&256){h=Wh(Error(st(423)),t),t=M2(e,t,o,i,h);break e}else if(o!==h){h=Wh(Error(st(424)),t),t=M2(e,t,o,i,h);break e}else for(ms=ul(t.stateNode.containerInfo.firstChild),gs=t,rr=!0,ea=null,i=Rk(t,null,o,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if($h(),o===h){t=uo(e,t,i);break e}Ni(e,t,o,i)}t=t.child}return t;case 5:return Nk(t),e===null&&jx(t),o=t.type,h=t.pendingProps,m=e!==null?e.memoizedProps:null,f=h.children,Ax(o,h)?f=null:m!==null&&Ax(o,m)&&(t.flags|=32),aA(e,t),Ni(e,t,f,i),t.child;case 6:return e===null&&jx(t),null;case 13:return lA(e,t,i);case 4:return lw(t,t.stateNode.containerInfo),o=t.pendingProps,e===null?t.child=Gh(t,null,o,i):Ni(e,t,o,i),t.child;case 11:return o=t.type,h=t.pendingProps,h=t.elementType===o?h:Xs(o,h),k2(e,t,o,h,i);case 7:return Ni(e,t,t.pendingProps,i),t.child;case 8:return Ni(e,t,t.pendingProps.children,i),t.child;case 12:return Ni(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(o=t.type._context,h=t.pendingProps,m=t.memoizedProps,f=h.value,Vn(Iy,o._currentValue),o._currentValue=f,m!==null)if(ra(m.value,f)){if(m.children===h.children&&!Ki.current){t=uo(e,t,i);break e}}else for(m=t.child,m!==null&&(m.return=t);m!==null;){var c=m.dependencies;if(c!==null){f=m.child;for(var E=c.firstContext;E!==null;){if(E.context===o){if(m.tag===1){E=io(-1,i&-i),E.tag=2;var C=m.updateQueue;if(C!==null){C=C.shared;var R=C.pending;R===null?E.next=E:(E.next=R.next,R.next=E),C.pending=E}}m.lanes|=i,E=m.alternate,E!==null&&(E.lanes|=i),Nx(m.return,i,t),c.lanes|=i;break}E=E.next}}else if(m.tag===10)f=m.type===t.type?null:m.child;else if(m.tag===18){if(f=m.return,f===null)throw Error(st(341));f.lanes|=i,c=f.alternate,c!==null&&(c.lanes|=i),Nx(f,i,t),f=m.sibling}else f=m.child;if(f!==null)f.return=m;else for(f=m;f!==null;){if(f===t){f=null;break}if(m=f.sibling,m!==null){m.return=f.return,f=m;break}f=f.return}m=f}Ni(e,t,h.children,i),t=t.child}return t;case 9:return h=t.type,o=t.pendingProps.children,Oh(t,i),h=Ns(h),o=o(h),t.flags|=1,Ni(e,t,o,i),t.child;case 14:return o=t.type,h=Xs(o,t.pendingProps),h=Xs(o.type,h),A2(e,t,o,h,i);case 15:return iA(e,t,t.type,t.pendingProps,i);case 17:return o=t.type,h=t.pendingProps,h=t.elementType===o?h:Xs(o,h),ay(e,t),t.tag=1,Xi(o)?(e=!0,Cy(t)):e=!1,Oh(t,i),tA(t,o,h),zx(t,o,h,i),Bx(null,t,o,!0,e,i);case 19:return cA(e,t,i);case 22:return sA(e,t,i)}throw Error(st(156,t.tag))};function EA(e,t){return JC(e,t)}function cz(e,t,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(e,t,i,o){return new cz(e,t,i,o)}function Sw(e){return e=e.prototype,!(!e||!e.isReactComponent)}function uz(e){if(typeof e=="function")return Sw(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ub)return 11;if(e===$b)return 14}return 2}function fl(e,t){var i=e.alternate;return i===null?(i=Ds(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function cy(e,t,i,o,h,m){var f=2;if(o=e,typeof e=="function")Sw(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case yh:return Fc(i.children,h,m,t);case Vb:f=8,h|=8;break;case ox:return e=Ds(12,i,t,h|2),e.elementType=ox,e.lanes=m,e;case lx:return e=Ds(13,i,t,h),e.elementType=lx,e.lanes=m,e;case cx:return e=Ds(19,i,t,h),e.elementType=cx,e.lanes=m,e;case NC:return d_(i,h,m,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case DC:f=10;break e;case jC:f=9;break e;case Ub:f=11;break e;case $b:f=14;break e;case Yo:f=16,o=null;break e}throw Error(st(130,e==null?e:typeof e,""))}return t=Ds(f,i,t,h),t.elementType=e,t.type=o,t.lanes=m,t}function Fc(e,t,i,o){return e=Ds(7,e,o,t),e.lanes=i,e}function d_(e,t,i,o){return e=Ds(22,e,o,t),e.elementType=NC,e.lanes=i,e.stateNode={isHidden:!1},e}function C0(e,t,i){return e=Ds(6,e,null,t),e.lanes=i,e}function k0(e,t,i){return t=Ds(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function hz(e,t,i,o,h){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=l0(0),this.expirationTimes=l0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l0(0),this.identifierPrefix=o,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function Tw(e,t,i,o,h,m,f,c,E){return e=new hz(e,t,i,c,E),t===1?(t=1,m===!0&&(t|=8)):t=0,m=Ds(3,null,null,t),e.current=m,m.stateNode=e,m.memoizedState={element:o,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},ow(m),e}function dz(e,t,i){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:gh,key:o==null?null:""+o,children:e,containerInfo:t,implementation:i}}function PA(e){if(!e)return yl;e=e._reactInternals;e:{if(Kc(e)!==e||e.tag!==1)throw Error(st(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Xi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(st(171))}if(e.tag===1){var i=e.type;if(Xi(i))return Pk(e,i,t)}return t}function CA(e,t,i,o,h,m,f,c,E){return e=Tw(i,o,!0,e,h,m,f,c,E),e.context=PA(null),i=e.current,o=Li(),h=pl(i),m=io(o,h),m.callback=t??null,hl(i,m,h),e.current.lanes=h,jf(e,h,o),Yi(e,o),e}function p_(e,t,i,o){var h=t.current,m=Li(),f=pl(h);return i=PA(i),t.context===null?t.context=i:t.pendingContext=i,t=io(m,f),t.payload={element:e},o=o===void 0?null:o,o!==null&&(t.callback=o),e=hl(h,t,f),e!==null&&(na(e,h,f,m),ry(e,h,f)),f}function By(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function V2(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Ew(e,t){V2(e,t),(e=e.alternate)&&V2(e,t)}function pz(){return null}var kA=typeof reportError=="function"?reportError:function(e){console.error(e)};function Pw(e){this._internalRoot=e}f_.prototype.render=Pw.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(st(409));p_(e,t,null,null)};f_.prototype.unmount=Pw.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Wc(function(){p_(null,e,null,null)}),t[lo]=null}};function f_(e){this._internalRoot=e}f_.prototype.unstable_scheduleHydration=function(e){if(e){var t=sk();e={blockedOn:null,target:e,priority:t};for(var i=0;i<el.length&&t!==0&&t<el[i].priority;i++);el.splice(i,0,e),i===0&&ok(e)}};function Cw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function m_(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function U2(){}function fz(e,t,i,o,h){if(h){if(typeof o=="function"){var m=o;o=function(){var C=By(f);m.call(C)}}var f=CA(t,o,e,0,null,!1,!1,"",U2);return e._reactRootContainer=f,e[lo]=f.current,hf(e.nodeType===8?e.parentNode:e),Wc(),f}for(;h=e.lastChild;)e.removeChild(h);if(typeof o=="function"){var c=o;o=function(){var C=By(E);c.call(C)}}var E=Tw(e,0,!1,null,null,!1,!1,"",U2);return e._reactRootContainer=E,e[lo]=E.current,hf(e.nodeType===8?e.parentNode:e),Wc(function(){p_(t,E,i,o)}),E}function g_(e,t,i,o,h){var m=i._reactRootContainer;if(m){var f=m;if(typeof h=="function"){var c=h;h=function(){var E=By(f);c.call(E)}}p_(t,f,e,h)}else f=fz(i,t,e,h,o);return By(f)}rk=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=Np(t.pendingLanes);i!==0&&(Wb(t,i|1),Yi(t,Sr()),!(cn&6)&&(Zh=Sr()+500,wl()))}break;case 13:Wc(function(){var o=co(e,1);if(o!==null){var h=Li();na(o,e,1,h)}}),Ew(e,1)}};Zb=function(e){if(e.tag===13){var t=co(e,134217728);if(t!==null){var i=Li();na(t,e,134217728,i)}Ew(e,134217728)}};ik=function(e){if(e.tag===13){var t=pl(e),i=co(e,t);if(i!==null){var o=Li();na(i,e,t,o)}Ew(e,t)}};sk=function(){return En};ak=function(e,t){var i=En;try{return En=e,t()}finally{En=i}};vx=function(e,t,i){switch(t){case"input":if(dx(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var o=i[t];if(o!==e&&o.form===e.form){var h=a_(o);if(!h)throw Error(st(90));zC(o),dx(o,h)}}}break;case"textarea":FC(e,i);break;case"select":t=i.value,t!=null&&jh(e,!!i.multiple,t,!1)}};WC=xw;ZC=Wc;var mz={usingClientEntryPoint:!1,Events:[Lf,bh,a_,GC,qC,xw]},Ip={findFiberByHostInstance:Rc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},gz={bundleType:Ip.bundleType,version:Ip.version,rendererPackageName:Ip.rendererPackageName,rendererConfig:Ip.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:po.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=XC(e),e===null?null:e.stateNode},findFiberByHostInstance:Ip.findFiberByHostInstance||pz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Og=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Og.isDisabled&&Og.supportsFiber)try{n_=Og.inject(gz),Sa=Og}catch{}}bs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mz;bs.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cw(t))throw Error(st(200));return dz(e,t,null,i)};bs.createRoot=function(e,t){if(!Cw(e))throw Error(st(299));var i=!1,o="",h=kA;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(h=t.onRecoverableError)),t=Tw(e,1,!1,null,null,i,!1,o,h),e[lo]=t.current,hf(e.nodeType===8?e.parentNode:e),new Pw(t)};bs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(st(188)):(e=Object.keys(e).join(","),Error(st(268,e)));return e=XC(t),e=e===null?null:e.stateNode,e};bs.flushSync=function(e){return Wc(e)};bs.hydrate=function(e,t,i){if(!m_(t))throw Error(st(200));return g_(null,e,t,!0,i)};bs.hydrateRoot=function(e,t,i){if(!Cw(e))throw Error(st(405));var o=i!=null&&i.hydratedSources||null,h=!1,m="",f=kA;if(i!=null&&(i.unstable_strictMode===!0&&(h=!0),i.identifierPrefix!==void 0&&(m=i.identifierPrefix),i.onRecoverableError!==void 0&&(f=i.onRecoverableError)),t=CA(t,null,e,1,i??null,h,!1,m,f),e[lo]=t.current,hf(e),o)for(e=0;e<o.length;e++)i=o[e],h=i._getVersion,h=h(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,h]:t.mutableSourceEagerHydrationData.push(i,h);return new f_(t)};bs.render=function(e,t,i){if(!m_(t))throw Error(st(200));return g_(null,e,t,!1,i)};bs.unmountComponentAtNode=function(e){if(!m_(e))throw Error(st(40));return e._reactRootContainer?(Wc(function(){g_(null,null,e,!1,function(){e._reactRootContainer=null,e[lo]=null})}),!0):!1};bs.unstable_batchedUpdates=xw;bs.unstable_renderSubtreeIntoContainer=function(e,t,i,o){if(!m_(i))throw Error(st(200));if(e==null||e._reactInternals===void 0)throw Error(st(38));return g_(e,t,i,!1,o)};bs.version="18.3.1-next-f1338f8080-20240426";function AA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(AA)}catch(e){console.error(e)}}AA(),AC.exports=bs;var yz=AC.exports,IA,$2=yz;IA=$2.createRoot,$2.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xf(){return xf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},xf.apply(this,arguments)}var sl;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(sl||(sl={}));const G2="popstate";function _z(e){e===void 0&&(e={});function t(o,h){let{pathname:m,search:f,hash:c}=o.location;return Jx("",{pathname:m,search:f,hash:c},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function i(o,h){return typeof h=="string"?h:Vy(h)}return xz(t,i,null,e)}function Tr(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function kw(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function vz(){return Math.random().toString(36).substr(2,8)}function q2(e,t){return{usr:e.state,key:e.key,idx:t}}function Jx(e,t,i,o){return i===void 0&&(i=null),xf({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?nd(t):t,{state:i,key:t&&t.key||o||vz()})}function Vy(e){let{pathname:t="/",search:i="",hash:o=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function nd(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let o=e.indexOf("?");o>=0&&(t.search=e.substr(o),e=e.substr(0,o)),e&&(t.pathname=e)}return t}function xz(e,t,i,o){o===void 0&&(o={});let{window:h=document.defaultView,v5Compat:m=!1}=o,f=h.history,c=sl.Pop,E=null,C=R();C==null&&(C=0,f.replaceState(xf({},f.state,{idx:C}),""));function R(){return(f.state||{idx:null}).idx}function L(){c=sl.Pop;let G=R(),J=G==null?null:G-C;C=G,E&&E({action:c,location:te.location,delta:J})}function B(G,J){c=sl.Push;let H=Jx(te.location,G,J);C=R()+1;let Q=q2(H,C),le=te.createHref(H);try{f.pushState(Q,"",le)}catch(ve){if(ve instanceof DOMException&&ve.name==="DataCloneError")throw ve;h.location.assign(le)}m&&E&&E({action:c,location:te.location,delta:1})}function X(G,J){c=sl.Replace;let H=Jx(te.location,G,J);C=R();let Q=q2(H,C),le=te.createHref(H);f.replaceState(Q,"",le),m&&E&&E({action:c,location:te.location,delta:0})}function W(G){let J=h.location.origin!=="null"?h.location.origin:h.location.href,H=typeof G=="string"?G:Vy(G);return H=H.replace(/ $/,"%20"),Tr(J,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,J)}let te={get action(){return c},get location(){return e(h,f)},listen(G){if(E)throw new Error("A history only accepts one active listener");return h.addEventListener(G2,L),E=G,()=>{h.removeEventListener(G2,L),E=null}},createHref(G){return t(h,G)},createURL:W,encodeLocation(G){let J=W(G);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:B,replace:X,go(G){return f.go(G)}};return te}var W2;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(W2||(W2={}));function bz(e,t,i){return i===void 0&&(i="/"),wz(e,t,i)}function wz(e,t,i,o){let h=typeof t=="string"?nd(t):t,m=Aw(h.pathname||"/",i);if(m==null)return null;let f=MA(e);Sz(f);let c=null;for(let E=0;c==null&&E<f.length;++E){let C=Nz(m);c=Rz(f[E],C)}return c}function MA(e,t,i,o){t===void 0&&(t=[]),i===void 0&&(i=[]),o===void 0&&(o="");let h=(m,f,c)=>{let E={relativePath:c===void 0?m.path||"":c,caseSensitive:m.caseSensitive===!0,childrenIndex:f,route:m};E.relativePath.startsWith("/")&&(Tr(E.relativePath.startsWith(o),'Absolute route path "'+E.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),E.relativePath=E.relativePath.slice(o.length));let C=ml([o,E.relativePath]),R=i.concat(E);m.children&&m.children.length>0&&(Tr(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+C+'".')),MA(m.children,t,R,C)),!(m.path==null&&!m.index)&&t.push({path:C,score:Iz(C,m.index),routesMeta:R})};return e.forEach((m,f)=>{var c;if(m.path===""||!((c=m.path)!=null&&c.includes("?")))h(m,f);else for(let E of RA(m.path))h(m,f,E)}),t}function RA(e){let t=e.split("/");if(t.length===0)return[];let[i,...o]=t,h=i.endsWith("?"),m=i.replace(/\?$/,"");if(o.length===0)return h?[m,""]:[m];let f=RA(o.join("/")),c=[];return c.push(...f.map(E=>E===""?m:[m,E].join("/"))),h&&c.push(...f),c.map(E=>e.startsWith("/")&&E===""?"/":E)}function Sz(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:Mz(t.routesMeta.map(o=>o.childrenIndex),i.routesMeta.map(o=>o.childrenIndex)))}const Tz=/^:[\w-]+$/,Ez=3,Pz=2,Cz=1,kz=10,Az=-2,Z2=e=>e==="*";function Iz(e,t){let i=e.split("/"),o=i.length;return i.some(Z2)&&(o+=Az),t&&(o+=Pz),i.filter(h=>!Z2(h)).reduce((h,m)=>h+(Tz.test(m)?Ez:m===""?Cz:kz),o)}function Mz(e,t){return e.length===t.length&&e.slice(0,-1).every((o,h)=>o===t[h])?e[e.length-1]-t[t.length-1]:0}function Rz(e,t,i){let{routesMeta:o}=e,h={},m="/",f=[];for(let c=0;c<o.length;++c){let E=o[c],C=c===o.length-1,R=m==="/"?t:t.slice(m.length)||"/",L=Dz({path:E.relativePath,caseSensitive:E.caseSensitive,end:C},R),B=E.route;if(!L)return null;Object.assign(h,L.params),f.push({params:h,pathname:ml([m,L.pathname]),pathnameBase:Bz(ml([m,L.pathnameBase])),route:B}),L.pathnameBase!=="/"&&(m=ml([m,L.pathnameBase]))}return f}function Dz(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,o]=jz(e.path,e.caseSensitive,e.end),h=t.match(i);if(!h)return null;let m=h[0],f=m.replace(/(.)\/+$/,"$1"),c=h.slice(1);return{params:o.reduce((C,R,L)=>{let{paramName:B,isOptional:X}=R;if(B==="*"){let te=c[L]||"";f=m.slice(0,m.length-te.length).replace(/(.)\/+$/,"$1")}const W=c[L];return X&&!W?C[B]=void 0:C[B]=(W||"").replace(/%2F/g,"/"),C},{}),pathname:m,pathnameBase:f,pattern:e}}function jz(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),kw(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],h="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,c,E)=>(o.push({paramName:c,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),h+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?h+="\\/*$":e!==""&&e!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,t?void 0:"i"),o]}function Nz(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return kw(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Aw(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,o=e.charAt(i);return o&&o!=="/"?null:e.slice(i)||"/"}const Lz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zz=e=>Lz.test(e);function Oz(e,t){t===void 0&&(t="/");let{pathname:i,search:o="",hash:h=""}=typeof e=="string"?nd(e):e,m;if(i)if(zz(i))m=i;else{if(i.includes("//")){let f=i;i=i.replace(/\/\/+/g,"/"),kw(!1,"Pathnames cannot have embedded double slashes - normalizing "+(f+" -> "+i))}i.startsWith("/")?m=H2(i.substring(1),"/"):m=H2(i,t)}else m=t;return{pathname:m,search:Vz(o),hash:Uz(h)}}function H2(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(h=>{h===".."?i.length>1&&i.pop():h!=="."&&i.push(h)}),i.length>1?i.join("/"):"/"}function A0(e,t,i,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Fz(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function Iw(e,t){let i=Fz(e);return t?i.map((o,h)=>h===i.length-1?o.pathname:o.pathnameBase):i.map(o=>o.pathnameBase)}function Mw(e,t,i,o){o===void 0&&(o=!1);let h;typeof e=="string"?h=nd(e):(h=xf({},e),Tr(!h.pathname||!h.pathname.includes("?"),A0("?","pathname","search",h)),Tr(!h.pathname||!h.pathname.includes("#"),A0("#","pathname","hash",h)),Tr(!h.search||!h.search.includes("#"),A0("#","search","hash",h)));let m=e===""||h.pathname==="",f=m?"/":h.pathname,c;if(f==null)c=i;else{let L=t.length-1;if(!o&&f.startsWith("..")){let B=f.split("/");for(;B[0]==="..";)B.shift(),L-=1;h.pathname=B.join("/")}c=L>=0?t[L]:"/"}let E=Oz(h,c),C=f&&f!=="/"&&f.endsWith("/"),R=(m||f===".")&&i.endsWith("/");return!E.pathname.endsWith("/")&&(C||R)&&(E.pathname+="/"),E}const ml=e=>e.join("/").replace(/\/\/+/g,"/"),Bz=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Vz=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Uz=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function $z(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const DA=["post","put","patch","delete"];new Set(DA);const Gz=["get",...DA];new Set(Gz);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bf(){return bf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},bf.apply(this,arguments)}const Rw=ze.createContext(null),qz=ze.createContext(null),Sl=ze.createContext(null),y_=ze.createContext(null),fo=ze.createContext({outlet:null,matches:[],isDataRoute:!1}),jA=ze.createContext(null);function Wz(e,t){let{relative:i}=t===void 0?{}:t;rd()||Tr(!1);let{basename:o,navigator:h}=ze.useContext(Sl),{hash:m,pathname:f,search:c}=zA(e,{relative:i}),E=f;return o!=="/"&&(E=f==="/"?o:ml([o,f])),h.createHref({pathname:E,search:c,hash:m})}function rd(){return ze.useContext(y_)!=null}function Xc(){return rd()||Tr(!1),ze.useContext(y_).location}function NA(e){ze.useContext(Sl).static||ze.useLayoutEffect(e)}function qr(){let{isDataRoute:e}=ze.useContext(fo);return e?sO():Zz()}function Zz(){rd()||Tr(!1);let e=ze.useContext(Rw),{basename:t,future:i,navigator:o}=ze.useContext(Sl),{matches:h}=ze.useContext(fo),{pathname:m}=Xc(),f=JSON.stringify(Iw(h,i.v7_relativeSplatPath)),c=ze.useRef(!1);return NA(()=>{c.current=!0}),ze.useCallback(function(C,R){if(R===void 0&&(R={}),!c.current)return;if(typeof C=="number"){o.go(C);return}let L=Mw(C,JSON.parse(f),m,R.relative==="path");e==null&&t!=="/"&&(L.pathname=L.pathname==="/"?t:ml([t,L.pathname])),(R.replace?o.replace:o.push)(L,R.state,R)},[t,o,f,m,e])}function LA(){let{matches:e}=ze.useContext(fo),t=e[e.length-1];return t?t.params:{}}function zA(e,t){let{relative:i}=t===void 0?{}:t,{future:o}=ze.useContext(Sl),{matches:h}=ze.useContext(fo),{pathname:m}=Xc(),f=JSON.stringify(Iw(h,o.v7_relativeSplatPath));return ze.useMemo(()=>Mw(e,JSON.parse(f),m,i==="path"),[e,f,m,i])}function Hz(e,t){return Kz(e,t)}function Kz(e,t,i,o){rd()||Tr(!1);let{navigator:h}=ze.useContext(Sl),{matches:m}=ze.useContext(fo),f=m[m.length-1],c=f?f.params:{};f&&f.pathname;let E=f?f.pathnameBase:"/";f&&f.route;let C=Xc(),R;if(t){var L;let G=typeof t=="string"?nd(t):t;E==="/"||(L=G.pathname)!=null&&L.startsWith(E)||Tr(!1),R=G}else R=C;let B=R.pathname||"/",X=B;if(E!=="/"){let G=E.replace(/^\//,"").split("/");X="/"+B.replace(/^\//,"").split("/").slice(G.length).join("/")}let W=bz(e,{pathname:X}),te=eO(W&&W.map(G=>Object.assign({},G,{params:Object.assign({},c,G.params),pathname:ml([E,h.encodeLocation?h.encodeLocation(G.pathname).pathname:G.pathname]),pathnameBase:G.pathnameBase==="/"?E:ml([E,h.encodeLocation?h.encodeLocation(G.pathnameBase).pathname:G.pathnameBase])})),m,i,o);return t&&te?ze.createElement(y_.Provider,{value:{location:bf({pathname:"/",search:"",hash:"",state:null,key:"default"},R),navigationType:sl.Pop}},te):te}function Xz(){let e=iO(),t=$z(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,h={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ze.createElement(ze.Fragment,null,ze.createElement("h2",null,"Unexpected Application Error!"),ze.createElement("h3",{style:{fontStyle:"italic"}},t),i?ze.createElement("pre",{style:h},i):null,null)}const Yz=ze.createElement(Xz,null);class Jz extends ze.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?ze.createElement(fo.Provider,{value:this.props.routeContext},ze.createElement(jA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Qz(e){let{routeContext:t,match:i,children:o}=e,h=ze.useContext(Rw);return h&&h.static&&h.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=i.route.id),ze.createElement(fo.Provider,{value:t},o)}function eO(e,t,i,o){var h;if(t===void 0&&(t=[]),i===void 0&&(i=null),o===void 0&&(o=null),e==null){var m;if(!i)return null;if(i.errors)e=i.matches;else if((m=o)!=null&&m.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let f=e,c=(h=i)==null?void 0:h.errors;if(c!=null){let R=f.findIndex(L=>L.route.id&&(c==null?void 0:c[L.route.id])!==void 0);R>=0||Tr(!1),f=f.slice(0,Math.min(f.length,R+1))}let E=!1,C=-1;if(i&&o&&o.v7_partialHydration)for(let R=0;R<f.length;R++){let L=f[R];if((L.route.HydrateFallback||L.route.hydrateFallbackElement)&&(C=R),L.route.id){let{loaderData:B,errors:X}=i,W=L.route.loader&&B[L.route.id]===void 0&&(!X||X[L.route.id]===void 0);if(L.route.lazy||W){E=!0,C>=0?f=f.slice(0,C+1):f=[f[0]];break}}}return f.reduceRight((R,L,B)=>{let X,W=!1,te=null,G=null;i&&(X=c&&L.route.id?c[L.route.id]:void 0,te=L.route.errorElement||Yz,E&&(C<0&&B===0?(aO("route-fallback"),W=!0,G=null):C===B&&(W=!0,G=L.route.hydrateFallbackElement||null)));let J=t.concat(f.slice(0,B+1)),H=()=>{let Q;return X?Q=te:W?Q=G:L.route.Component?Q=ze.createElement(L.route.Component,null):L.route.element?Q=L.route.element:Q=R,ze.createElement(Qz,{match:L,routeContext:{outlet:R,matches:J,isDataRoute:i!=null},children:Q})};return i&&(L.route.ErrorBoundary||L.route.errorElement||B===0)?ze.createElement(Jz,{location:i.location,revalidation:i.revalidation,component:te,error:X,children:H(),routeContext:{outlet:null,matches:J,isDataRoute:!0}}):H()},null)}var OA=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(OA||{}),FA=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(FA||{});function tO(e){let t=ze.useContext(Rw);return t||Tr(!1),t}function nO(e){let t=ze.useContext(qz);return t||Tr(!1),t}function rO(e){let t=ze.useContext(fo);return t||Tr(!1),t}function BA(e){let t=rO(),i=t.matches[t.matches.length-1];return i.route.id||Tr(!1),i.route.id}function iO(){var e;let t=ze.useContext(jA),i=nO(),o=BA();return t!==void 0?t:(e=i.errors)==null?void 0:e[o]}function sO(){let{router:e}=tO(OA.UseNavigateStable),t=BA(FA.UseNavigateStable),i=ze.useRef(!1);return NA(()=>{i.current=!0}),ze.useCallback(function(h,m){m===void 0&&(m={}),i.current&&(typeof h=="number"?e.navigate(h):e.navigate(h,bf({fromRouteId:t},m)))},[e,t])}const K2={};function aO(e,t,i){K2[e]||(K2[e]=!0)}function oO(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Hh(e){let{to:t,replace:i,state:o,relative:h}=e;rd()||Tr(!1);let{future:m,static:f}=ze.useContext(Sl),{matches:c}=ze.useContext(fo),{pathname:E}=Xc(),C=qr(),R=Mw(t,Iw(c,m.v7_relativeSplatPath),E,h==="path"),L=JSON.stringify(R);return ze.useEffect(()=>C(JSON.parse(L),{replace:i,state:o,relative:h}),[C,L,h,i,o]),null}function Vr(e){Tr(!1)}function lO(e){let{basename:t="/",children:i=null,location:o,navigationType:h=sl.Pop,navigator:m,static:f=!1,future:c}=e;rd()&&Tr(!1);let E=t.replace(/^\/*/,"/"),C=ze.useMemo(()=>({basename:E,navigator:m,static:f,future:bf({v7_relativeSplatPath:!1},c)}),[E,c,m,f]);typeof o=="string"&&(o=nd(o));let{pathname:R="/",search:L="",hash:B="",state:X=null,key:W="default"}=o,te=ze.useMemo(()=>{let G=Aw(R,E);return G==null?null:{location:{pathname:G,search:L,hash:B,state:X,key:W},navigationType:h}},[E,R,L,B,X,W,h]);return te==null?null:ze.createElement(Sl.Provider,{value:C},ze.createElement(y_.Provider,{children:i,value:te}))}function cO(e){let{children:t,location:i}=e;return Hz(Qx(t),i)}new Promise(()=>{});function Qx(e,t){t===void 0&&(t=[]);let i=[];return ze.Children.forEach(e,(o,h)=>{if(!ze.isValidElement(o))return;let m=[...t,h];if(o.type===ze.Fragment){i.push.apply(i,Qx(o.props.children,m));return}o.type!==Vr&&Tr(!1),!o.props.index||!o.props.children||Tr(!1);let f={id:o.props.id||m.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(f.children=Qx(o.props.children,m)),i.push(f)}),i}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function eb(){return eb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},eb.apply(this,arguments)}function uO(e,t){if(e==null)return{};var i={},o=Object.keys(e),h,m;for(m=0;m<o.length;m++)h=o[m],!(t.indexOf(h)>=0)&&(i[h]=e[h]);return i}function hO(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function dO(e,t){return e.button===0&&(!t||t==="_self")&&!hO(e)}function tb(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,i)=>{let o=e[i];return t.concat(Array.isArray(o)?o.map(h=>[i,h]):[[i,o]])},[]))}function pO(e,t){let i=tb(e);return t&&t.forEach((o,h)=>{i.has(h)||t.getAll(h).forEach(m=>{i.append(h,m)})}),i}const fO=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],mO="6";try{window.__reactRouterVersion=mO}catch{}const gO="startTransition",X2=aN[gO];function yO(e){let{basename:t,children:i,future:o,window:h}=e,m=ze.useRef();m.current==null&&(m.current=_z({window:h,v5Compat:!0}));let f=m.current,[c,E]=ze.useState({action:f.action,location:f.location}),{v7_startTransition:C}=o||{},R=ze.useCallback(L=>{C&&X2?X2(()=>E(L)):E(L)},[E,C]);return ze.useLayoutEffect(()=>f.listen(R),[f,R]),ze.useEffect(()=>oO(o),[o]),ze.createElement(lO,{basename:t,children:i,location:c.location,navigationType:c.action,navigator:f,future:o})}const _O=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",vO=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ja=ze.forwardRef(function(t,i){let{onClick:o,relative:h,reloadDocument:m,replace:f,state:c,target:E,to:C,preventScrollReset:R,viewTransition:L}=t,B=uO(t,fO),{basename:X}=ze.useContext(Sl),W,te=!1;if(typeof C=="string"&&vO.test(C)&&(W=C,_O))try{let Q=new URL(window.location.href),le=C.startsWith("//")?new URL(Q.protocol+C):new URL(C),ve=Aw(le.pathname,X);le.origin===Q.origin&&ve!=null?C=ve+le.search+le.hash:te=!0}catch{}let G=Wz(C,{relative:h}),J=xO(C,{replace:f,state:c,target:E,preventScrollReset:R,relative:h,viewTransition:L});function H(Q){o&&o(Q),Q.defaultPrevented||J(Q)}return ze.createElement("a",eb({},B,{href:W||G,onClick:te||m?o:H,ref:i,target:E}))});var Y2;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Y2||(Y2={}));var J2;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(J2||(J2={}));function xO(e,t){let{target:i,replace:o,state:h,preventScrollReset:m,relative:f,viewTransition:c}=t===void 0?{}:t,E=qr(),C=Xc(),R=zA(e,{relative:f});return ze.useCallback(L=>{if(dO(L,i)){L.preventDefault();let B=o!==void 0?o:Vy(C)===Vy(R);E(e,{replace:B,state:h,preventScrollReset:m,relative:f,viewTransition:c})}},[C,E,R,o,h,i,e,m,f,c])}function Dw(e){let t=ze.useRef(tb(e)),i=ze.useRef(!1),o=Xc(),h=ze.useMemo(()=>pO(o.search,i.current?null:t.current),[o.search]),m=qr(),f=ze.useCallback((c,E)=>{const C=tb(typeof c=="function"?c(h):c);i.current=!0,m("?"+C,E)},[m,h]);return[h,f]}const jw=ze.createContext({});function Nw(e){const t=ze.useRef(null);return t.current===null&&(t.current=e()),t.current}const __=ze.createContext(null),Lw=ze.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class bO extends ze.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function wO({children:e,isPresent:t}){const i=ze.useId(),o=ze.useRef(null),h=ze.useRef({width:0,height:0,top:0,left:0}),{nonce:m}=ze.useContext(Lw);return ze.useInsertionEffect(()=>{const{width:f,height:c,top:E,left:C}=h.current;if(t||!o.current||!f||!c)return;o.current.dataset.motionPopId=i;const R=document.createElement("style");return m&&(R.nonce=m),document.head.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${c}px !important;
            top: ${E}px !important;
            left: ${C}px !important;
          }
        `),()=>{document.head.removeChild(R)}},[t]),S.jsx(bO,{isPresent:t,childRef:o,sizeRef:h,children:ze.cloneElement(e,{ref:o})})}const SO=({children:e,initial:t,isPresent:i,onExitComplete:o,custom:h,presenceAffectsLayout:m,mode:f})=>{const c=Nw(TO),E=ze.useId(),C=ze.useCallback(L=>{c.set(L,!0);for(const B of c.values())if(!B)return;o&&o()},[c,o]),R=ze.useMemo(()=>({id:E,initial:t,isPresent:i,custom:h,onExitComplete:C,register:L=>(c.set(L,!1),()=>c.delete(L))}),m?[Math.random(),C]:[i,C]);return ze.useMemo(()=>{c.forEach((L,B)=>c.set(B,!1))},[i]),ze.useEffect(()=>{!i&&!c.size&&o&&o()},[i]),f==="popLayout"&&(e=S.jsx(wO,{isPresent:i,children:e})),S.jsx(__.Provider,{value:R,children:e})};function TO(){return new Map}function VA(e=!0){const t=ze.useContext(__);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:h}=t,m=ze.useId();ze.useEffect(()=>{e&&h(m)},[e]);const f=ze.useCallback(()=>e&&o&&o(m),[m,o,e]);return!i&&o?[!1,f]:[!0]}const Fg=e=>e.key||"";function Q2(e){const t=[];return ze.Children.forEach(e,i=>{ze.isValidElement(i)&&t.push(i)}),t}const zw=typeof window<"u",UA=zw?ze.useLayoutEffect:ze.useEffect,EO=({children:e,custom:t,initial:i=!0,onExitComplete:o,presenceAffectsLayout:h=!0,mode:m="sync",propagate:f=!1})=>{const[c,E]=VA(f),C=ze.useMemo(()=>Q2(e),[e]),R=f&&!c?[]:C.map(Fg),L=ze.useRef(!0),B=ze.useRef(C),X=Nw(()=>new Map),[W,te]=ze.useState(C),[G,J]=ze.useState(C);UA(()=>{L.current=!1,B.current=C;for(let le=0;le<G.length;le++){const ve=Fg(G[le]);R.includes(ve)?X.delete(ve):X.get(ve)!==!0&&X.set(ve,!1)}},[G,R.length,R.join("-")]);const H=[];if(C!==W){let le=[...C];for(let ve=0;ve<G.length;ve++){const Ee=G[ve],_e=Fg(Ee);R.includes(_e)||(le.splice(ve,0,Ee),H.push(Ee))}m==="wait"&&H.length&&(le=H),J(Q2(le)),te(C);return}const{forceRender:Q}=ze.useContext(jw);return S.jsx(S.Fragment,{children:G.map(le=>{const ve=Fg(le),Ee=f&&!c?!1:C===G||R.includes(ve),_e=()=>{if(X.has(ve))X.set(ve,!0);else return;let we=!0;X.forEach(Ge=>{Ge||(we=!1)}),we&&(Q==null||Q(),J(B.current),f&&(E==null||E()),o&&o())};return S.jsx(SO,{isPresent:Ee,initial:!L.current||i?void 0:!1,custom:Ee?void 0:t,presenceAffectsLayout:h,mode:m,onExitComplete:Ee?void 0:_e,children:le},ve)})})},ys=e=>e;let $A=ys;function Ow(e){let t;return()=>(t===void 0&&(t=e()),t)}const Kh=(e,t,i)=>{const o=t-e;return o===0?1:(i-e)/o},so=e=>e*1e3,ao=e=>e/1e3,PO={useManualTiming:!1};function CO(e){let t=new Set,i=new Set,o=!1,h=!1;const m=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function c(C){m.has(C)&&(E.schedule(C),e()),C(f)}const E={schedule:(C,R=!1,L=!1)=>{const X=L&&o?t:i;return R&&m.add(C),X.has(C)||X.add(C),C},cancel:C=>{i.delete(C),m.delete(C)},process:C=>{if(f=C,o){h=!0;return}o=!0,[t,i]=[i,t],t.forEach(c),t.clear(),o=!1,h&&(h=!1,E.process(C))}};return E}const Bg=["read","resolveKeyframes","update","preRender","render","postRender"],kO=40;function GA(e,t){let i=!1,o=!0;const h={delta:0,timestamp:0,isProcessing:!1},m=()=>i=!0,f=Bg.reduce((J,H)=>(J[H]=CO(m),J),{}),{read:c,resolveKeyframes:E,update:C,preRender:R,render:L,postRender:B}=f,X=()=>{const J=performance.now();i=!1,h.delta=o?1e3/60:Math.max(Math.min(J-h.timestamp,kO),1),h.timestamp=J,h.isProcessing=!0,c.process(h),E.process(h),C.process(h),R.process(h),L.process(h),B.process(h),h.isProcessing=!1,i&&t&&(o=!1,e(X))},W=()=>{i=!0,o=!0,h.isProcessing||e(X)};return{schedule:Bg.reduce((J,H)=>{const Q=f[H];return J[H]=(le,ve=!1,Ee=!1)=>(i||W(),Q.schedule(le,ve,Ee)),J},{}),cancel:J=>{for(let H=0;H<Bg.length;H++)f[Bg[H]].cancel(J)},state:h,steps:f}}const{schedule:Xn,cancel:_l,state:di,steps:I0}=GA(typeof requestAnimationFrame<"u"?requestAnimationFrame:ys,!0),qA=ze.createContext({strict:!1}),eE={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Xh={};for(const e in eE)Xh[e]={isEnabled:t=>eE[e].some(i=>!!t[i])};function AO(e){for(const t in e)Xh[t]={...Xh[t],...e[t]}}const IO=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Uy(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||IO.has(e)}let WA=e=>!Uy(e);function MO(e){e&&(WA=t=>t.startsWith("on")?!Uy(t):e(t))}try{MO(require("@emotion/is-prop-valid").default)}catch{}function RO(e,t,i){const o={};for(const h in e)h==="values"&&typeof e.values=="object"||(WA(h)||i===!0&&Uy(h)||!t&&!Uy(h)||e.draggable&&h.startsWith("onDrag"))&&(o[h]=e[h]);return o}function DO(e){if(typeof Proxy>"u")return e;const t=new Map,i=(...o)=>e(...o);return new Proxy(i,{get:(o,h)=>h==="create"?e:(t.has(h)||t.set(h,e(h)),t.get(h))})}const v_=ze.createContext({});function wf(e){return typeof e=="string"||Array.isArray(e)}function x_(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const Fw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Bw=["initial",...Fw];function b_(e){return x_(e.animate)||Bw.some(t=>wf(e[t]))}function ZA(e){return!!(b_(e)||e.variants)}function jO(e,t){if(b_(e)){const{initial:i,animate:o}=e;return{initial:i===!1||wf(i)?i:void 0,animate:wf(o)?o:void 0}}return e.inherit!==!1?t:{}}function NO(e){const{initial:t,animate:i}=jO(e,ze.useContext(v_));return ze.useMemo(()=>({initial:t,animate:i}),[tE(t),tE(i)])}function tE(e){return Array.isArray(e)?e.join(" "):e}const LO=Symbol.for("motionComponentSymbol");function kh(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function zO(e,t,i){return ze.useCallback(o=>{o&&e.onMount&&e.onMount(o),t&&(o?t.mount(o):t.unmount()),i&&(typeof i=="function"?i(o):kh(i)&&(i.current=o))},[t])}const Vw=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),OO="framerAppearId",HA="data-"+Vw(OO),{schedule:Uw}=GA(queueMicrotask,!1),KA=ze.createContext({});function FO(e,t,i,o,h){var m,f;const{visualElement:c}=ze.useContext(v_),E=ze.useContext(qA),C=ze.useContext(__),R=ze.useContext(Lw).reducedMotion,L=ze.useRef(null);o=o||E.renderer,!L.current&&o&&(L.current=o(e,{visualState:t,parent:c,props:i,presenceContext:C,blockInitialAnimation:C?C.initial===!1:!1,reducedMotionConfig:R}));const B=L.current,X=ze.useContext(KA);B&&!B.projection&&h&&(B.type==="html"||B.type==="svg")&&BO(L.current,i,h,X);const W=ze.useRef(!1);ze.useInsertionEffect(()=>{B&&W.current&&B.update(i,C)});const te=i[HA],G=ze.useRef(!!te&&!(!((m=window.MotionHandoffIsComplete)===null||m===void 0)&&m.call(window,te))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,te)));return UA(()=>{B&&(W.current=!0,window.MotionIsMounted=!0,B.updateFeatures(),Uw.render(B.render),G.current&&B.animationState&&B.animationState.animateChanges())}),ze.useEffect(()=>{B&&(!G.current&&B.animationState&&B.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,te)}),G.current=!1))}),B}function BO(e,t,i,o){const{layoutId:h,layout:m,drag:f,dragConstraints:c,layoutScroll:E,layoutRoot:C}=t;e.projection=new i(e.latestValues,t["data-framer-portal-id"]?void 0:XA(e.parent)),e.projection.setOptions({layoutId:h,layout:m,alwaysMeasureLayout:!!f||c&&kh(c),visualElement:e,animationType:typeof m=="string"?m:"both",initialPromotionConfig:o,layoutScroll:E,layoutRoot:C})}function XA(e){if(e)return e.options.allowProjection!==!1?e.projection:XA(e.parent)}function VO({preloadedFeatures:e,createVisualElement:t,useRender:i,useVisualState:o,Component:h}){var m,f;e&&AO(e);function c(C,R){let L;const B={...ze.useContext(Lw),...C,layoutId:UO(C)},{isStatic:X}=B,W=NO(C),te=o(C,X);if(!X&&zw){$O();const G=GO(B);L=G.MeasureLayout,W.visualElement=FO(h,te,B,t,G.ProjectionNode)}return S.jsxs(v_.Provider,{value:W,children:[L&&W.visualElement?S.jsx(L,{visualElement:W.visualElement,...B}):null,i(h,C,zO(te,W.visualElement,R),te,X,W.visualElement)]})}c.displayName=`motion.${typeof h=="string"?h:`create(${(f=(m=h.displayName)!==null&&m!==void 0?m:h.name)!==null&&f!==void 0?f:""})`}`;const E=ze.forwardRef(c);return E[LO]=h,E}function UO({layoutId:e}){const t=ze.useContext(jw).id;return t&&e!==void 0?t+"-"+e:e}function $O(e,t){ze.useContext(qA).strict}function GO(e){const{drag:t,layout:i}=Xh;if(!t&&!i)return{};const o={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(e)||i!=null&&i.isEnabled(e)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const qO=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function $w(e){return typeof e!="string"||e.includes("-")?!1:!!(qO.indexOf(e)>-1||/[A-Z]/u.test(e))}function nE(e){const t=[{},{}];return e==null||e.values.forEach((i,o)=>{t[0][o]=i.get(),t[1][o]=i.getVelocity()}),t}function Gw(e,t,i,o){if(typeof t=="function"){const[h,m]=nE(o);t=t(i!==void 0?i:e.custom,h,m)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[h,m]=nE(o);t=t(i!==void 0?i:e.custom,h,m)}return t}const nb=e=>Array.isArray(e),WO=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),ZO=e=>nb(e)?e[e.length-1]||0:e,Pi=e=>!!(e&&e.getVelocity);function uy(e){const t=Pi(e)?e.get():e;return WO(t)?t.toValue():t}function HO({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:i},o,h,m){const f={latestValues:KO(o,h,m,e),renderState:t()};return i&&(f.onMount=c=>i({props:o,current:c,...f}),f.onUpdate=c=>i(c)),f}const YA=e=>(t,i)=>{const o=ze.useContext(v_),h=ze.useContext(__),m=()=>HO(e,t,o,h);return i?m():Nw(m)};function KO(e,t,i,o){const h={},m=o(e,{});for(const B in m)h[B]=uy(m[B]);let{initial:f,animate:c}=e;const E=b_(e),C=ZA(e);t&&C&&!E&&e.inherit!==!1&&(f===void 0&&(f=t.initial),c===void 0&&(c=t.animate));let R=i?i.initial===!1:!1;R=R||f===!1;const L=R?c:f;if(L&&typeof L!="boolean"&&!x_(L)){const B=Array.isArray(L)?L:[L];for(let X=0;X<B.length;X++){const W=Gw(e,B[X]);if(W){const{transitionEnd:te,transition:G,...J}=W;for(const H in J){let Q=J[H];if(Array.isArray(Q)){const le=R?Q.length-1:0;Q=Q[le]}Q!==null&&(h[H]=Q)}for(const H in te)h[H]=te[H]}}}return h}const id=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Yc=new Set(id),JA=e=>t=>typeof t=="string"&&t.startsWith(e),QA=JA("--"),XO=JA("var(--"),qw=e=>XO(e)?YO.test(e.split("/*")[0].trim()):!1,YO=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,eI=(e,t)=>t&&typeof e=="number"?t.transform(e):e,ho=(e,t,i)=>i>t?t:i<e?e:i,sd={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Sf={...sd,transform:e=>ho(0,1,e)},Vg={...sd,default:1},Of=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Xo=Of("deg"),Ea=Of("%"),Nt=Of("px"),JO=Of("vh"),QO=Of("vw"),rE={...Ea,parse:e=>Ea.parse(e)/100,transform:e=>Ea.transform(e*100)},eF={borderWidth:Nt,borderTopWidth:Nt,borderRightWidth:Nt,borderBottomWidth:Nt,borderLeftWidth:Nt,borderRadius:Nt,radius:Nt,borderTopLeftRadius:Nt,borderTopRightRadius:Nt,borderBottomRightRadius:Nt,borderBottomLeftRadius:Nt,width:Nt,maxWidth:Nt,height:Nt,maxHeight:Nt,top:Nt,right:Nt,bottom:Nt,left:Nt,padding:Nt,paddingTop:Nt,paddingRight:Nt,paddingBottom:Nt,paddingLeft:Nt,margin:Nt,marginTop:Nt,marginRight:Nt,marginBottom:Nt,marginLeft:Nt,backgroundPositionX:Nt,backgroundPositionY:Nt},tF={rotate:Xo,rotateX:Xo,rotateY:Xo,rotateZ:Xo,scale:Vg,scaleX:Vg,scaleY:Vg,scaleZ:Vg,skew:Xo,skewX:Xo,skewY:Xo,distance:Nt,translateX:Nt,translateY:Nt,translateZ:Nt,x:Nt,y:Nt,z:Nt,perspective:Nt,transformPerspective:Nt,opacity:Sf,originX:rE,originY:rE,originZ:Nt},iE={...sd,transform:Math.round},Ww={...eF,...tF,zIndex:iE,size:Nt,fillOpacity:Sf,strokeOpacity:Sf,numOctaves:iE},nF={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},rF=id.length;function iF(e,t,i){let o="",h=!0;for(let m=0;m<rF;m++){const f=id[m],c=e[f];if(c===void 0)continue;let E=!0;if(typeof c=="number"?E=c===(f.startsWith("scale")?1:0):E=parseFloat(c)===0,!E||i){const C=eI(c,Ww[f]);if(!E){h=!1;const R=nF[f]||f;o+=`${R}(${C}) `}i&&(t[f]=C)}}return o=o.trim(),i?o=i(t,h?"":o):h&&(o="none"),o}function Zw(e,t,i){const{style:o,vars:h,transformOrigin:m}=e;let f=!1,c=!1;for(const E in t){const C=t[E];if(Yc.has(E)){f=!0;continue}else if(QA(E)){h[E]=C;continue}else{const R=eI(C,Ww[E]);E.startsWith("origin")?(c=!0,m[E]=R):o[E]=R}}if(t.transform||(f||i?o.transform=iF(t,e.transform,i):o.transform&&(o.transform="none")),c){const{originX:E="50%",originY:C="50%",originZ:R=0}=m;o.transformOrigin=`${E} ${C} ${R}`}}const sF={offset:"stroke-dashoffset",array:"stroke-dasharray"},aF={offset:"strokeDashoffset",array:"strokeDasharray"};function oF(e,t,i=1,o=0,h=!0){e.pathLength=1;const m=h?sF:aF;e[m.offset]=Nt.transform(-o);const f=Nt.transform(t),c=Nt.transform(i);e[m.array]=`${f} ${c}`}function sE(e,t,i){return typeof e=="string"?e:Nt.transform(t+i*e)}function lF(e,t,i){const o=sE(t,e.x,e.width),h=sE(i,e.y,e.height);return`${o} ${h}`}function Hw(e,{attrX:t,attrY:i,attrScale:o,originX:h,originY:m,pathLength:f,pathSpacing:c=1,pathOffset:E=0,...C},R,L){if(Zw(e,C,L),R){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:B,style:X,dimensions:W}=e;B.transform&&(W&&(X.transform=B.transform),delete B.transform),W&&(h!==void 0||m!==void 0||X.transform)&&(X.transformOrigin=lF(W,h!==void 0?h:.5,m!==void 0?m:.5)),t!==void 0&&(B.x=t),i!==void 0&&(B.y=i),o!==void 0&&(B.scale=o),f!==void 0&&oF(B,f,c,E,!1)}const Kw=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),tI=()=>({...Kw(),attrs:{}}),Xw=e=>typeof e=="string"&&e.toLowerCase()==="svg";function nI(e,{style:t,vars:i},o,h){Object.assign(e.style,t,h&&h.getProjectionStyles(o));for(const m in i)e.style.setProperty(m,i[m])}const rI=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function iI(e,t,i,o){nI(e,t,void 0,o);for(const h in t.attrs)e.setAttribute(rI.has(h)?h:Vw(h),t.attrs[h])}const $y={};function cF(e){Object.assign($y,e)}function sI(e,{layout:t,layoutId:i}){return Yc.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!$y[e]||e==="opacity")}function Yw(e,t,i){var o;const{style:h}=e,m={};for(const f in h)(Pi(h[f])||t.style&&Pi(t.style[f])||sI(f,e)||((o=i==null?void 0:i.getValue(f))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(m[f]=h[f]);return m}function aI(e,t,i){const o=Yw(e,t,i);for(const h in e)if(Pi(e[h])||Pi(t[h])){const m=id.indexOf(h)!==-1?"attr"+h.charAt(0).toUpperCase()+h.substring(1):h;o[m]=e[h]}return o}function uF(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const aE=["x","y","width","height","cx","cy","r"],hF={useVisualState:YA({scrapeMotionValuesFromProps:aI,createRenderState:tI,onUpdate:({props:e,prevProps:t,current:i,renderState:o,latestValues:h})=>{if(!i)return;let m=!!e.drag;if(!m){for(const c in h)if(Yc.has(c)){m=!0;break}}if(!m)return;let f=!t;if(t)for(let c=0;c<aE.length;c++){const E=aE[c];e[E]!==t[E]&&(f=!0)}f&&Xn.read(()=>{uF(i,o),Xn.render(()=>{Hw(o,h,Xw(i.tagName),e.transformTemplate),iI(i,o)})})}})},dF={useVisualState:YA({scrapeMotionValuesFromProps:Yw,createRenderState:Kw})};function oI(e,t,i){for(const o in t)!Pi(t[o])&&!sI(o,i)&&(e[o]=t[o])}function pF({transformTemplate:e},t){return ze.useMemo(()=>{const i=Kw();return Zw(i,t,e),Object.assign({},i.vars,i.style)},[t])}function fF(e,t){const i=e.style||{},o={};return oI(o,i,e),Object.assign(o,pF(e,t)),o}function mF(e,t){const i={},o=fF(e,t);return e.drag&&e.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=o,i}function gF(e,t,i,o){const h=ze.useMemo(()=>{const m=tI();return Hw(m,t,Xw(o),e.transformTemplate),{...m.attrs,style:{...m.style}}},[t]);if(e.style){const m={};oI(m,e.style,e),h.style={...m,...h.style}}return h}function yF(e=!1){return(i,o,h,{latestValues:m},f)=>{const E=($w(i)?gF:mF)(o,m,f,i),C=RO(o,typeof i=="string",e),R=i!==ze.Fragment?{...C,...E,ref:h}:{},{children:L}=o,B=ze.useMemo(()=>Pi(L)?L.get():L,[L]);return ze.createElement(i,{...R,children:B})}}function _F(e,t){return function(o,{forwardMotionProps:h}={forwardMotionProps:!1}){const f={...$w(o)?hF:dF,preloadedFeatures:e,useRender:yF(h),createVisualElement:t,Component:o};return VO(f)}}function lI(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let o=0;o<i;o++)if(t[o]!==e[o])return!1;return!0}function w_(e,t,i){const o=e.getProps();return Gw(o,t,i!==void 0?i:o.custom,e)}const vF=Ow(()=>window.ScrollTimeline!==void 0);class xF{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,i){for(let o=0;o<this.animations.length;o++)this.animations[o][t]=i}attachTimeline(t,i){const o=this.animations.map(h=>{if(vF()&&h.attachTimeline)return h.attachTimeline(t);if(typeof i=="function")return i(h)});return()=>{o.forEach((h,m)=>{h&&h(),this.animations[m].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let i=0;i<this.animations.length;i++)t=Math.max(t,this.animations[i].duration);return t}runAll(t){this.animations.forEach(i=>i[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class bF extends xF{then(t,i){return Promise.all(this.animations).then(t).catch(i)}}function Jw(e,t){return e?e[t]||e.default||e:void 0}const rb=2e4;function cI(e){let t=0;const i=50;let o=e.next(t);for(;!o.done&&t<rb;)t+=i,o=e.next(t);return t>=rb?1/0:t}function Qw(e){return typeof e=="function"}function oE(e,t){e.timeline=t,e.onfinish=null}const e1=e=>Array.isArray(e)&&typeof e[0]=="number",wF={linearEasing:void 0};function SF(e,t){const i=Ow(e);return()=>{var o;return(o=wF[t])!==null&&o!==void 0?o:i()}}const Gy=SF(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),uI=(e,t,i=10)=>{let o="";const h=Math.max(Math.round(t/i),2);for(let m=0;m<h;m++)o+=e(Kh(0,h-1,m))+", ";return`linear(${o.substring(0,o.length-2)})`};function hI(e){return!!(typeof e=="function"&&Gy()||!e||typeof e=="string"&&(e in ib||Gy())||e1(e)||Array.isArray(e)&&e.every(hI))}const zp=([e,t,i,o])=>`cubic-bezier(${e}, ${t}, ${i}, ${o})`,ib={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:zp([0,.65,.55,1]),circOut:zp([.55,0,1,.45]),backIn:zp([.31,.01,.66,-.59]),backOut:zp([.33,1.53,.69,.99])};function dI(e,t){if(e)return typeof e=="function"&&Gy()?uI(e,t):e1(e)?zp(e):Array.isArray(e)?e.map(i=>dI(i,t)||ib.easeOut):ib[e]}const Ks={x:!1,y:!1};function pI(){return Ks.x||Ks.y}function TF(e,t,i){var o;if(e instanceof Element)return[e];if(typeof e=="string"){let h=document;const m=(o=void 0)!==null&&o!==void 0?o:h.querySelectorAll(e);return m?Array.from(m):[]}return Array.from(e)}function fI(e,t){const i=TF(e),o=new AbortController,h={passive:!0,...t,signal:o.signal};return[i,h,()=>o.abort()]}function lE(e){return t=>{t.pointerType==="touch"||pI()||e(t)}}function EF(e,t,i={}){const[o,h,m]=fI(e,i),f=lE(c=>{const{target:E}=c,C=t(c);if(typeof C!="function"||!E)return;const R=lE(L=>{C(L),E.removeEventListener("pointerleave",R)});E.addEventListener("pointerleave",R,h)});return o.forEach(c=>{c.addEventListener("pointerenter",f,h)}),m}const mI=(e,t)=>t?e===t?!0:mI(e,t.parentElement):!1,t1=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,PF=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function CF(e){return PF.has(e.tagName)||e.tabIndex!==-1}const Op=new WeakSet;function cE(e){return t=>{t.key==="Enter"&&e(t)}}function M0(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const kF=(e,t)=>{const i=e.currentTarget;if(!i)return;const o=cE(()=>{if(Op.has(i))return;M0(i,"down");const h=cE(()=>{M0(i,"up")}),m=()=>M0(i,"cancel");i.addEventListener("keyup",h,t),i.addEventListener("blur",m,t)});i.addEventListener("keydown",o,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),t)};function uE(e){return t1(e)&&!pI()}function AF(e,t,i={}){const[o,h,m]=fI(e,i),f=c=>{const E=c.currentTarget;if(!uE(c)||Op.has(E))return;Op.add(E);const C=t(c),R=(X,W)=>{window.removeEventListener("pointerup",L),window.removeEventListener("pointercancel",B),!(!uE(X)||!Op.has(E))&&(Op.delete(E),typeof C=="function"&&C(X,{success:W}))},L=X=>{R(X,i.useGlobalTarget||mI(E,X.target))},B=X=>{R(X,!1)};window.addEventListener("pointerup",L,h),window.addEventListener("pointercancel",B,h)};return o.forEach(c=>{!CF(c)&&c.getAttribute("tabindex")===null&&(c.tabIndex=0),(i.useGlobalTarget?window:c).addEventListener("pointerdown",f,h),c.addEventListener("focus",C=>kF(C,h),h)}),m}function IF(e){return e==="x"||e==="y"?Ks[e]?null:(Ks[e]=!0,()=>{Ks[e]=!1}):Ks.x||Ks.y?null:(Ks.x=Ks.y=!0,()=>{Ks.x=Ks.y=!1})}const gI=new Set(["width","height","top","left","right","bottom",...id]);let hy;function MF(){hy=void 0}const Pa={now:()=>(hy===void 0&&Pa.set(di.isProcessing||PO.useManualTiming?di.timestamp:performance.now()),hy),set:e=>{hy=e,queueMicrotask(MF)}};function n1(e,t){e.indexOf(t)===-1&&e.push(t)}function r1(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}class i1{constructor(){this.subscriptions=[]}add(t){return n1(this.subscriptions,t),()=>r1(this.subscriptions,t)}notify(t,i,o){const h=this.subscriptions.length;if(h)if(h===1)this.subscriptions[0](t,i,o);else for(let m=0;m<h;m++){const f=this.subscriptions[m];f&&f(t,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function yI(e,t){return t?e*(1e3/t):0}const hE=30,RF=e=>!isNaN(parseFloat(e));class DF{constructor(t,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,h=!0)=>{const m=Pa.now();this.updatedAt!==m&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),h&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Pa.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=RF(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new i1);const o=this.events[t].add(i);return t==="change"?()=>{o(),Xn.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-o}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Pa.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>hE)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,hE);return yI(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Tf(e,t){return new DF(e,t)}function jF(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,Tf(i))}function NF(e,t){const i=w_(e,t);let{transitionEnd:o={},transition:h={},...m}=i||{};m={...m,...o};for(const f in m){const c=ZO(m[f]);jF(e,f,c)}}function LF(e){return!!(Pi(e)&&e.add)}function sb(e,t){const i=e.getValue("willChange");if(LF(i))return i.add(t)}function _I(e){return e.props[HA]}const vI=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,zF=1e-7,OF=12;function FF(e,t,i,o,h){let m,f,c=0;do f=t+(i-t)/2,m=vI(f,o,h)-e,m>0?i=f:t=f;while(Math.abs(m)>zF&&++c<OF);return f}function Ff(e,t,i,o){if(e===t&&i===o)return ys;const h=m=>FF(m,0,1,e,i);return m=>m===0||m===1?m:vI(h(m),t,o)}const xI=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,bI=e=>t=>1-e(1-t),wI=Ff(.33,1.53,.69,.99),s1=bI(wI),SI=xI(s1),TI=e=>(e*=2)<1?.5*s1(e):.5*(2-Math.pow(2,-10*(e-1))),a1=e=>1-Math.sin(Math.acos(e)),EI=bI(a1),PI=xI(a1),CI=e=>/^0[^.\s]+$/u.test(e);function BF(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||CI(e):!0}const Xp=e=>Math.round(e*1e5)/1e5,o1=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function VF(e){return e==null}const UF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,l1=(e,t)=>i=>!!(typeof i=="string"&&UF.test(i)&&i.startsWith(e)||t&&!VF(i)&&Object.prototype.hasOwnProperty.call(i,t)),kI=(e,t,i)=>o=>{if(typeof o!="string")return o;const[h,m,f,c]=o.match(o1);return{[e]:parseFloat(h),[t]:parseFloat(m),[i]:parseFloat(f),alpha:c!==void 0?parseFloat(c):1}},$F=e=>ho(0,255,e),R0={...sd,transform:e=>Math.round($F(e))},Nc={test:l1("rgb","red"),parse:kI("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:o=1})=>"rgba("+R0.transform(e)+", "+R0.transform(t)+", "+R0.transform(i)+", "+Xp(Sf.transform(o))+")"};function GF(e){let t="",i="",o="",h="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),o=e.substring(5,7),h=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),o=e.substring(3,4),h=e.substring(4,5),t+=t,i+=i,o+=o,h+=h),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:h?parseInt(h,16)/255:1}}const ab={test:l1("#"),parse:GF,transform:Nc.transform},Ah={test:l1("hsl","hue"),parse:kI("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:o=1})=>"hsla("+Math.round(e)+", "+Ea.transform(Xp(t))+", "+Ea.transform(Xp(i))+", "+Xp(Sf.transform(o))+")"},Si={test:e=>Nc.test(e)||ab.test(e)||Ah.test(e),parse:e=>Nc.test(e)?Nc.parse(e):Ah.test(e)?Ah.parse(e):ab.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Nc.transform(e):Ah.transform(e)},qF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function WF(e){var t,i;return isNaN(e)&&typeof e=="string"&&(((t=e.match(o1))===null||t===void 0?void 0:t.length)||0)+(((i=e.match(qF))===null||i===void 0?void 0:i.length)||0)>0}const AI="number",II="color",ZF="var",HF="var(",dE="${}",KF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ef(e){const t=e.toString(),i=[],o={color:[],number:[],var:[]},h=[];let m=0;const c=t.replace(KF,E=>(Si.test(E)?(o.color.push(m),h.push(II),i.push(Si.parse(E))):E.startsWith(HF)?(o.var.push(m),h.push(ZF),i.push(E)):(o.number.push(m),h.push(AI),i.push(parseFloat(E))),++m,dE)).split(dE);return{values:i,split:c,indexes:o,types:h}}function MI(e){return Ef(e).values}function RI(e){const{split:t,types:i}=Ef(e),o=t.length;return h=>{let m="";for(let f=0;f<o;f++)if(m+=t[f],h[f]!==void 0){const c=i[f];c===AI?m+=Xp(h[f]):c===II?m+=Si.transform(h[f]):m+=h[f]}return m}}const XF=e=>typeof e=="number"?0:e;function YF(e){const t=MI(e);return RI(e)(t.map(XF))}const vl={test:WF,parse:MI,createTransformer:RI,getAnimatableNone:YF},JF=new Set(["brightness","contrast","saturate","opacity"]);function QF(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[o]=i.match(o1)||[];if(!o)return e;const h=i.replace(o,"");let m=JF.has(t)?1:0;return o!==i&&(m*=100),t+"("+m+h+")"}const e3=/\b([a-z-]*)\(.*?\)/gu,ob={...vl,getAnimatableNone:e=>{const t=e.match(e3);return t?t.map(QF).join(" "):e}},t3={...Ww,color:Si,backgroundColor:Si,outlineColor:Si,fill:Si,stroke:Si,borderColor:Si,borderTopColor:Si,borderRightColor:Si,borderBottomColor:Si,borderLeftColor:Si,filter:ob,WebkitFilter:ob},c1=e=>t3[e];function DI(e,t){let i=c1(e);return i!==ob&&(i=vl),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const n3=new Set(["auto","none","0"]);function r3(e,t,i){let o=0,h;for(;o<e.length&&!h;){const m=e[o];typeof m=="string"&&!n3.has(m)&&Ef(m).values.length&&(h=e[o]),o++}if(h&&i)for(const m of t)e[m]=DI(i,h)}const pE=e=>e===sd||e===Nt,fE=(e,t)=>parseFloat(e.split(", ")[t]),mE=(e,t)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const h=o.match(/^matrix3d\((.+)\)$/u);if(h)return fE(h[1],t);{const m=o.match(/^matrix\((.+)\)$/u);return m?fE(m[1],e):0}},i3=new Set(["x","y","z"]),s3=id.filter(e=>!i3.has(e));function a3(e){const t=[];return s3.forEach(i=>{const o=e.getValue(i);o!==void 0&&(t.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),t}const Yh={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:mE(4,13),y:mE(5,14)};Yh.translateX=Yh.x;Yh.translateY=Yh.y;const Bc=new Set;let lb=!1,cb=!1;function jI(){if(cb){const e=Array.from(Bc).filter(o=>o.needsMeasurement),t=new Set(e.map(o=>o.element)),i=new Map;t.forEach(o=>{const h=a3(o);h.length&&(i.set(o,h),o.render())}),e.forEach(o=>o.measureInitialState()),t.forEach(o=>{o.render();const h=i.get(o);h&&h.forEach(([m,f])=>{var c;(c=o.getValue(m))===null||c===void 0||c.set(f)})}),e.forEach(o=>o.measureEndState()),e.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}cb=!1,lb=!1,Bc.forEach(e=>e.complete()),Bc.clear()}function NI(){Bc.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(cb=!0)})}function o3(){NI(),jI()}class u1{constructor(t,i,o,h,m,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=o,this.motionValue=h,this.element=m,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Bc.add(this),lb||(lb=!0,Xn.read(NI),Xn.resolveKeyframes(jI))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:o,motionValue:h}=this;for(let m=0;m<t.length;m++)if(t[m]===null)if(m===0){const f=h==null?void 0:h.get(),c=t[t.length-1];if(f!==void 0)t[0]=f;else if(o&&i){const E=o.readValue(i,c);E!=null&&(t[0]=E)}t[0]===void 0&&(t[0]=c),h&&f===void 0&&h.set(t[0])}else t[m]=t[m-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Bc.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Bc.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const LI=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),l3=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function c3(e){const t=l3.exec(e);if(!t)return[,];const[,i,o,h]=t;return[`--${i??o}`,h]}function zI(e,t,i=1){const[o,h]=c3(e);if(!o)return;const m=window.getComputedStyle(t).getPropertyValue(o);if(m){const f=m.trim();return LI(f)?parseFloat(f):f}return qw(h)?zI(h,t,i+1):h}const OI=e=>t=>t.test(e),u3={test:e=>e==="auto",parse:e=>e},FI=[sd,Nt,Ea,Xo,QO,JO,u3],gE=e=>FI.find(OI(e));class BI extends u1{constructor(t,i,o,h,m){super(t,i,o,h,m,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<t.length;E++){let C=t[E];if(typeof C=="string"&&(C=C.trim(),qw(C))){const R=zI(C,i.current);R!==void 0&&(t[E]=R),E===t.length-1&&(this.finalKeyframe=C)}}if(this.resolveNoneKeyframes(),!gI.has(o)||t.length!==2)return;const[h,m]=t,f=gE(h),c=gE(m);if(f!==c)if(pE(f)&&pE(c))for(let E=0;E<t.length;E++){const C=t[E];typeof C=="string"&&(t[E]=parseFloat(C))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,o=[];for(let h=0;h<t.length;h++)BF(t[h])&&o.push(h);o.length&&r3(t,o,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:o}=this;if(!t||!t.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Yh[o](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const h=i[i.length-1];h!==void 0&&t.getValue(o,h).jump(h,!1)}measureEndState(){var t;const{element:i,name:o,unresolvedKeyframes:h}=this;if(!i||!i.current)return;const m=i.getValue(o);m&&m.jump(this.measuredOrigin,!1);const f=h.length-1,c=h[f];h[f]=Yh[o](i.measureViewportBox(),window.getComputedStyle(i.current)),c!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=c),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([E,C])=>{i.getValue(E).set(C)}),this.resolveNoneKeyframes()}}const yE=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(vl.test(e)||e==="0")&&!e.startsWith("url("));function h3(e){const t=e[0];if(e.length===1)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}function d3(e,t,i,o){const h=e[0];if(h===null)return!1;if(t==="display"||t==="visibility")return!0;const m=e[e.length-1],f=yE(h,t),c=yE(m,t);return!f||!c?!1:h3(e)||(i==="spring"||Qw(i))&&o}const p3=e=>e!==null;function S_(e,{repeat:t,repeatType:i="loop"},o){const h=e.filter(p3),m=t&&i!=="loop"&&t%2===1?0:h.length-1;return!m||o===void 0?h[m]:o}const f3=40;class VI{constructor({autoplay:t=!0,delay:i=0,type:o="keyframes",repeat:h=0,repeatDelay:m=0,repeatType:f="loop",...c}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Pa.now(),this.options={autoplay:t,delay:i,type:o,repeat:h,repeatDelay:m,repeatType:f,...c},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>f3?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&o3(),this._resolved}onKeyframesResolved(t,i){this.resolvedAt=Pa.now(),this.hasAttemptedResolve=!0;const{name:o,type:h,velocity:m,delay:f,onComplete:c,onUpdate:E,isGenerator:C}=this.options;if(!C&&!d3(t,o,h,m))if(f)this.options.duration=0;else{E&&E(S_(t,this.options,i)),c&&c(),this.resolveFinishedPromise();return}const R=this.initPlayback(t,i);R!==!1&&(this._resolved={keyframes:t,finalKeyframe:i,...R},this.onPostResolved())}onPostResolved(){}then(t,i){return this.currentFinishedPromise.then(t,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const cr=(e,t,i)=>e+(t-e)*i;function D0(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function m3({hue:e,saturation:t,lightness:i,alpha:o}){e/=360,t/=100,i/=100;let h=0,m=0,f=0;if(!t)h=m=f=i;else{const c=i<.5?i*(1+t):i+t-i*t,E=2*i-c;h=D0(E,c,e+1/3),m=D0(E,c,e),f=D0(E,c,e-1/3)}return{red:Math.round(h*255),green:Math.round(m*255),blue:Math.round(f*255),alpha:o}}function qy(e,t){return i=>i>0?t:e}const j0=(e,t,i)=>{const o=e*e,h=i*(t*t-o)+o;return h<0?0:Math.sqrt(h)},g3=[ab,Nc,Ah],y3=e=>g3.find(t=>t.test(e));function _E(e){const t=y3(e);if(!t)return!1;let i=t.parse(e);return t===Ah&&(i=m3(i)),i}const vE=(e,t)=>{const i=_E(e),o=_E(t);if(!i||!o)return qy(e,t);const h={...i};return m=>(h.red=j0(i.red,o.red,m),h.green=j0(i.green,o.green,m),h.blue=j0(i.blue,o.blue,m),h.alpha=cr(i.alpha,o.alpha,m),Nc.transform(h))},_3=(e,t)=>i=>t(e(i)),Bf=(...e)=>e.reduce(_3),ub=new Set(["none","hidden"]);function v3(e,t){return ub.has(e)?i=>i<=0?e:t:i=>i>=1?t:e}function x3(e,t){return i=>cr(e,t,i)}function h1(e){return typeof e=="number"?x3:typeof e=="string"?qw(e)?qy:Si.test(e)?vE:S3:Array.isArray(e)?UI:typeof e=="object"?Si.test(e)?vE:b3:qy}function UI(e,t){const i=[...e],o=i.length,h=e.map((m,f)=>h1(m)(m,t[f]));return m=>{for(let f=0;f<o;f++)i[f]=h[f](m);return i}}function b3(e,t){const i={...e,...t},o={};for(const h in i)e[h]!==void 0&&t[h]!==void 0&&(o[h]=h1(e[h])(e[h],t[h]));return h=>{for(const m in o)i[m]=o[m](h);return i}}function w3(e,t){var i;const o=[],h={color:0,var:0,number:0};for(let m=0;m<t.values.length;m++){const f=t.types[m],c=e.indexes[f][h[f]],E=(i=e.values[c])!==null&&i!==void 0?i:0;o[m]=E,h[f]++}return o}const S3=(e,t)=>{const i=vl.createTransformer(t),o=Ef(e),h=Ef(t);return o.indexes.var.length===h.indexes.var.length&&o.indexes.color.length===h.indexes.color.length&&o.indexes.number.length>=h.indexes.number.length?ub.has(e)&&!h.values.length||ub.has(t)&&!o.values.length?v3(e,t):Bf(UI(w3(o,h),h.values),i):qy(e,t)};function $I(e,t,i){return typeof e=="number"&&typeof t=="number"&&typeof i=="number"?cr(e,t,i):h1(e)(e,t)}const T3=5;function GI(e,t,i){const o=Math.max(t-T3,0);return yI(i-e(o),t-o)}const yr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},N0=.001;function E3({duration:e=yr.duration,bounce:t=yr.bounce,velocity:i=yr.velocity,mass:o=yr.mass}){let h,m,f=1-t;f=ho(yr.minDamping,yr.maxDamping,f),e=ho(yr.minDuration,yr.maxDuration,ao(e)),f<1?(h=C=>{const R=C*f,L=R*e,B=R-i,X=hb(C,f),W=Math.exp(-L);return N0-B/X*W},m=C=>{const L=C*f*e,B=L*i+i,X=Math.pow(f,2)*Math.pow(C,2)*e,W=Math.exp(-L),te=hb(Math.pow(C,2),f);return(-h(C)+N0>0?-1:1)*((B-X)*W)/te}):(h=C=>{const R=Math.exp(-C*e),L=(C-i)*e+1;return-N0+R*L},m=C=>{const R=Math.exp(-C*e),L=(i-C)*(e*e);return R*L});const c=5/e,E=C3(h,m,c);if(e=so(e),isNaN(E))return{stiffness:yr.stiffness,damping:yr.damping,duration:e};{const C=Math.pow(E,2)*o;return{stiffness:C,damping:f*2*Math.sqrt(o*C),duration:e}}}const P3=12;function C3(e,t,i){let o=i;for(let h=1;h<P3;h++)o=o-e(o)/t(o);return o}function hb(e,t){return e*Math.sqrt(1-t*t)}const k3=["duration","bounce"],A3=["stiffness","damping","mass"];function xE(e,t){return t.some(i=>e[i]!==void 0)}function I3(e){let t={velocity:yr.velocity,stiffness:yr.stiffness,damping:yr.damping,mass:yr.mass,isResolvedFromDuration:!1,...e};if(!xE(e,A3)&&xE(e,k3))if(e.visualDuration){const i=e.visualDuration,o=2*Math.PI/(i*1.2),h=o*o,m=2*ho(.05,1,1-(e.bounce||0))*Math.sqrt(h);t={...t,mass:yr.mass,stiffness:h,damping:m}}else{const i=E3(e);t={...t,...i,mass:yr.mass},t.isResolvedFromDuration=!0}return t}function qI(e=yr.visualDuration,t=yr.bounce){const i=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:o,restDelta:h}=i;const m=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],c={done:!1,value:m},{stiffness:E,damping:C,mass:R,duration:L,velocity:B,isResolvedFromDuration:X}=I3({...i,velocity:-ao(i.velocity||0)}),W=B||0,te=C/(2*Math.sqrt(E*R)),G=f-m,J=ao(Math.sqrt(E/R)),H=Math.abs(G)<5;o||(o=H?yr.restSpeed.granular:yr.restSpeed.default),h||(h=H?yr.restDelta.granular:yr.restDelta.default);let Q;if(te<1){const ve=hb(J,te);Q=Ee=>{const _e=Math.exp(-te*J*Ee);return f-_e*((W+te*J*G)/ve*Math.sin(ve*Ee)+G*Math.cos(ve*Ee))}}else if(te===1)Q=ve=>f-Math.exp(-J*ve)*(G+(W+J*G)*ve);else{const ve=J*Math.sqrt(te*te-1);Q=Ee=>{const _e=Math.exp(-te*J*Ee),we=Math.min(ve*Ee,300);return f-_e*((W+te*J*G)*Math.sinh(we)+ve*G*Math.cosh(we))/ve}}const le={calculatedDuration:X&&L||null,next:ve=>{const Ee=Q(ve);if(X)c.done=ve>=L;else{let _e=0;te<1&&(_e=ve===0?so(W):GI(Q,ve,Ee));const we=Math.abs(_e)<=o,Ge=Math.abs(f-Ee)<=h;c.done=we&&Ge}return c.value=c.done?f:Ee,c},toString:()=>{const ve=Math.min(cI(le),rb),Ee=uI(_e=>le.next(ve*_e).value,ve,30);return ve+"ms "+Ee}};return le}function bE({keyframes:e,velocity:t=0,power:i=.8,timeConstant:o=325,bounceDamping:h=10,bounceStiffness:m=500,modifyTarget:f,min:c,max:E,restDelta:C=.5,restSpeed:R}){const L=e[0],B={done:!1,value:L},X=we=>c!==void 0&&we<c||E!==void 0&&we>E,W=we=>c===void 0?E:E===void 0||Math.abs(c-we)<Math.abs(E-we)?c:E;let te=i*t;const G=L+te,J=f===void 0?G:f(G);J!==G&&(te=J-L);const H=we=>-te*Math.exp(-we/o),Q=we=>J+H(we),le=we=>{const Ge=H(we),Je=Q(we);B.done=Math.abs(Ge)<=C,B.value=B.done?J:Je};let ve,Ee;const _e=we=>{X(B.value)&&(ve=we,Ee=qI({keyframes:[B.value,W(B.value)],velocity:GI(Q,we,B.value),damping:h,stiffness:m,restDelta:C,restSpeed:R}))};return _e(0),{calculatedDuration:null,next:we=>{let Ge=!1;return!Ee&&ve===void 0&&(Ge=!0,le(we),_e(we)),ve!==void 0&&we>=ve?Ee.next(we-ve):(!Ge&&le(we),B)}}}const M3=Ff(.42,0,1,1),R3=Ff(0,0,.58,1),WI=Ff(.42,0,.58,1),D3=e=>Array.isArray(e)&&typeof e[0]!="number",j3={linear:ys,easeIn:M3,easeInOut:WI,easeOut:R3,circIn:a1,circInOut:PI,circOut:EI,backIn:s1,backInOut:SI,backOut:wI,anticipate:TI},wE=e=>{if(e1(e)){$A(e.length===4);const[t,i,o,h]=e;return Ff(t,i,o,h)}else if(typeof e=="string")return j3[e];return e};function N3(e,t,i){const o=[],h=i||$I,m=e.length-1;for(let f=0;f<m;f++){let c=h(e[f],e[f+1]);if(t){const E=Array.isArray(t)?t[f]||ys:t;c=Bf(E,c)}o.push(c)}return o}function L3(e,t,{clamp:i=!0,ease:o,mixer:h}={}){const m=e.length;if($A(m===t.length),m===1)return()=>t[0];if(m===2&&t[0]===t[1])return()=>t[1];const f=e[0]===e[1];e[0]>e[m-1]&&(e=[...e].reverse(),t=[...t].reverse());const c=N3(t,o,h),E=c.length,C=R=>{if(f&&R<e[0])return t[0];let L=0;if(E>1)for(;L<e.length-2&&!(R<e[L+1]);L++);const B=Kh(e[L],e[L+1],R);return c[L](B)};return i?R=>C(ho(e[0],e[m-1],R)):C}function z3(e,t){const i=e[e.length-1];for(let o=1;o<=t;o++){const h=Kh(0,t,o);e.push(cr(i,1,h))}}function O3(e){const t=[0];return z3(t,e.length-1),t}function F3(e,t){return e.map(i=>i*t)}function B3(e,t){return e.map(()=>t||WI).splice(0,e.length-1)}function Wy({duration:e=300,keyframes:t,times:i,ease:o="easeInOut"}){const h=D3(o)?o.map(wE):wE(o),m={done:!1,value:t[0]},f=F3(i&&i.length===t.length?i:O3(t),e),c=L3(f,t,{ease:Array.isArray(h)?h:B3(t,h)});return{calculatedDuration:e,next:E=>(m.value=c(E),m.done=E>=e,m)}}const V3=e=>{const t=({timestamp:i})=>e(i);return{start:()=>Xn.update(t,!0),stop:()=>_l(t),now:()=>di.isProcessing?di.timestamp:Pa.now()}},U3={decay:bE,inertia:bE,tween:Wy,keyframes:Wy,spring:qI},$3=e=>e/100;class d1 extends VI{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:o,element:h,keyframes:m}=this.options,f=(h==null?void 0:h.KeyframeResolver)||u1,c=(E,C)=>this.onKeyframesResolved(E,C);this.resolver=new f(m,c,i,o,h),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:i="keyframes",repeat:o=0,repeatDelay:h=0,repeatType:m,velocity:f=0}=this.options,c=Qw(i)?i:U3[i]||Wy;let E,C;c!==Wy&&typeof t[0]!="number"&&(E=Bf($3,$I(t[0],t[1])),t=[0,100]);const R=c({...this.options,keyframes:t});m==="mirror"&&(C=c({...this.options,keyframes:[...t].reverse(),velocity:-f})),R.calculatedDuration===null&&(R.calculatedDuration=cI(R));const{calculatedDuration:L}=R,B=L+h,X=B*(o+1)-h;return{generator:R,mirroredGenerator:C,mapPercentToKeyframes:E,calculatedDuration:L,resolvedDuration:B,totalDuration:X}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,i=!1){const{resolved:o}=this;if(!o){const{keyframes:we}=this.options;return{done:!0,value:we[we.length-1]}}const{finalKeyframe:h,generator:m,mirroredGenerator:f,mapPercentToKeyframes:c,keyframes:E,calculatedDuration:C,totalDuration:R,resolvedDuration:L}=o;if(this.startTime===null)return m.next(0);const{delay:B,repeat:X,repeatType:W,repeatDelay:te,onUpdate:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-R/this.speed,this.startTime)),i?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const J=this.currentTime-B*(this.speed>=0?1:-1),H=this.speed>=0?J<0:J>R;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let Q=this.currentTime,le=m;if(X){const we=Math.min(this.currentTime,R)/L;let Ge=Math.floor(we),Je=we%1;!Je&&we>=1&&(Je=1),Je===1&&Ge--,Ge=Math.min(Ge,X+1),!!(Ge%2)&&(W==="reverse"?(Je=1-Je,te&&(Je-=te/L)):W==="mirror"&&(le=f)),Q=ho(0,1,Je)*L}const ve=H?{done:!1,value:E[0]}:le.next(Q);c&&(ve.value=c(ve.value));let{done:Ee}=ve;!H&&C!==null&&(Ee=this.speed>=0?this.currentTime>=R:this.currentTime<=0);const _e=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ee);return _e&&h!==void 0&&(ve.value=S_(E,this.options,h)),G&&G(ve.value),_e&&this.finish(),ve}get duration(){const{resolved:t}=this;return t?ao(t.calculatedDuration):0}get time(){return ao(this.currentTime)}set time(t){t=so(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=ao(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=V3,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=t(m=>this.tick(m))),i&&i();const h=this.driver.now();this.holdTime!==null?this.startTime=h-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=h):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const G3=new Set(["opacity","clipPath","filter","transform"]);function q3(e,t,i,{delay:o=0,duration:h=300,repeat:m=0,repeatType:f="loop",ease:c="easeInOut",times:E}={}){const C={[t]:i};E&&(C.offset=E);const R=dI(c,h);return Array.isArray(R)&&(C.easing=R),e.animate(C,{delay:o,duration:h,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:m+1,direction:f==="reverse"?"alternate":"normal"})}const W3=Ow(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Zy=10,Z3=2e4;function H3(e){return Qw(e.type)||e.type==="spring"||!hI(e.ease)}function K3(e,t){const i=new d1({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:e[0]};const h=[];let m=0;for(;!o.done&&m<Z3;)o=i.sample(m),h.push(o.value),m+=Zy;return{times:void 0,keyframes:h,duration:m-Zy,ease:"linear"}}const ZI={anticipate:TI,backInOut:SI,circInOut:PI};function X3(e){return e in ZI}class SE extends VI{constructor(t){super(t);const{name:i,motionValue:o,element:h,keyframes:m}=this.options;this.resolver=new BI(m,(f,c)=>this.onKeyframesResolved(f,c),i,o,h),this.resolver.scheduleResolve()}initPlayback(t,i){let{duration:o=300,times:h,ease:m,type:f,motionValue:c,name:E,startTime:C}=this.options;if(!c.owner||!c.owner.current)return!1;if(typeof m=="string"&&Gy()&&X3(m)&&(m=ZI[m]),H3(this.options)){const{onComplete:L,onUpdate:B,motionValue:X,element:W,...te}=this.options,G=K3(t,te);t=G.keyframes,t.length===1&&(t[1]=t[0]),o=G.duration,h=G.times,m=G.ease,f="keyframes"}const R=q3(c.owner.current,E,t,{...this.options,duration:o,times:h,ease:m});return R.startTime=C??this.calcStartTime(),this.pendingTimeline?(oE(R,this.pendingTimeline),this.pendingTimeline=void 0):R.onfinish=()=>{const{onComplete:L}=this.options;c.set(S_(t,this.options,i)),L&&L(),this.cancel(),this.resolveFinishedPromise()},{animation:R,duration:o,times:h,type:f,ease:m,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:i}=t;return ao(i)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:i}=t;return ao(i.currentTime||0)}set time(t){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=so(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:i}=t;return i.playbackRate}set speed(t){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:i}=t;return i.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:i}=t;return i.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:i}=this;if(!i)return ys;const{animation:o}=i;oE(o,t)}return ys}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:i,keyframes:o,duration:h,type:m,ease:f,times:c}=t;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:C,onUpdate:R,onComplete:L,element:B,...X}=this.options,W=new d1({...X,keyframes:o,duration:h,type:m,ease:f,times:c,isGenerator:!0}),te=so(this.time);C.setWithVelocity(W.sample(te-Zy).value,W.sample(te).value,Zy)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:i,name:o,repeatDelay:h,repeatType:m,damping:f,type:c}=t;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:C}=i.owner.getProps();return W3()&&o&&G3.has(o)&&!E&&!C&&!h&&m!=="mirror"&&f!==0&&c!=="inertia"}}const Y3={type:"spring",stiffness:500,damping:25,restSpeed:10},J3=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Q3={type:"keyframes",duration:.8},eB={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},tB=(e,{keyframes:t})=>t.length>2?Q3:Yc.has(e)?e.startsWith("scale")?J3(t[1]):Y3:eB;function nB({when:e,delay:t,delayChildren:i,staggerChildren:o,staggerDirection:h,repeat:m,repeatType:f,repeatDelay:c,from:E,elapsed:C,...R}){return!!Object.keys(R).length}const p1=(e,t,i,o={},h,m)=>f=>{const c=Jw(o,e)||{},E=c.delay||o.delay||0;let{elapsed:C=0}=o;C=C-so(E);let R={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...c,delay:-C,onUpdate:B=>{t.set(B),c.onUpdate&&c.onUpdate(B)},onComplete:()=>{f(),c.onComplete&&c.onComplete()},name:e,motionValue:t,element:m?void 0:h};nB(c)||(R={...R,...tB(e,R)}),R.duration&&(R.duration=so(R.duration)),R.repeatDelay&&(R.repeatDelay=so(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let L=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(R.duration=0,R.delay===0&&(L=!0)),L&&!m&&t.get()!==void 0){const B=S_(R.keyframes,c);if(B!==void 0)return Xn.update(()=>{R.onUpdate(B),R.onComplete()}),new bF([])}return!m&&SE.supports(R)?new SE(R):new d1(R)};function rB({protectedKeys:e,needsAnimating:t},i){const o=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,o}function HI(e,t,{delay:i=0,transitionOverride:o,type:h}={}){var m;let{transition:f=e.getDefaultTransition(),transitionEnd:c,...E}=t;o&&(f=o);const C=[],R=h&&e.animationState&&e.animationState.getState()[h];for(const L in E){const B=e.getValue(L,(m=e.latestValues[L])!==null&&m!==void 0?m:null),X=E[L];if(X===void 0||R&&rB(R,L))continue;const W={delay:i,...Jw(f||{},L)};let te=!1;if(window.MotionHandoffAnimation){const J=_I(e);if(J){const H=window.MotionHandoffAnimation(J,L,Xn);H!==null&&(W.startTime=H,te=!0)}}sb(e,L),B.start(p1(L,B,X,e.shouldReduceMotion&&gI.has(L)?{type:!1}:W,e,te));const G=B.animation;G&&C.push(G)}return c&&Promise.all(C).then(()=>{Xn.update(()=>{c&&NF(e,c)})}),C}function db(e,t,i={}){var o;const h=w_(e,t,i.type==="exit"?(o=e.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:m=e.getDefaultTransition()||{}}=h||{};i.transitionOverride&&(m=i.transitionOverride);const f=h?()=>Promise.all(HI(e,h,i)):()=>Promise.resolve(),c=e.variantChildren&&e.variantChildren.size?(C=0)=>{const{delayChildren:R=0,staggerChildren:L,staggerDirection:B}=m;return iB(e,t,R+C,L,B,i)}:()=>Promise.resolve(),{when:E}=m;if(E){const[C,R]=E==="beforeChildren"?[f,c]:[c,f];return C().then(()=>R())}else return Promise.all([f(),c(i.delay)])}function iB(e,t,i=0,o=0,h=1,m){const f=[],c=(e.variantChildren.size-1)*o,E=h===1?(C=0)=>C*o:(C=0)=>c-C*o;return Array.from(e.variantChildren).sort(sB).forEach((C,R)=>{C.notify("AnimationStart",t),f.push(db(C,t,{...m,delay:i+E(R)}).then(()=>C.notify("AnimationComplete",t)))}),Promise.all(f)}function sB(e,t){return e.sortNodePosition(t)}function aB(e,t,i={}){e.notify("AnimationStart",t);let o;if(Array.isArray(t)){const h=t.map(m=>db(e,m,i));o=Promise.all(h)}else if(typeof t=="string")o=db(e,t,i);else{const h=typeof t=="function"?w_(e,t,i.custom):t;o=Promise.all(HI(e,h,i))}return o.then(()=>{e.notify("AnimationComplete",t)})}const oB=Bw.length;function KI(e){if(!e)return;if(!e.isControllingVariants){const i=e.parent?KI(e.parent)||{}:{};return e.props.initial!==void 0&&(i.initial=e.props.initial),i}const t={};for(let i=0;i<oB;i++){const o=Bw[i],h=e.props[o];(wf(h)||h===!1)&&(t[o]=h)}return t}const lB=[...Fw].reverse(),cB=Fw.length;function uB(e){return t=>Promise.all(t.map(({animation:i,options:o})=>aB(e,i,o)))}function hB(e){let t=uB(e),i=TE(),o=!0;const h=E=>(C,R)=>{var L;const B=w_(e,R,E==="exit"?(L=e.presenceContext)===null||L===void 0?void 0:L.custom:void 0);if(B){const{transition:X,transitionEnd:W,...te}=B;C={...C,...te,...W}}return C};function m(E){t=E(e)}function f(E){const{props:C}=e,R=KI(e.parent)||{},L=[],B=new Set;let X={},W=1/0;for(let G=0;G<cB;G++){const J=lB[G],H=i[J],Q=C[J]!==void 0?C[J]:R[J],le=wf(Q),ve=J===E?H.isActive:null;ve===!1&&(W=G);let Ee=Q===R[J]&&Q!==C[J]&&le;if(Ee&&o&&e.manuallyAnimateOnMount&&(Ee=!1),H.protectedKeys={...X},!H.isActive&&ve===null||!Q&&!H.prevProp||x_(Q)||typeof Q=="boolean")continue;const _e=dB(H.prevProp,Q);let we=_e||J===E&&H.isActive&&!Ee&&le||G>W&&le,Ge=!1;const Je=Array.isArray(Q)?Q:[Q];let ft=Je.reduce(h(J),{});ve===!1&&(ft={});const{prevResolvedValues:At={}}=H,kt={...At,...ft},gt=bt=>{we=!0,B.has(bt)&&(Ge=!0,B.delete(bt)),H.needsAnimating[bt]=!0;const Ye=e.getValue(bt);Ye&&(Ye.liveStyle=!1)};for(const bt in kt){const Ye=ft[bt],Pe=At[bt];if(X.hasOwnProperty(bt))continue;let at=!1;nb(Ye)&&nb(Pe)?at=!lI(Ye,Pe):at=Ye!==Pe,at?Ye!=null?gt(bt):B.add(bt):Ye!==void 0&&B.has(bt)?gt(bt):H.protectedKeys[bt]=!0}H.prevProp=Q,H.prevResolvedValues=ft,H.isActive&&(X={...X,...ft}),o&&e.blockInitialAnimation&&(we=!1),we&&(!(Ee&&_e)||Ge)&&L.push(...Je.map(bt=>({animation:bt,options:{type:J}})))}if(B.size){const G={};B.forEach(J=>{const H=e.getBaseTarget(J),Q=e.getValue(J);Q&&(Q.liveStyle=!0),G[J]=H??null}),L.push({animation:G})}let te=!!L.length;return o&&(C.initial===!1||C.initial===C.animate)&&!e.manuallyAnimateOnMount&&(te=!1),o=!1,te?t(L):Promise.resolve()}function c(E,C){var R;if(i[E].isActive===C)return Promise.resolve();(R=e.variantChildren)===null||R===void 0||R.forEach(B=>{var X;return(X=B.animationState)===null||X===void 0?void 0:X.setActive(E,C)}),i[E].isActive=C;const L=f(E);for(const B in i)i[B].protectedKeys={};return L}return{animateChanges:f,setActive:c,setAnimateFunction:m,getState:()=>i,reset:()=>{i=TE(),o=!0}}}function dB(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!lI(t,e):!1}function bc(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function TE(){return{animate:bc(!0),whileInView:bc(),whileHover:bc(),whileTap:bc(),whileDrag:bc(),whileFocus:bc(),exit:bc()}}class Tl{constructor(t){this.isMounted=!1,this.node=t}update(){}}class pB extends Tl{constructor(t){super(t),t.animationState||(t.animationState=hB(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();x_(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let fB=0;class mB extends Tl{constructor(){super(...arguments),this.id=fB++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===o)return;const h=this.node.animationState.setActive("exit",!t);i&&!t&&h.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const gB={animation:{Feature:pB},exit:{Feature:mB}};function Pf(e,t,i,o={passive:!0}){return e.addEventListener(t,i,o),()=>e.removeEventListener(t,i)}function Vf(e){return{point:{x:e.pageX,y:e.pageY}}}const yB=e=>t=>t1(t)&&e(t,Vf(t));function Yp(e,t,i,o){return Pf(e,t,yB(i),o)}const EE=(e,t)=>Math.abs(e-t);function _B(e,t){const i=EE(e.x,t.x),o=EE(e.y,t.y);return Math.sqrt(i**2+o**2)}class XI{constructor(t,i,{transformPagePoint:o,contextWindow:h,dragSnapToOrigin:m=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=z0(this.lastMoveEventInfo,this.history),B=this.startEvent!==null,X=_B(L.offset,{x:0,y:0})>=3;if(!B&&!X)return;const{point:W}=L,{timestamp:te}=di;this.history.push({...W,timestamp:te});const{onStart:G,onMove:J}=this.handlers;B||(G&&G(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,L)},this.handlePointerMove=(L,B)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=L0(B,this.transformPagePoint),Xn.update(this.updatePoint,!0)},this.handlePointerUp=(L,B)=>{this.end();const{onEnd:X,onSessionEnd:W,resumeAnimation:te}=this.handlers;if(this.dragSnapToOrigin&&te&&te(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=z0(L.type==="pointercancel"?this.lastMoveEventInfo:L0(B,this.transformPagePoint),this.history);this.startEvent&&X&&X(L,G),W&&W(L,G)},!t1(t))return;this.dragSnapToOrigin=m,this.handlers=i,this.transformPagePoint=o,this.contextWindow=h||window;const f=Vf(t),c=L0(f,this.transformPagePoint),{point:E}=c,{timestamp:C}=di;this.history=[{...E,timestamp:C}];const{onSessionStart:R}=i;R&&R(t,z0(c,this.history)),this.removeListeners=Bf(Yp(this.contextWindow,"pointermove",this.handlePointerMove),Yp(this.contextWindow,"pointerup",this.handlePointerUp),Yp(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),_l(this.updatePoint)}}function L0(e,t){return t?{point:t(e.point)}:e}function PE(e,t){return{x:e.x-t.x,y:e.y-t.y}}function z0({point:e},t){return{point:e,delta:PE(e,YI(t)),offset:PE(e,vB(t)),velocity:xB(t,.1)}}function vB(e){return e[0]}function YI(e){return e[e.length-1]}function xB(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,o=null;const h=YI(e);for(;i>=0&&(o=e[i],!(h.timestamp-o.timestamp>so(t)));)i--;if(!o)return{x:0,y:0};const m=ao(h.timestamp-o.timestamp);if(m===0)return{x:0,y:0};const f={x:(h.x-o.x)/m,y:(h.y-o.y)/m};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const JI=1e-4,bB=1-JI,wB=1+JI,QI=.01,SB=0-QI,TB=0+QI;function vs(e){return e.max-e.min}function EB(e,t,i){return Math.abs(e-t)<=i}function CE(e,t,i,o=.5){e.origin=o,e.originPoint=cr(t.min,t.max,e.origin),e.scale=vs(i)/vs(t),e.translate=cr(i.min,i.max,e.origin)-e.originPoint,(e.scale>=bB&&e.scale<=wB||isNaN(e.scale))&&(e.scale=1),(e.translate>=SB&&e.translate<=TB||isNaN(e.translate))&&(e.translate=0)}function Jp(e,t,i,o){CE(e.x,t.x,i.x,o?o.originX:void 0),CE(e.y,t.y,i.y,o?o.originY:void 0)}function kE(e,t,i){e.min=i.min+t.min,e.max=e.min+vs(t)}function PB(e,t,i){kE(e.x,t.x,i.x),kE(e.y,t.y,i.y)}function AE(e,t,i){e.min=t.min-i.min,e.max=e.min+vs(t)}function Qp(e,t,i){AE(e.x,t.x,i.x),AE(e.y,t.y,i.y)}function CB(e,{min:t,max:i},o){return t!==void 0&&e<t?e=o?cr(t,e,o.min):Math.max(e,t):i!==void 0&&e>i&&(e=o?cr(i,e,o.max):Math.min(e,i)),e}function IE(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function kB(e,{top:t,left:i,bottom:o,right:h}){return{x:IE(e.x,i,h),y:IE(e.y,t,o)}}function ME(e,t){let i=t.min-e.min,o=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,o]=[o,i]),{min:i,max:o}}function AB(e,t){return{x:ME(e.x,t.x),y:ME(e.y,t.y)}}function IB(e,t){let i=.5;const o=vs(e),h=vs(t);return h>o?i=Kh(t.min,t.max-o,e.min):o>h&&(i=Kh(e.min,e.max-h,t.min)),ho(0,1,i)}function MB(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const pb=.35;function RB(e=pb){return e===!1?e=0:e===!0&&(e=pb),{x:RE(e,"left","right"),y:RE(e,"top","bottom")}}function RE(e,t,i){return{min:DE(e,t),max:DE(e,i)}}function DE(e,t){return typeof e=="number"?e:e[t]||0}const jE=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ih=()=>({x:jE(),y:jE()}),NE=()=>({min:0,max:0}),wr=()=>({x:NE(),y:NE()});function Is(e){return[e("x"),e("y")]}function eM({top:e,left:t,right:i,bottom:o}){return{x:{min:t,max:i},y:{min:e,max:o}}}function DB({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function jB(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),o=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function O0(e){return e===void 0||e===1}function fb({scale:e,scaleX:t,scaleY:i}){return!O0(e)||!O0(t)||!O0(i)}function Cc(e){return fb(e)||tM(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function tM(e){return LE(e.x)||LE(e.y)}function LE(e){return e&&e!=="0%"}function Hy(e,t,i){const o=e-i,h=t*o;return i+h}function zE(e,t,i,o,h){return h!==void 0&&(e=Hy(e,h,o)),Hy(e,i,o)+t}function mb(e,t=0,i=1,o,h){e.min=zE(e.min,t,i,o,h),e.max=zE(e.max,t,i,o,h)}function nM(e,{x:t,y:i}){mb(e.x,t.translate,t.scale,t.originPoint),mb(e.y,i.translate,i.scale,i.originPoint)}const OE=.999999999999,FE=1.0000000000001;function NB(e,t,i,o=!1){const h=i.length;if(!h)return;t.x=t.y=1;let m,f;for(let c=0;c<h;c++){m=i[c],f=m.projectionDelta;const{visualElement:E}=m.options;E&&E.props.style&&E.props.style.display==="contents"||(o&&m.options.layoutScroll&&m.scroll&&m!==m.root&&Rh(e,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,nM(e,f)),o&&Cc(m.latestValues)&&Rh(e,m.latestValues))}t.x<FE&&t.x>OE&&(t.x=1),t.y<FE&&t.y>OE&&(t.y=1)}function Mh(e,t){e.min=e.min+t,e.max=e.max+t}function BE(e,t,i,o,h=.5){const m=cr(e.min,e.max,h);mb(e,t,i,m,o)}function Rh(e,t){BE(e.x,t.x,t.scaleX,t.scale,t.originX),BE(e.y,t.y,t.scaleY,t.scale,t.originY)}function rM(e,t){return eM(jB(e.getBoundingClientRect(),t))}function LB(e,t,i){const o=rM(e,i),{scroll:h}=t;return h&&(Mh(o.x,h.offset.x),Mh(o.y,h.offset.y)),o}const iM=({current:e})=>e?e.ownerDocument.defaultView:null,zB=new WeakMap;class OB{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=wr(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const h=R=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(Vf(R).point)},m=(R,L)=>{const{drag:B,dragPropagation:X,onDragStart:W}=this.getProps();if(B&&!X&&(this.openDragLock&&this.openDragLock(),this.openDragLock=IF(B),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Is(G=>{let J=this.getAxisMotionValue(G).get()||0;if(Ea.test(J)){const{projection:H}=this.visualElement;if(H&&H.layout){const Q=H.layout.layoutBox[G];Q&&(J=vs(Q)*(parseFloat(J)/100))}}this.originPoint[G]=J}),W&&Xn.postRender(()=>W(R,L)),sb(this.visualElement,"transform");const{animationState:te}=this.visualElement;te&&te.setActive("whileDrag",!0)},f=(R,L)=>{const{dragPropagation:B,dragDirectionLock:X,onDirectionLock:W,onDrag:te}=this.getProps();if(!B&&!this.openDragLock)return;const{offset:G}=L;if(X&&this.currentDirection===null){this.currentDirection=FB(G),this.currentDirection!==null&&W&&W(this.currentDirection);return}this.updateAxis("x",L.point,G),this.updateAxis("y",L.point,G),this.visualElement.render(),te&&te(R,L)},c=(R,L)=>this.stop(R,L),E=()=>Is(R=>{var L;return this.getAnimationState(R)==="paused"&&((L=this.getAxisMotionValue(R).animation)===null||L===void 0?void 0:L.play())}),{dragSnapToOrigin:C}=this.getProps();this.panSession=new XI(t,{onSessionStart:h,onStart:m,onMove:f,onSessionEnd:c,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:C,contextWindow:iM(this.visualElement)})}stop(t,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:h}=i;this.startAnimation(h);const{onDragEnd:m}=this.getProps();m&&Xn.postRender(()=>m(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,o){const{drag:h}=this.getProps();if(!o||!Ug(t,h,this.currentDirection))return;const m=this.getAxisMotionValue(t);let f=this.originPoint[t]+o[t];this.constraints&&this.constraints[t]&&(f=CB(f,this.constraints[t],this.elastic[t])),m.set(f)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:o}=this.getProps(),h=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,m=this.constraints;i&&kh(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&h?this.constraints=kB(h.layoutBox,i):this.constraints=!1,this.elastic=RB(o),m!==this.constraints&&h&&this.constraints&&!this.hasMutatedConstraints&&Is(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=MB(h.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!kh(t))return!1;const o=t.current,{projection:h}=this.visualElement;if(!h||!h.layout)return!1;const m=LB(o,h.root,this.visualElement.getTransformPagePoint());let f=AB(h.layout.layoutBox,m);if(i){const c=i(DB(f));this.hasMutatedConstraints=!!c,c&&(f=eM(c))}return f}startAnimation(t){const{drag:i,dragMomentum:o,dragElastic:h,dragTransition:m,dragSnapToOrigin:f,onDragTransitionEnd:c}=this.getProps(),E=this.constraints||{},C=Is(R=>{if(!Ug(R,i,this.currentDirection))return;let L=E&&E[R]||{};f&&(L={min:0,max:0});const B=h?200:1e6,X=h?40:1e7,W={type:"inertia",velocity:o?t[R]:0,bounceStiffness:B,bounceDamping:X,timeConstant:750,restDelta:1,restSpeed:10,...m,...L};return this.startAxisValueAnimation(R,W)});return Promise.all(C).then(c)}startAxisValueAnimation(t,i){const o=this.getAxisMotionValue(t);return sb(this.visualElement,t),o.start(p1(t,o,0,i,this.visualElement,!1))}stopAnimation(){Is(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Is(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,o=this.visualElement.getProps(),h=o[i];return h||this.visualElement.getValue(t,(o.initial?o.initial[t]:void 0)||0)}snapToCursor(t){Is(i=>{const{drag:o}=this.getProps();if(!Ug(i,o,this.currentDirection))return;const{projection:h}=this.visualElement,m=this.getAxisMotionValue(i);if(h&&h.layout){const{min:f,max:c}=h.layout.layoutBox[i];m.set(t[i]-cr(f,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!kh(i)||!o||!this.constraints)return;this.stopAnimation();const h={x:0,y:0};Is(f=>{const c=this.getAxisMotionValue(f);if(c&&this.constraints!==!1){const E=c.get();h[f]=IB({min:E,max:E},this.constraints[f])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Is(f=>{if(!Ug(f,t,null))return;const c=this.getAxisMotionValue(f),{min:E,max:C}=this.constraints[f];c.set(cr(E,C,h[f]))})}addListeners(){if(!this.visualElement.current)return;zB.set(this.visualElement,this);const t=this.visualElement.current,i=Yp(t,"pointerdown",E=>{const{drag:C,dragListener:R=!0}=this.getProps();C&&R&&this.start(E)}),o=()=>{const{dragConstraints:E}=this.getProps();kh(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:h}=this.visualElement,m=h.addEventListener("measure",o);h&&!h.layout&&(h.root&&h.root.updateScroll(),h.updateLayout()),Xn.read(o);const f=Pf(window,"resize",()=>this.scalePositionWithinConstraints()),c=h.addEventListener("didUpdate",({delta:E,hasLayoutChanged:C})=>{this.isDragging&&C&&(Is(R=>{const L=this.getAxisMotionValue(R);L&&(this.originPoint[R]+=E[R].translate,L.set(L.get()+E[R].translate))}),this.visualElement.render())});return()=>{f(),i(),m(),c&&c()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:h=!1,dragConstraints:m=!1,dragElastic:f=pb,dragMomentum:c=!0}=t;return{...t,drag:i,dragDirectionLock:o,dragPropagation:h,dragConstraints:m,dragElastic:f,dragMomentum:c}}}function Ug(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function FB(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class BB extends Tl{constructor(t){super(t),this.removeGroupControls=ys,this.removeListeners=ys,this.controls=new OB(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ys}unmount(){this.removeGroupControls(),this.removeListeners()}}const VE=e=>(t,i)=>{e&&Xn.postRender(()=>e(t,i))};class VB extends Tl{constructor(){super(...arguments),this.removePointerDownListener=ys}onPointerDown(t){this.session=new XI(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:iM(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:o,onPanEnd:h}=this.node.getProps();return{onSessionStart:VE(t),onStart:VE(i),onMove:o,onEnd:(m,f)=>{delete this.session,h&&Xn.postRender(()=>h(m,f))}}}mount(){this.removePointerDownListener=Yp(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const dy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function UE(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Mp={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Nt.test(e))e=parseFloat(e);else return e;const i=UE(e,t.target.x),o=UE(e,t.target.y);return`${i}% ${o}%`}},UB={correct:(e,{treeScale:t,projectionDelta:i})=>{const o=e,h=vl.parse(e);if(h.length>5)return o;const m=vl.createTransformer(e),f=typeof h[0]!="number"?1:0,c=i.x.scale*t.x,E=i.y.scale*t.y;h[0+f]/=c,h[1+f]/=E;const C=cr(c,E,.5);return typeof h[2+f]=="number"&&(h[2+f]/=C),typeof h[3+f]=="number"&&(h[3+f]/=C),m(h)}};class $B extends ze.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:o,layoutId:h}=this.props,{projection:m}=t;cF(GB),m&&(i.group&&i.group.add(m),o&&o.register&&h&&o.register(m),m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),dy.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:o,drag:h,isPresent:m}=this.props,f=o.projection;return f&&(f.isPresent=m,h||t.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==m&&(m?f.promote():f.relegate()||Xn.postRender(()=>{const c=f.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Uw.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:h}=t;h&&(h.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(h),o&&o.deregister&&o.deregister(h))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function sM(e){const[t,i]=VA(),o=ze.useContext(jw);return S.jsx($B,{...e,layoutGroup:o,switchLayoutGroup:ze.useContext(KA),isPresent:t,safeToRemove:i})}const GB={borderRadius:{...Mp,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Mp,borderTopRightRadius:Mp,borderBottomLeftRadius:Mp,borderBottomRightRadius:Mp,boxShadow:UB};function qB(e,t,i){const o=Pi(e)?e:Tf(e);return o.start(p1("",o,t,i)),o.animation}function WB(e){return e instanceof SVGElement&&e.tagName!=="svg"}const ZB=(e,t)=>e.depth-t.depth;class HB{constructor(){this.children=[],this.isDirty=!1}add(t){n1(this.children,t),this.isDirty=!0}remove(t){r1(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(ZB),this.isDirty=!1,this.children.forEach(t)}}function KB(e,t){const i=Pa.now(),o=({timestamp:h})=>{const m=h-i;m>=t&&(_l(o),e(m-t))};return Xn.read(o,!0),()=>_l(o)}const aM=["TopLeft","TopRight","BottomLeft","BottomRight"],XB=aM.length,$E=e=>typeof e=="string"?parseFloat(e):e,GE=e=>typeof e=="number"||Nt.test(e);function YB(e,t,i,o,h,m){h?(e.opacity=cr(0,i.opacity!==void 0?i.opacity:1,JB(o)),e.opacityExit=cr(t.opacity!==void 0?t.opacity:1,0,QB(o))):m&&(e.opacity=cr(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let f=0;f<XB;f++){const c=`border${aM[f]}Radius`;let E=qE(t,c),C=qE(i,c);if(E===void 0&&C===void 0)continue;E||(E=0),C||(C=0),E===0||C===0||GE(E)===GE(C)?(e[c]=Math.max(cr($E(E),$E(C),o),0),(Ea.test(C)||Ea.test(E))&&(e[c]+="%")):e[c]=C}(t.rotate||i.rotate)&&(e.rotate=cr(t.rotate||0,i.rotate||0,o))}function qE(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const JB=oM(0,.5,EI),QB=oM(.5,.95,ys);function oM(e,t,i){return o=>o<e?0:o>t?1:i(Kh(e,t,o))}function WE(e,t){e.min=t.min,e.max=t.max}function ks(e,t){WE(e.x,t.x),WE(e.y,t.y)}function ZE(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function HE(e,t,i,o,h){return e-=t,e=Hy(e,1/i,o),h!==void 0&&(e=Hy(e,1/h,o)),e}function e5(e,t=0,i=1,o=.5,h,m=e,f=e){if(Ea.test(t)&&(t=parseFloat(t),t=cr(f.min,f.max,t/100)-f.min),typeof t!="number")return;let c=cr(m.min,m.max,o);e===m&&(c-=t),e.min=HE(e.min,t,i,c,h),e.max=HE(e.max,t,i,c,h)}function KE(e,t,[i,o,h],m,f){e5(e,t[i],t[o],t[h],t.scale,m,f)}const t5=["x","scaleX","originX"],n5=["y","scaleY","originY"];function XE(e,t,i,o){KE(e.x,t,t5,i?i.x:void 0,o?o.x:void 0),KE(e.y,t,n5,i?i.y:void 0,o?o.y:void 0)}function YE(e){return e.translate===0&&e.scale===1}function lM(e){return YE(e.x)&&YE(e.y)}function JE(e,t){return e.min===t.min&&e.max===t.max}function r5(e,t){return JE(e.x,t.x)&&JE(e.y,t.y)}function QE(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function cM(e,t){return QE(e.x,t.x)&&QE(e.y,t.y)}function eP(e){return vs(e.x)/vs(e.y)}function tP(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class i5{constructor(){this.members=[]}add(t){n1(this.members,t),t.scheduleRender()}remove(t){if(r1(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(h=>t===h);if(i===0)return!1;let o;for(let h=i;h>=0;h--){const m=this.members[h];if(m.isPresent!==!1){o=m;break}}return o?(this.promote(o),!0):!1}promote(t,i){const o=this.lead;if(t!==o&&(this.prevLead=o,this.lead=t,t.show(),o)){o.instance&&o.scheduleRender(),t.scheduleRender(),t.resumeFrom=o,i&&(t.resumeFrom.preserveOpacity=!0),o.snapshot&&(t.snapshot=o.snapshot,t.snapshot.latestValues=o.animationValues||o.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:h}=t.options;h===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:o}=t;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function s5(e,t,i){let o="";const h=e.x.translate/t.x,m=e.y.translate/t.y,f=(i==null?void 0:i.z)||0;if((h||m||f)&&(o=`translate3d(${h}px, ${m}px, ${f}px) `),(t.x!==1||t.y!==1)&&(o+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:C,rotate:R,rotateX:L,rotateY:B,skewX:X,skewY:W}=i;C&&(o=`perspective(${C}px) ${o}`),R&&(o+=`rotate(${R}deg) `),L&&(o+=`rotateX(${L}deg) `),B&&(o+=`rotateY(${B}deg) `),X&&(o+=`skewX(${X}deg) `),W&&(o+=`skewY(${W}deg) `)}const c=e.x.scale*t.x,E=e.y.scale*t.y;return(c!==1||E!==1)&&(o+=`scale(${c}, ${E})`),o||"none"}const kc={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Fp=typeof window<"u"&&window.MotionDebug!==void 0,F0=["","X","Y","Z"],a5={visibility:"hidden"},nP=1e3;let o5=0;function B0(e,t,i,o){const{latestValues:h}=t;h[e]&&(i[e]=h[e],t.setStaticValue(e,0),o&&(o[e]=0))}function uM(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const i=_I(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:h,layoutId:m}=e.options;window.MotionCancelOptimisedAnimation(i,"transform",Xn,!(h||m))}const{parent:o}=e;o&&!o.hasCheckedOptimisedAppear&&uM(o)}function hM({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:o,resetTransform:h}){return class{constructor(f={},c=t==null?void 0:t()){this.id=o5++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Fp&&(kc.totalNodes=kc.resolvedTargetDeltas=kc.recalculatedProjection=0),this.nodes.forEach(u5),this.nodes.forEach(m5),this.nodes.forEach(g5),this.nodes.forEach(h5),Fp&&window.MotionDebug.record(kc)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new HB)}addEventListener(f,c){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new i1),this.eventHandlers.get(f).add(c)}notifyListeners(f,...c){const E=this.eventHandlers.get(f);E&&E.notify(...c)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,c=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=WB(f),this.instance=f;const{layoutId:E,layout:C,visualElement:R}=this.options;if(R&&!R.current&&R.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),c&&(C||E)&&(this.isLayoutDirty=!0),e){let L;const B=()=>this.root.updateBlockedByResize=!1;e(f,()=>{this.root.updateBlockedByResize=!0,L&&L(),L=KB(B,250),dy.hasAnimatedSinceResize&&(dy.hasAnimatedSinceResize=!1,this.nodes.forEach(iP))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&R&&(E||C)&&this.addEventListener("didUpdate",({delta:L,hasLayoutChanged:B,hasRelativeTargetChanged:X,layout:W})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const te=this.options.transition||R.getDefaultTransition()||b5,{onLayoutAnimationStart:G,onLayoutAnimationComplete:J}=R.getProps(),H=!this.targetLayout||!cM(this.targetLayout,W)||X,Q=!B&&X;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Q||B&&(H||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(L,Q);const le={...Jw(te,"layout"),onPlay:G,onComplete:J};(R.shouldReduceMotion||this.options.layoutRoot)&&(le.delay=0,le.type=!1),this.startAnimation(le)}else B||iP(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=W})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,_l(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(y5),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&uM(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const L=this.path[R];L.shouldResetTransform=!0,L.updateScroll("snapshot"),L.options.layoutRoot&&L.willUpdate(!1)}const{layoutId:c,layout:E}=this.options;if(c===void 0&&!E)return;const C=this.getTransformTemplate();this.prevTransformTemplateValue=C?C(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(rP);return}this.isUpdating||this.nodes.forEach(p5),this.isUpdating=!1,this.nodes.forEach(f5),this.nodes.forEach(l5),this.nodes.forEach(c5),this.clearAllSnapshots();const c=Pa.now();di.delta=ho(0,1e3/60,c-di.timestamp),di.timestamp=c,di.isProcessing=!0,I0.update.process(di),I0.preRender.process(di),I0.render.process(di),di.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Uw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(d5),this.sharedNodes.forEach(_5)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Xn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Xn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=wr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(c=!1),c){const E=o(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!h)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!lM(this.projectionDelta),E=this.getTransformTemplate(),C=E?E(this.latestValues,""):void 0,R=C!==this.prevTransformTemplateValue;f&&(c||Cc(this.latestValues)||R)&&(h(this.instance,C),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const c=this.measurePageBox();let E=this.removeElementScroll(c);return f&&(E=this.removeTransform(E)),w5(E),{animationId:this.root.animationId,measuredBox:c,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:c}=this.options;if(!c)return wr();const E=c.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(S5))){const{scroll:R}=this.root;R&&(Mh(E.x,R.offset.x),Mh(E.y,R.offset.y))}return E}removeElementScroll(f){var c;const E=wr();if(ks(E,f),!((c=this.scroll)===null||c===void 0)&&c.wasRoot)return E;for(let C=0;C<this.path.length;C++){const R=this.path[C],{scroll:L,options:B}=R;R!==this.root&&L&&B.layoutScroll&&(L.wasRoot&&ks(E,f),Mh(E.x,L.offset.x),Mh(E.y,L.offset.y))}return E}applyTransform(f,c=!1){const E=wr();ks(E,f);for(let C=0;C<this.path.length;C++){const R=this.path[C];!c&&R.options.layoutScroll&&R.scroll&&R!==R.root&&Rh(E,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),Cc(R.latestValues)&&Rh(E,R.latestValues)}return Cc(this.latestValues)&&Rh(E,this.latestValues),E}removeTransform(f){const c=wr();ks(c,f);for(let E=0;E<this.path.length;E++){const C=this.path[E];if(!C.instance||!Cc(C.latestValues))continue;fb(C.latestValues)&&C.updateSnapshot();const R=wr(),L=C.measurePageBox();ks(R,L),XE(c,C.latestValues,C.snapshot?C.snapshot.layoutBox:void 0,R)}return Cc(this.latestValues)&&XE(c,this.latestValues),c}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==di.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var c;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const C=!!this.resumingFrom||this!==E;if(!(f||C&&this.isSharedProjectionDirty||this.isProjectionDirty||!((c=this.parent)===null||c===void 0)&&c.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:L,layoutId:B}=this.options;if(!(!this.layout||!(L||B))){if(this.resolvedRelativeTargetAt=di.timestamp,!this.targetDelta&&!this.relativeTarget){const X=this.getClosestProjectingParent();X&&X.layout&&this.animationProgress!==1?(this.relativeParent=X,this.forceRelativeParentToResolveTarget(),this.relativeTarget=wr(),this.relativeTargetOrigin=wr(),Qp(this.relativeTargetOrigin,this.layout.layoutBox,X.layout.layoutBox),ks(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=wr(),this.targetWithTransforms=wr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),PB(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ks(this.target,this.layout.layoutBox),nM(this.target,this.targetDelta)):ks(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const X=this.getClosestProjectingParent();X&&!!X.resumingFrom==!!this.resumingFrom&&!X.options.layoutScroll&&X.target&&this.animationProgress!==1?(this.relativeParent=X,this.forceRelativeParentToResolveTarget(),this.relativeTarget=wr(),this.relativeTargetOrigin=wr(),Qp(this.relativeTargetOrigin,this.target,X.target),ks(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Fp&&kc.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||fb(this.parent.latestValues)||tM(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const c=this.getLead(),E=!!this.resumingFrom||this!==c;let C=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(C=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(C=!1),this.resolvedRelativeTargetAt===di.timestamp&&(C=!1),C)return;const{layout:R,layoutId:L}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||L))return;ks(this.layoutCorrected,this.layout.layoutBox);const B=this.treeScale.x,X=this.treeScale.y;NB(this.layoutCorrected,this.treeScale,this.path,E),c.layout&&!c.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(c.target=c.layout.layoutBox,c.targetWithTransforms=wr());const{target:W}=c;if(!W){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(ZE(this.prevProjectionDelta.x,this.projectionDelta.x),ZE(this.prevProjectionDelta.y,this.projectionDelta.y)),Jp(this.projectionDelta,this.layoutCorrected,W,this.latestValues),(this.treeScale.x!==B||this.treeScale.y!==X||!tP(this.projectionDelta.x,this.prevProjectionDelta.x)||!tP(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",W)),Fp&&kc.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var c;if((c=this.options.visualElement)===null||c===void 0||c.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ih(),this.projectionDelta=Ih(),this.projectionDeltaWithTransform=Ih()}setAnimationOrigin(f,c=!1){const E=this.snapshot,C=E?E.latestValues:{},R={...this.latestValues},L=Ih();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const B=wr(),X=E?E.source:void 0,W=this.layout?this.layout.source:void 0,te=X!==W,G=this.getStack(),J=!G||G.members.length<=1,H=!!(te&&!J&&this.options.crossfade===!0&&!this.path.some(x5));this.animationProgress=0;let Q;this.mixTargetDelta=le=>{const ve=le/1e3;sP(L.x,f.x,ve),sP(L.y,f.y,ve),this.setTargetDelta(L),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Qp(B,this.layout.layoutBox,this.relativeParent.layout.layoutBox),v5(this.relativeTarget,this.relativeTargetOrigin,B,ve),Q&&r5(this.relativeTarget,Q)&&(this.isProjectionDirty=!1),Q||(Q=wr()),ks(Q,this.relativeTarget)),te&&(this.animationValues=R,YB(R,C,this.latestValues,ve,H,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ve},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(_l(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Xn.update(()=>{dy.hasAnimatedSinceResize=!0,this.currentAnimation=qB(0,nP,{...f,onUpdate:c=>{this.mixTargetDelta(c),f.onUpdate&&f.onUpdate(c)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(nP),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:c,target:E,layout:C,latestValues:R}=f;if(!(!c||!E||!C)){if(this!==f&&this.layout&&C&&dM(this.options.animationType,this.layout.layoutBox,C.layoutBox)){E=this.target||wr();const L=vs(this.layout.layoutBox.x);E.x.min=f.target.x.min,E.x.max=E.x.min+L;const B=vs(this.layout.layoutBox.y);E.y.min=f.target.y.min,E.y.max=E.y.min+B}ks(c,E),Rh(c,R),Jp(this.projectionDeltaWithTransform,this.layoutCorrected,c,R)}}registerSharedNode(f,c){this.sharedNodes.has(f)||this.sharedNodes.set(f,new i5),this.sharedNodes.get(f).add(c);const C=c.options.initialPromotionConfig;c.promote({transition:C?C.transition:void 0,preserveFollowOpacity:C&&C.shouldPreserveFollowOpacity?C.shouldPreserveFollowOpacity(c):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:c}=this.options;return c?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:c}=this.options;return c?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:c,preserveFollowOpacity:E}={}){const C=this.getStack();C&&C.promote(this,E),f&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let c=!1;const{latestValues:E}=f;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(c=!0),!c)return;const C={};E.z&&B0("z",f,C,this.animationValues);for(let R=0;R<F0.length;R++)B0(`rotate${F0[R]}`,f,C,this.animationValues),B0(`skew${F0[R]}`,f,C,this.animationValues);f.render();for(const R in C)f.setStaticValue(R,C[R]),this.animationValues&&(this.animationValues[R]=C[R]);f.scheduleRender()}getProjectionStyles(f){var c,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return a5;const C={visibility:""},R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,C.opacity="",C.pointerEvents=uy(f==null?void 0:f.pointerEvents)||"",C.transform=R?R(this.latestValues,""):"none",C;const L=this.getLead();if(!this.projectionDelta||!this.layout||!L.target){const te={};return this.options.layoutId&&(te.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,te.pointerEvents=uy(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!Cc(this.latestValues)&&(te.transform=R?R({},""):"none",this.hasProjected=!1),te}const B=L.animationValues||L.latestValues;this.applyTransformsToTarget(),C.transform=s5(this.projectionDeltaWithTransform,this.treeScale,B),R&&(C.transform=R(B,C.transform));const{x:X,y:W}=this.projectionDelta;C.transformOrigin=`${X.origin*100}% ${W.origin*100}% 0`,L.animationValues?C.opacity=L===this?(E=(c=B.opacity)!==null&&c!==void 0?c:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:B.opacityExit:C.opacity=L===this?B.opacity!==void 0?B.opacity:"":B.opacityExit!==void 0?B.opacityExit:0;for(const te in $y){if(B[te]===void 0)continue;const{correct:G,applyTo:J}=$y[te],H=C.transform==="none"?B[te]:G(B[te],L);if(J){const Q=J.length;for(let le=0;le<Q;le++)C[J[le]]=H}else C[te]=H}return this.options.layoutId&&(C.pointerEvents=L===this?uy(f==null?void 0:f.pointerEvents)||"":"none"),C}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var c;return(c=f.currentAnimation)===null||c===void 0?void 0:c.stop()}),this.root.nodes.forEach(rP),this.root.sharedNodes.clear()}}}function l5(e){e.updateLayout()}function c5(e){var t;const i=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:h}=e.layout,{animationType:m}=e.options,f=i.source!==e.layout.source;m==="size"?Is(L=>{const B=f?i.measuredBox[L]:i.layoutBox[L],X=vs(B);B.min=o[L].min,B.max=B.min+X}):dM(m,i.layoutBox,o)&&Is(L=>{const B=f?i.measuredBox[L]:i.layoutBox[L],X=vs(o[L]);B.max=B.min+X,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[L].max=e.relativeTarget[L].min+X)});const c=Ih();Jp(c,o,i.layoutBox);const E=Ih();f?Jp(E,e.applyTransform(h,!0),i.measuredBox):Jp(E,o,i.layoutBox);const C=!lM(c);let R=!1;if(!e.resumeFrom){const L=e.getClosestProjectingParent();if(L&&!L.resumeFrom){const{snapshot:B,layout:X}=L;if(B&&X){const W=wr();Qp(W,i.layoutBox,B.layoutBox);const te=wr();Qp(te,o,X.layoutBox),cM(W,te)||(R=!0),L.options.layoutRoot&&(e.relativeTarget=te,e.relativeTargetOrigin=W,e.relativeParent=L)}}}e.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:E,layoutDelta:c,hasLayoutChanged:C,hasRelativeTargetChanged:R})}else if(e.isLead()){const{onExitComplete:o}=e.options;o&&o()}e.options.transition=void 0}function u5(e){Fp&&kc.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function h5(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function d5(e){e.clearSnapshot()}function rP(e){e.clearMeasurements()}function p5(e){e.isLayoutDirty=!1}function f5(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function iP(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function m5(e){e.resolveTargetDelta()}function g5(e){e.calcProjection()}function y5(e){e.resetSkewAndRotation()}function _5(e){e.removeLeadSnapshot()}function sP(e,t,i){e.translate=cr(t.translate,0,i),e.scale=cr(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function aP(e,t,i,o){e.min=cr(t.min,i.min,o),e.max=cr(t.max,i.max,o)}function v5(e,t,i,o){aP(e.x,t.x,i.x,o),aP(e.y,t.y,i.y,o)}function x5(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const b5={duration:.45,ease:[.4,0,.1,1]},oP=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),lP=oP("applewebkit/")&&!oP("chrome/")?Math.round:ys;function cP(e){e.min=lP(e.min),e.max=lP(e.max)}function w5(e){cP(e.x),cP(e.y)}function dM(e,t,i){return e==="position"||e==="preserve-aspect"&&!EB(eP(t),eP(i),.2)}function S5(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const T5=hM({attachResizeListener:(e,t)=>Pf(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),V0={current:void 0},pM=hM({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!V0.current){const e=new T5({});e.mount(window),e.setOptions({layoutScroll:!0}),V0.current=e}return V0.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),E5={pan:{Feature:VB},drag:{Feature:BB,ProjectionNode:pM,MeasureLayout:sM}};function uP(e,t,i){const{props:o}=e;e.animationState&&o.whileHover&&e.animationState.setActive("whileHover",i==="Start");const h="onHover"+i,m=o[h];m&&Xn.postRender(()=>m(t,Vf(t)))}class P5 extends Tl{mount(){const{current:t}=this.node;t&&(this.unmount=EF(t,i=>(uP(this.node,i,"Start"),o=>uP(this.node,o,"End"))))}unmount(){}}class C5 extends Tl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Bf(Pf(this.node.current,"focus",()=>this.onFocus()),Pf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function hP(e,t,i){const{props:o}=e;e.animationState&&o.whileTap&&e.animationState.setActive("whileTap",i==="Start");const h="onTap"+(i==="End"?"":i),m=o[h];m&&Xn.postRender(()=>m(t,Vf(t)))}class k5 extends Tl{mount(){const{current:t}=this.node;t&&(this.unmount=AF(t,i=>(hP(this.node,i,"Start"),(o,{success:h})=>hP(this.node,o,h?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const gb=new WeakMap,U0=new WeakMap,A5=e=>{const t=gb.get(e.target);t&&t(e)},I5=e=>{e.forEach(A5)};function M5({root:e,...t}){const i=e||document;U0.has(i)||U0.set(i,{});const o=U0.get(i),h=JSON.stringify(t);return o[h]||(o[h]=new IntersectionObserver(I5,{root:e,...t})),o[h]}function R5(e,t,i){const o=M5(t);return gb.set(e,i),o.observe(e),()=>{gb.delete(e),o.unobserve(e)}}const D5={some:0,all:1};class j5 extends Tl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:o,amount:h="some",once:m}=t,f={root:i?i.current:void 0,rootMargin:o,threshold:typeof h=="number"?h:D5[h]},c=E=>{const{isIntersecting:C}=E;if(this.isInView===C||(this.isInView=C,m&&!C&&this.hasEnteredView))return;C&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",C);const{onViewportEnter:R,onViewportLeave:L}=this.node.getProps(),B=C?R:L;B&&B(E)};return R5(this.node.current,f,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(N5(t,i))&&this.startObserver()}unmount(){}}function N5({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const L5={inView:{Feature:j5},tap:{Feature:k5},focus:{Feature:C5},hover:{Feature:P5}},z5={layout:{ProjectionNode:pM,MeasureLayout:sM}},yb={current:null},fM={current:!1};function O5(){if(fM.current=!0,!!zw)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>yb.current=e.matches;e.addListener(t),t()}else yb.current=!1}const F5=[...FI,Si,vl],B5=e=>F5.find(OI(e)),dP=new WeakMap;function V5(e,t,i){for(const o in t){const h=t[o],m=i[o];if(Pi(h))e.addValue(o,h);else if(Pi(m))e.addValue(o,Tf(h,{owner:e}));else if(m!==h)if(e.hasValue(o)){const f=e.getValue(o);f.liveStyle===!0?f.jump(h):f.hasAnimated||f.set(h)}else{const f=e.getStaticValue(o);e.addValue(o,Tf(f!==void 0?f:h,{owner:e}))}}for(const o in i)t[o]===void 0&&e.removeValue(o);return t}const pP=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class U5{scrapeMotionValuesFromProps(t,i,o){return{}}constructor({parent:t,props:i,presenceContext:o,reducedMotionConfig:h,blockInitialAnimation:m,visualState:f},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=u1,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const X=Pa.now();this.renderScheduledAt<X&&(this.renderScheduledAt=X,Xn.render(this.render,!1,!0))};const{latestValues:E,renderState:C,onUpdate:R}=f;this.onUpdate=R,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=C,this.parent=t,this.props=i,this.presenceContext=o,this.depth=t?t.depth+1:0,this.reducedMotionConfig=h,this.options=c,this.blockInitialAnimation=!!m,this.isControllingVariants=b_(i),this.isVariantNode=ZA(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:L,...B}=this.scrapeMotionValuesFromProps(i,{},this);for(const X in B){const W=B[X];E[X]!==void 0&&Pi(W)&&W.set(E[X],!1)}}mount(t){this.current=t,dP.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),fM.current||O5(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:yb.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){dP.delete(this.current),this.projection&&this.projection.unmount(),_l(this.notifyUpdate),_l(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const o=Yc.has(t),h=i.on("change",c=>{this.latestValues[t]=c,this.props.onUpdate&&Xn.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),m=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{h(),m(),f&&f(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Xh){const i=Xh[t];if(!i)continue;const{isEnabled:o,Feature:h}=i;if(!this.features[t]&&h&&o(this.props)&&(this.features[t]=new h(this)),this.features[t]){const m=this.features[t];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):wr()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<pP.length;o++){const h=pP[o];this.propEventSubscriptions[h]&&(this.propEventSubscriptions[h](),delete this.propEventSubscriptions[h]);const m="on"+h,f=t[m];f&&(this.propEventSubscriptions[h]=this.on(h,f))}this.prevMotionValues=V5(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const o=this.values.get(t);i!==o&&(o&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let o=this.values.get(t);return o===void 0&&i!==void 0&&(o=Tf(i===null?void 0:i,{owner:this}),this.addValue(t,o)),o}readValue(t,i){var o;let h=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(o=this.getBaseTargetFromProps(this.props,t))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,t,this.options);return h!=null&&(typeof h=="string"&&(LI(h)||CI(h))?h=parseFloat(h):!B5(h)&&vl.test(i)&&(h=DI(t,i)),this.setBaseTarget(t,Pi(h)?h.get():h)),Pi(h)?h.get():h}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:o}=this.props;let h;if(typeof o=="string"||typeof o=="object"){const f=Gw(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(h=f[t])}if(o&&h!==void 0)return h;const m=this.getBaseTargetFromProps(this.props,t);return m!==void 0&&!Pi(m)?m:this.initialValues[t]!==void 0&&h===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new i1),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class mM extends U5{constructor(){super(...arguments),this.KeyframeResolver=BI}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:o}){delete i[t],delete o[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Pi(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function $5(e){return window.getComputedStyle(e)}class G5 extends mM{constructor(){super(...arguments),this.type="html",this.renderInstance=nI}readValueFromInstance(t,i){if(Yc.has(i)){const o=c1(i);return o&&o.default||0}else{const o=$5(t),h=(QA(i)?o.getPropertyValue(i):o[i])||0;return typeof h=="string"?h.trim():h}}measureInstanceViewportBox(t,{transformPagePoint:i}){return rM(t,i)}build(t,i,o){Zw(t,i,o.transformTemplate)}scrapeMotionValuesFromProps(t,i,o){return Yw(t,i,o)}}class q5 extends mM{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=wr}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(Yc.has(i)){const o=c1(i);return o&&o.default||0}return i=rI.has(i)?i:Vw(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,o){return aI(t,i,o)}build(t,i,o){Hw(t,i,this.isSVGTag,o.transformTemplate)}renderInstance(t,i,o,h){iI(t,i,o,h)}mount(t){this.isSVGTag=Xw(t.tagName),super.mount(t)}}const W5=(e,t)=>$w(e)?new q5(t):new G5(t,{allowProjection:e!==ze.Fragment}),Z5=_F({...gB,...L5,...E5,...z5},W5),Ft=DO(Z5);function T_(){return S.jsx("div",{className:"grid-bg"})}const fP="<>/\\{}[]()#@!$%&*";function H5({text:e}){const[t,i]=Ue.useState("");return Ue.useEffect(()=>{let o=0;const h=setInterval(()=>{o+=1;const m=Math.min(o/18,1),f=e.split("").map((c,E)=>E<e.length*m?c:fP[Math.floor(Math.random()*fP.length)]).join("");i(f),m===1&&clearInterval(h)},45);return()=>clearInterval(h)},[e]),S.jsx(Ft.h1,{className:"terminal-text mono",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},children:t})}function K5(){const e=qr();return S.jsxs("div",{style:{minHeight:"100vh",position:"relative",overflow:"hidden"},children:[S.jsx(T_,{}),S.jsxs("div",{style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2rem",padding:"6rem 2rem",textAlign:"center"},children:[S.jsx(H5,{text:"AI INFRASTRUCTURE FOR TRADES."}),S.jsx(Ft.p,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{delay:.3,duration:.8},style:{maxWidth:"640px",color:"#9ca3af"},children:"Kryonex orchestrates AI agents, lead intake, and customer messaging for modern HVAC and Plumbing teams."}),S.jsx(Ft.button,{className:"button-primary",whileHover:{scale:1.05},whileTap:{scale:.98},onClick:()=>e("/login"),children:"INITIALIZE SYSTEM"})]})]})}function E_(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,o=Object.getOwnPropertySymbols(e);h<o.length;h++)t.indexOf(o[h])<0&&Object.prototype.propertyIsEnumerable.call(e,o[h])&&(i[o[h]]=e[o[h]]);return i}function X5(e,t,i,o){function h(m){return m instanceof i?m:new i(function(f){f(m)})}return new(i||(i=Promise))(function(m,f){function c(R){try{C(o.next(R))}catch(L){f(L)}}function E(R){try{C(o.throw(R))}catch(L){f(L)}}function C(R){R.done?m(R.value):h(R.value).then(c,E)}C((o=o.apply(e,t||[])).next())})}const Y5=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class f1 extends Error{constructor(t,i="FunctionsError",o){super(t),this.name=i,this.context=o}}class J5 extends f1{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class mP extends f1{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class gP extends f1{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var _b;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(_b||(_b={}));class Q5{constructor(t,{headers:i={},customFetch:o,region:h=_b.Any}={}){this.url=t,this.headers=i,this.region=h,this.fetch=Y5(o)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return X5(this,arguments,void 0,function*(i,o={}){var h;let m,f;try{const{headers:c,method:E,body:C,signal:R,timeout:L}=o;let B={},{region:X}=o;X||(X=this.region);const W=new URL(`${this.url}/${i}`);X&&X!=="any"&&(B["x-region"]=X,W.searchParams.set("forceFunctionRegion",X));let te;C&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)?typeof Blob<"u"&&C instanceof Blob||C instanceof ArrayBuffer?(B["Content-Type"]="application/octet-stream",te=C):typeof C=="string"?(B["Content-Type"]="text/plain",te=C):typeof FormData<"u"&&C instanceof FormData?te=C:(B["Content-Type"]="application/json",te=JSON.stringify(C)):C&&typeof C!="string"&&!(typeof Blob<"u"&&C instanceof Blob)&&!(C instanceof ArrayBuffer)&&!(typeof FormData<"u"&&C instanceof FormData)?te=JSON.stringify(C):te=C;let G=R;L&&(f=new AbortController,m=setTimeout(()=>f.abort(),L),R?(G=f.signal,R.addEventListener("abort",()=>f.abort())):G=f.signal);const J=yield this.fetch(W.toString(),{method:E||"POST",headers:Object.assign(Object.assign(Object.assign({},B),this.headers),c),body:te,signal:G}).catch(ve=>{throw new J5(ve)}),H=J.headers.get("x-relay-error");if(H&&H==="true")throw new mP(J);if(!J.ok)throw new gP(J);let Q=((h=J.headers.get("Content-Type"))!==null&&h!==void 0?h:"text/plain").split(";")[0].trim(),le;return Q==="application/json"?le=yield J.json():Q==="application/octet-stream"||Q==="application/pdf"?le=yield J.blob():Q==="text/event-stream"?le=J:Q==="multipart/form-data"?le=yield J.formData():le=yield J.text(),{data:le,error:null,response:J}}catch(c){return{data:null,error:c,response:c instanceof gP||c instanceof mP?c.context:void 0}}finally{m&&clearTimeout(m)}})}}var e4=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},t4=class{constructor(e){var t,i;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(i=e.isMaybeSingle)!==null&&i!==void 0?i:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var i=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let h=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{let f=null,c=null,E=null,C=m.status,R=m.statusText;if(m.ok){var L,B;if(i.method!=="HEAD"){var X;const J=await m.text();J===""||(i.headers.get("Accept")==="text/csv"||i.headers.get("Accept")&&(!((X=i.headers.get("Accept"))===null||X===void 0)&&X.includes("application/vnd.pgrst.plan+text"))?c=J:c=JSON.parse(J))}const te=(L=i.headers.get("Prefer"))===null||L===void 0?void 0:L.match(/count=(exact|planned|estimated)/),G=(B=m.headers.get("content-range"))===null||B===void 0?void 0:B.split("/");te&&G&&G.length>1&&(E=parseInt(G[1])),i.isMaybeSingle&&i.method==="GET"&&Array.isArray(c)&&(c.length>1?(f={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,E=null,C=406,R="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{var W;const te=await m.text();try{f=JSON.parse(te),Array.isArray(f)&&m.status===404&&(c=[],f=null,C=200,R="OK")}catch{m.status===404&&te===""?(C=204,R="No Content"):f={message:te}}if(f&&i.isMaybeSingle&&(!(f==null||(W=f.details)===null||W===void 0)&&W.includes("0 rows"))&&(f=null,C=200,R="OK"),f&&i.shouldThrowOnError)throw new e4(f)}return{error:f,data:c,count:E,status:C,statusText:R}});return this.shouldThrowOnError||(h=h.catch(m=>{var f;let c="";const E=m==null?void 0:m.cause;if(E){var C,R,L,B;const W=(C=E==null?void 0:E.message)!==null&&C!==void 0?C:"",te=(R=E==null?void 0:E.code)!==null&&R!==void 0?R:"";c=`${(L=m==null?void 0:m.name)!==null&&L!==void 0?L:"FetchError"}: ${m==null?void 0:m.message}`,c+=`

Caused by: ${(B=E==null?void 0:E.name)!==null&&B!==void 0?B:"Error"}: ${W}`,te&&(c+=` (${te})`),E!=null&&E.stack&&(c+=`
${E.stack}`)}else{var X;c=(X=m==null?void 0:m.stack)!==null&&X!==void 0?X:""}return{error:{message:`${(f=m==null?void 0:m.name)!==null&&f!==void 0?f:"FetchError"}: ${m==null?void 0:m.message}`,details:c,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),h.then(e,t)}returns(){return this}overrideTypes(){return this}},n4=class extends t4{select(e){let t=!1;const i=(e??"*").split("").map(o=>/\s/.test(o)&&!t?"":(o==='"'&&(t=!t),o)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:i,foreignTable:o,referencedTable:h=o}={}){const m=h?`${h}.order`:"order",f=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${f?`${f},`:""}${e}.${t?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:i=t}={}){const o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(o,`${e}`),this}range(e,t,{foreignTable:i,referencedTable:o=i}={}){const h=typeof o>"u"?"offset":`${o}.offset`,m=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(h,`${e}`),this.url.searchParams.set(m,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:i=!1,buffers:o=!1,wal:h=!1,format:m="text"}={}){var f;const c=[e?"analyze":null,t?"verbose":null,i?"settings":null,o?"buffers":null,h?"wal":null].filter(Boolean).join("|"),E=(f=this.headers.get("Accept"))!==null&&f!==void 0?f:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${E}"; options=${c};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const yP=new RegExp("[,()]");var ph=class extends n4{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const i=Array.from(new Set(t)).map(o=>typeof o=="string"&&yP.test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`in.(${i})`),this}notIn(e,t){const i=Array.from(new Set(t)).map(o=>typeof o=="string"&&yP.test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`not.in.(${i})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:i,type:o}={}){let h="";o==="plain"?h="pl":o==="phrase"?h="ph":o==="websearch"&&(h="w");const m=i===void 0?"":`(${i})`;return this.url.searchParams.append(e,`${h}fts${m}.${t}`),this}match(e){return Object.entries(e).forEach(([t,i])=>{this.url.searchParams.append(t,`eq.${i}`)}),this}not(e,t,i){return this.url.searchParams.append(e,`not.${t}.${i}`),this}or(e,{foreignTable:t,referencedTable:i=t}={}){const o=i?`${i}.or`:"or";return this.url.searchParams.append(o,`(${e})`),this}filter(e,t,i){return this.url.searchParams.append(e,`${t}.${i}`),this}},r4=class{constructor(e,{headers:t={},schema:i,fetch:o}){this.url=e,this.headers=new Headers(t),this.schema=i,this.fetch=o}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:i=!1,count:o}=t??{},h=i?"HEAD":"GET";let m=!1;const f=(e??"*").split("").map(C=>/\s/.test(C)&&!m?"":(C==='"'&&(m=!m),C)).join(""),{url:c,headers:E}=this.cloneRequestState();return c.searchParams.set("select",f),o&&E.append("Prefer",`count=${o}`),new ph({method:h,url:c,headers:E,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:i=!0}={}){var o;const h="POST",{url:m,headers:f}=this.cloneRequestState();if(t&&f.append("Prefer",`count=${t}`),i||f.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((E,C)=>E.concat(Object.keys(C)),[]);if(c.length>0){const E=[...new Set(c)].map(C=>`"${C}"`);m.searchParams.set("columns",E.join(","))}}return new ph({method:h,url:m,headers:f,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:i=!1,count:o,defaultToNull:h=!0}={}){var m;const f="POST",{url:c,headers:E}=this.cloneRequestState();if(E.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),t!==void 0&&c.searchParams.set("on_conflict",t),o&&E.append("Prefer",`count=${o}`),h||E.append("Prefer","missing=default"),Array.isArray(e)){const C=e.reduce((R,L)=>R.concat(Object.keys(L)),[]);if(C.length>0){const R=[...new Set(C)].map(L=>`"${L}"`);c.searchParams.set("columns",R.join(","))}}return new ph({method:f,url:c,headers:E,schema:this.schema,body:e,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(e,{count:t}={}){var i;const o="PATCH",{url:h,headers:m}=this.cloneRequestState();return t&&m.append("Prefer",`count=${t}`),new ph({method:o,url:h,headers:m,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:e}={}){var t;const i="DELETE",{url:o,headers:h}=this.cloneRequestState();return e&&h.append("Prefer",`count=${e}`),new ph({method:i,url:o,headers:h,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},i4=class gM{constructor(t,{headers:i={},schema:o,fetch:h}={}){this.url=t,this.headers=new Headers(i),this.schemaName=o,this.fetch=h}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new r4(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new gM(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:o=!1,get:h=!1,count:m}={}){var f;let c;const E=new URL(`${this.url}/rpc/${t}`);let C;const R=X=>X!==null&&typeof X=="object"&&(!Array.isArray(X)||X.some(R)),L=o&&Object.values(i).some(R);L?(c="POST",C=i):o||h?(c=o?"HEAD":"GET",Object.entries(i).filter(([X,W])=>W!==void 0).map(([X,W])=>[X,Array.isArray(W)?`{${W.join(",")}}`:`${W}`]).forEach(([X,W])=>{E.searchParams.append(X,W)})):(c="POST",C=i);const B=new Headers(this.headers);return L?B.set("Prefer",m?`count=${m},return=minimal`:"return=minimal"):m&&B.set("Prefer",`count=${m}`),new ph({method:c,url:E,headers:B,schema:this.schemaName,body:C,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}};class s4{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const i=globalThis.process;if(i){const o=i.versions;if(o&&o.node){const h=o.node,m=parseInt(h.replace(/^v/,"").split(".")[0]);return m>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${m} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${m} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const o=this.getWebSocketConstructor();return new o(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const a4="2.90.1",o4=`realtime-js/${a4}`,yM="1.0.0",l4="2.0.0",_P=yM,vb=1e4,c4=1e3,u4=100;var Qo;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Qo||(Qo={}));var Ur;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Ur||(Ur={}));var Qs;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Qs||(Qs={}));var xb;(function(e){e.websocket="websocket"})(xb||(xb={}));var Ic;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Ic||(Ic={}));class h4{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,i){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return i(this._binaryEncodeUserBroadcastPush(t));let o=[t.join_ref,t.ref,t.topic,t.event,t.payload];return i(JSON.stringify(o))}_binaryEncodeUserBroadcastPush(t){var i;return this._isArrayBuffer((i=t.payload)===null||i===void 0?void 0:i.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var i,o;const h=(o=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&o!==void 0?o:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,h)}_encodeJsonUserBroadcastPush(t){var i,o;const h=(o=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&o!==void 0?o:{},f=new TextEncoder().encode(JSON.stringify(h)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,f)}_encodeUserBroadcastPush(t,i,o){var h,m;const f=t.topic,c=(h=t.ref)!==null&&h!==void 0?h:"",E=(m=t.join_ref)!==null&&m!==void 0?m:"",C=t.payload.event,R=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},L=Object.keys(R).length===0?"":JSON.stringify(R);if(E.length>255)throw new Error(`joinRef length ${E.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`ref length ${c.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`topic length ${f.length} exceeds maximum of 255`);if(C.length>255)throw new Error(`userEvent length ${C.length} exceeds maximum of 255`);if(L.length>255)throw new Error(`metadata length ${L.length} exceeds maximum of 255`);const B=this.USER_BROADCAST_PUSH_META_LENGTH+E.length+c.length+f.length+C.length+L.length,X=new ArrayBuffer(this.HEADER_LENGTH+B);let W=new DataView(X),te=0;W.setUint8(te++,this.KINDS.userBroadcastPush),W.setUint8(te++,E.length),W.setUint8(te++,c.length),W.setUint8(te++,f.length),W.setUint8(te++,C.length),W.setUint8(te++,L.length),W.setUint8(te++,i),Array.from(E,J=>W.setUint8(te++,J.charCodeAt(0))),Array.from(c,J=>W.setUint8(te++,J.charCodeAt(0))),Array.from(f,J=>W.setUint8(te++,J.charCodeAt(0))),Array.from(C,J=>W.setUint8(te++,J.charCodeAt(0))),Array.from(L,J=>W.setUint8(te++,J.charCodeAt(0)));var G=new Uint8Array(X.byteLength+o.byteLength);return G.set(new Uint8Array(X),0),G.set(new Uint8Array(o),X.byteLength),G.buffer}decode(t,i){if(this._isArrayBuffer(t)){let o=this._binaryDecode(t);return i(o)}if(typeof t=="string"){const o=JSON.parse(t),[h,m,f,c,E]=o;return i({join_ref:h,ref:m,topic:f,event:c,payload:E})}return i({})}_binaryDecode(t){const i=new DataView(t),o=i.getUint8(0),h=new TextDecoder;switch(o){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,i,h)}}_decodeUserBroadcast(t,i,o){const h=i.getUint8(1),m=i.getUint8(2),f=i.getUint8(3),c=i.getUint8(4);let E=this.HEADER_LENGTH+4;const C=o.decode(t.slice(E,E+h));E=E+h;const R=o.decode(t.slice(E,E+m));E=E+m;const L=o.decode(t.slice(E,E+f));E=E+f;const B=t.slice(E,t.byteLength),X=c===this.JSON_ENCODING?JSON.parse(o.decode(B)):B,W={type:this.BROADCAST_EVENT,event:R,payload:X};return f>0&&(W.meta=JSON.parse(L)),{join_ref:null,ref:null,topic:C,event:this.BROADCAST_EVENT,payload:W}}_isArrayBuffer(t){var i;return t instanceof ArrayBuffer||((i=t==null?void 0:t.constructor)===null||i===void 0?void 0:i.name)==="ArrayBuffer"}_pick(t,i){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([o])=>i.includes(o)))}}class _M{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Bn;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Bn||(Bn={}));const vP=(e,t,i={})=>{var o;const h=(o=i.skipTypes)!==null&&o!==void 0?o:[];return t?Object.keys(t).reduce((m,f)=>(m[f]=d4(f,e,t,h),m),{}):{}},d4=(e,t,i,o)=>{const h=t.find(c=>c.name===e),m=h==null?void 0:h.type,f=i[e];return m&&!o.includes(m)?vM(m,f):bb(f)},vM=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return g4(t,i)}switch(e){case Bn.bool:return p4(t);case Bn.float4:case Bn.float8:case Bn.int2:case Bn.int4:case Bn.int8:case Bn.numeric:case Bn.oid:return f4(t);case Bn.json:case Bn.jsonb:return m4(t);case Bn.timestamp:return y4(t);case Bn.abstime:case Bn.date:case Bn.daterange:case Bn.int4range:case Bn.int8range:case Bn.money:case Bn.reltime:case Bn.text:case Bn.time:case Bn.timestamptz:case Bn.timetz:case Bn.tsrange:case Bn.tstzrange:return bb(t);default:return bb(t)}},bb=e=>e,p4=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},f4=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},m4=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},g4=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,o=e[i];if(e[0]==="{"&&o==="}"){let m;const f=e.slice(1,i);try{m=JSON.parse("["+f+"]")}catch{m=f?f.split(","):[]}return m.map(c=>vM(t,c))}return e},y4=e=>typeof e=="string"?e.replace(" ","T"):e,xM=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class $0{constructor(t,i,o={},h=vb){this.channel=t,this.event=i,this.payload=o,this.timeout=h,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var o;return this._hasReceived(t)&&i((o=this.receivedResp)===null||o===void 0?void 0:o.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(o=>o.status===t).forEach(o=>o.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var xP;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(xP||(xP={}));class ef{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const o=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(o.state,{},h=>{const{onJoin:m,onLeave:f,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ef.syncState(this.state,h,m,f),this.pendingDiffs.forEach(E=>{this.state=ef.syncDiff(this.state,E,m,f)}),this.pendingDiffs=[],c()}),this.channel._on(o.diff,{},h=>{const{onJoin:m,onLeave:f,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(h):(this.state=ef.syncDiff(this.state,h,m,f),c())}),this.onJoin((h,m,f)=>{this.channel._trigger("presence",{event:"join",key:h,currentPresences:m,newPresences:f})}),this.onLeave((h,m,f)=>{this.channel._trigger("presence",{event:"leave",key:h,currentPresences:m,leftPresences:f})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,o,h){const m=this.cloneDeep(t),f=this.transformState(i),c={},E={};return this.map(m,(C,R)=>{f[C]||(E[C]=R)}),this.map(f,(C,R)=>{const L=m[C];if(L){const B=R.map(G=>G.presence_ref),X=L.map(G=>G.presence_ref),W=R.filter(G=>X.indexOf(G.presence_ref)<0),te=L.filter(G=>B.indexOf(G.presence_ref)<0);W.length>0&&(c[C]=W),te.length>0&&(E[C]=te)}else c[C]=R}),this.syncDiff(m,{joins:c,leaves:E},o,h)}static syncDiff(t,i,o,h){const{joins:m,leaves:f}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return o||(o=()=>{}),h||(h=()=>{}),this.map(m,(c,E)=>{var C;const R=(C=t[c])!==null&&C!==void 0?C:[];if(t[c]=this.cloneDeep(E),R.length>0){const L=t[c].map(X=>X.presence_ref),B=R.filter(X=>L.indexOf(X.presence_ref)<0);t[c].unshift(...B)}o(c,R,E)}),this.map(f,(c,E)=>{let C=t[c];if(!C)return;const R=E.map(L=>L.presence_ref);C=C.filter(L=>R.indexOf(L.presence_ref)<0),t[c]=C,h(c,C,E),C.length===0&&delete t[c]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(o=>i(o,t[o]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,o)=>{const h=t[o];return"metas"in h?i[o]=h.metas.map(m=>(m.presence_ref=m.phx_ref,delete m.phx_ref,delete m.phx_ref_prev,m)):i[o]=h,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bP;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(bP||(bP={}));var tf;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(tf||(tf={}));var eo;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(eo||(eo={}));class Dh{constructor(t,i={config:{}},o){var h,m;if(this.topic=t,this.params=i,this.socket=o,this.bindings={},this.state=Ur.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new $0(this,Qs.join,this.params,this.timeout),this.rejoinTimer=new _M(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ur.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(f=>f.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ur.closed,this.socket._remove(this)}),this._onError(f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=Ur.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ur.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=Ur.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qs.reply,{},(f,c)=>{this._trigger(this._replyEventName(c),f)}),this.presence=new ef(this),this.broadcastEndpointURL=xM(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((m=(h=this.params.config)===null||h===void 0?void 0:h.broadcast)===null||m===void 0)&&m.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var o,h,m;if(this.socket.isConnected()||this.socket.connect(),this.state==Ur.closed){const{config:{broadcast:f,presence:c,private:E}}=this.params,C=(h=(o=this.bindings.postgres_changes)===null||o===void 0?void 0:o.map(X=>X.filter))!==null&&h!==void 0?h:[],R=!!this.bindings[tf.PRESENCE]&&this.bindings[tf.PRESENCE].length>0||((m=this.params.config.presence)===null||m===void 0?void 0:m.enabled)===!0,L={},B={broadcast:f,presence:Object.assign(Object.assign({},c),{enabled:R}),postgres_changes:C,private:E};this.socket.accessTokenValue&&(L.access_token=this.socket.accessTokenValue),this._onError(X=>t==null?void 0:t(eo.CHANNEL_ERROR,X)),this._onClose(()=>t==null?void 0:t(eo.CLOSED)),this.updateJoinPayload(Object.assign({config:B},L)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:X})=>{var W;if(this.socket._isManualToken()||this.socket.setAuth(),X===void 0){t==null||t(eo.SUBSCRIBED);return}else{const te=this.bindings.postgres_changes,G=(W=te==null?void 0:te.length)!==null&&W!==void 0?W:0,J=[];for(let H=0;H<G;H++){const Q=te[H],{filter:{event:le,schema:ve,table:Ee,filter:_e}}=Q,we=X&&X[H];if(we&&we.event===le&&Dh.isFilterValueEqual(we.schema,ve)&&Dh.isFilterValueEqual(we.table,Ee)&&Dh.isFilterValueEqual(we.filter,_e))J.push(Object.assign(Object.assign({},Q),{id:we.id}));else{this.unsubscribe(),this.state=Ur.errored,t==null||t(eo.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=J,t&&t(eo.SUBSCRIBED);return}}).receive("error",X=>{this.state=Ur.errored,t==null||t(eo.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(X).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(eo.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,o){return this.state===Ur.joined&&t===tf.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,i,o)}async httpSend(t,i,o={}){var h;if(i==null)return Promise.reject("Payload is required for httpSend()");const m={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(m.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:m,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},c=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(h=o.timeout)!==null&&h!==void 0?h:this.timeout);if(c.status===202)return{success:!0};let E=c.statusText;try{const C=await c.json();E=C.error||C.message||E}catch{}return Promise.reject(new Error(E))}async send(t,i={}){var o,h;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:m,payload:f}=t,c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const E={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:m,payload:f,private:this.private}]})};try{const C=await this._fetchWithTimeout(this.broadcastEndpointURL,E,(o=i.timeout)!==null&&o!==void 0?o:this.timeout);return await((h=C.body)===null||h===void 0?void 0:h.cancel()),C.ok?"ok":"error"}catch(C){return C.name==="AbortError"?"timed out":"error"}}else return new Promise(m=>{var f,c,E;const C=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((E=(c=(f=this.params)===null||f===void 0?void 0:f.config)===null||c===void 0?void 0:c.broadcast)===null||E===void 0)&&E.ack)&&m("ok"),C.receive("ok",()=>m("ok")),C.receive("error",()=>m("error")),C.receive("timeout",()=>m("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ur.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qs.close,"leave",this._joinRef())};this.joinPush.destroy();let o=null;return new Promise(h=>{o=new $0(this,Qs.leave,{},t),o.receive("ok",()=>{i(),h("ok")}).receive("timeout",()=>{i(),h("timed out")}).receive("error",()=>{h("error")}),o.send(),this._canPush()||o.trigger("ok",{})}).finally(()=>{o==null||o.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ur.closed,this.bindings={}}async _fetchWithTimeout(t,i,o){const h=new AbortController,m=setTimeout(()=>h.abort(),o),f=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:h.signal}));return clearTimeout(m),f}_push(t,i,o=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let h=new $0(this,t,i,o);return this._canPush()?h.send():this._addToPushBuffer(h),h}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>u4){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,o){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,o){var h,m;const f=t.toLocaleLowerCase(),{close:c,error:E,leave:C,join:R}=Qs;if(o&&[c,E,C,R].indexOf(f)>=0&&o!==this._joinRef())return;let B=this._onMessage(f,i,o);if(i&&!B)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?(h=this.bindings.postgres_changes)===null||h===void 0||h.filter(X=>{var W,te,G;return((W=X.filter)===null||W===void 0?void 0:W.event)==="*"||((G=(te=X.filter)===null||te===void 0?void 0:te.event)===null||G===void 0?void 0:G.toLocaleLowerCase())===f}).map(X=>X.callback(B,o)):(m=this.bindings[f])===null||m===void 0||m.filter(X=>{var W,te,G,J,H,Q,le,ve;if(["broadcast","presence","postgres_changes"].includes(f))if("id"in X){const Ee=X.id,_e=(W=X.filter)===null||W===void 0?void 0:W.event;return Ee&&((te=i.ids)===null||te===void 0?void 0:te.includes(Ee))&&(_e==="*"||(_e==null?void 0:_e.toLocaleLowerCase())===((G=i.data)===null||G===void 0?void 0:G.type.toLocaleLowerCase()))&&(!(!((J=X.filter)===null||J===void 0)&&J.table)||X.filter.table===((H=i.data)===null||H===void 0?void 0:H.table))}else{const Ee=(le=(Q=X==null?void 0:X.filter)===null||Q===void 0?void 0:Q.event)===null||le===void 0?void 0:le.toLocaleLowerCase();return Ee==="*"||Ee===((ve=i==null?void 0:i.event)===null||ve===void 0?void 0:ve.toLocaleLowerCase())}else return X.type.toLocaleLowerCase()===f}).map(X=>{if(typeof B=="object"&&"ids"in B){const W=B.data,{schema:te,table:G,commit_timestamp:J,type:H,errors:Q}=W;B=Object.assign(Object.assign({},{schema:te,table:G,commit_timestamp:J,eventType:H,new:{},old:{},errors:Q}),this._getPayloadRecords(W))}X.callback(B,o)})}_isClosed(){return this.state===Ur.closed}_isJoined(){return this.state===Ur.joined}_isJoining(){return this.state===Ur.joining}_isLeaving(){return this.state===Ur.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,o){const h=t.toLocaleLowerCase(),m={type:h,filter:i,callback:o};return this.bindings[h]?this.bindings[h].push(m):this.bindings[h]=[m],this}_off(t,i){const o=t.toLocaleLowerCase();return this.bindings[o]&&(this.bindings[o]=this.bindings[o].filter(h=>{var m;return!(((m=h.type)===null||m===void 0?void 0:m.toLocaleLowerCase())===o&&Dh.isEqual(h.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const o in t)if(t[o]!==i[o])return!1;return!0}static isFilterValueEqual(t,i){return(t??void 0)===(i??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Qs.close,{},t)}_onError(t){this._on(Qs.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ur.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=vP(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=vP(t.columns,t.old_record)),i}}const G0=()=>{},$g={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},_4=[1e3,2e3,5e3,1e4],v4=1e4,x4=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class b4{constructor(t,i){var o;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=vb,this.transport=null,this.heartbeatIntervalMs=$g.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=G0,this.ref=0,this.reconnectTimer=null,this.vsn=_P,this.logger=G0,this.conn=null,this.sendBuffer=[],this.serializer=new h4,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=h=>h?(...m)=>h(...m):(...m)=>fetch(...m),!(!((o=i==null?void 0:i.params)===null||o===void 0)&&o.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${xb.websocket}`,this.httpEndpoint=xM(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i==null?void 0:i.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=s4.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const o=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(o),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,i??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,o){this.logger(t,i,o)}connectionState(){switch(this.conn&&this.conn.readyState){case Qo.connecting:return Ic.Connecting;case Qo.open:return Ic.Open;case Qo.closing:return Ic.Closing;default:return Ic.Closed}}isConnected(){return this.connectionState()===Ic.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const o=`realtime:${t}`,h=this.getChannels().find(m=>m.topic===o);if(h)return h;{const m=new Dh(`realtime:${t}`,i,this);return this.channels.push(m),m}}push(t){const{topic:i,event:o,payload:h,ref:m}=t,f=()=>{this.encode(t,c=>{var E;(E=this.conn)===null||E===void 0||E.send(c)})};this.log("push",`${i} ${o} (${m})`,h),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(c4,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},$g.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(o=>o.topic===t&&(o._isJoined()||o._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply"&&i.ref&&i.ref===this.pendingHeartbeatRef){const C=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error",C)}catch(R){this.log("error","error in heartbeat callback",R)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:o,event:h,payload:m,ref:f}=i,c=f?`(${f})`:"",E=m.status||"";this.log("receive",`${E} ${o} ${h} ${c}`.trim(),m),this.channels.filter(C=>C._isMember(o)).forEach(C=>C._trigger(h,m,f)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Qo.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Qo.open||this.conn.readyState===Qo.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(i=>{this.log("error","error waiting for auth on connect",i),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this._terminateWorker()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Qs.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const o=t.match(/\?/)?"&":"?",h=new URLSearchParams(i);return`${t}${o}${h}`}_workerObjectUrl(t){let i;if(t)i=t;else{const o=new Blob([x4],{type:"application/javascript"});i=URL.createObjectURL(o)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i,o=!1;if(t)i=t,o=!0;else if(this.accessToken)try{i=await this.accessToken()}catch(h){this.log("error","Error fetching access token from callback",h),i=this.accessTokenValue}else i=this.accessTokenValue;o?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(h=>{const m={access_token:i,version:o4};i&&h.updateJoinPayload(m),h.joinedOnce&&h._isJoined()&&h._push(Qs.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(i=>{this.log("error",`Error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(o=>{try{o(i)}catch(h){this.log("error",`error in ${t} callback`,h)}})}catch(o){this.log("error",`error triggering ${t} callbacks`,o)}}_setupReconnectionTimer(){this.reconnectTimer=new _M(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},$g.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,o,h,m,f,c,E,C,R,L,B,X;switch(this.transport=(i=t==null?void 0:t.transport)!==null&&i!==void 0?i:null,this.timeout=(o=t==null?void 0:t.timeout)!==null&&o!==void 0?o:vb,this.heartbeatIntervalMs=(h=t==null?void 0:t.heartbeatIntervalMs)!==null&&h!==void 0?h:$g.HEARTBEAT_INTERVAL,this.worker=(m=t==null?void 0:t.worker)!==null&&m!==void 0?m:!1,this.accessToken=(f=t==null?void 0:t.accessToken)!==null&&f!==void 0?f:null,this.heartbeatCallback=(c=t==null?void 0:t.heartbeatCallback)!==null&&c!==void 0?c:G0,this.vsn=(E=t==null?void 0:t.vsn)!==null&&E!==void 0?E:_P,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(C=t==null?void 0:t.reconnectAfterMs)!==null&&C!==void 0?C:W=>_4[W-1]||v4,this.vsn){case yM:this.encode=(R=t==null?void 0:t.encode)!==null&&R!==void 0?R:(W,te)=>te(JSON.stringify(W)),this.decode=(L=t==null?void 0:t.decode)!==null&&L!==void 0?L:(W,te)=>te(JSON.parse(W));break;case l4:this.encode=(B=t==null?void 0:t.encode)!==null&&B!==void 0?B:this.serializer.encode.bind(this.serializer),this.decode=(X=t==null?void 0:t.decode)!==null&&X!==void 0?X:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var Cf=class extends Error{constructor(e,t){var i;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((i=t.icebergType)==null?void 0:i.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function w4(e,t,i){const o=new URL(t,e);if(i)for(const[h,m]of Object.entries(i))m!==void 0&&o.searchParams.set(h,m);return o.toString()}async function S4(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function T4(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:i,path:o,query:h,body:m,headers:f}){const c=w4(e.baseUrl,o,h),E=await S4(e.auth),C=await t(c,{method:i,headers:{...m?{"Content-Type":"application/json"}:{},...E,...f},body:m?JSON.stringify(m):void 0}),R=await C.text(),L=(C.headers.get("content-type")||"").includes("application/json"),B=L&&R?JSON.parse(R):R;if(!C.ok){const X=L?B:void 0,W=X==null?void 0:X.error;throw new Cf((W==null?void 0:W.message)??`Request failed with status ${C.status}`,{status:C.status,icebergType:W==null?void 0:W.type,icebergCode:W==null?void 0:W.code,details:X})}return{status:C.status,headers:C.headers,data:B}}}}function Gg(e){return e.join("")}var E4=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Gg(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(o=>({namespace:o}))}async createNamespace(e,t){const i={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:i})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Gg(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Gg(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Gg(e.namespace)}`}),!0}catch(t){if(t instanceof Cf&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(i){if(i instanceof Cf&&i.status===409)return;throw i}}};function ah(e){return e.join("")}var P4=class{constructor(e,t="",i){this.client=e,this.prefix=t,this.accessDelegation=i}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ah(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ah(e.namespace)}/tables`,body:t,headers:i})).data.metadata}async updateTable(e,t){const i=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ah(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":i.data["metadata-location"],metadata:i.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ah(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ah(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ah(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(i){if(i instanceof Cf&&i.status===404)return!1;throw i}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(i){if(i instanceof Cf&&i.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw i}}},C4=class{constructor(e){var o;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const i=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=T4({baseUrl:i,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(o=e.accessDelegation)==null?void 0:o.join(","),this.namespaceOps=new E4(this.client,t),this.tableOps=new P4(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},P_=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function or(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var k4=class extends P_{constructor(e,t,i){super(e),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},wb=class extends P_{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const m1=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),A4=()=>Response,Sb=e=>{if(Array.isArray(e))return e.map(i=>Sb(i));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([i,o])=>{const h=i.replace(/([-_][a-z])/gi,m=>m.toUpperCase().replace(/[-_]/g,""));t[h]=Sb(o)}),t},I4=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},M4=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function kf(e){"@babel/helpers - typeof";return kf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kf(e)}function R4(e,t){if(kf(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var o=i.call(e,t);if(kf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function D4(e){var t=R4(e,"string");return kf(t)=="symbol"?t:t+""}function j4(e,t,i){return(t=D4(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function wP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Lt(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?wP(Object(i),!0).forEach(function(o){j4(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wP(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const q0=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},N4=async(e,t,i)=>{e instanceof await A4()&&!(i!=null&&i.noResolveJson)?e.json().then(o=>{const h=e.status||500,m=(o==null?void 0:o.statusCode)||h+"";t(new k4(q0(o),h,m))}).catch(o=>{t(new wb(q0(o),o))}):t(new wb(q0(e),e))},L4=(e,t,i,o)=>{const h={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!o?h:(I4(o)?(h.headers=Lt({"Content-Type":"application/json"},t==null?void 0:t.headers),h.body=JSON.stringify(o)):h.body=o,t!=null&&t.duplex&&(h.duplex=t.duplex),Lt(Lt({},h),i))};async function Uf(e,t,i,o,h,m){return new Promise((f,c)=>{e(i,L4(t,o,h,m)).then(E=>{if(!E.ok)throw E;return o!=null&&o.noResolveJson?E:E.json()}).then(E=>f(E)).catch(E=>N4(E,c,o))})}async function Af(e,t,i,o){return Uf(e,"GET",t,i,o)}async function Ys(e,t,i,o,h){return Uf(e,"POST",t,o,h,i)}async function Tb(e,t,i,o,h){return Uf(e,"PUT",t,o,h,i)}async function z4(e,t,i,o){return Uf(e,"HEAD",t,Lt(Lt({},i),{},{noResolveJson:!0}),o)}async function g1(e,t,i,o,h){return Uf(e,"DELETE",t,o,h,i)}var O4=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(or(t))return{data:null,error:t};throw t}}};let bM;bM=Symbol.toStringTag;var F4=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[bM]="BlobDownloadBuilder",this.promise=null}asStream(){return new O4(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(or(t))return{data:null,error:t};throw t}}};const B4={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},SP={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var V4=class{constructor(e,t={},i,o){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=i,this.fetch=m1(o)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,i,o){var h=this;try{let m;const f=Lt(Lt({},SP),o);let c=Lt(Lt({},h.headers),e==="POST"&&{"x-upsert":String(f.upsert)});const E=f.metadata;typeof Blob<"u"&&i instanceof Blob?(m=new FormData,m.append("cacheControl",f.cacheControl),E&&m.append("metadata",h.encodeMetadata(E)),m.append("",i)):typeof FormData<"u"&&i instanceof FormData?(m=i,m.has("cacheControl")||m.append("cacheControl",f.cacheControl),E&&!m.has("metadata")&&m.append("metadata",h.encodeMetadata(E))):(m=i,c["cache-control"]=`max-age=${f.cacheControl}`,c["content-type"]=f.contentType,E&&(c["x-metadata"]=h.toBase64(h.encodeMetadata(E))),(typeof ReadableStream<"u"&&m instanceof ReadableStream||m&&typeof m=="object"&&"pipe"in m&&typeof m.pipe=="function")&&!f.duplex&&(f.duplex="half")),o!=null&&o.headers&&(c=Lt(Lt({},c),o.headers));const C=h._removeEmptyFolders(t),R=h._getFinalPath(C),L=await(e=="PUT"?Tb:Ys)(h.fetch,`${h.url}/object/${R}`,m,Lt({headers:c},f!=null&&f.duplex?{duplex:f.duplex}:{}));return{data:{path:C,id:L.Id,fullPath:L.Key},error:null}}catch(m){if(h.shouldThrowOnError)throw m;if(or(m))return{data:null,error:m};throw m}}async upload(e,t,i){return this.uploadOrUpdate("POST",e,t,i)}async uploadToSignedUrl(e,t,i,o){var h=this;const m=h._removeEmptyFolders(e),f=h._getFinalPath(m),c=new URL(h.url+`/object/upload/sign/${f}`);c.searchParams.set("token",t);try{let E;const C=Lt({upsert:SP.upsert},o),R=Lt(Lt({},h.headers),{"x-upsert":String(C.upsert)});return typeof Blob<"u"&&i instanceof Blob?(E=new FormData,E.append("cacheControl",C.cacheControl),E.append("",i)):typeof FormData<"u"&&i instanceof FormData?(E=i,E.append("cacheControl",C.cacheControl)):(E=i,R["cache-control"]=`max-age=${C.cacheControl}`,R["content-type"]=C.contentType),{data:{path:m,fullPath:(await Tb(h.fetch,c.toString(),E,{headers:R})).Key},error:null}}catch(E){if(h.shouldThrowOnError)throw E;if(or(E))return{data:null,error:E};throw E}}async createSignedUploadUrl(e,t){var i=this;try{let o=i._getFinalPath(e);const h=Lt({},i.headers);t!=null&&t.upsert&&(h["x-upsert"]="true");const m=await Ys(i.fetch,`${i.url}/object/upload/sign/${o}`,{},{headers:h}),f=new URL(i.url+m.url),c=f.searchParams.get("token");if(!c)throw new P_("No token returned by API");return{data:{signedUrl:f.toString(),path:e,token:c},error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(or(o))return{data:null,error:o};throw o}}async update(e,t,i){return this.uploadOrUpdate("PUT",e,t,i)}async move(e,t,i){var o=this;try{return{data:await Ys(o.fetch,`${o.url}/object/move`,{bucketId:o.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i==null?void 0:i.destinationBucket},{headers:o.headers}),error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(or(h))return{data:null,error:h};throw h}}async copy(e,t,i){var o=this;try{return{data:{path:(await Ys(o.fetch,`${o.url}/object/copy`,{bucketId:o.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i==null?void 0:i.destinationBucket},{headers:o.headers})).Key},error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(or(h))return{data:null,error:h};throw h}}async createSignedUrl(e,t,i){var o=this;try{let h=o._getFinalPath(e),m=await Ys(o.fetch,`${o.url}/object/sign/${h}`,Lt({expiresIn:t},i!=null&&i.transform?{transform:i.transform}:{}),{headers:o.headers});const f=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return m={signedUrl:encodeURI(`${o.url}${m.signedURL}${f}`)},{data:m,error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(or(h))return{data:null,error:h};throw h}}async createSignedUrls(e,t,i){var o=this;try{const h=await Ys(o.fetch,`${o.url}/object/sign/${o.bucketId}`,{expiresIn:t,paths:e},{headers:o.headers}),m=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return{data:h.map(f=>Lt(Lt({},f),{},{signedUrl:f.signedURL?encodeURI(`${o.url}${f.signedURL}${m}`):null})),error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(or(h))return{data:null,error:h};throw h}}download(e,t){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),h=o?`?${o}`:"",m=this._getFinalPath(e),f=()=>Af(this.fetch,`${this.url}/${i}/${m}${h}`,{headers:this.headers,noResolveJson:!0});return new F4(f,this.shouldThrowOnError)}async info(e){var t=this;const i=t._getFinalPath(e);try{return{data:Sb(await Af(t.fetch,`${t.url}/object/info/${i}`,{headers:t.headers})),error:null}}catch(o){if(t.shouldThrowOnError)throw o;if(or(o))return{data:null,error:o};throw o}}async exists(e){var t=this;const i=t._getFinalPath(e);try{return await z4(t.fetch,`${t.url}/object/${i}`,{headers:t.headers}),{data:!0,error:null}}catch(o){if(t.shouldThrowOnError)throw o;if(or(o)&&o instanceof wb){const h=o.originalError;if([400,404].includes(h==null?void 0:h.status))return{data:!1,error:o}}throw o}}getPublicUrl(e,t){const i=this._getFinalPath(e),o=[],h=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";h!==""&&o.push(h);const m=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",f=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});f!==""&&o.push(f);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${m}/public/${i}${c}`)}}}async remove(e){var t=this;try{return{data:await g1(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async list(e,t,i){var o=this;try{const h=Lt(Lt(Lt({},B4),t),{},{prefix:e||""});return{data:await Ys(o.fetch,`${o.url}/object/list/${o.bucketId}`,h,{headers:o.headers},i),error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(or(h))return{data:null,error:h};throw h}}async listV2(e,t){var i=this;try{const o=Lt({},e);return{data:await Ys(i.fetch,`${i.url}/object/list-v2/${i.bucketId}`,o,{headers:i.headers},t),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(or(o))return{data:null,error:o};throw o}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const wM="2.90.1",SM={"X-Client-Info":`storage-js/${wM}`};var U4=class{constructor(e,t={},i,o){this.shouldThrowOnError=!1;const h=new URL(e);o!=null&&o.useNewHostname&&/supabase\.(co|in|red)$/.test(h.hostname)&&!h.hostname.includes("storage.supabase.")&&(h.hostname=h.hostname.replace("supabase.","storage.supabase.")),this.url=h.href.replace(/\/$/,""),this.headers=Lt(Lt({},SM),t),this.fetch=m1(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const i=t.listBucketOptionsToQueryString(e);return{data:await Af(t.fetch,`${t.url}/bucket${i}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async getBucket(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async createBucket(e,t={public:!1}){var i=this;try{return{data:await Ys(i.fetch,`${i.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(or(o))return{data:null,error:o};throw o}}async updateBucket(e,t){var i=this;try{return{data:await Tb(i.fetch,`${i.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(or(o))return{data:null,error:o};throw o}}async emptyBucket(e){var t=this;try{return{data:await Ys(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async deleteBucket(e){var t=this;try{return{data:await g1(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},$4=class{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Lt(Lt({},SM),t),this.fetch=m1(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Ys(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async listBuckets(e){var t=this;try{const i=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&i.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&i.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&i.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&i.set("sortOrder",e.sortOrder),e!=null&&e.search&&i.set("search",e.search);const o=i.toString(),h=o?`${t.url}/bucket?${o}`:`${t.url}/bucket`;return{data:await Af(t.fetch,h,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}async deleteBucket(e){var t=this;try{return{data:await g1(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(or(i))return{data:null,error:i};throw i}}from(e){var t=this;if(!M4(e))throw new P_("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const i=new C4({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),o=this.shouldThrowOnError;return new Proxy(i,{get(h,m){const f=h[m];return typeof f!="function"?f:async(...c)=>{try{return{data:await f.apply(h,c),error:null}}catch(E){if(o)throw E;return{data:null,error:E}}}}})}};const y1={"X-Client-Info":`storage-js/${wM}`,"Content-Type":"application/json"};var TM=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function ps(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}var W0=class extends TM{constructor(e,t,i){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},G4=class extends TM{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const _1=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),q4=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},TP=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),W4=async(e,t,i)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(i!=null&&i.noResolveJson)){const o=e.status||500,h=e;if(typeof h.json=="function")h.json().then(m=>{const f=(m==null?void 0:m.statusCode)||(m==null?void 0:m.code)||o+"";t(new W0(TP(m),o,f))}).catch(()=>{const m=o+"";t(new W0(h.statusText||`HTTP ${o} error`,o,m))});else{const m=o+"";t(new W0(h.statusText||`HTTP ${o} error`,o,m))}}else t(new G4(TP(e),e))},Z4=(e,t,i,o)=>{const h={method:e,headers:(t==null?void 0:t.headers)||{}};return o?(q4(o)?(h.headers=Lt({"Content-Type":"application/json"},t==null?void 0:t.headers),h.body=JSON.stringify(o)):h.body=o,Lt(Lt({},h),i)):h};async function H4(e,t,i,o,h,m){return new Promise((f,c)=>{e(i,Z4(t,o,h,m)).then(E=>{if(!E.ok)throw E;if(o!=null&&o.noResolveJson)return E;const C=E.headers.get("content-type");return!C||!C.includes("application/json")?{}:E.json()}).then(E=>f(E)).catch(E=>W4(E,c,o))})}async function fs(e,t,i,o,h){return H4(e,"POST",t,o,h,i)}var K4=class{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Lt(Lt({},y1),t),this.fetch=_1(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async getIndex(e,t){var i=this;try{return{data:await fs(i.fetch,`${i.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:i.headers}),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(ps(o))return{data:null,error:o};throw o}}async listIndexes(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async deleteIndex(e,t){var i=this;try{return{data:await fs(i.fetch,`${i.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:i.headers})||{},error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(ps(o))return{data:null,error:o};throw o}}},X4=class{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Lt(Lt({},y1),t),this.fetch=_1(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await fs(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async getVectors(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async listVectors(e){var t=this;try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await fs(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async queryVectors(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await fs(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}},Y4=class{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Lt(Lt({},y1),t),this.fetch=_1(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async getBucket(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async listBuckets(e={}){var t=this;try{return{data:await fs(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}async deleteBucket(e){var t=this;try{return{data:await fs(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ps(i))return{data:null,error:i};throw i}}},J4=class extends Y4{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Q4(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,i=this;return t().call(i,e)}async getBucket(e){var t=()=>super.getBucket,i=this;return t().call(i,e)}async listBuckets(e={}){var t=()=>super.listBuckets,i=this;return t().call(i,e)}async deleteBucket(e){var t=()=>super.deleteBucket,i=this;return t().call(i,e)}},Q4=class extends K4{constructor(e,t,i,o){super(e,t,o),this.vectorBucketName=i}async createIndex(e){var t=()=>super.createIndex,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,i=this;return t().call(i,i.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,i=this;return t().call(i,i.vectorBucketName,e)}index(e){return new eV(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},eV=class extends X4{constructor(e,t,i,o,h){super(e,t,h),this.vectorBucketName=i,this.indexName=o}async putVectors(e){var t=()=>super.putVectors,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async getVectors(e){var t=()=>super.getVectors,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,i=this;return t().call(i,Lt(Lt({},e),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}},tV=class extends U4{constructor(e,t={},i,o){super(e,t,i,o)}from(e){return new V4(this.url,this.headers,e,this.fetch)}get vectors(){return new J4(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $4(this.url+"/iceberg",this.headers,this.fetch)}};const EM="2.90.1",fh=30*1e3,Eb=3,Z0=Eb*fh,nV="http://localhost:9999",rV="supabase.auth.token",iV={"X-Client-Info":`gotrue-js/${EM}`},Pb="X-Supabase-Api-Version",PM={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sV=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,aV=10*60*1e3;class If extends Error{constructor(t,i,o){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=o}}function Tt(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class oV extends If{constructor(t,i,o){super(t,i,o),this.name="AuthApiError",this.status=i,this.code=o}}function lV(e){return Tt(e)&&e.name==="AuthApiError"}class Mc extends If{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class mo extends If{constructor(t,i,o,h){super(t,o,h),this.name=i,this.status=o}}class hs extends mo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function cV(e){return Tt(e)&&e.name==="AuthSessionMissingError"}class oh extends mo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qg extends mo{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Wg extends mo{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function uV(e){return Tt(e)&&e.name==="AuthImplicitGrantRedirectError"}class EP extends mo{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hV extends mo{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Cb extends mo{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function H0(e){return Tt(e)&&e.name==="AuthRetryableFetchError"}class PP extends mo{constructor(t,i,o){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=o}}class kb extends mo{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ky="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),CP=` 	
\r=`.split(""),dV=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<CP.length;t+=1)e[CP[t].charCodeAt(0)]=-2;for(let t=0;t<Ky.length;t+=1)e[Ky[t].charCodeAt(0)]=t;return e})();function kP(e,t,i){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const o=t.queue>>t.queuedBits-6&63;i(Ky[o]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const o=t.queue>>t.queuedBits-6&63;i(Ky[o]),t.queuedBits-=6}}function CM(e,t,i){const o=dV[e];if(o>-1)for(t.queue=t.queue<<6|o,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(o===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function AP(e){const t=[],i=f=>{t.push(String.fromCodePoint(f))},o={utf8seq:0,codepoint:0},h={queue:0,queuedBits:0},m=f=>{mV(f,o,i)};for(let f=0;f<e.length;f+=1)CM(e.charCodeAt(f),h,m);return t.join("")}function pV(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function fV(e,t){for(let i=0;i<e.length;i+=1){let o=e.charCodeAt(i);if(o>55295&&o<=56319){const h=(o-55296)*1024&65535;o=(e.charCodeAt(i+1)-56320&65535|h)+65536,i+=1}pV(o,t)}}function mV(e,t,i){if(t.utf8seq===0){if(e<=127){i(e);return}for(let o=1;o<6;o+=1)if(!(e>>7-o&1)){t.utf8seq=o;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function Bh(e){const t=[],i={queue:0,queuedBits:0},o=h=>{t.push(h)};for(let h=0;h<e.length;h+=1)CM(e.charCodeAt(h),i,o);return new Uint8Array(t)}function gV(e){const t=[];return fV(e,i=>t.push(i)),new Uint8Array(t)}function Lc(e){const t=[],i={queue:0,queuedBits:0},o=h=>{t.push(h)};return e.forEach(h=>kP(h,i,o)),kP(null,i,o),t.join("")}function yV(e){return Math.round(Date.now()/1e3)+e}function _V(){return Symbol("auth-callback")}const ui=()=>typeof window<"u"&&typeof document<"u",wc={tested:!1,writable:!1},kM=()=>{if(!ui())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(wc.tested)return wc.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),wc.tested=!0,wc.writable=!0}catch{wc.tested=!0,wc.writable=!1}return wc.writable};function vV(e){const t={},i=new URL(e);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((h,m)=>{t[m]=h})}catch{}return i.searchParams.forEach((o,h)=>{t[h]=o}),t}const AM=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),xV=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",mh=async(e,t,i)=>{await e.setItem(t,JSON.stringify(i))},Sc=async(e,t)=>{const i=await e.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},ci=async(e,t)=>{await e.removeItem(t)};class C_{constructor(){this.promise=new C_.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}C_.promiseConstructor=Promise;function K0(e){const t=e.split(".");if(t.length!==3)throw new kb("Invalid JWT structure");for(let o=0;o<t.length;o++)if(!sV.test(t[o]))throw new kb("JWT not in base64url format");return{header:JSON.parse(AP(t[0])),payload:JSON.parse(AP(t[1])),signature:Bh(t[2]),raw:{header:t[0],payload:t[1]}}}async function bV(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function wV(e,t){return new Promise((o,h)=>{(async()=>{for(let m=0;m<1/0;m++)try{const f=await e(m);if(!t(m,null,f)){o(f);return}}catch(f){if(!t(m,f)){h(f);return}}})()})}function SV(e){return("0"+e.toString(16)).substr(-2)}function TV(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",o=i.length;let h="";for(let m=0;m<56;m++)h+=i.charAt(Math.floor(Math.random()*o));return h}return crypto.getRandomValues(t),Array.from(t,SV).join("")}async function EV(e){const i=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",i),h=new Uint8Array(o);return Array.from(h).map(m=>String.fromCharCode(m)).join("")}async function PV(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const i=await EV(e);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function lh(e,t,i=!1){const o=TV();let h=o;i&&(h+="/PASSWORD_RECOVERY"),await mh(e,`${t}-code-verifier`,h);const m=await PV(o);return[m,o===m?"plain":"s256"]}const CV=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function kV(e){const t=e.headers.get(Pb);if(!t||!t.match(CV))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function AV(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function IV(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const MV=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ch(e){if(!MV.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function X0(){const e={};return new Proxy(e,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const o=i.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function RV(e,t){return new Proxy(e,{get:(i,o,h)=>{if(o==="__isInsecureUserWarningProxy")return!0;if(typeof o=="symbol"){const m=o.toString();if(m==="Symbol(Symbol.toPrimitive)"||m==="Symbol(Symbol.toStringTag)"||m==="Symbol(util.inspect.custom)"||m==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,o,h)}return!t.value&&typeof o=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,o,h)}})}function IP(e){return JSON.parse(JSON.stringify(e))}const Ac=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),DV=[502,503,504];async function MP(e){var t;if(!xV(e))throw new Cb(Ac(e),0);if(DV.includes(e.status))throw new Cb(Ac(e),e.status);let i;try{i=await e.json()}catch(m){throw new Mc(Ac(m),m)}let o;const h=kV(e);if(h&&h.getTime()>=PM["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?o=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(o=i.error_code),o){if(o==="weak_password")throw new PP(Ac(i),e.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(o==="session_not_found")throw new hs}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((m,f)=>m&&typeof f=="string",!0))throw new PP(Ac(i),e.status,i.weak_password.reasons);throw new oV(Ac(i),e.status||500,o)}const jV=(e,t,i,o)=>{const h={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?h:(h.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),h.body=JSON.stringify(o),Object.assign(Object.assign({},h),i))};async function jt(e,t,i,o){var h;const m=Object.assign({},o==null?void 0:o.headers);m[Pb]||(m[Pb]=PM["2024-01-01"].name),o!=null&&o.jwt&&(m.Authorization=`Bearer ${o.jwt}`);const f=(h=o==null?void 0:o.query)!==null&&h!==void 0?h:{};o!=null&&o.redirectTo&&(f.redirect_to=o.redirectTo);const c=Object.keys(f).length?"?"+new URLSearchParams(f).toString():"",E=await NV(e,t,i+c,{headers:m,noResolveJson:o==null?void 0:o.noResolveJson},{},o==null?void 0:o.body);return o!=null&&o.xform?o==null?void 0:o.xform(E):{data:Object.assign({},E),error:null}}async function NV(e,t,i,o,h,m){const f=jV(t,o,h,m);let c;try{c=await e(i,Object.assign({},f))}catch(E){throw console.error(E),new Cb(Ac(E),0)}if(c.ok||await MP(c),o!=null&&o.noResolveJson)return c;try{return await c.json()}catch(E){await MP(E)}}function Hs(e){var t;let i=null;OV(e)&&(i=Object.assign({},e),e.expires_at||(i.expires_at=yV(e.expires_in)));const o=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:i,user:o},error:null}}function RP(e){const t=Hs(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0)&&(t.data.weak_password=e.weak_password),t}function nl(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function LV(e){return{data:e,error:null}}function zV(e){const{action_link:t,email_otp:i,hashed_token:o,redirect_to:h,verification_type:m}=e,f=E_(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:t,email_otp:i,hashed_token:o,redirect_to:h,verification_type:m},E=Object.assign({},f);return{data:{properties:c,user:E},error:null}}function DP(e){return e}function OV(e){return e.access_token&&e.refresh_token&&e.expires_in}const Y0=["global","local","others"];class FV{constructor({url:t="",headers:i={},fetch:o}){this.url=t,this.headers=i,this.fetch=AM(o),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=Y0[0]){if(Y0.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Y0.join(", ")}`);try{return await jt(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(o){if(Tt(o))return{data:null,error:o};throw o}}async inviteUserByEmail(t,i={}){try{return await jt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:nl})}catch(o){if(Tt(o))return{data:{user:null},error:o};throw o}}async generateLink(t){try{const{options:i}=t,o=E_(t,["options"]),h=Object.assign(Object.assign({},o),i);return"newEmail"in o&&(h.new_email=o==null?void 0:o.newEmail,delete h.newEmail),await jt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:h,headers:this.headers,xform:zV,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(Tt(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await jt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:nl})}catch(i){if(Tt(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,o,h,m,f,c,E;try{const C={nextPage:null,lastPage:0,total:0},R=await jt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(o=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:"",per_page:(m=(h=t==null?void 0:t.perPage)===null||h===void 0?void 0:h.toString())!==null&&m!==void 0?m:""},xform:DP});if(R.error)throw R.error;const L=await R.json(),B=(f=R.headers.get("x-total-count"))!==null&&f!==void 0?f:0,X=(E=(c=R.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&E!==void 0?E:[];return X.length>0&&(X.forEach(W=>{const te=parseInt(W.split(";")[0].split("=")[1].substring(0,1)),G=JSON.parse(W.split(";")[1].split("=")[1]);C[`${G}Page`]=te}),C.total=parseInt(B)),{data:Object.assign(Object.assign({},L),C),error:null}}catch(C){if(Tt(C))return{data:{users:[]},error:C};throw C}}async getUserById(t){ch(t);try{return await jt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:nl})}catch(i){if(Tt(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){ch(t);try{return await jt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:nl})}catch(o){if(Tt(o))return{data:{user:null},error:o};throw o}}async deleteUser(t,i=!1){ch(t);try{return await jt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:nl})}catch(o){if(Tt(o))return{data:{user:null},error:o};throw o}}async _listFactors(t){ch(t.userId);try{const{data:i,error:o}=await jt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:h=>({data:{factors:h},error:null})});return{data:i,error:o}}catch(i){if(Tt(i))return{data:null,error:i};throw i}}async _deleteFactor(t){ch(t.userId),ch(t.id);try{return{data:await jt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(Tt(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,o,h,m,f,c,E;try{const C={nextPage:null,lastPage:0,total:0},R=await jt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(o=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:"",per_page:(m=(h=t==null?void 0:t.perPage)===null||h===void 0?void 0:h.toString())!==null&&m!==void 0?m:""},xform:DP});if(R.error)throw R.error;const L=await R.json(),B=(f=R.headers.get("x-total-count"))!==null&&f!==void 0?f:0,X=(E=(c=R.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&E!==void 0?E:[];return X.length>0&&(X.forEach(W=>{const te=parseInt(W.split(";")[0].split("=")[1].substring(0,1)),G=JSON.parse(W.split(";")[1].split("=")[1]);C[`${G}Page`]=te}),C.total=parseInt(B)),{data:Object.assign(Object.assign({},L),C),error:null}}catch(C){if(Tt(C))return{data:{clients:[]},error:C};throw C}}async _createOAuthClient(t){try{return await jt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Tt(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await jt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Tt(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await jt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Tt(o))return{data:null,error:o};throw o}}async _deleteOAuthClient(t){try{return await jt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(Tt(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await jt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Tt(i))return{data:null,error:i};throw i}}}function jP(e={}){return{getItem:t=>e[t]||null,setItem:(t,i)=>{e[t]=i},removeItem:t=>{delete e[t]}}}const uh={debug:!!(globalThis&&kM()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class IM extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class BV extends IM{}async function VV(e,t,i){uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const o=new globalThis.AbortController;return t>0&&setTimeout(()=>{o.abort(),uh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:o.signal},async h=>{if(h){uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,h.name);try{return await i()}finally{uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,h.name)}}else{if(t===0)throw uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new BV(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(uh.debug)try{const m=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(m,null,"  "))}catch(m){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",m)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function UV(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function MM(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function $V(e){return parseInt(e,16)}function GV(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,o=>o.toString(16).padStart(2,"0")).join("")}function qV(e){var t;const{chainId:i,domain:o,expirationTime:h,issuedAt:m=new Date,nonce:f,notBefore:c,requestId:E,resources:C,scheme:R,uri:L,version:B}=e;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!o)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(f&&f.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${f}`);if(!L)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(B!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${B}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const X=MM(e.address),W=R?`${R}://${o}`:o,te=e.statement?`${e.statement}
`:"",G=`${W} wants you to sign in with your Ethereum account:
${X}

${te}`;let J=`URI: ${L}
Version: ${B}
Chain ID: ${i}${f?`
Nonce: ${f}`:""}
Issued At: ${m.toISOString()}`;if(h&&(J+=`
Expiration Time: ${h.toISOString()}`),c&&(J+=`
Not Before: ${c.toISOString()}`),E&&(J+=`
Request ID: ${E}`),C){let H=`
Resources:`;for(const Q of C){if(!Q||typeof Q!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Q}`);H+=`
- ${Q}`}J+=H}return`${G}
${J}`}class Dr extends Error{constructor({message:t,code:i,cause:o,name:h}){var m;super(t,{cause:o}),this.__isWebAuthnError=!0,this.name=(m=h??(o instanceof Error?o.name:void 0))!==null&&m!==void 0?m:"Unknown Error",this.code=i}}class Xy extends Dr{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function WV({error:e,options:t}){var i,o,h;const{publicKey:m}=t;if(!m)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Dr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((i=m.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new Dr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((o=m.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Dr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((h=m.authenticatorSelection)===null||h===void 0?void 0:h.userVerification)==="required")return new Dr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Dr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Dr({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return m.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new Dr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Dr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const f=window.location.hostname;if(RM(f)){if(m.rp.id!==f)return new Dr({message:`The RP ID "${m.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Dr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(m.user.id.byteLength<1||m.user.id.byteLength>64)return new Dr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Dr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Dr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function ZV({error:e,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Dr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Dr({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const o=window.location.hostname;if(RM(o)){if(i.rpId!==o)return new Dr({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Dr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Dr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Dr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class HV{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const KV=new HV;function XV(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:i,excludeCredentials:o}=e,h=E_(e,["challenge","user","excludeCredentials"]),m=Bh(t).buffer,f=Object.assign(Object.assign({},i),{id:Bh(i.id).buffer}),c=Object.assign(Object.assign({},h),{challenge:m,user:f});if(o&&o.length>0){c.excludeCredentials=new Array(o.length);for(let E=0;E<o.length;E++){const C=o[E];c.excludeCredentials[E]=Object.assign(Object.assign({},C),{id:Bh(C.id).buffer,type:C.type||"public-key",transports:C.transports})}}return c}function YV(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:i}=e,o=E_(e,["challenge","allowCredentials"]),h=Bh(t).buffer,m=Object.assign(Object.assign({},o),{challenge:h});if(i&&i.length>0){m.allowCredentials=new Array(i.length);for(let f=0;f<i.length;f++){const c=i[f];m.allowCredentials[f]=Object.assign(Object.assign({},c),{id:Bh(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return m}function JV(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const i=e;return{id:e.id,rawId:e.id,response:{attestationObject:Lc(new Uint8Array(e.response.attestationObject)),clientDataJSON:Lc(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function QV(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const i=e,o=e.getClientExtensionResults(),h=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Lc(new Uint8Array(h.authenticatorData)),clientDataJSON:Lc(new Uint8Array(h.clientDataJSON)),signature:Lc(new Uint8Array(h.signature)),userHandle:h.userHandle?Lc(new Uint8Array(h.userHandle)):void 0},type:"public-key",clientExtensionResults:o,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function RM(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function NP(){var e,t;return!!(ui()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function e6(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Xy("Browser returned unexpected credential type",t)}:{data:null,error:new Xy("Empty credential response",t)}}catch(t){return{data:null,error:WV({error:t,options:e})}}}async function t6(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Xy("Browser returned unexpected credential type",t)}:{data:null,error:new Xy("Empty credential response",t)}}catch(t){return{data:null,error:ZV({error:t,options:e})}}}const n6={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},r6={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Yy(...e){const t=h=>h!==null&&typeof h=="object"&&!Array.isArray(h),i=h=>h instanceof ArrayBuffer||ArrayBuffer.isView(h),o={};for(const h of e)if(h)for(const m in h){const f=h[m];if(f!==void 0)if(Array.isArray(f))o[m]=f;else if(i(f))o[m]=f;else if(t(f)){const c=o[m];t(c)?o[m]=Yy(c,f):o[m]=Yy(f)}else o[m]=f}return o}function i6(e,t){return Yy(n6,e,t||{})}function s6(e,t){return Yy(r6,e,t||{})}class a6{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:o,signal:h},m){try{const{data:f,error:c}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!f)return{data:null,error:c};const E=h??KV.createNewAbortSignal();if(f.webauthn.type==="create"){const{user:C}=f.webauthn.credential_options.publicKey;C.name||(C.name=`${C.id}:${o}`),C.displayName||(C.displayName=C.name)}switch(f.webauthn.type){case"create":{const C=i6(f.webauthn.credential_options.publicKey,m==null?void 0:m.create),{data:R,error:L}=await e6({publicKey:C,signal:E});return R?{data:{factorId:t,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:R}},error:null}:{data:null,error:L}}case"request":{const C=s6(f.webauthn.credential_options.publicKey,m==null?void 0:m.request),{data:R,error:L}=await t6(Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:C,signal:E}));return R?{data:{factorId:t,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:R}},error:null}:{data:null,error:L}}}}catch(f){return Tt(f)?{data:null,error:f}:{data:null,error:new Mc("Unexpected error in challenge",f)}}}async _verify({challengeId:t,factorId:i,webauthn:o}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:o})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:o=typeof window<"u"?[window.location.origin]:void 0,signal:h}={}},m){if(!i)return{data:null,error:new If("rpId is required for WebAuthn authentication")};try{if(!NP())return{data:null,error:new Mc("Browser does not support WebAuthn",null)};const{data:f,error:c}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:o},signal:h},{request:m});if(!f)return{data:null,error:c};const{webauthn:E}=f;return this._verify({factorId:t,challengeId:f.challengeId,webauthn:{type:E.type,rpId:i,rpOrigins:o,credential_response:E.credential_response}})}catch(f){return Tt(f)?{data:null,error:f}:{data:null,error:new Mc("Unexpected error in authenticate",f)}}}async _register({friendlyName:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:o=typeof window<"u"?[window.location.origin]:void 0,signal:h}={}},m){if(!i)return{data:null,error:new If("rpId is required for WebAuthn registration")};try{if(!NP())return{data:null,error:new Mc("Browser does not support WebAuthn",null)};const{data:f,error:c}=await this._enroll({friendlyName:t});if(!f)return await this.client.mfa.listFactors().then(R=>{var L;return(L=R.data)===null||L===void 0?void 0:L.all.find(B=>B.factor_type==="webauthn"&&B.friendly_name===t&&B.status!=="unverified")}).then(R=>R?this.client.mfa.unenroll({factorId:R==null?void 0:R.id}):void 0),{data:null,error:c};const{data:E,error:C}=await this._challenge({factorId:f.id,friendlyName:f.friendly_name,webauthn:{rpId:i,rpOrigins:o},signal:h},{create:m});return E?this._verify({factorId:f.id,challengeId:E.challengeId,webauthn:{rpId:i,rpOrigins:o,type:E.webauthn.type,credential_response:E.webauthn.credential_response}}):{data:null,error:C}}catch(f){return Tt(f)?{data:null,error:f}:{data:null,error:new Mc("Unexpected error in register",f)}}}}UV();const o6={url:nV,storageKey:rV,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:iV,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function LP(e,t,i){return await i()}const hh={};class Mf{get jwks(){var t,i;return(i=(t=hh[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){hh[this.storageKey]=Object.assign(Object.assign({},hh[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=hh[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){hh[this.storageKey]=Object.assign(Object.assign({},hh[this.storageKey]),{cachedAt:t})}constructor(t){var i,o,h;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const m=Object.assign(Object.assign({},o6),t);if(this.storageKey=m.storageKey,this.instanceID=(i=Mf.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,Mf.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!m.debug,typeof m.debug=="function"&&(this.logger=m.debug),this.instanceID>0&&ui()){const f=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(f),this.logDebugMessages&&console.trace(f)}if(this.persistSession=m.persistSession,this.autoRefreshToken=m.autoRefreshToken,this.admin=new FV({url:m.url,headers:m.headers,fetch:m.fetch}),this.url=m.url,this.headers=m.headers,this.fetch=AM(m.fetch),this.lock=m.lock||LP,this.detectSessionInUrl=m.detectSessionInUrl,this.flowType=m.flowType,this.hasCustomAuthorizationHeader=m.hasCustomAuthorizationHeader,this.throwOnError=m.throwOnError,this.lockAcquireTimeout=m.lockAcquireTimeout,m.lock?this.lock=m.lock:this.persistSession&&ui()&&(!((o=globalThis==null?void 0:globalThis.navigator)===null||o===void 0)&&o.locks)?this.lock=VV:this.lock=LP,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new a6(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(m.storage?this.storage=m.storage:kM()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=jP(this.memoryStorage)),m.userStorage&&(this.userStorage=m.userStorage)):(this.memoryStorage={},this.storage=jP(this.memoryStorage)),ui()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(f){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",f)}(h=this.broadcastChannel)===null||h===void 0||h.addEventListener("message",async f=>{this._debug("received broadcast notification from other tab or client",f),await this._notifyAllSubscribers(f.data.event,f.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${EM}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},o="none";if(ui()&&(i=vV(window.location.href),this._isImplicitGrantCallback(i)?o="implicit":await this._isPKCECallback(i)&&(o="pkce")),ui()&&this.detectSessionInUrl&&o!=="none"){const{data:h,error:m}=await this._getSessionFromURL(i,o);if(m){if(this._debug("#_initialize()","error detecting session from URL",m),uV(m)){const E=(t=m.details)===null||t===void 0?void 0:t.code;if(E==="identity_already_exists"||E==="identity_not_found"||E==="single_identity_not_deletable")return{error:m}}return{error:m}}const{session:f,redirectType:c}=h;return this._debug("#_initialize()","detected session in URL",f,"redirect type",c),await this._saveSession(f),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",f):await this._notifyAllSubscribers("SIGNED_IN",f)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return Tt(i)?this._returnResult({error:i}):this._returnResult({error:new Mc("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,o,h;try{const m=await jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(h=t==null?void 0:t.options)===null||h===void 0?void 0:h.captchaToken}},xform:Hs}),{data:f,error:c}=m;if(c||!f)return this._returnResult({data:{user:null,session:null},error:c});const E=f.session,C=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",E)),this._returnResult({data:{user:C,session:E},error:null})}catch(m){if(Tt(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signUp(t){var i,o,h;try{let m;if("email"in t){const{email:R,password:L,options:B}=t;let X=null,W=null;this.flowType==="pkce"&&([X,W]=await lh(this.storage,this.storageKey)),m=await jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:B==null?void 0:B.emailRedirectTo,body:{email:R,password:L,data:(i=B==null?void 0:B.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:B==null?void 0:B.captchaToken},code_challenge:X,code_challenge_method:W},xform:Hs})}else if("phone"in t){const{phone:R,password:L,options:B}=t;m=await jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:R,password:L,data:(o=B==null?void 0:B.data)!==null&&o!==void 0?o:{},channel:(h=B==null?void 0:B.channel)!==null&&h!==void 0?h:"sms",gotrue_meta_security:{captcha_token:B==null?void 0:B.captchaToken}},xform:Hs})}else throw new qg("You must provide either an email or phone number and a password");const{data:f,error:c}=m;if(c||!f)return await ci(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:c});const E=f.session,C=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",E)),this._returnResult({data:{user:C,session:E},error:null})}catch(m){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signInWithPassword(t){try{let i;if("email"in t){const{email:m,password:f,options:c}=t;i=await jt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:m,password:f,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:RP})}else if("phone"in t){const{phone:m,password:f,options:c}=t;i=await jt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:m,password:f,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:RP})}else throw new qg("You must provide either an email or phone number and a password");const{data:o,error:h}=i;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!o||!o.session||!o.user){const m=new oh;return this._returnResult({data:{user:null,session:null},error:m})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:h})}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,o,h,m;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:(m=t.options)===null||m===void 0?void 0:m.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,o,h,m,f,c,E,C,R,L,B;let X,W;if("message"in t)X=t.message,W=t.signature;else{const{chain:te,wallet:G,statement:J,options:H}=t;let Q;if(ui())if(typeof G=="object")Q=G;else{const Ge=window;if("ethereum"in Ge&&typeof Ge.ethereum=="object"&&"request"in Ge.ethereum&&typeof Ge.ethereum.request=="function")Q=Ge.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof G!="object"||!(H!=null&&H.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Q=G}const le=new URL((i=H==null?void 0:H.url)!==null&&i!==void 0?i:window.location.href),ve=await Q.request({method:"eth_requestAccounts"}).then(Ge=>Ge).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!ve||ve.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Ee=MM(ve[0]);let _e=(o=H==null?void 0:H.signInWithEthereum)===null||o===void 0?void 0:o.chainId;if(!_e){const Ge=await Q.request({method:"eth_chainId"});_e=$V(Ge)}const we={domain:le.host,address:Ee,statement:J,uri:le.href,version:"1",chainId:_e,nonce:(h=H==null?void 0:H.signInWithEthereum)===null||h===void 0?void 0:h.nonce,issuedAt:(f=(m=H==null?void 0:H.signInWithEthereum)===null||m===void 0?void 0:m.issuedAt)!==null&&f!==void 0?f:new Date,expirationTime:(c=H==null?void 0:H.signInWithEthereum)===null||c===void 0?void 0:c.expirationTime,notBefore:(E=H==null?void 0:H.signInWithEthereum)===null||E===void 0?void 0:E.notBefore,requestId:(C=H==null?void 0:H.signInWithEthereum)===null||C===void 0?void 0:C.requestId,resources:(R=H==null?void 0:H.signInWithEthereum)===null||R===void 0?void 0:R.resources};X=qV(we),W=await Q.request({method:"personal_sign",params:[GV(X),Ee]})}try{const{data:te,error:G}=await jt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:X,signature:W},!((L=t.options)===null||L===void 0)&&L.captchaToken?{gotrue_meta_security:{captcha_token:(B=t.options)===null||B===void 0?void 0:B.captchaToken}}:null),xform:Hs});if(G)throw G;if(!te||!te.session||!te.user){const J=new oh;return this._returnResult({data:{user:null,session:null},error:J})}return te.session&&(await this._saveSession(te.session),await this._notifyAllSubscribers("SIGNED_IN",te.session)),this._returnResult({data:Object.assign({},te),error:G})}catch(te){if(Tt(te))return this._returnResult({data:{user:null,session:null},error:te});throw te}}async signInWithSolana(t){var i,o,h,m,f,c,E,C,R,L,B,X;let W,te;if("message"in t)W=t.message,te=t.signature;else{const{chain:G,wallet:J,statement:H,options:Q}=t;let le;if(ui())if(typeof J=="object")le=J;else{const Ee=window;if("solana"in Ee&&typeof Ee.solana=="object"&&("signIn"in Ee.solana&&typeof Ee.solana.signIn=="function"||"signMessage"in Ee.solana&&typeof Ee.solana.signMessage=="function"))le=Ee.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof J!="object"||!(Q!=null&&Q.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");le=J}const ve=new URL((i=Q==null?void 0:Q.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in le&&le.signIn){const Ee=await le.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Q==null?void 0:Q.signInWithSolana),{version:"1",domain:ve.host,uri:ve.href}),H?{statement:H}:null));let _e;if(Array.isArray(Ee)&&Ee[0]&&typeof Ee[0]=="object")_e=Ee[0];else if(Ee&&typeof Ee=="object"&&"signedMessage"in Ee&&"signature"in Ee)_e=Ee;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in _e&&"signature"in _e&&(typeof _e.signedMessage=="string"||_e.signedMessage instanceof Uint8Array)&&_e.signature instanceof Uint8Array)W=typeof _e.signedMessage=="string"?_e.signedMessage:new TextDecoder().decode(_e.signedMessage),te=_e.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in le)||typeof le.signMessage!="function"||!("publicKey"in le)||typeof le!="object"||!le.publicKey||!("toBase58"in le.publicKey)||typeof le.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");W=[`${ve.host} wants you to sign in with your Solana account:`,le.publicKey.toBase58(),...H?["",H,""]:[""],"Version: 1",`URI: ${ve.href}`,`Issued At: ${(h=(o=Q==null?void 0:Q.signInWithSolana)===null||o===void 0?void 0:o.issuedAt)!==null&&h!==void 0?h:new Date().toISOString()}`,...!((m=Q==null?void 0:Q.signInWithSolana)===null||m===void 0)&&m.notBefore?[`Not Before: ${Q.signInWithSolana.notBefore}`]:[],...!((f=Q==null?void 0:Q.signInWithSolana)===null||f===void 0)&&f.expirationTime?[`Expiration Time: ${Q.signInWithSolana.expirationTime}`]:[],...!((c=Q==null?void 0:Q.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${Q.signInWithSolana.chainId}`]:[],...!((E=Q==null?void 0:Q.signInWithSolana)===null||E===void 0)&&E.nonce?[`Nonce: ${Q.signInWithSolana.nonce}`]:[],...!((C=Q==null?void 0:Q.signInWithSolana)===null||C===void 0)&&C.requestId?[`Request ID: ${Q.signInWithSolana.requestId}`]:[],...!((L=(R=Q==null?void 0:Q.signInWithSolana)===null||R===void 0?void 0:R.resources)===null||L===void 0)&&L.length?["Resources",...Q.signInWithSolana.resources.map(_e=>`- ${_e}`)]:[]].join(`
`);const Ee=await le.signMessage(new TextEncoder().encode(W),"utf8");if(!Ee||!(Ee instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");te=Ee}}try{const{data:G,error:J}=await jt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:W,signature:Lc(te)},!((B=t.options)===null||B===void 0)&&B.captchaToken?{gotrue_meta_security:{captcha_token:(X=t.options)===null||X===void 0?void 0:X.captchaToken}}:null),xform:Hs});if(J)throw J;if(!G||!G.session||!G.user){const H=new oh;return this._returnResult({data:{user:null,session:null},error:H})}return G.session&&(await this._saveSession(G.session),await this._notifyAllSubscribers("SIGNED_IN",G.session)),this._returnResult({data:Object.assign({},G),error:J})}catch(G){if(Tt(G))return this._returnResult({data:{user:null,session:null},error:G});throw G}}async _exchangeCodeForSession(t){const i=await Sc(this.storage,`${this.storageKey}-code-verifier`),[o,h]=(i??"").split("/");try{if(!o&&this.flowType==="pkce")throw new hV;const{data:m,error:f}=await jt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:o},xform:Hs});if(await ci(this.storage,`${this.storageKey}-code-verifier`),f)throw f;if(!m||!m.session||!m.user){const c=new oh;return this._returnResult({data:{user:null,session:null,redirectType:null},error:c})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign(Object.assign({},m),{redirectType:h??null}),error:f})}catch(m){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(m))return this._returnResult({data:{user:null,session:null,redirectType:null},error:m});throw m}}async signInWithIdToken(t){try{const{options:i,provider:o,token:h,access_token:m,nonce:f}=t,c=await jt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:h,access_token:m,nonce:f,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Hs}),{data:E,error:C}=c;if(C)return this._returnResult({data:{user:null,session:null},error:C});if(!E||!E.session||!E.user){const R=new oh;return this._returnResult({data:{user:null,session:null},error:R})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:E,error:C})}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,o,h,m,f;try{if("email"in t){const{email:c,options:E}=t;let C=null,R=null;this.flowType==="pkce"&&([C,R]=await lh(this.storage,this.storageKey));const{error:L}=await jt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(i=E==null?void 0:E.data)!==null&&i!==void 0?i:{},create_user:(o=E==null?void 0:E.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken},code_challenge:C,code_challenge_method:R},redirectTo:E==null?void 0:E.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:L})}if("phone"in t){const{phone:c,options:E}=t,{data:C,error:R}=await jt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(h=E==null?void 0:E.data)!==null&&h!==void 0?h:{},create_user:(m=E==null?void 0:E.shouldCreateUser)!==null&&m!==void 0?m:!0,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken},channel:(f=E==null?void 0:E.channel)!==null&&f!==void 0?f:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:C==null?void 0:C.message_id},error:R})}throw new qg("You must provide either an email or phone number.")}catch(c){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async verifyOtp(t){var i,o;try{let h,m;"options"in t&&(h=(i=t.options)===null||i===void 0?void 0:i.redirectTo,m=(o=t.options)===null||o===void 0?void 0:o.captchaToken);const{data:f,error:c}=await jt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:m}}),redirectTo:h,xform:Hs});if(c)throw c;if(!f)throw new Error("An error occurred on token verification.");const E=f.session,C=f.user;return E!=null&&E.access_token&&(await this._saveSession(E),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",E)),this._returnResult({data:{user:C,session:E},error:null})}catch(h){if(Tt(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async signInWithSSO(t){var i,o,h,m,f;try{let c=null,E=null;this.flowType==="pkce"&&([c,E]=await lh(this.storage,this.storageKey));const C=await jt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(o=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&o!==void 0?o:void 0}),!((h=t==null?void 0:t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:c,code_challenge_method:E}),headers:this.headers,xform:LV});return!((m=C.data)===null||m===void 0)&&m.url&&ui()&&!(!((f=t.options)===null||f===void 0)&&f.skipBrowserRedirect)&&window.location.assign(C.data.url),this._returnResult(C)}catch(c){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(c))return this._returnResult({data:null,error:c});throw c}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:o}=t;if(o)throw o;if(!i)throw new hs;const{error:h}=await jt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:h})})}catch(t){if(Tt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:o,type:h,options:m}=t,{error:f}=await jt(this.fetch,"POST",i,{headers:this.headers,body:{email:o,type:h,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},redirectTo:m==null?void 0:m.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}else if("phone"in t){const{phone:o,type:h,options:m}=t,{data:f,error:c}=await jt(this.fetch,"POST",i,{headers:this.headers,body:{phone:o,type:h,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:f==null?void 0:f.message_id},error:c})}throw new qg("You must provide either an email or phone number and a type")}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),h=(async()=>(await o,await i()))();return this.pendingInLock.push((async()=>{try{await h}catch{}})()),h}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const o=i();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){const h=[...this.pendingInLock];await Promise.all(h),this.pendingInLock.splice(0,h.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await Sc(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const o=t.expires_at?t.expires_at*1e3-Date.now()<Z0:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",t.expires_at),!o){if(this.userStorage){const f=await Sc(this.userStorage,this.storageKey+"-user");f!=null&&f.user?t.user=f.user:t.user=X0()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const f={value:this.suppressGetSessionWarning};t.user=RV(t.user,f),f.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:h,error:m}=await this._callRefreshToken(t.refresh_token);return m?this._returnResult({data:{session:null},error:m}):this._returnResult({data:{session:h},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const i=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return i.data.user&&(this.suppressGetSessionWarning=!0),i}async _getUser(t){try{return t?await jt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:nl}):await this._useSession(async i=>{var o,h,m;const{data:f,error:c}=i;if(c)throw c;return!(!((o=f.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new hs}:await jt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(m=(h=f.session)===null||h===void 0?void 0:h.access_token)!==null&&m!==void 0?m:void 0,xform:nl})})}catch(i){if(Tt(i))return cV(i)&&(await this._removeSession(),await ci(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async o=>{const{data:h,error:m}=o;if(m)throw m;if(!h.session)throw new hs;const f=h.session;let c=null,E=null;this.flowType==="pkce"&&t.email!=null&&([c,E]=await lh(this.storage,this.storageKey));const{data:C,error:R}=await jt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:c,code_challenge_method:E}),jwt:f.access_token,xform:nl});if(R)throw R;return f.user=C.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),this._returnResult({data:{user:f.user},error:null})})}catch(o){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(o))return this._returnResult({data:{user:null},error:o});throw o}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new hs;const i=Date.now()/1e3;let o=i,h=!0,m=null;const{payload:f}=K0(t.access_token);if(f.exp&&(o=f.exp,h=o<=i),h){const{data:c,error:E}=await this._callRefreshToken(t.refresh_token);if(E)return this._returnResult({data:{user:null,session:null},error:E});if(!c)return{data:{user:null,session:null},error:null};m=c}else{const{data:c,error:E}=await this._getUser(t.access_token);if(E)throw E;m={access_token:t.access_token,refresh_token:t.refresh_token,user:c.user,token_type:"bearer",expires_in:o-i,expires_at:o},await this._saveSession(m),await this._notifyAllSubscribers("SIGNED_IN",m)}return this._returnResult({data:{user:m.user,session:m},error:null})}catch(i){if(Tt(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var o;if(!t){const{data:f,error:c}=i;if(c)throw c;t=(o=f.session)!==null&&o!==void 0?o:void 0}if(!(t!=null&&t.refresh_token))throw new hs;const{data:h,error:m}=await this._callRefreshToken(t.refresh_token);return m?this._returnResult({data:{user:null,session:null},error:m}):h?this._returnResult({data:{user:h.user,session:h},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!ui())throw new Wg("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Wg(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new EP("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wg("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new EP("No code detected.");const{data:H,error:Q}=await this._exchangeCodeForSession(t.code);if(Q)throw Q;const le=new URL(window.location.href);return le.searchParams.delete("code"),window.history.replaceState(window.history.state,"",le.toString()),{data:{session:H.session,redirectType:null},error:null}}const{provider_token:o,provider_refresh_token:h,access_token:m,refresh_token:f,expires_in:c,expires_at:E,token_type:C}=t;if(!m||!c||!f||!C)throw new Wg("No session defined in URL");const R=Math.round(Date.now()/1e3),L=parseInt(c);let B=R+L;E&&(B=parseInt(E));const X=B-R;X*1e3<=fh&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${X}s, should have been closer to ${L}s`);const W=B-L;R-W>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",W,B,R):R-W<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",W,B,R);const{data:te,error:G}=await this._getUser(m);if(G)throw G;const J={provider_token:o,provider_refresh_token:h,access_token:m,expires_in:L,expires_at:B,refresh_token:f,token_type:C,user:te.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:J,redirectType:t.type},error:null})}catch(o){if(Tt(o))return this._returnResult({data:{session:null,redirectType:null},error:o});throw o}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await Sc(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var o;const{data:h,error:m}=i;if(m)return this._returnResult({error:m});const f=(o=h.session)===null||o===void 0?void 0:o.access_token;if(f){const{error:c}=await this.admin.signOut(f,t);if(c&&!(lV(c)&&(c.status===404||c.status===401||c.status===403)))return this._returnResult({error:c})}return t!=="others"&&(await this._removeSession(),await ci(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=_V(),o={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,o),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:o}}}async _emitInitialSession(t){return await this._useSession(async i=>{var o,h;try{const{data:{session:m},error:f}=i;if(f)throw f;await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",m)),this._debug("INITIAL_SESSION","callback id",t,"session",m)}catch(m){await((h=this.stateChangeEmitters.get(t))===null||h===void 0?void 0:h.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",m),console.error(m)}})}async resetPasswordForEmail(t,i={}){let o=null,h=null;this.flowType==="pkce"&&([o,h]=await lh(this.storage,this.storageKey,!0));try{return await jt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:o,code_challenge_method:h,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(m){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(m))return this._returnResult({data:null,error:m});throw m}}async getUserIdentities(){var t;try{const{data:i,error:o}=await this.getUser();if(o)throw o;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:o,error:h}=await this._useSession(async m=>{var f,c,E,C,R;const{data:L,error:B}=m;if(B)throw B;const X=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(f=t.options)===null||f===void 0?void 0:f.redirectTo,scopes:(c=t.options)===null||c===void 0?void 0:c.scopes,queryParams:(E=t.options)===null||E===void 0?void 0:E.queryParams,skipBrowserRedirect:!0});return await jt(this.fetch,"GET",X,{headers:this.headers,jwt:(R=(C=L.session)===null||C===void 0?void 0:C.access_token)!==null&&R!==void 0?R:void 0})});if(h)throw h;return ui()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(o==null?void 0:o.url),this._returnResult({data:{provider:t.provider,url:o==null?void 0:o.url},error:null})}catch(o){if(Tt(o))return this._returnResult({data:{provider:t.provider,url:null},error:o});throw o}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var o;try{const{error:h,data:{session:m}}=i;if(h)throw h;const{options:f,provider:c,token:E,access_token:C,nonce:R}=t,L=await jt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(o=m==null?void 0:m.access_token)!==null&&o!==void 0?o:void 0,body:{provider:c,id_token:E,access_token:C,nonce:R,link_identity:!0,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Hs}),{data:B,error:X}=L;return X?this._returnResult({data:{user:null,session:null},error:X}):!B||!B.session||!B.user?this._returnResult({data:{user:null,session:null},error:new oh}):(B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("USER_UPDATED",B.session)),this._returnResult({data:B,error:X}))}catch(h){if(await ci(this.storage,`${this.storageKey}-code-verifier`),Tt(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var o,h;const{data:m,error:f}=i;if(f)throw f;return await jt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(h=(o=m.session)===null||o===void 0?void 0:o.access_token)!==null&&h!==void 0?h:void 0})})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const o=Date.now();return await wV(async h=>(h>0&&await bV(200*Math.pow(2,h-1)),this._debug(i,"refreshing attempt",h),await jt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Hs})),(h,m)=>{const f=200*Math.pow(2,h);return m&&H0(m)&&Date.now()+f-o<fh})}catch(o){if(this._debug(i,"error",o),Tt(o))return this._returnResult({data:{session:null,user:null},error:o});throw o}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const o=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",o),ui()&&!i.skipBrowserRedirect&&window.location.assign(o),{data:{provider:t,url:o},error:null}}async _recoverAndRefresh(){var t,i;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const h=await Sc(this.storage,this.storageKey);if(h&&this.userStorage){let f=await Sc(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!f&&(f={user:h.user},await mh(this.userStorage,this.storageKey+"-user",f)),h.user=(t=f==null?void 0:f.user)!==null&&t!==void 0?t:X0()}else if(h&&!h.user&&!h.user){const f=await Sc(this.storage,this.storageKey+"-user");f&&(f!=null&&f.user)?(h.user=f.user,await ci(this.storage,this.storageKey+"-user"),await mh(this.storage,this.storageKey,h)):h.user=X0()}if(this._debug(o,"session from storage",h),!this._isValidSession(h)){this._debug(o,"session is not valid"),h!==null&&await this._removeSession();return}const m=((i=h.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<Z0;if(this._debug(o,`session has${m?"":" not"} expired with margin of ${Z0}s`),m){if(this.autoRefreshToken&&h.refresh_token){const{error:f}=await this._callRefreshToken(h.refresh_token);f&&(console.error(f),H0(f)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",f),await this._removeSession()))}}else if(h.user&&h.user.__isUserNotAvailableProxy===!0)try{const{data:f,error:c}=await this._getUser(h.access_token);!c&&(f!=null&&f.user)?(h.user=f.user,await this._saveSession(h),await this._notifyAllSubscribers("SIGNED_IN",h)):this._debug(o,"could not get user data, skipping SIGNED_IN notification")}catch(f){console.error("Error getting user data:",f),this._debug(o,"error getting user data, skipping SIGNED_IN notification",f)}else await this._notifyAllSubscribers("SIGNED_IN",h)}catch(h){this._debug(o,"error",h),console.error(h);return}finally{this._debug(o,"end")}}async _callRefreshToken(t){var i,o;if(!t)throw new hs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const h=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(h,"begin");try{this.refreshingDeferred=new C_;const{data:m,error:f}=await this._refreshAccessToken(t);if(f)throw f;if(!m.session)throw new hs;await this._saveSession(m.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",m.session);const c={data:m.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(m){if(this._debug(h,"error",m),Tt(m)){const f={data:null,error:m};return H0(m)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(f),f}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(m),m}finally{this.refreshingDeferred=null,this._debug(h,"end")}}async _notifyAllSubscribers(t,i,o=!0){const h=`#_notifyAllSubscribers(${t})`;this._debug(h,"begin",i,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:t,session:i});const m=[],f=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(t,i)}catch(E){m.push(E)}});if(await Promise.all(f),m.length>0){for(let c=0;c<m.length;c+=1)console.error(m[c]);throw m[0]}}finally{this._debug(h,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ci(this.storage,`${this.storageKey}-code-verifier`);const i=Object.assign({},t),o=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!o&&i.user&&await mh(this.userStorage,this.storageKey+"-user",{user:i.user});const h=Object.assign({},i);delete h.user;const m=IP(h);await mh(this.storage,this.storageKey,m)}else{const h=IP(i);await mh(this.storage,this.storageKey,h)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ci(this.storage,this.storageKey),await ci(this.storage,this.storageKey+"-code-verifier"),await ci(this.storage,this.storageKey+"-user"),this.userStorage&&await ci(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ui()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),fh);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const i=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const i=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,i&&clearTimeout(i)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:o}}=i;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const h=Math.floor((o.expires_at*1e3-t)/fh);this._debug("#_autoRefreshTokenTick()",`access token expires in ${h} ticks, a tick lasts ${fh}ms, refresh threshold is ${Eb} ticks`),h<=Eb&&await this._callRefreshToken(o.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof IM)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ui()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,o){const h=[`provider=${encodeURIComponent(i)}`];if(o!=null&&o.redirectTo&&h.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o!=null&&o.scopes&&h.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){const[m,f]=await lh(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(m)}`,code_challenge_method:`${encodeURIComponent(f)}`});h.push(c.toString())}if(o!=null&&o.queryParams){const m=new URLSearchParams(o.queryParams);h.push(m.toString())}return o!=null&&o.skipBrowserRedirect&&h.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${t}?${h.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var o;const{data:h,error:m}=i;return m?this._returnResult({data:null,error:m}):await jt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(o=h==null?void 0:h.session)===null||o===void 0?void 0:o.access_token})})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var o,h;const{data:m,error:f}=i;if(f)return this._returnResult({data:null,error:f});const c=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:E,error:C}=await jt(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(o=m==null?void 0:m.session)===null||o===void 0?void 0:o.access_token});return C?this._returnResult({data:null,error:C}):(t.factorType==="totp"&&E.type==="totp"&&(!((h=E==null?void 0:E.totp)===null||h===void 0)&&h.qr_code)&&(E.totp.qr_code=`data:image/svg+xml;utf-8,${E.totp.qr_code}`),this._returnResult({data:E,error:null}))})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async i=>{var o;const{data:h,error:m}=i;if(m)return this._returnResult({data:null,error:m});const f=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?JV(t.webauthn.credential_response):QV(t.webauthn.credential_response)})}:{code:t.code}),{data:c,error:E}=await jt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:f,headers:this.headers,jwt:(o=h==null?void 0:h.session)===null||o===void 0?void 0:o.access_token});return E?this._returnResult({data:null,error:E}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),this._returnResult({data:c,error:E}))})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async i=>{var o;const{data:h,error:m}=i;if(m)return this._returnResult({data:null,error:m});const f=await jt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(o=h==null?void 0:h.session)===null||o===void 0?void 0:o.access_token});if(f.error)return f;const{data:c}=f;if(c.type!=="webauthn")return{data:c,error:null};switch(c.webauthn.type){case"create":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:XV(c.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:YV(c.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:o}=await this._challenge({factorId:t.factorId});return o?this._returnResult({data:null,error:o}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:o}=await this.getUser();if(o)return{data:null,error:o};const h={all:[],phone:[],totp:[],webauthn:[]};for(const m of(t=i==null?void 0:i.factors)!==null&&t!==void 0?t:[])h.all.push(m),m.status==="verified"&&h[m.factor_type].push(m);return{data:h,error:null}}async _getAuthenticatorAssuranceLevel(){var t,i;const{data:{session:o},error:h}=await this.getSession();if(h)return this._returnResult({data:null,error:h});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:m}=K0(o.access_token);let f=null;m.aal&&(f=m.aal);let c=f;((i=(t=o.user.factors)===null||t===void 0?void 0:t.filter(R=>R.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(c="aal2");const C=m.amr||[];return{data:{currentLevel:f,nextLevel:c,currentAuthenticationMethods:C},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:o},error:h}=i;return h?this._returnResult({data:null,error:h}):o?await jt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:o.access_token,xform:m=>({data:m,error:null})}):this._returnResult({data:null,error:new hs})})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async o=>{const{data:{session:h},error:m}=o;if(m)return this._returnResult({data:null,error:m});if(!h)return this._returnResult({data:null,error:new hs});const f=await jt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:h.access_token,body:{action:"approve"},xform:c=>({data:c,error:null})});return f.data&&f.data.redirect_url&&ui()&&!(i!=null&&i.skipBrowserRedirect)&&window.location.assign(f.data.redirect_url),f})}catch(o){if(Tt(o))return this._returnResult({data:null,error:o});throw o}}async _denyAuthorization(t,i){try{return await this._useSession(async o=>{const{data:{session:h},error:m}=o;if(m)return this._returnResult({data:null,error:m});if(!h)return this._returnResult({data:null,error:new hs});const f=await jt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:h.access_token,body:{action:"deny"},xform:c=>({data:c,error:null})});return f.data&&f.data.redirect_url&&ui()&&!(i!=null&&i.skipBrowserRedirect)&&window.location.assign(f.data.redirect_url),f})}catch(o){if(Tt(o))return this._returnResult({data:null,error:o});throw o}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:i},error:o}=t;return o?this._returnResult({data:null,error:o}):i?await jt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,xform:h=>({data:h,error:null})}):this._returnResult({data:null,error:new hs})})}catch(t){if(Tt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async i=>{const{data:{session:o},error:h}=i;return h?this._returnResult({data:null,error:h}):o?(await jt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:o.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new hs})})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async fetchJwk(t,i={keys:[]}){let o=i.keys.find(c=>c.kid===t);if(o)return o;const h=Date.now();if(o=this.jwks.keys.find(c=>c.kid===t),o&&this.jwks_cached_at+aV>h)return o;const{data:m,error:f}=await jt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return!m.keys||m.keys.length===0||(this.jwks=m,this.jwks_cached_at=h,o=m.keys.find(c=>c.kid===t),!o)?null:o}async getClaims(t,i={}){try{let o=t;if(!o){const{data:X,error:W}=await this.getSession();if(W||!X.session)return this._returnResult({data:null,error:W});o=X.session.access_token}const{header:h,payload:m,signature:f,raw:{header:c,payload:E}}=K0(o);i!=null&&i.allowExpired||AV(m.exp);const C=!h.alg||h.alg.startsWith("HS")||!h.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(h.kid,i!=null&&i.keys?{keys:i.keys}:i==null?void 0:i.jwks);if(!C){const{error:X}=await this.getUser(o);if(X)throw X;return{data:{claims:m,header:h,signature:f},error:null}}const R=IV(h.alg),L=await crypto.subtle.importKey("jwk",C,R,!0,["verify"]);if(!await crypto.subtle.verify(R,L,f,gV(`${c}.${E}`)))throw new kb("Invalid JWT signature");return{data:{claims:m,header:h,signature:f},error:null}}catch(o){if(Tt(o))return this._returnResult({data:null,error:o});throw o}}}Mf.nextInstanceID={};const l6=Mf,c6="2.90.1";let Bp="";typeof Deno<"u"?Bp="deno":typeof document<"u"?Bp="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Bp="react-native":Bp="node";const u6={"X-Client-Info":`supabase-js-${Bp}/${c6}`},h6={headers:u6},d6={schema:"public"},p6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},f6={};function Rf(e){"@babel/helpers - typeof";return Rf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rf(e)}function m6(e,t){if(Rf(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var o=i.call(e,t);if(Rf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function g6(e){var t=m6(e,"string");return Rf(t)=="symbol"?t:t+""}function y6(e,t,i){return(t=g6(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function zP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function gr(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zP(Object(i),!0).forEach(function(o){y6(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zP(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const _6=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),v6=()=>Headers,x6=(e,t,i)=>{const o=_6(i),h=v6();return async(m,f)=>{var c;const E=(c=await t())!==null&&c!==void 0?c:e;let C=new h(f==null?void 0:f.headers);return C.has("apikey")||C.set("apikey",e),C.has("Authorization")||C.set("Authorization",`Bearer ${E}`),o(m,gr(gr({},f),{},{headers:C}))}};function b6(e){return e.endsWith("/")?e:e+"/"}function w6(e,t){var i,o;const{db:h,auth:m,realtime:f,global:c}=e,{db:E,auth:C,realtime:R,global:L}=t,B={db:gr(gr({},E),h),auth:gr(gr({},C),m),realtime:gr(gr({},R),f),storage:{},global:gr(gr(gr({},L),c),{},{headers:gr(gr({},(i=L==null?void 0:L.headers)!==null&&i!==void 0?i:{}),(o=c==null?void 0:c.headers)!==null&&o!==void 0?o:{})}),accessToken:async()=>""};return e.accessToken?B.accessToken=e.accessToken:delete B.accessToken,B}function S6(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(b6(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var T6=class extends l6{constructor(e){super(e)}},E6=class{constructor(e,t,i){var o,h;this.supabaseUrl=e,this.supabaseKey=t;const m=S6(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",m),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",m),this.storageUrl=new URL("storage/v1",m),this.functionsUrl=new URL("functions/v1",m);const f=`sb-${m.hostname.split(".")[0]}-auth-token`,c={db:d6,realtime:f6,auth:gr(gr({},p6),{},{storageKey:f}),global:h6},E=w6(i??{},c);if(this.storageKey=(o=E.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(h=E.global.headers)!==null&&h!==void 0?h:{},E.accessToken)this.accessToken=E.accessToken,this.auth=new Proxy({},{get:(R,L)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(L)} is not possible`)}});else{var C;this.auth=this._initSupabaseAuthClient((C=E.auth)!==null&&C!==void 0?C:{},this.headers,E.global.fetch)}this.fetch=x6(t,this._getAccessToken.bind(this),E.global.fetch),this.realtime=this._initRealtimeClient(gr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},E.realtime)),this.accessToken&&this.accessToken().then(R=>this.realtime.setAuth(R)).catch(R=>console.warn("Failed to set initial Realtime auth token:",R)),this.rest=new i4(new URL("rest/v1",m).href,{headers:this.headers,schema:E.db.schema,fetch:this.fetch}),this.storage=new tV(this.storageUrl.href,this.headers,this.fetch,i==null?void 0:i.storage),E.accessToken||this._listenForAuthEvents()}get functions(){return new Q5(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,i)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,i;if(e.accessToken)return await e.accessToken();const{data:o}=await e.auth.getSession();return(t=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:o,userStorage:h,storageKey:m,flowType:f,lock:c,debug:E,throwOnError:C},R,L){const B={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new T6({url:this.authUrl.href,headers:gr(gr({},B),R),storageKey:m,autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:o,userStorage:h,flowType:f,lock:c,debug:E,throwOnError:C,fetch:L,hasCustomAuthorizationHeader:Object.keys(this.headers).some(X=>X.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new b4(this.realtimeUrl.href,gr(gr({},e),{},{params:gr(gr({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const P6=(e,t,i)=>new E6(e,t,i);function C6(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const i=t.match(/^v(\d+)\./);return i?parseInt(i[1],10)<=18:!1}C6()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const k6="https://oxrtdijdvqbbgaowoglu.supabase.co",A6="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94cnRkaWpkdnFiYmdhb3dvZ2x1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NzgwMjksImV4cCI6MjA4NDM1NDAyOX0.aeF1ayN463KpToLcDgLIvNGlTQjF4Ehn1NzK1fPk7to",zt=P6(k6,A6,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}});function DM(e,t){return function(){return e.apply(t,arguments)}}const{toString:I6}=Object.prototype,{getPrototypeOf:v1}=Object,{iterator:k_,toStringTag:jM}=Symbol,A_=(e=>t=>{const i=I6.call(t);return e[i]||(e[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),ia=e=>(e=e.toLowerCase(),t=>A_(t)===e),I_=e=>t=>typeof t===e,{isArray:ad}=Array,Jh=I_("undefined");function $f(e){return e!==null&&!Jh(e)&&e.constructor!==null&&!Jh(e.constructor)&&Ji(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const NM=ia("ArrayBuffer");function M6(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&NM(e.buffer),t}const R6=I_("string"),Ji=I_("function"),LM=I_("number"),Gf=e=>e!==null&&typeof e=="object",D6=e=>e===!0||e===!1,py=e=>{if(A_(e)!=="object")return!1;const t=v1(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(jM in e)&&!(k_ in e)},j6=e=>{if(!Gf(e)||$f(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},N6=ia("Date"),L6=ia("File"),z6=ia("Blob"),O6=ia("FileList"),F6=e=>Gf(e)&&Ji(e.pipe),B6=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ji(e.append)&&((t=A_(e))==="formdata"||t==="object"&&Ji(e.toString)&&e.toString()==="[object FormData]"))},V6=ia("URLSearchParams"),[U6,$6,G6,q6]=["ReadableStream","Request","Response","Headers"].map(ia),W6=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qf(e,t,{allOwnKeys:i=!1}={}){if(e===null||typeof e>"u")return;let o,h;if(typeof e!="object"&&(e=[e]),ad(e))for(o=0,h=e.length;o<h;o++)t.call(null,e[o],o,e);else{if($f(e))return;const m=i?Object.getOwnPropertyNames(e):Object.keys(e),f=m.length;let c;for(o=0;o<f;o++)c=m[o],t.call(null,e[c],c,e)}}function zM(e,t){if($f(e))return null;t=t.toLowerCase();const i=Object.keys(e);let o=i.length,h;for(;o-- >0;)if(h=i[o],t===h.toLowerCase())return h;return null}const zc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,OM=e=>!Jh(e)&&e!==zc;function Ab(){const{caseless:e,skipUndefined:t}=OM(this)&&this||{},i={},o=(h,m)=>{const f=e&&zM(i,m)||m;py(i[f])&&py(h)?i[f]=Ab(i[f],h):py(h)?i[f]=Ab({},h):ad(h)?i[f]=h.slice():(!t||!Jh(h))&&(i[f]=h)};for(let h=0,m=arguments.length;h<m;h++)arguments[h]&&qf(arguments[h],o);return i}const Z6=(e,t,i,{allOwnKeys:o}={})=>(qf(t,(h,m)=>{i&&Ji(h)?e[m]=DM(h,i):e[m]=h},{allOwnKeys:o}),e),H6=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),K6=(e,t,i,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},X6=(e,t,i,o)=>{let h,m,f;const c={};if(t=t||{},e==null)return t;do{for(h=Object.getOwnPropertyNames(e),m=h.length;m-- >0;)f=h[m],(!o||o(f,e,t))&&!c[f]&&(t[f]=e[f],c[f]=!0);e=i!==!1&&v1(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},Y6=(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;const o=e.indexOf(t,i);return o!==-1&&o===i},J6=e=>{if(!e)return null;if(ad(e))return e;let t=e.length;if(!LM(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},Q6=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&v1(Uint8Array)),eU=(e,t)=>{const o=(e&&e[k_]).call(e);let h;for(;(h=o.next())&&!h.done;){const m=h.value;t.call(e,m[0],m[1])}},tU=(e,t)=>{let i;const o=[];for(;(i=e.exec(t))!==null;)o.push(i);return o},nU=ia("HTMLFormElement"),rU=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,o,h){return o.toUpperCase()+h}),OP=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),iU=ia("RegExp"),FM=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),o={};qf(i,(h,m)=>{let f;(f=t(h,m,e))!==!1&&(o[m]=f||h)}),Object.defineProperties(e,o)},sU=e=>{FM(e,(t,i)=>{if(Ji(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];if(Ji(o)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},aU=(e,t)=>{const i={},o=h=>{h.forEach(m=>{i[m]=!0})};return ad(e)?o(e):o(String(e).split(t)),i},oU=()=>{},lU=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function cU(e){return!!(e&&Ji(e.append)&&e[jM]==="FormData"&&e[k_])}const uU=e=>{const t=new Array(10),i=(o,h)=>{if(Gf(o)){if(t.indexOf(o)>=0)return;if($f(o))return o;if(!("toJSON"in o)){t[h]=o;const m=ad(o)?[]:{};return qf(o,(f,c)=>{const E=i(f,h+1);!Jh(E)&&(m[c]=E)}),t[h]=void 0,m}}return o};return i(e,0)},hU=ia("AsyncFunction"),dU=e=>e&&(Gf(e)||Ji(e))&&Ji(e.then)&&Ji(e.catch),BM=((e,t)=>e?setImmediate:t?((i,o)=>(zc.addEventListener("message",({source:h,data:m})=>{h===zc&&m===i&&o.length&&o.shift()()},!1),h=>{o.push(h),zc.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Ji(zc.postMessage)),pU=typeof queueMicrotask<"u"?queueMicrotask.bind(zc):typeof process<"u"&&process.nextTick||BM,fU=e=>e!=null&&Ji(e[k_]),Be={isArray:ad,isArrayBuffer:NM,isBuffer:$f,isFormData:B6,isArrayBufferView:M6,isString:R6,isNumber:LM,isBoolean:D6,isObject:Gf,isPlainObject:py,isEmptyObject:j6,isReadableStream:U6,isRequest:$6,isResponse:G6,isHeaders:q6,isUndefined:Jh,isDate:N6,isFile:L6,isBlob:z6,isRegExp:iU,isFunction:Ji,isStream:F6,isURLSearchParams:V6,isTypedArray:Q6,isFileList:O6,forEach:qf,merge:Ab,extend:Z6,trim:W6,stripBOM:H6,inherits:K6,toFlatObject:X6,kindOf:A_,kindOfTest:ia,endsWith:Y6,toArray:J6,forEachEntry:eU,matchAll:tU,isHTMLForm:nU,hasOwnProperty:OP,hasOwnProp:OP,reduceDescriptors:FM,freezeMethods:sU,toObjectSet:aU,toCamelCase:rU,noop:oU,toFiniteNumber:lU,findKey:zM,global:zc,isContextDefined:OM,isSpecCompliantForm:cU,toJSONObject:uU,isAsyncFn:hU,isThenable:dU,setImmediate:BM,asap:pU,isIterable:fU};function Xt(e,t,i,o,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),o&&(this.request=o),h&&(this.response=h,this.status=h.status?h.status:null)}Be.inherits(Xt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Be.toJSONObject(this.config),code:this.code,status:this.status}}});const VM=Xt.prototype,UM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{UM[e]={value:e}});Object.defineProperties(Xt,UM);Object.defineProperty(VM,"isAxiosError",{value:!0});Xt.from=(e,t,i,o,h,m)=>{const f=Object.create(VM);Be.toFlatObject(e,f,function(R){return R!==Error.prototype},C=>C!=="isAxiosError");const c=e&&e.message?e.message:"Error",E=t==null&&e?e.code:t;return Xt.call(f,c,E,i,o,h),e&&f.cause==null&&Object.defineProperty(f,"cause",{value:e,configurable:!0}),f.name=e&&e.name||"Error",m&&Object.assign(f,m),f};const mU=null;function Ib(e){return Be.isPlainObject(e)||Be.isArray(e)}function $M(e){return Be.endsWith(e,"[]")?e.slice(0,-2):e}function FP(e,t,i){return e?e.concat(t).map(function(h,m){return h=$M(h),!i&&m?"["+h+"]":h}).join(i?".":""):t}function gU(e){return Be.isArray(e)&&!e.some(Ib)}const yU=Be.toFlatObject(Be,{},null,function(t){return/^is[A-Z]/.test(t)});function M_(e,t,i){if(!Be.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,i=Be.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(te,G){return!Be.isUndefined(G[te])});const o=i.metaTokens,h=i.visitor||R,m=i.dots,f=i.indexes,E=(i.Blob||typeof Blob<"u"&&Blob)&&Be.isSpecCompliantForm(t);if(!Be.isFunction(h))throw new TypeError("visitor must be a function");function C(W){if(W===null)return"";if(Be.isDate(W))return W.toISOString();if(Be.isBoolean(W))return W.toString();if(!E&&Be.isBlob(W))throw new Xt("Blob is not supported. Use a Buffer instead.");return Be.isArrayBuffer(W)||Be.isTypedArray(W)?E&&typeof Blob=="function"?new Blob([W]):Buffer.from(W):W}function R(W,te,G){let J=W;if(W&&!G&&typeof W=="object"){if(Be.endsWith(te,"{}"))te=o?te:te.slice(0,-2),W=JSON.stringify(W);else if(Be.isArray(W)&&gU(W)||(Be.isFileList(W)||Be.endsWith(te,"[]"))&&(J=Be.toArray(W)))return te=$M(te),J.forEach(function(Q,le){!(Be.isUndefined(Q)||Q===null)&&t.append(f===!0?FP([te],le,m):f===null?te:te+"[]",C(Q))}),!1}return Ib(W)?!0:(t.append(FP(G,te,m),C(W)),!1)}const L=[],B=Object.assign(yU,{defaultVisitor:R,convertValue:C,isVisitable:Ib});function X(W,te){if(!Be.isUndefined(W)){if(L.indexOf(W)!==-1)throw Error("Circular reference detected in "+te.join("."));L.push(W),Be.forEach(W,function(J,H){(!(Be.isUndefined(J)||J===null)&&h.call(t,J,Be.isString(H)?H.trim():H,te,B))===!0&&X(J,te?te.concat(H):[H])}),L.pop()}}if(!Be.isObject(e))throw new TypeError("data must be an object");return X(e),t}function BP(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return t[o]})}function x1(e,t){this._pairs=[],e&&M_(e,this,t)}const GM=x1.prototype;GM.append=function(t,i){this._pairs.push([t,i])};GM.toString=function(t){const i=t?function(o){return t.call(this,o,BP)}:BP;return this._pairs.map(function(h){return i(h[0])+"="+i(h[1])},"").join("&")};function _U(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function qM(e,t,i){if(!t)return e;const o=i&&i.encode||_U;Be.isFunction(i)&&(i={serialize:i});const h=i&&i.serialize;let m;if(h?m=h(t,i):m=Be.isURLSearchParams(t)?t.toString():new x1(t,i).toString(o),m){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+m}return e}class VP{constructor(){this.handlers=[]}use(t,i,o){return this.handlers.push({fulfilled:t,rejected:i,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Be.forEach(this.handlers,function(o){o!==null&&t(o)})}}const WM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vU=typeof URLSearchParams<"u"?URLSearchParams:x1,xU=typeof FormData<"u"?FormData:null,bU=typeof Blob<"u"?Blob:null,wU={isBrowser:!0,classes:{URLSearchParams:vU,FormData:xU,Blob:bU},protocols:["http","https","file","blob","url","data"]},b1=typeof window<"u"&&typeof document<"u",Mb=typeof navigator=="object"&&navigator||void 0,SU=b1&&(!Mb||["ReactNative","NativeScript","NS"].indexOf(Mb.product)<0),TU=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",EU=b1&&window.location.href||"http://localhost",PU=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:b1,hasStandardBrowserEnv:SU,hasStandardBrowserWebWorkerEnv:TU,navigator:Mb,origin:EU},Symbol.toStringTag,{value:"Module"})),Ei={...PU,...wU};function CU(e,t){return M_(e,new Ei.classes.URLSearchParams,{visitor:function(i,o,h,m){return Ei.isNode&&Be.isBuffer(i)?(this.append(o,i.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)},...t})}function kU(e){return Be.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function AU(e){const t={},i=Object.keys(e);let o;const h=i.length;let m;for(o=0;o<h;o++)m=i[o],t[m]=e[m];return t}function ZM(e){function t(i,o,h,m){let f=i[m++];if(f==="__proto__")return!0;const c=Number.isFinite(+f),E=m>=i.length;return f=!f&&Be.isArray(h)?h.length:f,E?(Be.hasOwnProp(h,f)?h[f]=[h[f],o]:h[f]=o,!c):((!h[f]||!Be.isObject(h[f]))&&(h[f]=[]),t(i,o,h[f],m)&&Be.isArray(h[f])&&(h[f]=AU(h[f])),!c)}if(Be.isFormData(e)&&Be.isFunction(e.entries)){const i={};return Be.forEachEntry(e,(o,h)=>{t(kU(o),h,i,0)}),i}return null}function IU(e,t,i){if(Be.isString(e))try{return(t||JSON.parse)(e),Be.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(i||JSON.stringify)(e)}const Wf={transitional:WM,adapter:["xhr","http","fetch"],transformRequest:[function(t,i){const o=i.getContentType()||"",h=o.indexOf("application/json")>-1,m=Be.isObject(t);if(m&&Be.isHTMLForm(t)&&(t=new FormData(t)),Be.isFormData(t))return h?JSON.stringify(ZM(t)):t;if(Be.isArrayBuffer(t)||Be.isBuffer(t)||Be.isStream(t)||Be.isFile(t)||Be.isBlob(t)||Be.isReadableStream(t))return t;if(Be.isArrayBufferView(t))return t.buffer;if(Be.isURLSearchParams(t))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(m){if(o.indexOf("application/x-www-form-urlencoded")>-1)return CU(t,this.formSerializer).toString();if((c=Be.isFileList(t))||o.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return M_(c?{"files[]":t}:t,E&&new E,this.formSerializer)}}return m||h?(i.setContentType("application/json",!1),IU(t)):t}],transformResponse:[function(t){const i=this.transitional||Wf.transitional,o=i&&i.forcedJSONParsing,h=this.responseType==="json";if(Be.isResponse(t)||Be.isReadableStream(t))return t;if(t&&Be.isString(t)&&(o&&!this.responseType||h)){const f=!(i&&i.silentJSONParsing)&&h;try{return JSON.parse(t,this.parseReviver)}catch(c){if(f)throw c.name==="SyntaxError"?Xt.from(c,Xt.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ei.classes.FormData,Blob:Ei.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Be.forEach(["delete","get","head","post","put","patch"],e=>{Wf.headers[e]={}});const MU=Be.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),RU=e=>{const t={};let i,o,h;return e&&e.split(`
`).forEach(function(f){h=f.indexOf(":"),i=f.substring(0,h).trim().toLowerCase(),o=f.substring(h+1).trim(),!(!i||t[i]&&MU[i])&&(i==="set-cookie"?t[i]?t[i].push(o):t[i]=[o]:t[i]=t[i]?t[i]+", "+o:o)}),t},UP=Symbol("internals");function Rp(e){return e&&String(e).trim().toLowerCase()}function fy(e){return e===!1||e==null?e:Be.isArray(e)?e.map(fy):String(e)}function DU(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=i.exec(e);)t[o[1]]=o[2];return t}const jU=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function J0(e,t,i,o,h){if(Be.isFunction(o))return o.call(this,t,i);if(h&&(t=i),!!Be.isString(t)){if(Be.isString(o))return t.indexOf(o)!==-1;if(Be.isRegExp(o))return o.test(t)}}function NU(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,i,o)=>i.toUpperCase()+o)}function LU(e,t){const i=Be.toCamelCase(" "+t);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+i,{value:function(h,m,f){return this[o].call(this,t,h,m,f)},configurable:!0})})}let Qi=class{constructor(t){t&&this.set(t)}set(t,i,o){const h=this;function m(c,E,C){const R=Rp(E);if(!R)throw new Error("header name must be a non-empty string");const L=Be.findKey(h,R);(!L||h[L]===void 0||C===!0||C===void 0&&h[L]!==!1)&&(h[L||E]=fy(c))}const f=(c,E)=>Be.forEach(c,(C,R)=>m(C,R,E));if(Be.isPlainObject(t)||t instanceof this.constructor)f(t,i);else if(Be.isString(t)&&(t=t.trim())&&!jU(t))f(RU(t),i);else if(Be.isObject(t)&&Be.isIterable(t)){let c={},E,C;for(const R of t){if(!Be.isArray(R))throw TypeError("Object iterator must return a key-value pair");c[C=R[0]]=(E=c[C])?Be.isArray(E)?[...E,R[1]]:[E,R[1]]:R[1]}f(c,i)}else t!=null&&m(i,t,o);return this}get(t,i){if(t=Rp(t),t){const o=Be.findKey(this,t);if(o){const h=this[o];if(!i)return h;if(i===!0)return DU(h);if(Be.isFunction(i))return i.call(this,h,o);if(Be.isRegExp(i))return i.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Rp(t),t){const o=Be.findKey(this,t);return!!(o&&this[o]!==void 0&&(!i||J0(this,this[o],o,i)))}return!1}delete(t,i){const o=this;let h=!1;function m(f){if(f=Rp(f),f){const c=Be.findKey(o,f);c&&(!i||J0(o,o[c],c,i))&&(delete o[c],h=!0)}}return Be.isArray(t)?t.forEach(m):m(t),h}clear(t){const i=Object.keys(this);let o=i.length,h=!1;for(;o--;){const m=i[o];(!t||J0(this,this[m],m,t,!0))&&(delete this[m],h=!0)}return h}normalize(t){const i=this,o={};return Be.forEach(this,(h,m)=>{const f=Be.findKey(o,m);if(f){i[f]=fy(h),delete i[m];return}const c=t?NU(m):String(m).trim();c!==m&&delete i[m],i[c]=fy(h),o[c]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const i=Object.create(null);return Be.forEach(this,(o,h)=>{o!=null&&o!==!1&&(i[h]=t&&Be.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,i])=>t+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...i){const o=new this(t);return i.forEach(h=>o.set(h)),o}static accessor(t){const o=(this[UP]=this[UP]={accessors:{}}).accessors,h=this.prototype;function m(f){const c=Rp(f);o[c]||(LU(h,f),o[c]=!0)}return Be.isArray(t)?t.forEach(m):m(t),this}};Qi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Be.reduceDescriptors(Qi.prototype,({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(o){this[i]=o}}});Be.freezeMethods(Qi);function Q0(e,t){const i=this||Wf,o=t||i,h=Qi.from(o.headers);let m=o.data;return Be.forEach(e,function(c){m=c.call(i,m,h.normalize(),t?t.status:void 0)}),h.normalize(),m}function HM(e){return!!(e&&e.__CANCEL__)}function od(e,t,i){Xt.call(this,e??"canceled",Xt.ERR_CANCELED,t,i),this.name="CanceledError"}Be.inherits(od,Xt,{__CANCEL__:!0});function KM(e,t,i){const o=i.config.validateStatus;!i.status||!o||o(i.status)?e(i):t(new Xt("Request failed with status code "+i.status,[Xt.ERR_BAD_REQUEST,Xt.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function zU(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function OU(e,t){e=e||10;const i=new Array(e),o=new Array(e);let h=0,m=0,f;return t=t!==void 0?t:1e3,function(E){const C=Date.now(),R=o[m];f||(f=C),i[h]=E,o[h]=C;let L=m,B=0;for(;L!==h;)B+=i[L++],L=L%e;if(h=(h+1)%e,h===m&&(m=(m+1)%e),C-f<t)return;const X=R&&C-R;return X?Math.round(B*1e3/X):void 0}}function FU(e,t){let i=0,o=1e3/t,h,m;const f=(C,R=Date.now())=>{i=R,h=null,m&&(clearTimeout(m),m=null),e(...C)};return[(...C)=>{const R=Date.now(),L=R-i;L>=o?f(C,R):(h=C,m||(m=setTimeout(()=>{m=null,f(h)},o-L)))},()=>h&&f(h)]}const Jy=(e,t,i=3)=>{let o=0;const h=OU(50,250);return FU(m=>{const f=m.loaded,c=m.lengthComputable?m.total:void 0,E=f-o,C=h(E),R=f<=c;o=f;const L={loaded:f,total:c,progress:c?f/c:void 0,bytes:E,rate:C||void 0,estimated:C&&c&&R?(c-f)/C:void 0,event:m,lengthComputable:c!=null,[t?"download":"upload"]:!0};e(L)},i)},$P=(e,t)=>{const i=e!=null;return[o=>t[0]({lengthComputable:i,total:e,loaded:o}),t[1]]},GP=e=>(...t)=>Be.asap(()=>e(...t)),BU=Ei.hasStandardBrowserEnv?((e,t)=>i=>(i=new URL(i,Ei.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new URL(Ei.origin),Ei.navigator&&/(msie|trident)/i.test(Ei.navigator.userAgent)):()=>!0,VU=Ei.hasStandardBrowserEnv?{write(e,t,i,o,h,m,f){if(typeof document>"u")return;const c=[`${e}=${encodeURIComponent(t)}`];Be.isNumber(i)&&c.push(`expires=${new Date(i).toUTCString()}`),Be.isString(o)&&c.push(`path=${o}`),Be.isString(h)&&c.push(`domain=${h}`),m===!0&&c.push("secure"),Be.isString(f)&&c.push(`SameSite=${f}`),document.cookie=c.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function UU(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function $U(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function XM(e,t,i){let o=!UU(t);return e&&(o||i==!1)?$U(e,t):t}const qP=e=>e instanceof Qi?{...e}:e;function Zc(e,t){t=t||{};const i={};function o(C,R,L,B){return Be.isPlainObject(C)&&Be.isPlainObject(R)?Be.merge.call({caseless:B},C,R):Be.isPlainObject(R)?Be.merge({},R):Be.isArray(R)?R.slice():R}function h(C,R,L,B){if(Be.isUndefined(R)){if(!Be.isUndefined(C))return o(void 0,C,L,B)}else return o(C,R,L,B)}function m(C,R){if(!Be.isUndefined(R))return o(void 0,R)}function f(C,R){if(Be.isUndefined(R)){if(!Be.isUndefined(C))return o(void 0,C)}else return o(void 0,R)}function c(C,R,L){if(L in t)return o(C,R);if(L in e)return o(void 0,C)}const E={url:m,method:m,data:m,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:c,headers:(C,R,L)=>h(qP(C),qP(R),L,!0)};return Be.forEach(Object.keys({...e,...t}),function(R){const L=E[R]||h,B=L(e[R],t[R],R);Be.isUndefined(B)&&L!==c||(i[R]=B)}),i}const YM=e=>{const t=Zc({},e);let{data:i,withXSRFToken:o,xsrfHeaderName:h,xsrfCookieName:m,headers:f,auth:c}=t;if(t.headers=f=Qi.from(f),t.url=qM(XM(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&f.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Be.isFormData(i)){if(Ei.hasStandardBrowserEnv||Ei.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(Be.isFunction(i.getHeaders)){const E=i.getHeaders(),C=["content-type","content-length"];Object.entries(E).forEach(([R,L])=>{C.includes(R.toLowerCase())&&f.set(R,L)})}}if(Ei.hasStandardBrowserEnv&&(o&&Be.isFunction(o)&&(o=o(t)),o||o!==!1&&BU(t.url))){const E=h&&m&&VU.read(m);E&&f.set(h,E)}return t},GU=typeof XMLHttpRequest<"u",qU=GU&&function(e){return new Promise(function(i,o){const h=YM(e);let m=h.data;const f=Qi.from(h.headers).normalize();let{responseType:c,onUploadProgress:E,onDownloadProgress:C}=h,R,L,B,X,W;function te(){X&&X(),W&&W(),h.cancelToken&&h.cancelToken.unsubscribe(R),h.signal&&h.signal.removeEventListener("abort",R)}let G=new XMLHttpRequest;G.open(h.method.toUpperCase(),h.url,!0),G.timeout=h.timeout;function J(){if(!G)return;const Q=Qi.from("getAllResponseHeaders"in G&&G.getAllResponseHeaders()),ve={data:!c||c==="text"||c==="json"?G.responseText:G.response,status:G.status,statusText:G.statusText,headers:Q,config:e,request:G};KM(function(_e){i(_e),te()},function(_e){o(_e),te()},ve),G=null}"onloadend"in G?G.onloadend=J:G.onreadystatechange=function(){!G||G.readyState!==4||G.status===0&&!(G.responseURL&&G.responseURL.indexOf("file:")===0)||setTimeout(J)},G.onabort=function(){G&&(o(new Xt("Request aborted",Xt.ECONNABORTED,e,G)),G=null)},G.onerror=function(le){const ve=le&&le.message?le.message:"Network Error",Ee=new Xt(ve,Xt.ERR_NETWORK,e,G);Ee.event=le||null,o(Ee),G=null},G.ontimeout=function(){let le=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded";const ve=h.transitional||WM;h.timeoutErrorMessage&&(le=h.timeoutErrorMessage),o(new Xt(le,ve.clarifyTimeoutError?Xt.ETIMEDOUT:Xt.ECONNABORTED,e,G)),G=null},m===void 0&&f.setContentType(null),"setRequestHeader"in G&&Be.forEach(f.toJSON(),function(le,ve){G.setRequestHeader(ve,le)}),Be.isUndefined(h.withCredentials)||(G.withCredentials=!!h.withCredentials),c&&c!=="json"&&(G.responseType=h.responseType),C&&([B,W]=Jy(C,!0),G.addEventListener("progress",B)),E&&G.upload&&([L,X]=Jy(E),G.upload.addEventListener("progress",L),G.upload.addEventListener("loadend",X)),(h.cancelToken||h.signal)&&(R=Q=>{G&&(o(!Q||Q.type?new od(null,e,G):Q),G.abort(),G=null)},h.cancelToken&&h.cancelToken.subscribe(R),h.signal&&(h.signal.aborted?R():h.signal.addEventListener("abort",R)));const H=zU(h.url);if(H&&Ei.protocols.indexOf(H)===-1){o(new Xt("Unsupported protocol "+H+":",Xt.ERR_BAD_REQUEST,e));return}G.send(m||null)})},WU=(e,t)=>{const{length:i}=e=e?e.filter(Boolean):[];if(t||i){let o=new AbortController,h;const m=function(C){if(!h){h=!0,c();const R=C instanceof Error?C:this.reason;o.abort(R instanceof Xt?R:new od(R instanceof Error?R.message:R))}};let f=t&&setTimeout(()=>{f=null,m(new Xt(`timeout ${t} of ms exceeded`,Xt.ETIMEDOUT))},t);const c=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(C=>{C.unsubscribe?C.unsubscribe(m):C.removeEventListener("abort",m)}),e=null)};e.forEach(C=>C.addEventListener("abort",m));const{signal:E}=o;return E.unsubscribe=()=>Be.asap(c),E}},ZU=function*(e,t){let i=e.byteLength;if(i<t){yield e;return}let o=0,h;for(;o<i;)h=o+t,yield e.slice(o,h),o=h},HU=async function*(e,t){for await(const i of KU(e))yield*ZU(i,t)},KU=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:i,value:o}=await t.read();if(i)break;yield o}}finally{await t.cancel()}},WP=(e,t,i,o)=>{const h=HU(e,t);let m=0,f,c=E=>{f||(f=!0,o&&o(E))};return new ReadableStream({async pull(E){try{const{done:C,value:R}=await h.next();if(C){c(),E.close();return}let L=R.byteLength;if(i){let B=m+=L;i(B)}E.enqueue(new Uint8Array(R))}catch(C){throw c(C),C}},cancel(E){return c(E),h.return()}},{highWaterMark:2})},ZP=64*1024,{isFunction:Zg}=Be,XU=(({Request:e,Response:t})=>({Request:e,Response:t}))(Be.global),{ReadableStream:HP,TextEncoder:KP}=Be.global,XP=(e,...t)=>{try{return!!e(...t)}catch{return!1}},YU=e=>{e=Be.merge.call({skipUndefined:!0},XU,e);const{fetch:t,Request:i,Response:o}=e,h=t?Zg(t):typeof fetch=="function",m=Zg(i),f=Zg(o);if(!h)return!1;const c=h&&Zg(HP),E=h&&(typeof KP=="function"?(W=>te=>W.encode(te))(new KP):async W=>new Uint8Array(await new i(W).arrayBuffer())),C=m&&c&&XP(()=>{let W=!1;const te=new i(Ei.origin,{body:new HP,method:"POST",get duplex(){return W=!0,"half"}}).headers.has("Content-Type");return W&&!te}),R=f&&c&&XP(()=>Be.isReadableStream(new o("").body)),L={stream:R&&(W=>W.body)};h&&["text","arrayBuffer","blob","formData","stream"].forEach(W=>{!L[W]&&(L[W]=(te,G)=>{let J=te&&te[W];if(J)return J.call(te);throw new Xt(`Response type '${W}' is not supported`,Xt.ERR_NOT_SUPPORT,G)})});const B=async W=>{if(W==null)return 0;if(Be.isBlob(W))return W.size;if(Be.isSpecCompliantForm(W))return(await new i(Ei.origin,{method:"POST",body:W}).arrayBuffer()).byteLength;if(Be.isArrayBufferView(W)||Be.isArrayBuffer(W))return W.byteLength;if(Be.isURLSearchParams(W)&&(W=W+""),Be.isString(W))return(await E(W)).byteLength},X=async(W,te)=>{const G=Be.toFiniteNumber(W.getContentLength());return G??B(te)};return async W=>{let{url:te,method:G,data:J,signal:H,cancelToken:Q,timeout:le,onDownloadProgress:ve,onUploadProgress:Ee,responseType:_e,headers:we,withCredentials:Ge="same-origin",fetchOptions:Je}=YM(W),ft=t||fetch;_e=_e?(_e+"").toLowerCase():"text";let At=WU([H,Q&&Q.toAbortSignal()],le),kt=null;const gt=At&&At.unsubscribe&&(()=>{At.unsubscribe()});let We;try{if(Ee&&C&&G!=="get"&&G!=="head"&&(We=await X(we,J))!==0){let mt=new i(te,{method:"POST",body:J,duplex:"half"}),Pt;if(Be.isFormData(J)&&(Pt=mt.headers.get("content-type"))&&we.setContentType(Pt),mt.body){const[sn,an]=$P(We,Jy(GP(Ee)));J=WP(mt.body,ZP,sn,an)}}Be.isString(Ge)||(Ge=Ge?"include":"omit");const wt=m&&"credentials"in i.prototype,bt={...Je,signal:At,method:G.toUpperCase(),headers:we.normalize().toJSON(),body:J,duplex:"half",credentials:wt?Ge:void 0};kt=m&&new i(te,bt);let Ye=await(m?ft(kt,Je):ft(te,bt));const Pe=R&&(_e==="stream"||_e==="response");if(R&&(ve||Pe&&gt)){const mt={};["status","statusText","headers"].forEach(tn=>{mt[tn]=Ye[tn]});const Pt=Be.toFiniteNumber(Ye.headers.get("content-length")),[sn,an]=ve&&$P(Pt,Jy(GP(ve),!0))||[];Ye=new o(WP(Ye.body,ZP,sn,()=>{an&&an(),gt&&gt()}),mt)}_e=_e||"text";let at=await L[Be.findKey(L,_e)||"text"](Ye,W);return!Pe&&gt&&gt(),await new Promise((mt,Pt)=>{KM(mt,Pt,{data:at,headers:Qi.from(Ye.headers),status:Ye.status,statusText:Ye.statusText,config:W,request:kt})})}catch(wt){throw gt&&gt(),wt&&wt.name==="TypeError"&&/Load failed|fetch/i.test(wt.message)?Object.assign(new Xt("Network Error",Xt.ERR_NETWORK,W,kt),{cause:wt.cause||wt}):Xt.from(wt,wt&&wt.code,W,kt)}}},JU=new Map,JM=e=>{let t=e&&e.env||{};const{fetch:i,Request:o,Response:h}=t,m=[o,h,i];let f=m.length,c=f,E,C,R=JU;for(;c--;)E=m[c],C=R.get(E),C===void 0&&R.set(E,C=c?new Map:YU(t)),R=C;return C};JM();const w1={http:mU,xhr:qU,fetch:{get:JM}};Be.forEach(w1,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const YP=e=>`- ${e}`,QU=e=>Be.isFunction(e)||e===null||e===!1;function e$(e,t){e=Be.isArray(e)?e:[e];const{length:i}=e;let o,h;const m={};for(let f=0;f<i;f++){o=e[f];let c;if(h=o,!QU(o)&&(h=w1[(c=String(o)).toLowerCase()],h===void 0))throw new Xt(`Unknown adapter '${c}'`);if(h&&(Be.isFunction(h)||(h=h.get(t))))break;m[c||"#"+f]=h}if(!h){const f=Object.entries(m).map(([E,C])=>`adapter ${E} `+(C===!1?"is not supported by the environment":"is not available in the build"));let c=i?f.length>1?`since :
`+f.map(YP).join(`
`):" "+YP(f[0]):"as no adapter specified";throw new Xt("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return h}const QM={getAdapter:e$,adapters:w1};function ex(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new od(null,e)}function JP(e){return ex(e),e.headers=Qi.from(e.headers),e.data=Q0.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),QM.getAdapter(e.adapter||Wf.adapter,e)(e).then(function(o){return ex(e),o.data=Q0.call(e,e.transformResponse,o),o.headers=Qi.from(o.headers),o},function(o){return HM(o)||(ex(e),o&&o.response&&(o.response.data=Q0.call(e,e.transformResponse,o.response),o.response.headers=Qi.from(o.response.headers))),Promise.reject(o)})}const eR="1.13.2",R_={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{R_[e]=function(o){return typeof o===e||"a"+(t<1?"n ":" ")+e}});const QP={};R_.transitional=function(t,i,o){function h(m,f){return"[Axios v"+eR+"] Transitional option '"+m+"'"+f+(o?". "+o:"")}return(m,f,c)=>{if(t===!1)throw new Xt(h(f," has been removed"+(i?" in "+i:"")),Xt.ERR_DEPRECATED);return i&&!QP[f]&&(QP[f]=!0,console.warn(h(f," has been deprecated since v"+i+" and will be removed in the near future"))),t?t(m,f,c):!0}};R_.spelling=function(t){return(i,o)=>(console.warn(`${o} is likely a misspelling of ${t}`),!0)};function t$(e,t,i){if(typeof e!="object")throw new Xt("options must be an object",Xt.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let h=o.length;for(;h-- >0;){const m=o[h],f=t[m];if(f){const c=e[m],E=c===void 0||f(c,m,e);if(E!==!0)throw new Xt("option "+m+" must be "+E,Xt.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Xt("Unknown option "+m,Xt.ERR_BAD_OPTION)}}const my={assertOptions:t$,validators:R_},xa=my.validators;let Vc=class{constructor(t){this.defaults=t||{},this.interceptors={request:new VP,response:new VP}}async request(t,i){try{return await this._request(t,i)}catch(o){if(o instanceof Error){let h={};Error.captureStackTrace?Error.captureStackTrace(h):h=new Error;const m=h.stack?h.stack.replace(/^.+\n/,""):"";try{o.stack?m&&!String(o.stack).endsWith(m.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+m):o.stack=m}catch{}}throw o}}_request(t,i){typeof t=="string"?(i=i||{},i.url=t):i=t||{},i=Zc(this.defaults,i);const{transitional:o,paramsSerializer:h,headers:m}=i;o!==void 0&&my.assertOptions(o,{silentJSONParsing:xa.transitional(xa.boolean),forcedJSONParsing:xa.transitional(xa.boolean),clarifyTimeoutError:xa.transitional(xa.boolean)},!1),h!=null&&(Be.isFunction(h)?i.paramsSerializer={serialize:h}:my.assertOptions(h,{encode:xa.function,serialize:xa.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),my.assertOptions(i,{baseUrl:xa.spelling("baseURL"),withXsrfToken:xa.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let f=m&&Be.merge(m.common,m[i.method]);m&&Be.forEach(["delete","get","head","post","put","patch","common"],W=>{delete m[W]}),i.headers=Qi.concat(f,m);const c=[];let E=!0;this.interceptors.request.forEach(function(te){typeof te.runWhen=="function"&&te.runWhen(i)===!1||(E=E&&te.synchronous,c.unshift(te.fulfilled,te.rejected))});const C=[];this.interceptors.response.forEach(function(te){C.push(te.fulfilled,te.rejected)});let R,L=0,B;if(!E){const W=[JP.bind(this),void 0];for(W.unshift(...c),W.push(...C),B=W.length,R=Promise.resolve(i);L<B;)R=R.then(W[L++],W[L++]);return R}B=c.length;let X=i;for(;L<B;){const W=c[L++],te=c[L++];try{X=W(X)}catch(G){te.call(this,G);break}}try{R=JP.call(this,X)}catch(W){return Promise.reject(W)}for(L=0,B=C.length;L<B;)R=R.then(C[L++],C[L++]);return R}getUri(t){t=Zc(this.defaults,t);const i=XM(t.baseURL,t.url,t.allowAbsoluteUrls);return qM(i,t.params,t.paramsSerializer)}};Be.forEach(["delete","get","head","options"],function(t){Vc.prototype[t]=function(i,o){return this.request(Zc(o||{},{method:t,url:i,data:(o||{}).data}))}});Be.forEach(["post","put","patch"],function(t){function i(o){return function(m,f,c){return this.request(Zc(c||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:m,data:f}))}}Vc.prototype[t]=i(),Vc.prototype[t+"Form"]=i(!0)});let n$=class tR{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(m){i=m});const o=this;this.promise.then(h=>{if(!o._listeners)return;let m=o._listeners.length;for(;m-- >0;)o._listeners[m](h);o._listeners=null}),this.promise.then=h=>{let m;const f=new Promise(c=>{o.subscribe(c),m=c}).then(h);return f.cancel=function(){o.unsubscribe(m)},f},t(function(m,f,c){o.reason||(o.reason=new od(m,f,c),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const t=new AbortController,i=o=>{t.abort(o)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new tR(function(h){t=h}),cancel:t}}};function r$(e){return function(i){return e.apply(null,i)}}function i$(e){return Be.isObject(e)&&e.isAxiosError===!0}const Rb={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Rb).forEach(([e,t])=>{Rb[t]=e});function nR(e){const t=new Vc(e),i=DM(Vc.prototype.request,t);return Be.extend(i,Vc.prototype,t,{allOwnKeys:!0}),Be.extend(i,t,null,{allOwnKeys:!0}),i.create=function(h){return nR(Zc(e,h))},i}const Er=nR(Wf);Er.Axios=Vc;Er.CanceledError=od;Er.CancelToken=n$;Er.isCancel=HM;Er.VERSION=eR;Er.toFormData=M_;Er.AxiosError=Xt;Er.Cancel=Er.CanceledError;Er.all=function(t){return Promise.all(t)};Er.spread=r$;Er.isAxiosError=i$;Er.mergeConfig=Zc;Er.AxiosHeaders=Qi;Er.formToJSON=e=>ZM(Be.isHTMLForm(e)?new FormData(e):e);Er.getAdapter=QM.getAdapter;Er.HttpStatusCode=Rb;Er.default=Er;const{Axios:B8,AxiosError:V8,CanceledError:U8,isCancel:$8,CancelToken:G8,VERSION:q8,all:W8,Cancel:Z8,isAxiosError:H8,spread:K8,toFormData:X8,AxiosHeaders:Y8,HttpStatusCode:J8,formToJSON:Q8,getAdapter:eG,mergeConfig:tG}=Er,Pn=Er.create({baseURL:"http://localhost:3000"});Pn.interceptors.request.use(async e=>{var o;const{data:t}=await zt.auth.getSession(),i=(o=t==null?void 0:t.session)==null?void 0:o.access_token;return i&&(e.headers.Authorization=`Bearer ${i}`),e});const s$=e=>Pn.post("/deploy-agent",e),a$=()=>Pn.get("/dashboard-stats"),rR=()=>Pn.get("/leads"),iR=()=>Pn.get("/admin/leads"),o$=(e,t)=>Pn.post("/leads/update-status",{leadId:e,status:t}),l$=()=>Pn.get("/messages"),sR=e=>Pn.post("/create-checkout-session",e),c$=()=>Pn.post("/create-portal-session"),u$=e=>Pn.post("/create-topup-session",e),Qy=()=>Pn.get("/subscription-status"),eC=e=>Pn.post("/verify-checkout-session",{sessionId:e}),tC=()=>Pn.get("/admin/audit-logs"),nC=()=>Pn.post("/admin/auto-grant"),tx=()=>Pn.get("/admin/metrics"),rC=()=>Pn.get("/admin/health"),h$=()=>Pn.post("/admin/sync-stripe"),iC=(e=14)=>Pn.get("/admin/timeseries",{params:{days:e}}),d$=e=>Pn.post("/admin/create-client",e),p$=()=>Pn.post("/consent"),aR=()=>Pn.get("/usage/status"),f$=e=>Pn.post("/send-sms",e),m$=e=>Pn.post("/tracking/create",e),oR=e=>Pn.get(`/tracking/session/${e}`),lR=e=>Pn.get(`/tracking/points/${e}`),g$=e=>Pn.post("/tracking/update",e),y$=()=>Pn.get("/admin/sellers"),_$=e=>Pn.get(`/admin/sellers/${e}/dossier`),v$=(e,t)=>Pn.post(`/admin/commissions/${e}/approve`,t);function x$(){const e=qr(),[t,i]=Ue.useState(""),[o,h]=Ue.useState(""),[m,f]=Ue.useState("login"),[c,E]=Ue.useState(!1),[C,R]=Ue.useState(""),[L,B]=Ue.useState(""),[X,W]=Ue.useState(!0);Ue.useEffect(()=>{let J=!0;return(async()=>{var le;const{data:Q}=await zt.auth.getSession();if(J&&(Q!=null&&Q.session)){if(!window.sessionStorage.getItem("kryonex_session_ok")){await zt.auth.signOut(),W(!1);return}try{if((le=(await nC()).data)!=null&&le.ok){window.localStorage.setItem("kryonex_admin_mode","admin"),e("/admin");return}}catch{}const{data:ve}=await zt.from("profiles").select("role").eq("user_id",Q.session.user.id).maybeSingle();if((ve==null?void 0:ve.role)==="admin"){window.localStorage.setItem("kryonex_admin_mode","admin"),e("/admin");return}if((ve==null?void 0:ve.role)==="seller"){e("/console/dialer");return}window.localStorage.setItem("kryonex_admin_mode","user"),e("/wizard")}J&&W(!1)})(),()=>{J=!1}},[e]);const te=async J=>{var ve,Ee,_e,we;J.preventDefault(),R(""),B(""),E(!0);const H=m==="signup"?await zt.auth.signUp({email:t,password:o,options:{emailRedirectTo:`${window.location.origin}/login`}}):await zt.auth.signInWithPassword({email:t,password:o});if(E(!1),H.error){const Ge=H.error.message||"Authentication failed";m==="signup"&&/already registered|already in use|user already/i.test(Ge)?(B("Account exists. Switch to Sign In."),f("login")):m==="login"&&/invalid login/i.test(Ge)?R("Invalid credentials. Use Forgot Password or Sign Up."):R(Ge);return}if(m==="signup"&&!((ve=H.data)!=null&&ve.session)){B("Check your email to confirm your account, then log in.");return}window.sessionStorage.setItem("kryonex_session_ok","1");try{if((Ee=(await nC()).data)!=null&&Ee.ok){window.localStorage.setItem("kryonex_admin_mode","admin"),e("/admin");return}}catch{}const{data:Q}=await zt.auth.getSession(),{data:le}=await zt.from("profiles").select("role").eq("user_id",(we=(_e=Q==null?void 0:Q.session)==null?void 0:_e.user)==null?void 0:we.id).maybeSingle();if((le==null?void 0:le.role)==="admin"){window.localStorage.setItem("kryonex_admin_mode","admin"),e("/admin");return}if((le==null?void 0:le.role)==="seller"){e("/console/dialer");return}window.localStorage.setItem("kryonex_admin_mode","user"),e("/wizard")},G=async()=>{if(!t){R("Enter your email first.");return}R(""),B(""),E(!0);const{error:J}=await zt.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/login`});if(E(!1),J){R(J.message);return}B("Password reset email sent.")};return S.jsxs("div",{style:{minHeight:"100vh",position:"relative"},children:[S.jsx(T_,{}),S.jsxs("div",{style:{position:"relative",zIndex:1,maxWidth:"420px",margin:"0 auto",padding:"7rem 1.5rem"},children:[X?S.jsx("div",{className:"glass",style:{padding:"2rem",textAlign:"center",letterSpacing:"0.2rem",color:"#8b5cf6"},children:"AUTHORIZING..."}):S.jsx(Ft.h2,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6},style:{letterSpacing:"0.2rem",marginBottom:"2rem",textAlign:"center"},children:m==="signup"?"NEW USER SYNTHESIS":"BIO-METRIC SECURITY GATE"}),!X&&S.jsxs("form",{className:"glass",style:{padding:"2.5rem"},onSubmit:te,children:[S.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.6rem",marginBottom:"1.5rem"},children:[S.jsx("button",{type:"button",onClick:()=>f("login"),style:{padding:"0.6rem",borderRadius:"999px",border:"1px solid rgba(255,255,255,0.2)",background:m==="login"?"rgba(34,211,238,0.2)":"transparent",color:m==="login"?"#22d3ee":"#9ca3af",fontWeight:600},children:"Sign In"}),S.jsx("button",{type:"button",onClick:()=>f("signup"),style:{padding:"0.6rem",borderRadius:"999px",border:"1px solid rgba(255,255,255,0.2)",background:m==="signup"?"rgba(34,211,238,0.2)":"transparent",color:m==="signup"?"#22d3ee":"#9ca3af",fontWeight:600},children:"Create"})]}),S.jsxs("label",{style:{display:"block",marginBottom:"1.5rem"},children:[S.jsx("span",{style:{color:"#9ca3af"},children:"Email"}),S.jsx("input",{className:"input-field",type:"email",required:!0,value:t,onChange:J=>i(J.target.value)})]}),S.jsxs("label",{style:{display:"block",marginBottom:"1.5rem"},children:[S.jsx("span",{style:{color:"#9ca3af"},children:"Access Key"}),S.jsx("input",{className:"input-field",type:"password",required:!0,value:o,onChange:J=>h(J.target.value)})]}),C?S.jsx("div",{style:{color:"#f87171",marginBottom:"1rem"},children:C}):null,L?S.jsx("div",{style:{color:"#10b981",marginBottom:"1rem"},children:L}):null,S.jsx(Ft.button,{type:"submit",disabled:c,style:{width:"100%",padding:"0.9rem",borderRadius:"999px",border:"none",background:"linear-gradient(90deg, rgba(16,185,129,1) 0%, rgba(5,5,5,1) 100%)",color:"#e5e7eb",fontWeight:600,letterSpacing:"0.15rem"},whileHover:{scale:1.02},whileTap:{scale:.98},children:c?"VERIFYING...":m==="signup"?"AUTHORIZE PROFILE":"IDENTIFY USER"}),m==="login"?S.jsx("div",{style:{marginTop:"0.9rem",textAlign:"center"},children:S.jsx("button",{type:"button",onClick:G,style:{background:"transparent",border:"none",color:"#8b5cf6",letterSpacing:"0.08rem",cursor:"pointer"},children:"Forgot Password"})}):null]})]})]})}/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b$=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cR=(...e)=>e.filter((t,i,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var w$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S$=ze.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:h="",children:m,iconNode:f,...c},E)=>ze.createElement("svg",{ref:E,...w$,width:t,height:t,stroke:e,strokeWidth:o?Number(i)*24/Number(t):i,className:cR("lucide",h),...c},[...f.map(([C,R])=>ze.createElement(C,R)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=(e,t)=>{const i=ze.forwardRef(({className:o,...h},m)=>ze.createElement(S$,{ref:m,iconNode:t,className:cR(`lucide-${b$(e)}`,o),...h}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T$=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],E$=Qr("Building2",T$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P$=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],C$=Qr("Calendar",P$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k$=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],uR=Qr("Clock",k$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A$=[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]],I$=Qr("Cpu",A$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M$=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],e_=Qr("CreditCard",M$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R$=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],D$=Qr("DollarSign",R$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j$=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],N$=Qr("Droplet",j$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L$=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],sC=Qr("Mic",L$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z$=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],O$=Qr("Play",z$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F$=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],B$=Qr("Settings",F$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V$=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],S1=Qr("ShieldCheck",V$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U$=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],$$=Qr("Signal",U$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G$=[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]],gy=Qr("Terminal",G$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q$=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],W$=Qr("TrendingUp",q$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],H$=Qr("UserCheck",Z$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],X$=Qr("Users",K$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y$=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],aC=Qr("Wrench",Y$);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J$=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],oC=Qr("Zap",J$);function Q$({align:e="right",onModeChange:t}){const i=qr(),[o,h]=Ue.useState(!1),[m,f]=Ue.useState(window.localStorage.getItem("kryonex_admin_mode")||"user");if(Ue.useEffect(()=>{let E=!0;return(async()=>{var X;const{data:R}=await zt.auth.getSession(),L=(X=R==null?void 0:R.session)==null?void 0:X.user;if(!L)return;const{data:B}=await zt.from("profiles").select("role").eq("user_id",L.id).maybeSingle();E&&h((B==null?void 0:B.role)==="admin")})(),()=>{E=!1}},[]),!o)return null;const c=E=>{window.localStorage.setItem("kryonex_admin_mode",E),f(E),t&&t(E)};return S.jsxs("div",{style:{display:"flex",gap:"0.6rem",justifyContent:e==="right"?"flex-end":"flex-start",flexWrap:"wrap"},children:[S.jsx("button",{className:"button-primary",onClick:()=>{c("admin"),i("/admin")},children:"ADMIN COMMAND"}),S.jsx("button",{className:"button-primary",onClick:()=>{c("user"),i("/dashboard")},children:"USER VIEW"}),S.jsxs("div",{style:{color:"#9ca3af",alignSelf:"center"},children:["Mode: ",S.jsx("span",{style:{color:"#22d3ee"},children:m.toUpperCase()})]})]})}function xs(){const e=Xc(),t=qr(),[i,o]=Ue.useState(!1),[h,m]=Ue.useState(!1),[f,c]=Ue.useState(!1),[E,C]=Ue.useState(""),[R,L]=Ue.useState(!1),[B,X]=Ue.useState({status:"unknown",plan_type:null}),[W,te]=Ue.useState(()=>window.localStorage.getItem("kryonex_admin_mode")||"user");Ue.useEffect(()=>{let le=!0;return(async()=>{var Je;const{data:Ee}=await zt.auth.getSession(),_e=(Je=Ee==null?void 0:Ee.session)==null?void 0:Je.user;if(!_e)return;const{data:we}=await zt.from("profiles").select("role, business_name, industry").eq("user_id",_e.id).maybeSingle(),Ge=await Qy();le&&(m((we==null?void 0:we.role)==="admin"),c((we==null?void 0:we.role)==="seller"),C(_e.email||""),L(!!(we!=null&&we.business_name)&&!!(we!=null&&we.industry)),X(Ge.data||{status:"unknown",plan_type:null}))})(),()=>{le=!1}},[]);const G=async()=>{await zt.auth.signOut(),window.sessionStorage.removeItem("kryonex_session_ok"),o(!1),t("/login",{replace:!0})},J=[{to:"/dashboard",label:"Dashboard"}];f&&J.push({to:"/console/dialer",label:"Sales Console"}),R||J.push({to:"/wizard",label:"Wizard"}),J.push({to:"/billing",label:"Billing"}),h&&J.push({to:"/admin",label:"Admin"});const H=h&&W==="admin"?"ADMIN VIEW":f?"AGENT VIEW":"USER VIEW",Q=h&&W==="admin"?"view-admin":f?"view-agent":"view-user";return S.jsxs(S.Fragment,{children:[S.jsx("div",{className:`top-menu-view-badge ${Q}`,children:H}),S.jsxs("div",{className:"top-menu",children:[S.jsxs("button",{className:"top-menu-button",onClick:()=>o(le=>!le),type:"button",children:[S.jsx("span",{children:"MENU"}),S.jsx("span",{className:`status-dot status-${String(B.status||"").toLowerCase().replace("_","-")}`})]}),i?S.jsxs("div",{className:"top-menu-panel",children:[S.jsxs("div",{className:"top-menu-header",children:[S.jsx("div",{className:"top-menu-title",children:"Kryonex Control"}),E?S.jsx("div",{className:"top-menu-email",children:E}):null]}),S.jsx("div",{className:"top-menu-links",children:J.map(le=>S.jsx(Ja,{to:le.to,className:`top-menu-item${e.pathname===le.to?" is-active":""}`,onClick:()=>o(!1),children:le.label},le.to))}),S.jsxs("div",{className:"top-menu-status",children:[S.jsx("div",{className:"top-menu-status-label",children:"Billing"}),S.jsx("div",{className:`status-pill status-${String(B.status||"").toLowerCase().replace("_","-")}`,children:B.plan_type?`${B.plan_type}  ${B.status}`:B.status})]}),S.jsx("div",{className:"top-menu-section",children:S.jsx(Q$,{align:"left",onModeChange:le=>te(le)})}),S.jsx("button",{className:"top-menu-logout",type:"button",onClick:G,children:"Log Out"})]}):null]})]})}function al({value:e,onChange:t}){return S.jsxs("select",{value:e,onChange:t,className:"bg-black/40 border border-white/10 text-white rounded-lg px-3 py-2 text-sm focus:border-neon-cyan focus:outline-none transition-colors cursor-pointer hover:bg-white/5",children:[S.jsx("option",{children:"06:00 AM"}),S.jsx("option",{children:"07:00 AM"}),S.jsx("option",{children:"08:00 AM"}),S.jsx("option",{children:"09:00 AM"}),S.jsx("option",{children:"10:00 AM"}),S.jsx("option",{children:"11:00 AM"}),S.jsx("option",{children:"12:00 PM"}),S.jsx("option",{children:"01:00 PM"}),S.jsx("option",{children:"02:00 PM"}),S.jsx("option",{children:"03:00 PM"}),S.jsx("option",{children:"04:00 PM"}),S.jsx("option",{children:"05:00 PM"}),S.jsx("option",{children:"06:00 PM"}),S.jsx("option",{children:"07:00 PM"}),S.jsx("option",{children:"08:00 PM"})]})}const hR=[{id:"hvac",label:"HVAC",protocol:"HVAC Protocol",title:"Thermal Control Agent",description:'Specialized in furnaces, AC units, and emergency climate control. Uses "Comfort First" logic.',accent:"cyan"},{id:"plumbing",label:"Plumbing",protocol:"Plumbing Protocol",title:"Hydro-Static Agent",description:'Specialized in leaks, clogs, and water heaters. Uses "Damage Control" priority logic.',accent:"purple"}],Db=["Calm & Professional","Warm & Friendly","Executive & Direct"],lC=[{title:"Identity",description:"Define the business signature.",icon:E$},{title:"Intelligence",description:"Choose the AI persona & Tone.",icon:I$},{title:"Logistics",description:"Time protocols & Service Rates.",icon:uR},{title:"Activation",description:"Authorize the deployment.",icon:e_},{title:"Handshake",description:"Sync with Kryonex core.",icon:S1},{title:"Success",description:"Receptionist is online.",icon:gy}],dh={initial:{opacity:0,y:24,scale:.95},animate:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,y:-24,scale:.95,transition:{duration:.3,ease:"easeIn"}}},e8={nameInput:"",areaCodeInput:"",industryInput:"",toneInput:"Calm & Professional",weekdayOpen:"08:00 AM",weekdayClose:"05:00 PM",weekendEnabled:!1,saturdayOpen:"09:00 AM",saturdayClose:"02:00 PM",emergency247:!1,standardFee:"89",emergencyFee:"189",transferNumber:"",paymentId:"",cardName:"",cardNumber:"",cardExpiry:"",cardCvc:""},t8=["Securing uplink...","Injecting personality matrix...","Compiling schedule logic...","Setting price parameters...","Generating omnichannel voiceprint...","Calibrating latency shields...","Provisioning AI Receptionist..."];function n8(){const[e,t]=ze.useState(()=>{const tt=Number(window.localStorage.getItem("kryonex_wizard_step"));return Number.isFinite(tt)&&tt>=1&&tt<=6?tt:1}),i=qr(),[o,h]=ze.useState(e8),[m,f]=ze.useState(!1),[c,E]=ze.useState(""),[C,R]=ze.useState(""),[L,B]=ze.useState(!1),[X,W]=ze.useState(""),[te,G]=ze.useState(!1),[J,H]=ze.useState(""),[Q,le]=ze.useState(!1),[ve,Ee]=ze.useState(!1),[_e,we]=ze.useState(""),[Ge,Je]=ze.useState(!1),[ft,At]=ze.useState("pro"),[kt,gt]=ze.useState(!1),[We,wt]=ze.useState(!1),[bt,Ye]=ze.useState(""),[Pe]=Dw(),at=Pe.get("core")==="1"||window.localStorage.getItem("kryonex_core_offer")==="1",mt=ze.useRef({ctx:null,lastToneAt:0}),Pt=lC[e-1],sn=Pt.icon,an=o.areaCodeInput.length===3,tn=o.nameInput.trim().length>0&&an&&ve,fn=o.industryInput.length>0,Yn=o.standardFee.length>0&&o.emergencyFee.length>0,vr=Q,wn=(tt,Ut)=>{h(Dt=>({...Dt,[tt]:Ut}))},Nr=()=>{const tt=Date.now();if(tt-mt.current.lastToneAt<45)return;mt.current.lastToneAt=tt,mt.current.ctx||(mt.current.ctx=new(window.AudioContext||window.webkitAudioContext));const Ut=mt.current.ctx,Dt=Ut.createOscillator(),Wt=Ut.createGain();Dt.type="triangle",Dt.frequency.value=520,Wt.gain.value=.015,Dt.connect(Wt),Wt.connect(Ut.destination),Dt.start(),Dt.stop(Ut.currentTime+.05)},Ca=tt=>{const Ut=tt.target.value.replace(/\D/g,"").slice(0,3);wn("areaCodeInput",Ut),Nr()},ki=async tt=>{var Ut,Dt,Wt;if(we(""),!tt){Ee(!1);return}try{(Ut=(await p$()).data)!=null&&Ut.ok&&Ee(!0)}catch(Ct){we(((Wt=(Dt=Ct.response)==null?void 0:Dt.data)==null?void 0:Wt.error)||"Consent failed"),Ee(!1)}},zs=async tt=>{var Ct;W(""),B(!0);const{data:Ut}=await zt.auth.getSession(),Dt=(Ct=Ut==null?void 0:Ut.session)==null?void 0:Ct.user;if(!Dt)return B(!1),W("Session expired. Please log in again."),!1;const{error:Wt}=await zt.from("profiles").upsert({user_id:Dt.id,...tt});return B(!1),Wt?(W(Wt.message),!1):!0};ze.useEffect(()=>{const tt=Pe.get("success"),Ut=Pe.get("canceled"),Dt=Pe.get("session_id");if(Ut&&(H("Checkout canceled. Please retry."),localStorage.removeItem("kryonex_pending_checkout_session")),tt&&Dt)eC(Dt).then(Wt=>{wn("paymentId",Dt),le(!0),e<5&&t(5),H(""),localStorage.removeItem("kryonex_pending_checkout_session"),i("/dashboard",{replace:!0})}).catch(Wt=>{var Ct,Lr;H(((Lr=(Ct=Wt.response)==null?void 0:Ct.data)==null?void 0:Lr.error)||"Payment verification failed."),le(!1)});else if(!tt&&!Dt){const Wt=localStorage.getItem("kryonex_pending_checkout_session");Wt&&eC(Wt).then(()=>{wn("paymentId",Wt),le(!0),e<5&&t(5),H(""),localStorage.removeItem("kryonex_pending_checkout_session"),i("/dashboard",{replace:!0})}).catch(()=>{})}},[Pe,e,i]),ze.useEffect(()=>{window.localStorage.setItem("kryonex_wizard_step",String(e))},[e]),ze.useEffect(()=>{let tt=!0;return(async()=>{var Dt,Wt;try{const Ct=await Qy(),Lr=(Dt=Ct==null?void 0:Ct.data)==null?void 0:Dt.status,ei=(Wt=Ct==null?void 0:Ct.data)==null?void 0:Wt.current_period_end,Mn=["active","trialing"].includes(String(Lr||"").toLowerCase()),Ce=ei?new Date(ei).getTime()>Date.now():!0;tt&&Mn&&Ce&&(le(!0),H(""),Pe.get("new")==="1"?t(Z=>Z<4?4:Z):i("/dashboard",{replace:!0}))}catch{}})(),()=>{tt=!1}},[i,Pe]),ze.useEffect(()=>{let tt=!0;return(async()=>{var Lr;const{data:Dt}=await zt.auth.getSession(),Wt=(Lr=Dt==null?void 0:Dt.session)==null?void 0:Lr.user;if(!Wt)return;const{data:Ct}=await zt.from("profiles").select("consent_accepted_at, consent_version, role").eq("user_id",Wt.id).maybeSingle();tt&&(Ct!=null&&Ct.consent_accepted_at)&&Ee(!0),tt&&(Ct==null?void 0:Ct.role)==="admin"&&Je(!0)})(),()=>{tt=!1}},[]),ze.useEffect(()=>{let tt=!0;return(async()=>{var K,Z;const{data:Dt}=await zt.auth.getSession(),Wt=(K=Dt==null?void 0:Dt.session)==null?void 0:K.user;if(!Wt)return;const{data:Ct}=await zt.from("profiles").select("business_name, industry, role").eq("user_id",Wt.id).maybeSingle();if(!(!!(Ct!=null&&Ct.business_name)&&!!(Ct!=null&&Ct.industry))){tt&&(wt(!1),Ye(""));return}if((Ct==null?void 0:Ct.role)==="admin"){tt&&(wt(!1),Ye(""));return}const ei=await Qy(),Mn=String(((Z=ei==null?void 0:ei.data)==null?void 0:Z.plan_type)||"").toLowerCase(),Ce=Mn.includes("elite")||Mn.includes("white")||Mn.includes("glove");tt&&(wt(!Ce),Ye(Ce?"":"New agent creation is available on Elite/White-Glove plans only."))})(),()=>{tt=!1}},[]);const ir=()=>{let tt=`Standard operating hours are Monday through Friday, ${o.weekdayOpen} to ${o.weekdayClose}.`;return o.weekendEnabled?tt+=` We are also open Weekends from ${o.saturdayOpen} to ${o.saturdayClose}.`:tt+=" We are closed on weekends.",o.emergency247?tt+=" CRITICAL: We offer 24/7 Emergency Dispatch for urgent issues outside these hours.":tt+=" We do NOT offer after-hours service. If they call late, ask them to call back in the morning.",tt},mi=ze.useMemo(()=>({business_name:o.nameInput,industry:o.industryInput,area_code:o.areaCodeInput,payment_id:o.paymentId,plan_tier:ft,agent_tone:o.toneInput,schedule_summary:ir(),standard_fee:o.standardFee,emergency_fee:o.emergencyFee,transfer_number:o.transferNumber}),[o,ft]),Fi=async()=>{var tt;E(""),f(!0);try{const Ut=await s$({businessName:o.nameInput,industry:o.industryInput,areaCode:o.areaCodeInput,tone:o.toneInput,scheduleSummary:ir(),standardFee:o.standardFee,emergencyFee:o.emergencyFee,paymentId:o.paymentId,transferNumber:o.transferNumber,planTier:ft});R(((tt=Ut==null?void 0:Ut.data)==null?void 0:tt.phone_number)||""),t(6)}catch{E("Deployment failed. Neural uplink refused.")}finally{f(!1)}},In=async()=>{var tt,Ut,Dt,Wt;H(""),G(!0);try{const Ct=ft||"pro",Lr=`${window.location.origin}/wizard?success=true&session_id={CHECKOUT_SESSION_ID}`,ei=`${window.location.origin}/wizard?canceled=true`,Mn=await sR({planTier:Ct,successUrl:Lr,cancelUrl:ei});(tt=Mn.data)!=null&&tt.sessionId&&localStorage.setItem("kryonex_pending_checkout_session",Mn.data.sessionId),(Ut=Mn.data)!=null&&Ut.url&&(window.location.href=Mn.data.url)}catch(Ct){H(((Wt=(Dt=Ct.response)==null?void 0:Dt.data)==null?void 0:Wt.error)||Ct.message)}finally{G(!1)}};return We?S.jsxs("div",{className:"min-h-screen bg-void-black text-white relative overflow-hidden font-sans selection:bg-neon-cyan/30",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsx("div",{className:"relative z-10 mx-auto flex min-h-screen max-w-4xl flex-col px-6 py-16",children:S.jsxs("div",{className:"glass-panel rounded-3xl p-8 border border-white/10",children:[S.jsx("div",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Access Locked"}),S.jsx("h1",{className:"mt-4 text-3xl font-semibold",children:"Wizard Restricted"}),S.jsx("p",{className:"mt-3 text-white/60",children:bt||"This wizard is reserved for Elite/White-Glove accounts."}),S.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[S.jsx("button",{className:"glow-button",onClick:()=>i("/billing"),children:"Upgrade Plan"}),S.jsx("a",{className:"button-primary",href:"mailto:support@kryonextech.com?subject=New%20Agent%20Request",children:"Contact Support"}),S.jsx("button",{className:"button-primary",onClick:()=>i("/dashboard"),children:"Back to Dashboard"})]})]})})]}):S.jsxs("div",{className:"min-h-screen bg-void-black text-white relative overflow-hidden font-sans selection:bg-neon-cyan/30",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40",style:{backgroundSize:"48px 48px"}}),S.jsx("div",{className:"absolute -top-28 -right-28 h-72 w-72 rounded-full bg-neon-purple/20 blur-[120px]"}),S.jsx("div",{className:"absolute bottom-0 left-0 h-96 w-96 rounded-full bg-neon-cyan/10 blur-[140px]"}),S.jsxs("div",{className:"relative z-10 mx-auto flex min-h-screen max-w-6xl flex-col px-6 py-10",children:[S.jsxs("header",{className:"mb-10 flex flex-wrap items-center justify-between gap-6",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-neon-cyan/70",children:"Kryonex Deployment Wizard v3.0"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold sm:text-5xl tracking-tight",children:"Launch Intelligence."}),S.jsx("p",{className:"mt-3 max-w-xl text-base text-white/60",children:"Orchestrate identity, intelligence, and logistics with cinematic precision."})]}),S.jsx("div",{className:"glass-panel rounded-2xl px-5 py-4 border border-white/5 bg-white/5 backdrop-blur-md",children:S.jsxs("div",{className:"flex items-center gap-4",children:[S.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-neon-cyan/20 to-transparent text-neon-cyan shadow-glow ring-1 ring-white/10",children:S.jsx(sn,{size:24})}),S.jsxs("div",{children:[S.jsxs("p",{className:"text-xs uppercase tracking-wider text-white/50",children:["Phase ",e," of 6"]}),S.jsx("p",{className:"text-lg font-semibold tracking-wide",children:Pt.title})]})]})})]}),S.jsxs("div",{className:"glass-panel relative flex-1 rounded-[28px] p-8 sm:p-10 border border-white/10 bg-black/40 backdrop-blur-xl shadow-2xl",children:[S.jsx("div",{className:"mb-10 flex flex-wrap items-center gap-3 overflow-x-auto pb-2 scrollbar-hide",children:lC.map((tt,Ut)=>{const Dt=e===Ut+1,Wt=e>Ut+1,Ct=tt.icon;return S.jsxs("div",{className:`flex items-center gap-2 rounded-full border px-4 py-2 text-xs font-medium transition-all duration-300 ${Dt?"border-neon-cyan/50 bg-neon-cyan/10 text-neon-cyan shadow-glow scale-105":Wt?"border-neon-green/30 text-neon-green/70":"border-white/5 text-white/40"}`,children:[S.jsx(Ct,{size:14}),S.jsx("span",{children:tt.title})]},tt.title)})}),S.jsxs(EO,{mode:"wait",children:[e===1&&S.jsxs(Ft.div,{variants:dh,initial:"initial",animate:"animate",exit:"exit",className:"grid gap-12 lg:grid-cols-[1fr_1fr]",children:[S.jsxs("div",{className:"space-y-8",children:[S.jsxs("div",{children:[S.jsx("h2",{className:"text-3xl font-semibold",children:"Identity Signal"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Define the business presence that powers the AI voice."})]}),S.jsxs("div",{className:"space-y-6",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx("label",{className:"text-xs uppercase tracking-wider text-white/50",children:"Business Name"}),S.jsx("input",{className:"glass-input w-full text-lg",placeholder:"e.g. Apex Comfort Co.",value:o.nameInput,onChange:tt=>{wn("nameInput",tt.target.value),Nr()},autoFocus:!0})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx("label",{className:"text-xs uppercase tracking-wider text-white/50",children:"Area Code"}),S.jsx("input",{className:"glass-input w-full text-lg tracking-[0.5em] font-mono",placeholder:"___",value:o.areaCodeInput,onChange:Ca,maxLength:3}),S.jsx("p",{className:`text-xs ${an?"text-neon-green":"text-neon-pink"}`,children:an?" Routing Valid":"Must be 3 digits"})]}),S.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[S.jsx("div",{className:"text-xs uppercase tracking-wider text-white/50",children:"Consent Protocol"}),S.jsxs("label",{className:"mt-3 flex items-start gap-3 text-sm text-white/70",children:[S.jsx("input",{type:"checkbox",checked:ve,onChange:tt=>ki(tt.target.checked)}),S.jsx("span",{children:"I confirm I have obtained all required customer consent for calls, SMS, and recordings, and accept the Terms & Privacy Policy."})]}),_e?S.jsx("div",{className:"mt-2 text-neon-pink text-xs",children:_e}):null]}),X?S.jsx("div",{className:"text-neon-pink text-sm",children:X}):null]})]}),S.jsxs("div",{className:"glass-panel preview-glow flex flex-col justify-between rounded-3xl p-8 bg-gradient-to-b from-white/5 to-transparent border border-white/5",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/40",children:"Preview Output"}),S.jsx("h3",{className:"mt-4 text-3xl font-bold text-white preview-text",children:o.nameInput||"UNINITIALIZED"}),S.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[S.jsx("span",{className:"h-2 w-2 rounded-full bg-neon-green animate-pulse"}),S.jsxs("span",{className:"text-white/85 font-mono text-sm",children:["Targeting: (",o.areaCodeInput||"___",") Region"]})]})]}),S.jsxs("div",{className:"space-y-3 mt-10",children:[S.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/60",children:[S.jsx(S1,{className:"text-neon-green",size:16}),"Signal encryption:"," ",S.jsx("span",{className:"text-neon-green",children:"LOCKED"})]}),S.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/60",children:[S.jsx(gy,{className:"text-neon-cyan",size:16}),"Smart routing:"," ",S.jsx("span",{className:"text-neon-cyan",children:"ARMED"})]})]})]})]},"step-1"),e===2&&S.jsxs(Ft.div,{variants:dh,initial:"initial",animate:"animate",exit:"exit",className:"space-y-8",children:[S.jsxs("div",{children:[S.jsx("h2",{className:"text-3xl font-semibold",children:"Intelligence Core"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Select the neural model and personality."})]}),S.jsxs("div",{className:"mb-8 p-6 rounded-3xl border border-white/10 bg-white/5 backdrop-blur-sm relative overflow-hidden",children:[S.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5",children:S.jsx(sC,{size:80})}),S.jsxs("div",{className:"flex items-center gap-3 mb-6 relative z-10",children:[S.jsx("div",{className:"p-2 bg-neon-cyan/20 rounded-lg text-neon-cyan",children:S.jsx(sC,{size:20})}),S.jsx("h3",{className:"text-xl font-semibold text-white",children:"Voice Personality"})]}),S.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 relative z-10",children:Db.map(tt=>S.jsx("button",{type:"button",onClick:()=>wn("toneInput",tt),className:`py-4 px-4 rounded-xl border text-sm font-medium transition-all duration-300 ${o.toneInput===tt?"border-neon-cyan bg-neon-cyan/10 text-neon-cyan shadow-[0_0_15px_rgba(34,211,238,0.3)]":"border-white/10 text-white/60 hover:bg-white/10 hover:text-white"}`,children:tt},tt))})]}),S.jsx("div",{className:"grid gap-6 lg:grid-cols-2",children:hR.map(tt=>{const Ut=o.industryInput===tt.id,Dt=tt.accent==="purple"?{border:"border-neon-purple",bg:"bg-neon-purple/5",hover:"hover:border-neon-purple/50",text:"text-neon-purple",icon:"bg-neon-purple/10"}:{border:"border-neon-cyan",bg:"bg-neon-cyan/5",hover:"hover:border-neon-cyan/50",text:"text-neon-cyan",icon:"bg-neon-cyan/10"},Wt=tt.id==="plumbing"?N$:aC;return S.jsxs("button",{onClick:async()=>{wn("industryInput",tt.id),await zs({industry:tt.label})},className:`group relative overflow-hidden rounded-2xl border p-8 text-left transition-all duration-300 ${Dt.hover} ${Ut?`${Dt.border} ${Dt.bg}`:"border-white/10 bg-black/20"}`,children:[S.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity",children:S.jsx(Wt,{size:100})}),S.jsxs("div",{className:"relative z-10",children:[S.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[S.jsx("span",{className:`flex h-10 w-10 items-center justify-center rounded-lg ${Dt.icon} ${Dt.text}`,children:S.jsx(Wt,{size:20})}),S.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${Dt.text}`,children:tt.protocol})]}),S.jsx("h3",{className:"text-xl font-bold text-white",children:tt.title}),S.jsx("p",{className:"mt-2 text-sm text-white/60",children:tt.description})]})]},tt.id)})})]},"step-2"),e===3&&S.jsxs(Ft.div,{variants:dh,initial:"initial",animate:"animate",exit:"exit",className:"grid gap-12 lg:grid-cols-[1.2fr_0.8fr]",children:[S.jsxs("div",{className:"space-y-8",children:[S.jsxs("div",{children:[S.jsx("h2",{className:"text-3xl font-semibold",children:"Temporal & Financial"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Configure the AI's internal clock and availability logic."})]}),S.jsxs("div",{className:"space-y-6",children:[S.jsxs("div",{className:"p-5 rounded-2xl border border-white/10 bg-white/5",children:[S.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[S.jsx(C$,{size:18,className:"text-neon-cyan"}),S.jsx("h3",{className:"font-semibold text-white",children:"Standard Weekdays (Mon-Fri)"})]}),S.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[S.jsx(al,{value:o.weekdayOpen,onChange:tt=>wn("weekdayOpen",tt.target.value)}),S.jsx("span",{className:"text-white/40 text-xs uppercase tracking-widest",children:"TO"}),S.jsx(al,{value:o.weekdayClose,onChange:tt=>wn("weekdayClose",tt.target.value)})]})]}),S.jsxs("div",{className:`p-5 rounded-2xl border transition-colors duration-300 ${o.weekendEnabled?"border-neon-green/30 bg-neon-green/5":"border-white/10 bg-white/5"}`,children:[S.jsxs("div",{className:"flex items-center justify-between mb-4 cursor-pointer",onClick:()=>wn("weekendEnabled",!o.weekendEnabled),children:[S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx(uR,{size:18,className:o.weekendEnabled?"text-neon-green":"text-white/40"}),S.jsx("h3",{className:`font-semibold ${o.weekendEnabled?"text-white":"text-white/60"}`,children:"Weekend Operations"})]}),S.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors ${o.weekendEnabled?"bg-neon-green":"bg-white/10"}`,children:S.jsx("div",{className:`bg-white h-4 w-4 rounded-full shadow-md transform transition-transform ${o.weekendEnabled?"translate-x-6":"translate-x-0"}`})})]}),o.weekendEnabled&&S.jsxs(Ft.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"flex flex-wrap items-center gap-4 pt-2 border-t border-white/10",children:[S.jsx(al,{value:o.saturdayOpen,onChange:tt=>wn("saturdayOpen",tt.target.value)}),S.jsx("span",{className:"text-white/40 text-xs uppercase tracking-widest",children:"TO"}),S.jsx(al,{value:o.saturdayClose,onChange:tt=>wn("saturdayClose",tt.target.value)})]})]}),S.jsx("div",{className:`p-5 rounded-2xl border transition-all duration-300 cursor-pointer ${o.emergency247?"border-neon-pink bg-neon-pink/10 shadow-[0_0_20px_rgba(255,50,90,0.2)]":"border-white/10 bg-white/5"}`,onClick:()=>wn("emergency247",!o.emergency247),children:S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx(oC,{size:18,className:o.emergency247?"text-neon-pink fill-neon-pink animate-pulse":"text-white/40"}),S.jsxs("div",{children:[S.jsx("h3",{className:`font-semibold ${o.emergency247?"text-neon-pink":"text-white/60"}`,children:"Emergency Override Protocol"}),S.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Enable 24/7 Red-List dispatching."})]})]}),S.jsx("div",{className:`w-6 h-6 rounded border flex items-center justify-center transition-colors ${o.emergency247?"border-neon-pink bg-neon-pink text-black":"border-white/20"}`,children:o.emergency247&&S.jsx(aC,{size:12})})]})}),S.jsxs("div",{className:"mt-6 p-6 rounded-3xl border border-white/10 bg-white/5 backdrop-blur-sm",children:[S.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[S.jsx("div",{className:"p-2 bg-neon-green/20 rounded-lg text-neon-green",children:S.jsx(D$,{size:20})}),S.jsxs("div",{children:[S.jsx("h3",{className:"text-xl font-semibold text-white",children:"Service Economics"}),S.jsx("p",{className:"text-xs text-white/50",children:"Define the financial thresholds for the AI."})]})]}),S.jsxs("div",{className:"space-y-2 mb-6",children:[S.jsx("label",{className:"text-xs uppercase tracking-wider text-white/50",children:"Transfer Number (Human Escalation)"}),S.jsx("input",{className:"glass-input w-full font-mono text-neon-cyan",value:o.transferNumber,onChange:tt=>wn("transferNumber",tt.target.value),placeholder:"+1 800 555 0123"})]}),S.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[S.jsxs("div",{className:"space-y-2",children:[S.jsx("label",{className:"text-xs uppercase tracking-wider text-white/50",children:"Standard Dispatch"}),S.jsxs("div",{className:"relative",children:[S.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/40",children:"$"}),S.jsx("input",{className:"glass-input w-full pl-8 font-mono text-neon-cyan text-lg",value:o.standardFee,onChange:tt=>wn("standardFee",tt.target.value),placeholder:"89"})]})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx("label",{className:"text-xs uppercase tracking-wider text-white/50",children:"Emergency / After-Hours"}),S.jsxs("div",{className:"relative",children:[S.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/40",children:"$"}),S.jsx("input",{className:"glass-input w-full pl-8 font-mono text-neon-pink text-lg",value:o.emergencyFee,onChange:tt=>wn("emergencyFee",tt.target.value),placeholder:"189"})]})]})]})]})]})]}),S.jsxs("div",{className:"glass-panel p-6 rounded-3xl bg-black/40 border border-white/10 flex flex-col gap-4",children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/40",children:"Logic Preview"}),S.jsxs("div",{className:"p-4 rounded-xl bg-black/60 border border-white/5 font-mono text-xs text-neon-cyan leading-relaxed",children:[`> CHECKING_SCHEDULE...
`,`> MON-FRI: ${o.weekdayOpen} - ${o.weekdayClose}
`,`> WEEKEND: ${o.weekendEnabled?"ACTIVE":"OFFLINE"}
`,`> EMERGENCY_MODE: ${o.emergency247?"ENABLED":"DISABLED"}
`,`> TRANSFER_NUMBER: ${o.transferNumber?o.transferNumber:"NONE"}
`,`> STANDARD_FEE: $${o.standardFee}
`,`> EMERGENCY_FEE: $${o.emergencyFee}`]}),S.jsx("p",{className:"text-xs text-white/50 italic",children:"The AI will use this logic to accept or reject appointment requests."})]})]},"step-3"),e===4&&S.jsxs(Ft.div,{variants:dh,initial:"initial",animate:"animate",exit:"exit",className:"grid gap-12 lg:grid-cols-[1.1fr_0.9fr]",children:[S.jsxs("div",{className:"space-y-6",children:[S.jsxs("div",{children:[S.jsx("h2",{className:"text-3xl font-semibold",children:"Activation"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Secure the deployment uplink with Stripe checkout."})]}),Ge?S.jsxs("div",{className:"glass-panel rounded-2xl p-4 border border-white/10",children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Admin Override"}),S.jsx("div",{className:"mt-2 text-sm text-white/60",children:"Billing is optional for admin accounts. You can bypass checkout to test the full flow."}),S.jsx("button",{className:"glow-button mt-3",onClick:()=>{le(!0),wn("paymentId","admin_override")},children:"BYPASS BILLING"})]}):null,S.jsxs("div",{className:"space-y-3",children:[S.jsx("div",{className:"text-xs uppercase tracking-wider text-white/50",children:"Choose Tier"}),S.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{id:"pro",label:"PRO  $197/mo",desc:"Most popular"},{id:"elite",label:"ELITE  $397/mo",desc:"Multilocation + VIP"},...at||ft==="core"?[{id:"core",label:"CORE  $97/mo",desc:"Private access tier"}]:[]].map(tt=>S.jsxs("button",{type:"button",onClick:()=>At(tt.id),className:`rounded-2xl border px-4 py-3 text-left transition-all ${ft===tt.id?"border-neon-cyan bg-neon-cyan/10 text-neon-cyan":"border-white/10 text-white/60 hover:bg-white/5"}`,children:[S.jsx("div",{className:"text-sm font-semibold",children:tt.label}),S.jsx("div",{className:"text-xs text-white/50",children:tt.desc})]},tt.id))})]}),S.jsxs("div",{className:"space-y-4",children:[S.jsx("label",{className:"text-xs uppercase tracking-wider text-white/50",children:"Plan Selected"}),S.jsxs("div",{className:"glass-input w-full flex items-center justify-between",children:[S.jsx("span",{className:"uppercase tracking-widest text-white/70",children:ft.toUpperCase()}),S.jsx("span",{className:"font-mono text-neon-cyan",children:ft==="elite"?"$397/mo":ft==="core"?"$97/mo":"$197/mo"})]})]}),S.jsx("div",{className:"space-y-2 text-sm text-white/60",children:"Checkout is handled by Stripe in a secure window. Your card never touches our servers."}),J?S.jsx("div",{className:"text-neon-pink text-sm",children:J}):null]}),S.jsxs("div",{className:"glass-panel rounded-3xl p-8 border border-white/5 bg-gradient-to-br from-white/5 to-transparent",children:[S.jsxs("div",{className:"flex justify-between items-center mb-6",children:[S.jsx("span",{className:"text-xs uppercase tracking-[0.3em] text-white/40",children:"Secure Chamber"}),S.jsx(e_,{className:"text-neon-cyan",size:20})]}),S.jsxs("div",{className:"aspect-[1.58/1] rounded-2xl bg-gradient-to-br from-gray-900 to-black border border-white/10 p-6 relative overflow-hidden shadow-2xl",children:[S.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:S.jsx(e_,{size:100,className:"text-white"})}),S.jsxs("div",{className:"relative z-10 flex flex-col justify-between h-full",children:[S.jsx("div",{className:"text-xl font-bold italic tracking-widest text-white/20",children:"VISA"}),S.jsx("div",{className:"font-mono text-xl tracking-[0.2em] text-white/90",children:"   "}),S.jsxs("div",{className:"flex justify-between text-xs text-white/50",children:[S.jsx("span",{children:"CARDHOLDER"}),S.jsx("span",{children:"VALID THRU"})]})]})]}),S.jsx("button",{onClick:In,disabled:te,className:"glow-button mt-8 w-full group disabled:opacity-60",children:S.jsx("span",{className:"group-hover:tracking-widest transition-all duration-300",children:te?"OPENING CHECKOUT...":"OPEN STRIPE CHECKOUT"})}),o.paymentId&&S.jsxs(Ft.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-lg bg-neon-cyan/10 border border-neon-cyan/30 text-center text-neon-cyan text-sm font-mono",children:["STRIPE VERIFIED: ",o.paymentId]})]})]},"step-4"),e===5&&S.jsxs(Ft.div,{variants:dh,initial:"initial",animate:"animate",exit:"exit",className:"grid gap-12 lg:grid-cols-[1.1fr_0.9fr]",children:[S.jsxs("div",{className:"space-y-6",children:[S.jsxs("div",{children:[S.jsx("h2",{className:"text-3xl font-semibold",children:"Handshake Protocol"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Final review before neural injection."})]}),S.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-6 space-y-4",children:[S.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/5",children:[S.jsx("span",{className:"text-white/50 text-sm",children:"Target Identity"}),S.jsx("span",{className:"text-white font-medium",children:o.nameInput})]}),S.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/5",children:[S.jsx("span",{className:"text-white/50 text-sm",children:"Industry Model"}),S.jsx("span",{className:"text-neon-cyan font-mono uppercase",children:o.industryInput})]}),S.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/5",children:[S.jsx("span",{className:"text-white/50 text-sm",children:"Voice Personality"}),S.jsx("span",{className:"text-white font-mono",children:o.toneInput})]}),S.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/5",children:[S.jsx("span",{className:"text-white/50 text-sm",children:"Service Rates"}),S.jsxs("span",{className:"text-white font-mono",children:["$",o.standardFee," / $",o.emergencyFee]})]}),S.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-white/5",children:[S.jsx("span",{className:"text-white/50 text-sm",children:"Region Routing"}),S.jsxs("span",{className:"text-white font-mono",children:["(",o.areaCodeInput,")"]})]}),S.jsxs("div",{className:"flex justify-between items-center py-2",children:[S.jsx("span",{className:"text-white/50 text-sm",children:"Payment Token"}),S.jsx("span",{className:"text-neon-green font-mono",children:o.paymentId})]})]}),c&&S.jsxs("div",{className:"p-4 rounded-xl bg-neon-pink/10 border border-neon-pink/50 text-neon-pink text-sm flex items-center gap-2",children:[S.jsx(oC,{size:16})," ",c]})]}),S.jsxs("div",{className:"glass-panel rounded-3xl p-8 border border-white/5",children:[S.jsxs("div",{className:"flex justify-between items-center mb-4",children:[S.jsx("span",{className:"text-xs uppercase tracking-[0.3em] text-white/40",children:"JSON Payload"}),S.jsx(gy,{size:16,className:"text-neon-cyan"})]}),S.jsx("div",{className:"bg-black/60 rounded-xl p-4 border border-white/10 overflow-hidden",children:S.jsx("pre",{className:"text-[10px] sm:text-xs text-neon-green/80 font-mono whitespace-pre-wrap leading-relaxed",children:JSON.stringify(mi,null,2)})}),S.jsx("button",{onClick:()=>gt(!0),disabled:m,className:"glow-button mt-6 w-full py-4 text-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:m?"ESTABLISHING UPLINK...":"DEPLOY RECEPTIONIST"}),m&&S.jsx("div",{className:"mt-6 space-y-1 font-mono text-xs text-neon-cyan/70",children:t8.map((tt,Ut)=>S.jsx(Ft.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:Ut*.5},children:`> ${tt}`},tt))})]})]},"step-5"),e===6&&S.jsxs(Ft.div,{variants:dh,initial:"initial",animate:"animate",exit:"exit",className:"flex min-h-[500px] flex-col items-center justify-center text-center",children:[S.jsx(Ft.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200},className:"mb-8 p-6 rounded-full bg-neon-green/10 border border-neon-green/50 shadow-[0_0_50px_rgba(34,243,164,0.3)]",children:S.jsx(gy,{size:64,className:"text-neon-green"})}),S.jsx("p",{className:"text-sm uppercase tracking-[0.6em] text-neon-green",children:"System Online"}),S.jsx("h2",{className:"mt-4 text-6xl font-bold text-white drop-shadow-[0_0_25px_rgba(255,255,255,0.5)]",children:"DEPLOYED"}),S.jsx("p",{className:"mt-6 text-xl text-white/60 max-w-lg mx-auto",children:"Neural handshake complete. Your AI Receptionist is listening on the network."}),S.jsxs("div",{className:"mt-12 group relative",children:[S.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-neon-green to-neon-cyan rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"}),S.jsx("div",{className:"relative px-12 py-6 bg-black rounded-xl leading-none flex items-center",children:S.jsx("span",{className:"text-4xl font-mono text-neon-green font-bold tracking-widest",children:C||"+1 (800) 555-0199"})})]})]},"step-6")]})]}),e<6&&S.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-between gap-4",children:[S.jsx("button",{onClick:()=>t(tt=>Math.max(1,tt-1)),disabled:e===1||m,className:"px-6 py-3 rounded-xl border border-white/10 hover:bg-white/5 hover:border-white/30 text-white/60 disabled:opacity-30 transition-all text-sm font-medium tracking-wide uppercase",children:"Back"}),S.jsxs("div",{className:"flex items-center gap-3 text-xs text-white/40 uppercase tracking-widest",children:[S.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-neon-cyan animate-pulse"}),"Kryonex Secure Environment"]}),e===1&&S.jsx("button",{onClick:async()=>{await zs({business_name:o.nameInput})&&t(2)},disabled:!tn||L,className:"glow-button",children:L?"SAVING...":"Confirm Identity"}),e===2&&S.jsx("button",{onClick:()=>t(3),disabled:!fn||L,className:"glow-button",children:"Initialize Logic"}),e===3&&S.jsx("button",{onClick:async()=>{await zs({transfer_number:o.transferNumber||null})&&t(4)},disabled:!Yn,className:"glow-button",children:"Proceed to Pay"}),e===4&&S.jsx("button",{onClick:()=>t(5),disabled:!vr,className:"glow-button",children:"Review Payload"})]})]}),kt&&S.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"grid",placeItems:"center",zIndex:50},children:S.jsxs("div",{className:"glass-panel rounded-3xl p-6 border border-white/10",style:{maxWidth:"520px",width:"90%"},children:[S.jsx("div",{className:"text-lg font-semibold",children:"Final Confirmation"}),S.jsx("div",{className:"text-sm text-white/60 mt-2",children:"Review and confirm deployment details."}),S.jsxs("div",{className:"mt-4 text-sm text-white/70",children:[S.jsxs("div",{children:["Business: ",o.nameInput]}),S.jsxs("div",{children:["Industry: ",o.industryInput]}),S.jsxs("div",{children:["Tier: ",ft.toUpperCase()]}),S.jsxs("div",{children:["Area Code: ",o.areaCodeInput]}),S.jsxs("div",{children:["Voice: ",o.toneInput]})]}),S.jsxs("div",{className:"mt-4 flex gap-3 justify-end",children:[S.jsx("button",{className:"button-primary",onClick:()=>gt(!1),children:"Cancel"}),S.jsx("button",{className:"glow-button",onClick:()=>{gt(!1),Fi()},children:"Confirm Deploy"})]})]})})]})}function go({eligibleNewAgent:e,onUpgrade:t,onNewAgent:i,billingStatus:o,tier:h,agentLive:m,lastUpdated:f,isAdmin:c=!1,isSeller:E=!1}){const[C,R]=Ue.useState(!0),L=String(o||"none").toUpperCase(),B=h?h.toUpperCase():"NONE",X=f?f.toLocaleTimeString():"--";return S.jsxs("aside",{className:"side-nav",children:[S.jsxs("div",{className:"side-nav-header",children:[S.jsx("div",{className:"side-nav-title",children:"Kryonex"}),S.jsx("div",{className:"side-nav-sub",children:"Command Suite"})]}),S.jsx("div",{className:"side-nav-actions",children:e?S.jsx("button",{className:"side-nav-button",onClick:i,children:"Create New Agent"}):S.jsx("button",{className:"side-nav-button",onClick:t,children:"Upgrade for Multiple Agents"})}),S.jsxs("nav",{className:"side-nav-links",children:[S.jsx("div",{className:"side-nav-label",children:"Daily Sales Ops"}),!E&&S.jsx("a",{href:"#command-deck",className:"side-nav-link",children:"Command Deck"}),E?S.jsx(Ja,{to:"/console/dialer",className:"side-nav-link",children:"Call Center"}):c?S.jsx(Ja,{to:"/admin/call-center",className:"side-nav-link",children:"Call Center"}):null,S.jsx("a",{href:"#lead-grid",className:"side-nav-link",children:"Lead Grid"}),!E&&S.jsxs(S.Fragment,{children:[S.jsx("a",{href:"#black-box",className:"side-nav-link",children:"Black Box"}),S.jsx("a",{href:"#sms-log",className:"side-nav-link",children:"Messages"})]}),S.jsx(Ja,{to:"/calendar",className:"side-nav-link",children:"Calendar"}),c&&!E?S.jsxs("div",{className:"side-nav-admin-group",children:[S.jsxs("button",{type:"button",className:"side-nav-admin-toggle",onClick:()=>R(W=>!W),children:[S.jsx("span",{children:"ADMIN COMMAND"}),S.jsx("span",{children:C?"v":">"})]}),C?S.jsxs("div",{className:"side-nav-admin-links",children:[S.jsx(Ja,{to:"/admin/wizard/create",className:"side-nav-link",children:"Client Wizard"}),S.jsx(Ja,{to:"/admin/sellers",className:"side-nav-link",children:"Personnel"}),S.jsx(Ja,{to:"/admin/users",className:"side-nav-link",children:"Fleet Registry"}),S.jsx(Ja,{to:"/admin/logs",className:"side-nav-link",children:"Global Neural Logs"}),S.jsx(Ja,{to:"/admin/financials",className:"side-nav-link",children:"Revenue Telemetry"})]}):null]}):null]}),S.jsxs("div",{className:"side-nav-status",children:[S.jsx("div",{className:"side-nav-label",children:"Trust Signals"}),S.jsxs("div",{className:"side-nav-pill",children:["Agent ",m?"LIVE":"PAUSED"]}),S.jsxs("div",{className:"side-nav-pill",children:["Billing ",L]}),S.jsxs("div",{className:"side-nav-pill",children:["Tier ",B]}),S.jsxs("div",{className:"side-nav-pill",children:["Pulse ",X]})]})]})}function r8(){const e=qr(),[t,i]=Ue.useState({total_leads:0,new_leads:0,booked_leads:0,call_volume:0}),[o,h]=Ue.useState([]),[m,f]=Ue.useState([]),[c,E]=Ue.useState({status:"none",plan_type:null,current_period_end:null}),[C,R]=Ue.useState(null),[L,B]=Ue.useState({phone_number:"",is_active:!0}),[X,W]=Ue.useState(!0),[te,G]=Ue.useState(""),[J,H]=Ue.useState(""),[Q,le]=Ue.useState(""),[ve,Ee]=Ue.useState(null);Ue.useEffect(()=>{let gt=!0;const We=async(bt=!1)=>{var Ye;try{const[Pe,at,mt,Pt,sn]=await Promise.all([a$(),rR(),Qy(),aR(),l$()]);gt&&(i(Pe.data),h(at.data.leads||[]),E(mt.data||{status:"none",plan_type:null}),R(Pt.data||null),f(sn.data.messages||[]),Ee(new Date));const{data:an}=await zt.auth.getSession(),tn=(Ye=an==null?void 0:an.session)==null?void 0:Ye.user;if(tn){const{data:fn}=await zt.from("profiles").select("business_name, transfer_number").eq("user_id",tn.id).maybeSingle();gt&&fn&&(G(fn.business_name||""),H(fn.transfer_number||""));const{data:Yn}=await zt.from("agents").select("phone_number, is_active").eq("user_id",tn.id).order("created_at",{ascending:!1}).maybeSingle();gt&&Yn&&B({phone_number:Yn.phone_number||"",is_active:Yn.is_active!==!1})}}finally{gt&&bt&&W(!1)}};We(!0);const wt=setInterval(()=>We(!1),15e3);return()=>{gt=!1,clearInterval(wt)}},[]);const _e=()=>{e("/billing")},we=async()=>{var bt;le("");const{data:gt}=await zt.auth.getSession(),We=(bt=gt==null?void 0:gt.session)==null?void 0:bt.user;if(!We)return;const{error:wt}=await zt.from("profiles").update({business_name:te||null,transfer_number:J||null}).eq("user_id",We.id);if(wt){le(wt.message);return}await zt.from("agents").update({transfer_number:J||null}).eq("user_id",We.id),le("Saved.")},Ge=String(c.plan_type||"").toLowerCase(),Je=Ge.includes("elite")||Ge.includes("white")||Ge.includes("glove"),ft=gt=>gt?new Date(gt).toLocaleDateString():"N/A",At=()=>c.status==="active"||c.status==="trialing"?"status-active":c.status==="past_due"?"status-past-due":c.status==="canceled"?"status-canceled":"status-none",kt=(gt,We)=>{if(!We)return 0;const wt=We-gt;return Math.min(100,Math.max(0,Math.round(wt/We*100)))};return S.jsxs("div",{className:"war-room",children:[S.jsx(xs,{}),S.jsxs("div",{className:"dashboard-layout",children:[S.jsx(go,{eligibleNewAgent:Je,onUpgrade:_e,onNewAgent:()=>e("/wizard?new=1"),billingStatus:c.status,tier:c.plan_type,agentLive:L.is_active,lastUpdated:ve,isSeller:!0}),S.jsxs("div",{className:"war-room-shell",children:[S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"war-room-header",children:[S.jsxs("div",{children:[S.jsx("div",{className:"war-room-kicker",children:"THE WAR ROOM"}),S.jsx("div",{className:"war-room-title",children:"Kryonex Command Deck"})]}),S.jsx("div",{className:"war-room-actions",children:S.jsx("button",{className:"button-primary pulse-gold",onClick:_e,children:"MANAGE SUBSCRIPTION"})})]}),S.jsxs("div",{className:"status-bar",children:[S.jsxs("div",{className:"status-live",children:[S.jsx("span",{className:"live-dot"}),S.jsx("span",{children:"LIVE"}),S.jsx("span",{className:"live-time",children:ve?ve.toLocaleTimeString():"--"})]}),S.jsxs("div",{className:"status-pill status-active",children:["Agent ",L.is_active?"LIVE":"PAUSED"]}),S.jsxs("div",{className:`status-pill ${At()}`,children:["Billing ",c.status||"none"]}),S.jsxs("div",{className:"status-pill status-unknown",children:["Tier ",c.plan_type||"none"]}),S.jsxs("div",{className:"status-pill status-unknown",children:["Next Bill ",ft(c.current_period_end)]}),S.jsxs("div",{className:"status-pill status-unknown",children:["AI Line ",L.phone_number||"unassigned"]})]}),S.jsxs("div",{className:"command-grid",id:"command-deck",children:[S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsx("div",{className:"deck-title",children:"Business Profile"}),S.jsx("label",{className:"deck-label",children:"Business Name"}),S.jsx("input",{className:"glass-input",value:te,onChange:gt=>G(gt.target.value),placeholder:"Kryonex Operations"}),S.jsx("label",{className:"deck-label",children:"Transfer Number"}),S.jsx("input",{className:"glass-input mono",value:J,onChange:gt=>H(gt.target.value),placeholder:"+1 800 555 0123"}),S.jsx("button",{className:"glow-button deck-action",onClick:we,children:"SAVE CHANGES"}),Q?S.jsx("div",{className:"deck-status",children:Q}):null]}),S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsx("div",{className:"deck-title",children:"Agent Control"}),S.jsxs("div",{className:"deck-row",children:[S.jsx("span",{children:"AI Line"}),S.jsx("span",{className:"mono text-neon-cyan",children:L.phone_number||"unassigned"})]}),S.jsxs("div",{className:"deck-row",children:[S.jsx("span",{children:"Status"}),S.jsx("span",{className:`mono ${L.is_active?"text-neon-green":"text-neon-pink"}`,children:L.is_active?"LIVE":"PAUSED"})]}),Je?S.jsx("button",{className:"button-primary deck-action",onClick:()=>e("/wizard?new=1"),children:"NEW AGENT"}):S.jsx("button",{className:"button-primary deck-action",onClick:_e,children:"UPGRADE FOR NEW AGENT"}),S.jsx("a",{className:"button-primary deck-action",href:"mailto:support@kryonextech.com?subject=Industry%20Change%20Request",children:"REQUEST INDUSTRY CHANGE"})]}),S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsx("div",{className:"deck-title",children:"Usage Pulse"}),S.jsxs("div",{className:"deck-row",children:[S.jsx("span",{children:"Call Minutes"}),S.jsxs("span",{className:"mono",children:[(C==null?void 0:C.call_minutes_remaining)??0,"/",(C==null?void 0:C.call_minutes_total)??0]})]}),S.jsx("div",{className:"progress-bar",children:S.jsx("div",{className:"progress-fill",style:{width:`${kt((C==null?void 0:C.call_minutes_remaining)??0,(C==null?void 0:C.call_minutes_total)??0)}%`}})}),S.jsxs("div",{className:"deck-row",children:[S.jsx("span",{children:"SMS"}),S.jsxs("span",{className:"mono",children:[(C==null?void 0:C.sms_remaining)??0,"/",(C==null?void 0:C.sms_total)??0]})]}),S.jsx("div",{className:"progress-bar",children:S.jsx("div",{className:"progress-fill",style:{width:`${kt((C==null?void 0:C.sms_remaining)??0,(C==null?void 0:C.sms_total)??0)}%`}})}),S.jsxs("div",{className:"deck-row",children:[S.jsx("span",{children:"Limit State"}),S.jsx("span",{className:"mono",children:(C==null?void 0:C.limit_state)||"ok"})]})]}),S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsx("div",{className:"deck-title",children:"KPI Snapshot"}),S.jsxs("div",{className:"kpi-grid",children:[S.jsxs("div",{className:"kpi",children:[S.jsx("div",{children:"Total Leads"}),S.jsx("div",{className:"mono text-neon-green",children:t.total_leads})]}),S.jsxs("div",{className:"kpi",children:[S.jsx("div",{children:"Booked"}),S.jsx("div",{className:"mono text-neon-green",children:t.booked_leads})]}),S.jsxs("div",{className:"kpi",children:[S.jsx("div",{children:"Missed"}),S.jsx("div",{className:"mono text-neon-pink",children:Math.max(0,t.total_leads-t.booked_leads)})]}),S.jsxs("div",{className:"kpi",children:[S.jsx("div",{children:"Call Volume"}),S.jsx("div",{className:"mono text-neon-purple",children:t.call_volume})]})]})]})]}),S.jsxs("div",{className:"intel-grid",children:[S.jsxs("div",{className:"glass-panel intel-card",id:"lead-grid",children:[S.jsx("div",{className:"intel-title",children:"Lead Grid"}),S.jsx("div",{style:{overflowX:"auto"},children:S.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[S.jsx("thead",{style:{textAlign:"left",color:"#9ca3af"},children:S.jsxs("tr",{children:[S.jsx("th",{style:{paddingBottom:"0.8rem"},children:"Name"}),S.jsx("th",{style:{paddingBottom:"0.8rem"},children:"Status"}),S.jsx("th",{style:{paddingBottom:"0.8rem"},children:"Summary"}),S.jsx("th",{style:{paddingBottom:"0.8rem"},children:"Sentiment"})]})}),S.jsx("tbody",{children:X?S.jsx("tr",{children:S.jsx("td",{colSpan:"4",style:{padding:"1rem"},children:"Loading..."})}):o.length?o.map(gt=>{var We;return S.jsxs("tr",{className:"scanline-row",children:[S.jsx("td",{style:{padding:"0.8rem 0"},children:gt.name||"Unknown"}),S.jsx("td",{style:{padding:"0.8rem 0"},children:S.jsx("span",{className:`badge ${((We=gt.status)==null?void 0:We.toLowerCase())==="booked"?"badge-booked":"badge-missed"}`,children:gt.status||"MISSED"})}),S.jsx("td",{style:{padding:"0.8rem 0",color:"#9ca3af"},children:gt.summary||"No summary."}),S.jsx("td",{style:{padding:"0.8rem 0"},children:gt.sentiment})]},gt.id)}):S.jsx("tr",{children:S.jsx("td",{colSpan:"4",style:{padding:"1rem"},children:"No leads captured yet."})})})]})})]}),S.jsxs("div",{className:"glass-panel intel-card",id:"black-box",children:[S.jsx("div",{className:"intel-title",children:"Black Box"}),o.length?S.jsx("div",{className:"blackbox-list",children:o.slice(0,3).map(gt=>S.jsxs("div",{className:"blackbox-item",children:[S.jsxs("div",{className:"blackbox-head",children:[S.jsx("div",{children:gt.name||"Unknown Caller"}),S.jsx("span",{className:"mono text-neon-cyan",children:gt.status||"MISSED"})]}),S.jsx("div",{className:"blackbox-body",children:gt.transcript||gt.summary||"Transcript unavailable."}),gt.call_duration_seconds?S.jsxs("div",{className:"blackbox-meta",children:["Duration: ",Math.round(gt.call_duration_seconds/60),"m"]}):null,gt.recording_url?S.jsx("audio",{className:"blackbox-audio",controls:!0,src:gt.recording_url,children:"Your browser does not support audio playback."}):S.jsx("div",{className:"blackbox-meta",children:"Recording unavailable."})]},gt.id))}):S.jsx("div",{className:"blackbox-empty",children:"No recordings yet. Calls will appear here."})]}),S.jsxs("div",{className:"glass-panel intel-card",id:"sms-log",children:[S.jsx("div",{className:"intel-title",children:"SMS Log"}),m.length?S.jsx("div",{className:"blackbox-list",children:m.slice(0,5).map(gt=>{var We;return S.jsxs("div",{className:"blackbox-item",children:[S.jsxs("div",{className:"blackbox-head",children:[S.jsx("div",{children:(We=gt.direction)==null?void 0:We.toUpperCase()}),S.jsx("span",{className:"mono text-neon-purple",children:new Date(gt.timestamp).toLocaleString()})]}),S.jsx("div",{className:"blackbox-body",children:gt.body})]},gt.id)})}):S.jsx("div",{className:"blackbox-empty",children:"No SMS yet."})]})]}),S.jsx("div",{className:"intel-grid",id:"calendar",children:S.jsxs("div",{className:"glass-panel intel-card",children:[S.jsx("div",{className:"intel-title",children:"Calendar"}),S.jsx("div",{className:"blackbox-empty",children:"Calendar integration launches with Elite."})]})})]})]})]})}const cC=e=>new Date(e.getFullYear(),e.getMonth(),1),uC=e=>new Date(e.getFullYear(),e.getMonth()+1,0),i8=e=>String(e).padStart(2,"0");function s8(){const e=qr(),[t,i]=Ue.useState(new Date),[o,h]=Ue.useState(new Date),[m,f]=Ue.useState([]),[c,E]=Ue.useState(!0),[C,R]=Ue.useState({customer_name:"",customer_phone:"",start_date:"",start_time:"",duration_minutes:"60",location:"",notes:"",reminder_minutes:"15",reminder_enabled:!0,eta_enabled:!1,eta_minutes:"10",eta_link:""}),[L,B]=Ue.useState(""),[X,W]=Ue.useState(""),[te,G]=Ue.useState(""),[J,H]=Ue.useState("20"),[Q,le]=Ue.useState(""),[ve,Ee]=Ue.useState(""),_e=async Pe=>{var tn;E(!0);const at=cC(Pe),mt=uC(Pe),{data:Pt}=await zt.auth.getSession(),sn=(tn=Pt==null?void 0:Pt.session)==null?void 0:tn.user;if(!sn)return;const{data:an}=await zt.from("appointments").select("*").eq("user_id",sn.id).gte("start_time",at.toISOString()).lte("start_time",mt.toISOString()).order("start_time",{ascending:!0});f(an||[]),E(!1)};Ue.useEffect(()=>{_e(t)},[t]);const we=async()=>{var Nr;B("");const{data:Pe}=await zt.auth.getSession(),at=(Nr=Pe==null?void 0:Pe.session)==null?void 0:Nr.user;if(!at)return;if(!C.customer_name||!C.start_date||!C.start_time){B("Please fill customer name, date, and time.");return}const[mt,Pt,sn]=C.start_date.split("-").map(Number),[an,tn]=C.start_time.split(":").map(Number),fn=new Date(mt,Pt-1,sn,an,tn),Yn=parseInt(C.duration_minutes||"60",10),vr=new Date(fn.getTime()+Yn*6e4),{error:wn}=await zt.from("appointments").insert({user_id:at.id,customer_name:C.customer_name,customer_phone:C.customer_phone||null,start_time:fn.toISOString(),end_time:vr.toISOString(),location:C.location||null,notes:C.notes||null,reminder_minutes:parseInt(C.reminder_minutes||"0",10),reminder_enabled:!!C.reminder_enabled,eta_enabled:!!C.eta_enabled,eta_minutes:parseInt(C.eta_minutes||"10",10),eta_link:C.eta_link||null,status:"booked"});if(wn){B(wn.message);return}R({customer_name:"",customer_phone:"",start_date:"",start_time:"",duration_minutes:"60",location:"",notes:"",reminder_minutes:"15",reminder_enabled:!0,eta_enabled:!1,eta_minutes:"10",eta_link:""}),await _e(t),B("Appointment locked.")},Ge=Pe=>Pe.toISOString().slice(0,10),Je=m.filter(Pe=>{var at;return((at=Pe.start_time)==null?void 0:at.slice(0,10))===Ge(o)}),ft=()=>{cC(t);const Pe=uC(t),at=[];for(let mt=1;mt<=Pe.getDate();mt+=1)at.push(new Date(t.getFullYear(),t.getMonth(),mt));return at},At=Pe=>m.filter(at=>{var mt;return((mt=at.start_time)==null?void 0:mt.slice(0,10))===Ge(Pe)}).length,kt=async(Pe,at)=>{var mt,Pt;if(!Pe){B("Customer phone required to send SMS.");return}try{await f$({to:Pe,body:at}),B("Message sent.")}catch(sn){B(((Pt=(mt=sn.response)==null?void 0:mt.data)==null?void 0:Pt.error)||"SMS failed.")}},gt=()=>`Kryonex update: Your tech is en route. ETA ${String(J||C.eta_minutes||"20").trim()} minutes.`,We=()=>{const Pe=String(te||C.eta_link||"").trim();return Pe?`Kryonex update: Track your tech live here: ${Pe}`:"Kryonex update: Live tracking link pending."},wt=async()=>{var Pe,at,mt;if(Ee(""),!C.customer_phone){Ee("Customer phone required to generate tracking.");return}try{const sn=(Pe=(await m$({customerPhone:C.customer_phone,etaMinutes:J})).data)==null?void 0:Pe.tracking_url;le(sn||""),sn&&G(sn),Ee("Tracking link generated.")}catch(Pt){Ee(((mt=(at=Pt.response)==null?void 0:at.data)==null?void 0:mt.error)||"Tracking link failed.")}},bt=async(Pe,at)=>{var sn;const{data:mt}=await zt.auth.getSession();(sn=mt==null?void 0:mt.session)!=null&&sn.user&&(await zt.from("appointments").update(at).eq("id",Pe),await _e(t))},Ye=t.toLocaleString("default",{month:"long",year:"numeric"});return S.jsxs("div",{className:"war-room",children:[S.jsx(xs,{}),S.jsxs("div",{className:"dashboard-layout",children:[S.jsx(go,{eligibleNewAgent:!1,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"active",tier:"calendar",agentLive:!0,lastUpdated:new Date,isSeller:!0}),S.jsxs("div",{className:"war-room-shell",children:[S.jsxs("div",{className:"calendar-header",children:[S.jsxs("div",{children:[S.jsx("div",{className:"war-room-kicker",children:"SCHEDULING CORE"}),S.jsx("div",{className:"war-room-title",children:"Operations Calendar"})]}),S.jsx("div",{className:"calendar-actions",children:S.jsx("button",{className:"button-primary",onClick:()=>e("/dashboard"),children:"Back to Dashboard"})})]}),S.jsxs("div",{className:"calendar-panel glass-panel",children:[S.jsxs("div",{className:"calendar-top",children:[S.jsx("button",{className:"button-primary",onClick:()=>i(new Date(t.getFullYear(),t.getMonth()-1,1)),children:""}),S.jsx("div",{className:"calendar-month",children:Ye}),S.jsx("button",{className:"button-primary",onClick:()=>i(new Date(t.getFullYear(),t.getMonth()+1,1)),children:""})]}),S.jsx("div",{className:"calendar-grid",children:ft().map(Pe=>{const at=At(Pe),mt=Ge(Pe)===Ge(o),Pt=at>=4?"high":at>=2?"mid":at>0?"low":"none";return S.jsxs("button",{className:`calendar-day ${Pt} ${mt?"active":""}`,onClick:()=>h(Pe),children:[S.jsx("div",{children:i8(Pe.getDate())}),S.jsxs("span",{children:[at," jobs"]})]},Pe.toISOString())})})]}),S.jsxs("div",{className:"glass-panel",style:{marginTop:"1.5rem",padding:"1.5rem"},children:[S.jsx("div",{className:"war-room-kicker",children:"Customer Messaging"}),S.jsx("div",{style:{color:"#9ca3af",marginTop:"0.4rem"},children:"Send ETA or live tracking updates (optional)."}),S.jsxs("div",{style:{marginTop:"1rem",display:"grid",gap:"0.8rem"},children:[S.jsxs("label",{style:{display:"grid",gap:"0.4rem"},children:[S.jsx("span",{style:{color:"#9ca3af"},children:"ETA Minutes"}),S.jsx("input",{className:"input-field",value:J,onChange:Pe=>H(Pe.target.value),placeholder:"20"})]}),S.jsxs("label",{style:{display:"grid",gap:"0.4rem"},children:[S.jsx("span",{style:{color:"#9ca3af"},children:"Live Tracking Link"}),S.jsx("input",{className:"input-field",value:te,onChange:Pe=>G(Pe.target.value),placeholder:"https://tracking.yourdomain.com/..."})]}),S.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.6rem"},children:[S.jsx("button",{className:"button-primary",onClick:wt,children:"Generate Tracking Link"}),Q?S.jsx("button",{className:"button-primary",onClick:()=>window.open(Q,"_blank"),children:"Open Tracking Page"}):null]}),ve?S.jsx("div",{style:{color:"#9ca3af"},children:ve}):null,S.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.6rem"},children:[S.jsx("button",{className:"button-primary",onClick:()=>kt(C.customer_phone,gt()),children:"Send ETA Text"}),S.jsx("button",{className:"button-primary",onClick:()=>kt(C.customer_phone,We()),children:"Send Live Tracking Text"})]})]})]}),S.jsxs("div",{className:"command-grid",id:"calendar",children:[S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsx("div",{className:"deck-title",children:"New Appointment"}),S.jsx("label",{className:"deck-label",children:"Customer"}),S.jsx("input",{className:"glass-input",value:C.customer_name,onChange:Pe=>R({...C,customer_name:Pe.target.value}),placeholder:"Jane Smith"}),S.jsx("label",{className:"deck-label",children:"Phone"}),S.jsx("input",{className:"glass-input mono",value:C.customer_phone,onChange:Pe=>R({...C,customer_phone:Pe.target.value}),placeholder:"+1 555 220 1399"}),S.jsx("label",{className:"deck-label",children:"Date"}),S.jsx("input",{className:"glass-input",type:"date",value:C.start_date,onChange:Pe=>R({...C,start_date:Pe.target.value})}),S.jsx("label",{className:"deck-label",children:"Time"}),S.jsx("input",{className:"glass-input",type:"time",value:C.start_time,onChange:Pe=>R({...C,start_time:Pe.target.value})}),S.jsx("label",{className:"deck-label",children:"Duration"}),S.jsxs("select",{className:"glass-input",value:C.duration_minutes,onChange:Pe=>R({...C,duration_minutes:Pe.target.value}),children:[S.jsx("option",{value:"30",children:"30 minutes"}),S.jsx("option",{value:"60",children:"60 minutes"}),S.jsx("option",{value:"90",children:"90 minutes"}),S.jsx("option",{value:"120",children:"120 minutes"})]}),S.jsx("label",{className:"deck-label",children:"Location"}),S.jsx("input",{className:"glass-input",value:C.location,onChange:Pe=>R({...C,location:Pe.target.value}),placeholder:"123 Main St"}),S.jsx("label",{className:"deck-label",children:"Reminder"}),S.jsxs("select",{className:"glass-input",value:C.reminder_minutes,onChange:Pe=>R({...C,reminder_minutes:Pe.target.value}),children:[S.jsx("option",{value:"0",children:"No reminder"}),S.jsx("option",{value:"15",children:"15 minutes before"}),S.jsx("option",{value:"30",children:"30 minutes before"}),S.jsx("option",{value:"60",children:"60 minutes before"})]}),S.jsx("label",{className:"deck-label",children:"Auto Reminder"}),S.jsxs("label",{className:"toggle",children:[S.jsx("input",{type:"checkbox",checked:C.reminder_enabled,onChange:Pe=>R({...C,reminder_enabled:Pe.target.checked})}),S.jsx("span",{className:"toggle-slider"}),S.jsx("span",{className:"toggle-label",children:C.reminder_enabled?"Enabled":"Disabled"})]}),S.jsx("label",{className:"deck-label",children:"ETA Tracking"}),S.jsxs("label",{className:"toggle",children:[S.jsx("input",{type:"checkbox",checked:C.eta_enabled,onChange:Pe=>R({...C,eta_enabled:Pe.target.checked})}),S.jsx("span",{className:"toggle-slider"}),S.jsx("span",{className:"toggle-label",children:C.eta_enabled?"Enabled":"Disabled"})]}),S.jsx("label",{className:"deck-label",children:"ETA Minutes"}),S.jsxs("select",{className:"glass-input",value:C.eta_minutes,onChange:Pe=>R({...C,eta_minutes:Pe.target.value}),children:[S.jsx("option",{value:"5",children:"5 minutes"}),S.jsx("option",{value:"10",children:"10 minutes"}),S.jsx("option",{value:"15",children:"15 minutes"})]}),S.jsx("label",{className:"deck-label",children:"ETA Link"}),S.jsx("input",{className:"glass-input",value:C.eta_link,onChange:Pe=>R({...C,eta_link:Pe.target.value}),placeholder:"https://maps.google.com/?q=..."}),S.jsx("label",{className:"deck-label",children:"Notes"}),S.jsx("textarea",{className:"glass-input",rows:"3",value:C.notes,onChange:Pe=>R({...C,notes:Pe.target.value}),placeholder:"Special instructions..."}),S.jsx("button",{className:"glow-button deck-action",onClick:we,children:"Lock Appointment"}),L?S.jsx("div",{className:"deck-status",children:L}):null]}),S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsxs("div",{className:"deck-title",children:["Schedule  ",o.toDateString()]}),c?S.jsx("div",{className:"blackbox-empty",children:"Loading schedule..."}):Je.length?Je.map(Pe=>S.jsxs("div",{className:"blackbox-item",children:[S.jsxs("div",{className:"blackbox-head",children:[S.jsx("div",{children:Pe.customer_name}),S.jsx("span",{className:"mono text-neon-cyan",children:new Date(Pe.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),S.jsx("div",{className:"blackbox-body",children:Pe.location||"No location"}),S.jsxs("div",{className:"blackbox-meta",children:["Reminder: ",Pe.reminder_minutes||0," min"]}),S.jsxs("div",{className:"calendar-cta",children:[S.jsx("button",{className:"button-primary",onClick:()=>kt(Pe.customer_phone,`Reminder: ${Pe.customer_name}, your appointment is scheduled for ${new Date(Pe.start_time).toLocaleString()}.`),children:"Send Reminder Now"}),S.jsx("button",{className:"button-primary",onClick:()=>kt(Pe.customer_phone,"We are running about 10 minutes late for your appointment."),children:"Running Late"}),S.jsx("button",{className:"button-primary",onClick:()=>kt(Pe.customer_phone,"We need to reschedule your appointment. Reply with a time that works for you."),children:"Reschedule"}),S.jsxs("button",{className:"button-primary",onClick:()=>bt(Pe.id,{reminder_enabled:!Pe.reminder_enabled}),children:["Reminder ",Pe.reminder_enabled?"ON":"OFF"]}),S.jsxs("button",{className:"button-primary",onClick:()=>bt(Pe.id,{eta_enabled:!Pe.eta_enabled}),children:["ETA ",Pe.eta_enabled?"ON":"OFF"]})]})]},Pe.id)):S.jsx("div",{className:"blackbox-empty",children:"No appointments for this day."})]}),S.jsxs("div",{className:"deck-card glass-panel",children:[S.jsx("div",{className:"deck-title",children:"Customer Updates"}),S.jsx("label",{className:"deck-label",children:"Custom SMS"}),S.jsx("textarea",{className:"glass-input",rows:"4",value:X,onChange:Pe=>W(Pe.target.value),placeholder:"Write a custom update to all booked customers..."}),S.jsx("label",{className:"deck-label",children:"GPS / ETA Link"}),S.jsx("input",{className:"glass-input",value:te,onChange:Pe=>G(Pe.target.value),placeholder:"https://maps.google.com/?q=..."}),S.jsxs("div",{className:"calendar-cta",children:[S.jsx("button",{className:"glow-button",onClick:()=>{var at;const Pe=(at=Je[0])==null?void 0:at.customer_phone;kt(Pe,X||"We are on the way.")},children:"Send Custom Update"}),S.jsx("button",{className:"button-primary",onClick:()=>{var at;const Pe=(at=Je[0])==null?void 0:at.customer_phone;kt(Pe,`Your technician is 10 minutes away. Track here: ${te}`)},children:"Send ETA"})]}),S.jsx("div",{className:"blackbox-meta",children:"GPS messages use the first appointment of the day. Add phone numbers to enable SMS."})]})]})]})]})]})}const hC=[{id:"pro",title:"PRO",description:"AI receptionist + recordings + advanced routing.",accent:"#22d3ee",price:"$197/mo"},{id:"elite",title:"ELITE",description:"Multi-location + VIP onboarding + SLA support.",accent:"#7c3aed",price:"$397/mo"},{id:"core",title:"CORE",description:"Private launch tier with limited access.",accent:"#f59e0b",price:"$97/mo"},{id:"white_glove",title:"WHITE GLOVE",description:"Full-service premium onboarding with dedicated support.",accent:"#ec4899",price:"$997/mo"}],Hg=[{id:"call_recordings",label:"Call Recordings",description:"Store and review call recordings."},{id:"auto_sms_followup",label:"Auto SMS Follow-Up",description:"Send automatic text follow-ups after calls."},{id:"sms_reminders",label:"SMS Appointment Reminders",description:"Auto-send appointment reminders."},{id:"eta_texts",label:"ETA Texts",description:"Send ETA update texts to customers."},{id:"live_tracking_text",label:"Live Tracking Link",description:"Send a tracking link with live vehicle trail."},{id:"transfer_routing",label:"Call Transfer Routing",description:"Route callers to a live number when needed."},{id:"emergency_afterhours",label:"After-Hours Emergency Mode",description:"Enable 24/7 emergency handling outside business hours."}],Kg={pro:["call_recordings","auto_sms_followup","sms_reminders","transfer_routing"],elite:["call_recordings","auto_sms_followup","sms_reminders","eta_texts","live_tracking_text","transfer_routing","emergency_afterhours"],core:["call_recordings","auto_sms_followup"],white_glove:["call_recordings","auto_sms_followup","sms_reminders","eta_texts","live_tracking_text","transfer_routing","emergency_afterhours"]},dR=e=>e?hC:hC.filter(t=>t.id!=="core");function a8(){const[e,t]=Ue.useState(null),[i,o]=Ue.useState(""),[h,m]=Ue.useState(""),[f,c]=Ue.useState("pro"),[E,C]=Ue.useState(!1),[R,L]=Ue.useState(window.localStorage.getItem("kryonex_admin_mode")||"user"),[B,X]=Ue.useState(null),[W,te]=Ue.useState(""),G=new URLSearchParams(window.location.search).get("core")==="1"||window.localStorage.getItem("kryonex_core_offer")==="1",J=Ue.useMemo(()=>dR(G||f==="core"),[G,f]);Ue.useEffect(()=>{let ve=!0;return(async()=>{var At;const{data:_e}=await zt.auth.getSession(),we=(At=_e==null?void 0:_e.session)==null?void 0:At.user;if(!we)return;const{data:Ge}=await zt.from("profiles").select("industry, role").eq("user_id",we.id).maybeSingle();ve&&(Ge!=null&&Ge.industry)&&m(Ge.industry.toLowerCase()),ve&&(Ge==null?void 0:Ge.role)==="admin"&&C(!0);const{data:Je}=await zt.from("subscriptions").select("plan_type").eq("user_id",we.id).maybeSingle();ve&&(Je!=null&&Je.plan_type)&&c(Je.plan_type.toLowerCase());const ft=await aR();ve&&X(ft.data||null)})(),()=>{ve=!1}},[]);const H=async ve=>{var Ee,_e,we;o(""),t(ve);try{const Ge=await sR({planTier:ve});(Ee=Ge.data)!=null&&Ee.url&&(window.location.href=Ge.data.url)}catch(Ge){o(((we=(_e=Ge.response)==null?void 0:_e.data)==null?void 0:we.error)||Ge.message)}finally{t(null)}},Q=async()=>{var ve,Ee,_e;o("");try{const we=await c$();(ve=we.data)!=null&&ve.url&&(window.location.href=we.data.url)}catch(we){o(((_e=(Ee=we.response)==null?void 0:Ee.data)==null?void 0:_e.error)||we.message)}},le=async ve=>{var Ee,_e,we;te(ve),o("");try{const Ge=`${window.location.origin}/billing?topup=success`,Je=`${window.location.origin}/billing?topup=canceled`,ft=await u$({topupType:ve,successUrl:Ge,cancelUrl:Je});(Ee=ft.data)!=null&&Ee.url&&(window.location.href=ft.data.url)}catch(Ge){o(((we=(_e=Ge.response)==null?void 0:_e.data)==null?void 0:we.error)||Ge.message)}finally{te("")}};return S.jsxs("div",{style:{minHeight:"100vh",padding:"4rem 1.5rem"},children:[S.jsx(xs,{}),S.jsxs("div",{style:{maxWidth:"1100px",margin:"0 auto"},children:[S.jsx(Ft.h2,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6},style:{letterSpacing:"0.2rem",marginBottom:"1.5rem"},children:"BILLING CORE"}),E&&R==="user"?S.jsx("div",{className:"glass",style:{padding:"1rem",marginBottom:"1.5rem"},children:"Admin override active. Billing is optional for admin accounts."}):null,S.jsx(Ft.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.6},style:{color:"#9ca3af",marginBottom:"2rem"},children:"Choose your deployment tier and manage subscription access."}),B?S.jsxs("div",{className:"glass",style:{padding:"1rem",marginBottom:"1.5rem"},children:[S.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[S.jsxs("div",{children:[S.jsx("div",{className:"mono",children:"Call Minutes"}),S.jsxs("div",{children:[B.call_minutes_remaining," / ",B.call_minutes_total," remaining"]})]}),S.jsxs("div",{children:[S.jsx("div",{className:"mono",children:"SMS"}),S.jsxs("div",{children:[B.sms_remaining," / ",B.sms_total," remaining"]})]})]}),S.jsxs("div",{style:{marginTop:"0.8rem",color:"#9ca3af"},children:["Status: ",B.limit_state]})]}):null,i?S.jsx("div",{style:{color:"#f87171",marginBottom:"1.5rem"},children:i}):null,S.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:"1.5rem"},children:J.map(ve=>S.jsxs(Ft.div,{className:`glass plan-card ${f===ve.id?"plan-active":""}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5},style:{padding:"2rem",borderColor:`${ve.accent}40`},children:[S.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"0.7rem"},children:ve.title}),S.jsx("div",{className:"mono",style:{fontSize:"2.2rem",marginBottom:"1rem"},children:ve.price}),S.jsx("div",{style:{color:"#9ca3af",marginBottom:"1.5rem"},children:ve.description}),S.jsx("button",{className:"button-primary",style:{width:"100%"},onClick:()=>H(ve.id),disabled:e===ve.id,children:e===ve.id?"INITIALIZING...":"ACTIVATE PROTOCOL"})]},ve.id))}),S.jsxs("div",{className:"glass",style:{marginTop:"2rem",padding:"1.5rem"},children:[S.jsx("div",{style:{marginBottom:"0.8rem"},children:"Already subscribed?"}),S.jsx("button",{className:"button-primary pulse-gold",onClick:Q,children:"MANAGE SUBSCRIPTION"})]}),S.jsxs("div",{className:"glass",style:{marginTop:"2rem",padding:"1.5rem"},children:[S.jsx("div",{style:{marginBottom:"0.8rem"},children:"Prepaid Top-Ups"}),S.jsxs("div",{style:{display:"grid",gap:"0.8rem",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))"},children:[S.jsx("button",{className:"button-primary",onClick:()=>le("calls_300"),disabled:W==="calls_300",children:W==="calls_300"?"LOADING...":"300 MINS ($79)"}),S.jsx("button",{className:"button-primary",onClick:()=>le("calls_800"),disabled:W==="calls_800",children:W==="calls_800"?"LOADING...":"800 MINS ($199)"}),S.jsx("button",{className:"button-primary",onClick:()=>le("sms_500"),disabled:W==="sms_500",children:W==="sms_500"?"LOADING...":"500 SMS ($25)"}),S.jsx("button",{className:"button-primary",onClick:()=>le("sms_1000"),disabled:W==="sms_1000",children:W==="sms_1000"?"LOADING...":"1000 SMS ($45)"})]})]})]})]})}const o8=e=>e?new Date(e).toLocaleString():"",l8=e=>e?e.includes("failed")||e.includes("revoked")?"text-neon-pink":e.includes("activated")||e.includes("verified")?"text-neon-green":"text-neon-cyan":"text-white/70",pR=(e,t,i)=>{if(!e.length)return"";const o=Math.max(...e),h=Math.min(...e),m=o-h||1;return e.map((f,c)=>{const E=c/(e.length-1)*t,C=i-(f-h)/m*i;return`${c===0?"M":"L"}${E},${C}`}).join(" ")},Xg=({title:e,value:t,subtitle:i,tone:o,data:h,unit:m})=>{const E=pR(h,220,70),C=`${E} L 220,70 L 0,70 Z`;return S.jsxs("div",{className:"rounded-2xl border border-white/5 bg-black/40 p-4",children:[S.jsxs("div",{className:"flex items-start justify-between gap-3",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm text-white/60",children:e}),S.jsxs("div",{className:`mt-2 text-xl font-mono ${o}`,children:[t,m]}),i?S.jsx("div",{className:"mt-1 text-xs text-white/40",children:i}):null]}),S.jsx("div",{className:"h-10 w-10 rounded-xl border border-white/10 bg-white/5 grid place-items-center",children:S.jsx("span",{className:`text-xs ${o}`,children:"LIVE"})})]}),S.jsx("div",{className:"mt-4",children:S.jsxs("svg",{width:220,height:70,viewBox:"0 0 220 70",children:[S.jsx("defs",{children:S.jsxs("linearGradient",{id:`glow-${e}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[S.jsx("stop",{offset:"0%",stopColor:"rgba(34,211,238,0.55)"}),S.jsx("stop",{offset:"100%",stopColor:"rgba(34,211,238,0)"})]})}),S.jsx("path",{d:C,fill:`url(#glow-${e})`,opacity:"0.7"}),S.jsx("path",{d:E,fill:"none",stroke:"rgba(34,211,238,0.9)",strokeWidth:"2",strokeLinecap:"round"})]})})]})},Yg=({title:e,subtitle:t,data:i,stroke:o})=>{const f=pR(i,520,120),c=`${f} L 520,120 L 0,120 Z`;return S.jsxs("div",{className:"glass-panel rounded-3xl p-6 border border-white/10",children:[S.jsxs("div",{className:"flex items-center justify-between mb-4",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:e}),S.jsx("div",{className:"text-sm text-white/60",children:t})]}),S.jsx("div",{className:"text-xs text-white/40",children:"LIVE"})]}),S.jsxs("svg",{width:"100%",height:120,viewBox:"0 0 520 120",children:[S.jsx("defs",{children:S.jsxs("linearGradient",{id:`panel-${e}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[S.jsx("stop",{offset:"0%",stopColor:o,stopOpacity:"0.45"}),S.jsx("stop",{offset:"100%",stopColor:o,stopOpacity:"0"})]})}),S.jsx("path",{d:c,fill:`url(#panel-${e})`}),S.jsx("path",{d:f,fill:"none",stroke:o,strokeWidth:"2.5",strokeLinecap:"round"})]})]})};function c8(){var te,G,J,H,Q,le,ve,Ee;const e=qr(),[t,i]=Ue.useState([]),[o,h]=Ue.useState(null),[m,f]=Ue.useState(null),[c,E]=Ue.useState(null),[C,R]=Ue.useState(!0),[L,B]=Ue.useState(0),[X,W]=Ue.useState(!1);return Ue.useEffect(()=>{let _e=!0;(async()=>{try{const[Je,ft,At,kt]=await Promise.all([tC(),tx(),rC(),iC()]);_e&&(i(Je.data.logs||[]),h(ft.data||null),f(At.data||null),E(kt.data||null))}finally{_e&&R(!1)}})();const Ge=setInterval(()=>{B(Je=>Je+1)},15e3);return()=>{_e=!1,clearInterval(Ge)}},[]),Ue.useEffect(()=>{let _e=!0;return L?((async()=>{try{const[Ge,Je,ft,At]=await Promise.all([tC(),tx(),rC(),iC()]);_e&&(i(Ge.data.logs||[]),h(Je.data||null),f(ft.data||null),E(At.data||null))}catch{}})(),()=>{_e=!1}):void 0},[L]),S.jsxs("div",{className:"min-h-screen bg-void-black text-white relative overflow-hidden",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsx("div",{className:"absolute -top-28 -right-28 h-72 w-72 rounded-full bg-neon-purple/20 blur-[120px]"}),S.jsx("div",{className:"absolute bottom-0 left-0 h-96 w-96 rounded-full bg-neon-cyan/10 blur-[140px]"}),S.jsxs("div",{className:"relative z-10 mx-auto max-w-6xl px-6 py-10 dashboard-layout",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{children:[S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"glass-panel rounded-3xl p-8 border border-white/10",children:[S.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-6",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"NASA-Grade Oversight"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold tracking-tight",children:"Admin Command Center"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Live audit stream for critical transactions and security events."})]}),S.jsxs("div",{className:"glass-panel rounded-2xl px-5 py-4 border border-white/10",children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/50",children:"System Status"}),S.jsx("div",{className:"mt-2 text-neon-green font-mono",children:"NOMINAL"})]})]}),S.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[S.jsx("button",{className:"button-primary",onClick:()=>{window.localStorage.setItem("kryonex_admin_mode","off"),window.location.href="/dashboard"},children:"VIEW USER DASHBOARD"}),S.jsx("button",{className:"button-primary",onClick:()=>window.location.reload(),children:"REFRESH TELEMETRY"}),S.jsx("button",{className:"button-primary",onClick:async()=>{W(!0);try{await h$();const _e=await tx();h(_e.data||null)}finally{W(!1)}},children:X?"SYNCING STRIPE...":"SYNC STRIPE"})]})]}),S.jsxs("div",{className:"mt-8 grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[S.jsxs(Ft.div,{className:"glass-panel rounded-3xl p-6 border border-white/10",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:[S.jsxs("div",{className:"flex items-center justify-between mb-4",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Audit Timeline"}),S.jsx("div",{className:"text-lg font-semibold",children:"Security Events"})]}),S.jsxs("div",{className:"text-xs text-white/50",children:[t.length," entries"]})]}),S.jsx("div",{className:"space-y-4 max-h-[520px] overflow-y-auto pr-2",children:C?S.jsx("div",{className:"text-white/60",children:"Loading logs..."}):t.length?t.map(_e=>{var we;return S.jsxs("div",{className:"rounded-2xl border border-white/5 bg-black/40 p-4",children:[S.jsxs("div",{className:"flex items-start justify-between gap-4",children:[S.jsxs("div",{children:[S.jsx("div",{className:`text-sm font-semibold ${l8(_e.action)}`,children:((we=_e.action)==null?void 0:we.replace(/_/g," "))||"event"}),S.jsxs("div",{className:"text-xs text-white/50 mt-1",children:[_e.entity," ",_e.entity_id?` ${_e.entity_id}`:""]})]}),S.jsx("div",{className:"text-xs text-white/40 font-mono",children:o8(_e.created_at)})]}),_e.metadata?S.jsx("pre",{className:"mt-3 text-[11px] text-white/50 font-mono whitespace-pre-wrap",children:JSON.stringify(_e.metadata,null,2)}):null]},_e.id)}):S.jsx("div",{className:"text-white/60",children:"No audit events yet."})})]}),S.jsxs(Ft.div,{className:"glass-panel rounded-3xl p-6 border border-white/10",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Mission KPIs"}),S.jsxs("div",{className:"mt-4 grid gap-4",children:[o?S.jsxs(S.Fragment,{children:[S.jsx(Xg,{title:"MRR",value:`$${(((te=o.mrr)==null?void 0:te.amount_cents)||0)/100}`,unit:"/mo",subtitle:"Monthly recurring revenue",tone:"text-neon-green",data:[12,18,16,22,28,26,30]}),S.jsx(Xg,{title:"Conversion",value:o.conversion_rate||0,unit:"%",subtitle:"Active subs / total users",tone:"text-neon-cyan",data:[4,6,7,9,11,10,12]}),S.jsx(Xg,{title:"Active Subs",value:((G=o.totals)==null?void 0:G.active_subscriptions)||0,unit:"",subtitle:"Currently billed",tone:"text-neon-cyan",data:[1,3,4,5,7,8,9]}),S.jsx(Xg,{title:"Failed Payments",value:((J=o.totals)==null?void 0:J.past_due)||0,unit:"",subtitle:"Past-due accounts",tone:"text-neon-pink",data:[0,1,1,2,1,1,2]})]}):S.jsx("div",{className:"text-white/60",children:"Loading KPI telemetry..."}),S.jsxs("div",{className:"rounded-2xl border border-white/5 bg-black/40 p-4",children:[S.jsx("div",{className:"text-sm text-white/60",children:"System Health"}),m?S.jsxs("div",{className:"mt-2 text-xs text-white/60 space-y-1",children:[S.jsxs("div",{children:["Uptime: ",m.uptime_sec,"s"]}),S.jsxs("div",{children:["Stripe Webhook:"," ",m.last_stripe_webhook_at||"No signal"]}),S.jsxs("div",{children:["Retell Webhook:"," ",m.last_retell_webhook_at||"No signal"]})]}):S.jsx("div",{className:"mt-2 text-xs text-white/60",children:"Loading health telemetry..."})]}),[{label:"Deploy Attempts",value:"Monitoring",tone:"text-neon-cyan"},{label:"Payment Failures",value:"Auto-Isolate",tone:"text-neon-pink"},{label:"Portal Access",value:"Tracked",tone:"text-neon-green"},{label:"Webhook Integrity",value:"Verified",tone:"text-neon-cyan"}].map(_e=>S.jsxs("div",{className:"rounded-2xl border border-white/5 bg-black/40 p-4",children:[S.jsx("div",{className:"text-sm text-white/60",children:_e.label}),S.jsx("div",{className:`mt-2 text-lg font-mono ${_e.tone}`,children:_e.value})]},_e.label)),S.jsxs("div",{className:"rounded-2xl border border-white/5 bg-black/40 p-4",children:[S.jsx("div",{className:"text-sm text-white/60",children:"Last Synchronization"}),S.jsx("div",{className:"mt-2 text-lg font-mono text-neon-cyan",children:new Date().toLocaleTimeString()})]})]})]})]}),S.jsxs("div",{className:"mt-8 grid gap-6 lg:grid-cols-2",children:[S.jsx(Yg,{title:"MRR Trajectory",subtitle:"Daily MRR momentum",data:((Q=(H=c==null?void 0:c.series)==null?void 0:H.mrr_cents)==null?void 0:Q.map(_e=>_e/100))||[2,4,3,5,6,8,9],stroke:"rgba(16,185,129,0.9)"}),S.jsx(Yg,{title:"New Subscribers",subtitle:"Daily paid conversions",data:((le=c==null?void 0:c.series)==null?void 0:le.subs)||[1,2,1,3,2,4,5],stroke:"rgba(34,211,238,0.9)"}),S.jsx(Yg,{title:"New Users",subtitle:"Daily account creation",data:((ve=c==null?void 0:c.series)==null?void 0:ve.users)||[3,4,2,5,6,7,8],stroke:"rgba(124,58,237,0.9)"}),S.jsx(Yg,{title:"Lead Velocity",subtitle:"Daily leads captured",data:((Ee=c==null?void 0:c.series)==null?void 0:Ee.leads)||[2,5,4,6,8,7,9],stroke:"rgba(244,63,94,0.9)"})]})]})]})]})}const u8=["1","2","3","4","5","6","7","8","9","*","0","#"];function h8(){const e=qr(),[t,i]=Ue.useState([]),[o,h]=Ue.useState(!0),[m,f]=Ue.useState(""),[c,E]=Ue.useState(""),[C,R]=Ue.useState(""),[L,B]=Ue.useState("idle"),X=Ue.useCallback(async()=>{var le,ve,Ee;h(!0),f("");try{const we=((le=(await iR()).data)==null?void 0:le.leads)||[];if(i(we),we.length&&!c){const Ge=we[0];E(Ge.id),R(Ge.phone||"")}}catch(_e){f(((Ee=(ve=_e.response)==null?void 0:ve.data)==null?void 0:Ee.error)||_e.message)}finally{h(!1)}},[c]);Ue.useEffect(()=>{X()},[X]),Ue.useEffect(()=>{const le=zt.channel("admin-call-center-leads").on("postgres_changes",{event:"*",schema:"public",table:"leads"},()=>X()).subscribe();return()=>{zt.removeChannel(le)}},[X]);const W=Ue.useMemo(()=>t.find(le=>String(le.id)===String(c)),[t,c]),te=le=>{E(le.id),R(le.phone||"")},G=le=>{R(ve=>`${ve}${le}`)},J=()=>{C&&(B("calling"),window.location.href=`tel:${C}`)},H=()=>{B("idle")},Q=()=>{const le=W!=null&&W.id?`?leadId=${W.id}`:"";e(`/admin/wizard/create${le}`)};return S.jsxs("div",{className:"min-h-screen w-full bg-void-black text-white relative overflow-hidden font-sans",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsxs("div",{className:"relative z-10 flex w-full h-screen",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{className:"flex-1 px-6 py-8 space-y-6",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-widest text-neon-cyan/70",children:"Live Dialer"}),S.jsx("h1",{className:"text-4xl font-semibold",children:"Admin Call Center"})]}),S.jsx("button",{className:"button-primary",onClick:Q,children:"Create Client Deployment"})]}),S.jsxs("div",{className:"grid gap-6",style:{gridTemplateColumns:"3fr 1fr"},children:[S.jsxs(Ft.div,{className:"glass-panel rounded-3xl border border-white/10 p-6 min-h-[600px]",initial:{opacity:0,y:12},animate:{opacity:1,y:0},children:[S.jsxs("div",{className:"flex items-center justify-between mb-4",children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Lead Grid"}),S.jsx("button",{className:"button-primary",onClick:X,children:"Refresh"})]}),m?S.jsx("div",{className:"text-neon-pink",children:m}):null,S.jsxs("div",{className:"text-xs uppercase tracking-widest text-white/40 grid grid-cols-[1fr_1fr_0.7fr_0.9fr_0.7fr] gap-4 pb-3 border-b border-white/10",children:[S.jsx("div",{children:"Business Name"}),S.jsx("div",{children:"Contact"}),S.jsx("div",{children:"Status"}),S.jsx("div",{children:"Last Outcome"}),S.jsx("div",{children:"Tags"})]}),S.jsx("div",{className:"mt-4 max-h-[620px] overflow-y-auto pr-2 space-y-2",children:o?S.jsx("div",{className:"text-white/60",children:"Fetching leads..."}):t.length?t.map(le=>S.jsxs("div",{className:`grid grid-cols-[1fr_1fr_0.7fr_0.9fr_0.7fr] gap-4 items-center rounded-2xl border border-white/5 bg-black/40 px-4 py-3 transition hover:bg-cyan-900/20 cursor-pointer ${c===le.id?"border-neon-cyan/70 bg-neon-cyan/5":""}`,onClick:()=>te(le),children:[S.jsx("div",{className:"text-sm font-semibold",children:le.business_name||"Unnamed"}),S.jsx("div",{className:"text-xs text-white/60",children:le.phone||"No phone"}),S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/70",children:le.status||"new"}),S.jsx("div",{className:"text-xs text-white/50",children:le.last_outcome||""}),S.jsx("div",{className:"flex gap-1",children:S.jsx("span",{className:"px-2 py-0.5 text-[10px] uppercase tracking-widest bg-white/10 rounded-full",children:"VIP"})})]},le.id)):S.jsx("div",{className:"text-white/60",children:"No leads assigned."})})]}),S.jsxs(Ft.div,{className:"glass-panel rounded-3xl border border-white/10 p-6 min-h-[600px] flex flex-col",initial:{opacity:0,y:12},animate:{opacity:1,y:0},children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40 mb-3",children:"Dialer"}),S.jsxs("div",{className:"glass-panel rounded-2xl border border-white/10 p-4 mb-4",children:[S.jsx("div",{className:"text-xs text-white/50",children:"Active Lead"}),S.jsx("div",{className:"text-lg font-semibold",children:(W==null?void 0:W.business_name)||(W==null?void 0:W.name)||"Select a lead"}),S.jsx("div",{className:"text-xs text-white/40",children:(W==null?void 0:W.phone)||"No phone"})]}),S.jsx("button",{className:"glow-button w-full mb-3",onClick:J,children:L==="calling"?"CALLING...":`CALL ${(W==null?void 0:W.business_name)||"LEAD"}`}),S.jsxs("div",{className:"flex gap-2 mb-3",children:[S.jsx("button",{className:"button-primary flex-1",onClick:H,children:"End Call"}),S.jsx("button",{className:"glow-button flex-1",onClick:Q,type:"button",children:"Create Client Deployment"})]}),S.jsxs("div",{className:"mt-2 rounded-2xl border border-white/10 bg-black/40 p-4",children:[S.jsx("input",{className:"input-field w-full mb-3",value:C,onChange:le=>R(le.target.value),placeholder:"Dial number"}),S.jsx("div",{className:"grid grid-cols-3 gap-2",children:u8.map(le=>S.jsx("button",{className:"button-primary py-2 text-base",onClick:()=>G(le),children:le},le))})]})]})]})]})]})]})}const dC=(e,t=[])=>{const i={};return e.forEach(o=>{i[o.id]=t.includes(o.id)}),i},pC=e=>{if(!e)return"";const t=Number(e);return Number.isNaN(t)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},d8=e=>e.replace(/[^0-9.]/g,""),nx=e=>{const t=e.replace(/\D/g,""),i=t.slice(0,3),o=t.slice(3,6),h=t.slice(6,10);return o?h?`(${i}) ${o}-${h}`:`(${i}) ${o}`:i},p8=[{id:"tier",label:"Tier Selection",subtitle:"Choose subscription tier"},{id:"features",label:"System Activation",subtitle:"Arm / disarm capabilities"},{id:"details",label:"Client Configuration",subtitle:"Contact & routing"}];function f8(){var ft,At,kt,gt;const e=qr(),[t]=Dw(),i=t.get("leadId"),o=new URLSearchParams(window.location.search).get("core")==="1"||window.localStorage.getItem("kryonex_core_offer")==="1",h=dR(o),[m,f]=Ue.useState(((ft=h[0])==null?void 0:ft.id)||"pro"),[c,E]=Ue.useState(()=>{var We;return dC(Hg,Kg[((We=h[0])==null?void 0:We.id)||"pro"])}),[C,R]=Ue.useState({clientName:"",businessName:"",industry:"",areaCode:"",tone:Db[0]||"Calm & Professional",email:"",phone:"",weekdayOpen:"08:00 AM",weekdayClose:"05:00 PM",weekendEnabled:!1,saturdayOpen:"09:00 AM",saturdayClose:"02:00 PM",alwaysOpen:!1,emergencyDispatch:!1,emergencyPhone:"",afterHoursLogic:"",standardFee:"",emergencyFee:"",transferNumber:"",notes:""}),[L,B]=Ue.useState(!1),[X,W]=Ue.useState(""),[te,G]=Ue.useState(!1),[J,H]=Ue.useState(null);Ue.useEffect(()=>{if(!i)return;let We=!0;return iR().then(wt=>{var Ye,Pe;if(!We)return;const bt=(Pe=(Ye=wt.data)==null?void 0:Ye.leads)==null?void 0:Pe.find(at=>String(at.id)===String(i));bt&&R(at=>({...at,clientName:bt.name||"",businessName:bt.business_name||"",industry:bt.industry||"",phone:bt.phone||""}))}).catch(()=>{}),()=>{We=!1}},[i]),Ue.useEffect(()=>{const We=Kg[m]||[];E(dC(Hg,We))},[m]);const Q=We=>{E(wt=>({...wt,[We]:!wt[We]}))},le=We=>wt=>{const bt=d8(wt.target.value);R(Ye=>({...Ye,[We]:bt}))},ve=We=>wt=>{const bt=wt.target.value.replace(/\D/g,"");R(Ye=>({...Ye,[We]:bt}))},Ee=We=>wt=>{const bt=wt.target.value;R(Ye=>({...Ye,[We]:bt}))},_e=()=>{if(C.alwaysOpen)return"Operations are always open (24/7).";let We=`Operating MondayFriday, ${C.weekdayOpen} to ${C.weekdayClose}.`;return C.weekendEnabled?We+=` Weekends from ${C.saturdayOpen} to ${C.saturdayClose}.`:We+=" Weekends are offline.",C.emergencyDispatch&&(We+=" Emergency dispatch ready."),We},we=Hg.filter(We=>{var wt;return(wt=Kg[m])==null?void 0:wt.includes(We.id)}),Ge=async We=>{var wt,bt;We==null||We.preventDefault(),W(""),B(!0);try{const Ye=await d$({email:C.email,fullName:C.clientName,businessName:C.businessName,industry:C.industry,phone:C.phone,tierId:m,features:we.map(Pe=>Pe.id),leadId:i});H(Ye.data||null),G(!0)}catch(Ye){W(((bt=(wt=Ye.response)==null?void 0:wt.data)==null?void 0:bt.error)||Ye.message)}finally{B(!1)}},Je=p8.map((We,wt)=>{const bt=wt+1,Ye=We.id==="tier"&&!!m||We.id==="features"&&we.length>0||We.id==="details"&&!!C.businessName,Pe=We.id==="tier"||We.id==="features"&&!!c||We.id==="details"&&!!C.businessName;return{...We,stepNumber:bt,isActive:Pe,isComplete:Ye}});return S.jsxs("div",{className:"min-h-screen w-full bg-void-black text-white",children:[S.jsx(xs,{}),S.jsxs("div",{className:"relative z-10 flex h-screen",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{className:"flex-1 flex flex-col",children:[S.jsxs(Ft.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"px-6 py-4 border-b border-white/10 bg-black/60 backdrop-blur-sm",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Command Console"}),S.jsx("h1",{className:"mt-1 text-2xl font-semibold",children:"Admin Client Wizard"})]}),S.jsx("button",{className:"button-primary",onClick:()=>e("/admin/call-center"),children:"Back to Call Center"})]}),S.jsx("div",{className:"mt-4 flex items-center gap-8",children:Je.map(We=>S.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[S.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold border-2 ${We.isComplete?"border-neon-green bg-neon-green/20 text-neon-green":We.isActive?"border-neon-cyan bg-neon-cyan/20 text-neon-cyan":"border-white/30 bg-white/5 text-white/50"}`,children:We.isComplete?"":We.stepNumber}),S.jsxs("div",{className:"flex-1",children:[S.jsx("div",{className:`text-sm font-semibold ${We.isActive?"text-neon-cyan":We.isComplete?"text-neon-green":"text-white/60"}`,children:We.label}),S.jsx("div",{className:"text-xs text-white/40",children:We.subtitle})]})]},We.id))})]}),S.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[S.jsxs("div",{className:"w-[65%] overflow-y-auto px-6 py-6 space-y-8",children:[S.jsx(Ft.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-4",children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:"Tier Selection"}),S.jsx("select",{className:"input-field w-full text-lg p-4",value:m,onChange:We=>f(We.target.value),children:h.map(We=>S.jsxs("option",{value:We.id,children:[We.title,"  ",We.price]},We.id))})]})}),S.jsx(Ft.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1},children:S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-4",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:"System Activation"}),S.jsx("div",{className:"text-xs text-white/50",children:"Manage deployment state"})]}),S.jsxs("span",{className:"text-xs font-mono text-white/50",children:[we.length," systems"]})]}),S.jsx("div",{className:"grid gap-3",children:Hg.filter(We=>{var wt;return(wt=Kg[m])==null?void 0:wt.includes(We.id)}).map(We=>{const wt=!!c[We.id];return S.jsxs("div",{className:`rounded-2xl border p-4 flex items-center justify-between ${wt?"border-neon-green bg-neon-green/5":"border-neon-pink bg-neon-pink/5"}`,children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold",children:We.label}),We.description&&S.jsx("div",{className:"text-xs text-white/60",children:We.description})]}),S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx("span",{className:`text-[0.6rem] uppercase tracking-[0.3em] font-mono ${wt?"text-neon-green":"text-neon-pink"}`,children:wt?"ARMED":"DISARMED"}),S.jsx("button",{type:"button",onClick:()=>Q(We.id),className:`w-12 h-6 rounded-full border-2 relative ${wt?"bg-neon-green/30 border-neon-green/50":"bg-neon-pink/30 border-neon-pink/50"}`,children:S.jsx("div",{className:`w-4 h-4 rounded-full absolute top-0.5 transition ${wt?"left-6 bg-neon-green":"left-0.5 bg-neon-pink"}`})})]})]},We.id)})})]})}),S.jsx(Ft.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-5",children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:"Client Details"}),S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Business Name"}),S.jsx("input",{className:"input-field w-full",value:C.businessName,onChange:Ee("businessName")})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Client Name"}),S.jsx("input",{className:"input-field w-full",value:C.clientName,onChange:Ee("clientName")})]})]}),S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Industry"}),S.jsxs("select",{className:"input-field w-full",value:C.industry,onChange:Ee("industry"),children:[S.jsx("option",{value:"",children:"Select industry"}),hR.map(We=>S.jsx("option",{value:We.id,children:We.label},We.id))]})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Area Code"}),S.jsx("input",{className:"input-field w-full",value:C.areaCode,onChange:Ee("areaCode")})]})]}),S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Email"}),S.jsx("input",{className:"input-field w-full",type:"email",value:C.email,onChange:Ee("email")})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Phone"}),S.jsx("input",{className:"input-field w-full",value:nx(C.phone),onChange:ve("phone")})]})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-sm text-white/70",children:"Agent Tone"}),S.jsx("select",{className:"input-field w-full",value:C.tone,onChange:Ee("tone"),children:Db.map(We=>S.jsx("option",{value:We,children:We},We))})]})]})}),S.jsx(Ft.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-5",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:"Schedule & Routing"}),S.jsx("div",{className:"text-xs text-white/50",children:"Configure hours and routing"})]}),S.jsx("button",{type:"button",onClick:()=>R(We=>({...We,alwaysOpen:!We.alwaysOpen,weekendEnabled:We.alwaysOpen?We.weekendEnabled:!1})),className:`px-4 py-2 rounded-lg text-xs font-semibold transition ${C.alwaysOpen?"bg-neon-cyan/20 text-neon-cyan border border-neon-cyan/40":"bg-white/10 text-white/70 border border-white/20 hover:bg-white/20"}`,children:C.alwaysOpen?"24/7 OPS ACTIVE":"Enable 24/7 Ops"})]}),!C.alwaysOpen&&S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/50 uppercase tracking-[0.3em]",children:"Weekday Open"}),S.jsx(al,{value:C.weekdayOpen,onChange:Ee("weekdayOpen")})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/50 uppercase tracking-[0.3em]",children:"Weekday Close"}),S.jsx(al,{value:C.weekdayClose,onChange:Ee("weekdayClose")})]})]}),S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("span",{className:"text-xs text-white/50 uppercase tracking-[0.3em]",children:"Weekend"}),S.jsx("button",{type:"button",onClick:()=>R(We=>({...We,weekendEnabled:!We.weekendEnabled})),className:`px-3 py-1 rounded text-xs font-semibold ${C.weekendEnabled?"bg-neon-green/20 text-neon-green":"bg-white/10 text-white/70"}`,children:C.weekendEnabled?"ENABLED":"DISABLED"})]}),C.weekendEnabled&&S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsx(al,{value:C.saturdayOpen,onChange:Ee("saturdayOpen")}),S.jsx(al,{value:C.saturdayClose,onChange:Ee("saturdayClose")})]})]}),C.alwaysOpen&&S.jsx("div",{className:"text-xs text-neon-green",children:"Schedule locked to 24/7. Time pickers disabled."})]})}),S.jsx(Ft.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.4},children:S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-5",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:"Emergency Protocols"}),S.jsx("div",{className:"text-xs text-white/50",children:"Activate dispatch controls"})]}),S.jsx("button",{type:"button",onClick:()=>R(We=>({...We,emergencyDispatch:!We.emergencyDispatch})),className:`px-4 py-2 rounded-lg text-xs font-semibold transition ${C.emergencyDispatch?"bg-neon-pink/20 text-neon-pink border border-neon-pink/40":"bg-white/10 text-white/70 border border-white/20 hover:bg-white/20"}`,children:C.emergencyDispatch?"Dispatch Active":"Activate Emergency Dispatch"})]}),C.emergencyDispatch&&S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/60",children:"Emergency Phone"}),S.jsx("input",{className:"input-field w-full",value:nx(C.emergencyPhone),onChange:ve("emergencyPhone")})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/60",children:"Transfer Number"}),S.jsx("input",{className:"input-field w-full",value:nx(C.transferNumber),onChange:ve("transferNumber")})]})]}),S.jsx("div",{className:"grid grid-cols-1 gap-4",children:S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/60",children:"After-Hours Logic"}),S.jsxs("select",{className:"input-field w-full",value:C.afterHoursLogic,onChange:Ee("afterHoursLogic"),children:[S.jsx("option",{value:"",children:"Select response"}),S.jsx("option",{value:"take_message",children:"Take Message"}),S.jsx("option",{value:"forward_dispatch",children:"Forward to Dispatch"}),S.jsx("option",{value:"play_warning",children:"Play 911 Warning"}),S.jsx("option",{value:"custom",children:"Custom Instruction"})]})]})}),S.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/60",children:"Standard Fee"}),S.jsx("input",{className:"input-field w-full",value:pC(C.standardFee),onChange:le("standardFee")})]}),S.jsxs("label",{className:"space-y-2",children:[S.jsx("span",{className:"text-xs text-white/60",children:"Emergency Fee"}),S.jsx("input",{className:"input-field w-full",value:pC(C.emergencyFee),onChange:le("emergencyFee")})]})]})]})]})}),S.jsx(Ft.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-4",children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:"Deployment Notes"}),S.jsx("textarea",{className:"input-field w-full",rows:3,value:C.notes,onChange:Ee("notes"),placeholder:"Special instructions or requirements..."}),X&&S.jsx("div",{className:"text-neon-pink text-sm",children:X}),te&&S.jsxs("div",{className:"text-neon-green space-y-2 text-sm",children:[S.jsx("div",{children:"Client deployment initiated."}),J!=null&&J.checkout_url?S.jsx("button",{type:"button",className:"button-primary",onClick:()=>window.open(J.checkout_url,"_blank"),children:"Open Stripe Checkout"}):S.jsx("div",{children:"Checkout: Processing..."})]}),S.jsx("button",{className:"glow-button w-full",type:"submit",disabled:L,onClick:Ge,children:L?"DEPLOYING...":"Launch Deployment"})]})})]}),S.jsx("div",{className:"w-[35%] px-6 py-6",children:S.jsx("div",{className:"sticky top-6",children:S.jsxs(Ft.div,{initial:{opacity:0,x:20},animate:{opacity:[.92,1,.92],y:[0,-4,0]},transition:{duration:6,repeat:1/0,repeatType:"reverse",delay:.5},className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-6 max-h-[calc(100vh-120px)] overflow-y-auto",whileHover:{boxShadow:"0 20px 45px rgba(34, 211, 238, 0.35)",scale:1.01},children:[S.jsxs("div",{className:"text-center text-white",children:[S.jsx("div",{className:"text-lg font-semibold",children:"Live Preview"}),S.jsx("div",{className:"text-xs text-white/60",children:"JSON payload building in real-time"})]}),S.jsxs(Ft.div,{initial:{opacity:.8},animate:{opacity:[.8,1,.8]},transition:{duration:4,repeat:1/0},className:"rounded-2xl border border-white/10 bg-black/40 p-4 space-y-2",children:[S.jsx("div",{className:"text-sm text-white/60",children:"Client"}),S.jsx("div",{className:"text-lg font-semibold",children:C.businessName||"New Client"}),S.jsxs("div",{className:"text-xs text-white/50",children:[C.industry||"Industry","  ",C.areaCode||"Area"]})]}),S.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4 space-y-2",children:[S.jsx("div",{className:"text-sm text-white/60",children:"Tier"}),S.jsx("div",{className:"text-lg font-semibold",children:(kt=(At=h.find(We=>We.id===m))==null?void 0:At.title)==null?void 0:kt.toUpperCase()}),S.jsx("div",{className:"text-xs text-white/50",children:(gt=h.find(We=>We.id===m))==null?void 0:gt.description})]}),S.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4 space-y-2",children:[S.jsx("div",{className:"text-sm text-white/60",children:"Schedule"}),S.jsx("div",{className:"text-xs text-white/70",children:_e()})]}),S.jsxs(Ft.div,{initial:{x:0},animate:{x:[0,2,0]},transition:{duration:5,repeat:1/0,repeatType:"reverse"},className:"rounded-2xl border border-white/10 bg-black/40 p-4 space-y-2",children:[S.jsx("div",{className:"text-sm text-white/60",children:"Telemetry"}),S.jsxs("div",{className:"text-xs text-white/50",children:["Charging ",we.length," systems"]}),S.jsxs("div",{className:"text-xs text-white/50",children:["Emergency Dispatch:"," ",S.jsx("span",{className:C.emergencyDispatch?"text-neon-pink":"text-white/60",children:C.emergencyDispatch?"ACTIVE":"INACTIVE"})]})]}),S.jsx(Ft.div,{initial:{opacity:.8},animate:{opacity:[.8,1,.8]},transition:{duration:5,repeat:1/0},className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:S.jsx("pre",{className:"text-[10px] font-mono text-white/60",children:JSON.stringify({businessName:C.businessName,industry:C.industry,areaCode:C.areaCode,tone:C.tone,alwaysOpen:C.alwaysOpen,emergencyDispatch:C.emergencyDispatch,transferNumber:C.transferNumber,features:we.map(We=>({id:We.id,armed:c[We.id]}))},null,2)})})]})})})]})]})]})]})}const m8=[{id:"contacted",label:"Contacted"},{id:"demo_set",label:"Demo Set"},{id:"closed_won",label:"Closed Won"},{id:"dead",label:"Dead"}],g8=["1","2","3","4","5","6","7","8","9","*","0","#"],y8=e=>e?new Date(e).toLocaleString():"--";function _8(){const e=qr(),[t,i]=Ue.useState([]),[o,h]=Ue.useState(""),[m,f]=Ue.useState(""),[c,E]=Ue.useState(!0),[C,R]=Ue.useState(""),[L,B]=Ue.useState(""),[X,W]=Ue.useState("idle"),te=Ue.useCallback(async()=>{var _e,we,Ge;E(!0),R("");try{const ft=((_e=(await rR()).data)==null?void 0:_e.leads)||[];if(i(ft),ft.length&&!o){const At=ft[0];h(At.id),f(At.phone||"")}}catch(Je){R(((Ge=(we=Je.response)==null?void 0:we.data)==null?void 0:Ge.error)||Je.message)}finally{E(!1)}},[o]);Ue.useEffect(()=>{te()},[te]),Ue.useEffect(()=>{const _e=zt.channel("sales-console-leads").on("postgres_changes",{event:"*",schema:"public",table:"leads"},()=>te()).subscribe();return()=>{zt.removeChannel(_e)}},[te]);const G=Ue.useMemo(()=>t.find(_e=>String(_e.id)===String(o)),[t,o]),J=_e=>{h(_e.id),f(_e.phone||"")},H=_e=>{f(we=>`${we}${_e}`)},Q=()=>{m&&(W("calling"),window.location.href=`tel:${m}`)},le=()=>{W("idle")},ve=async _e=>{var we,Ge;if(G!=null&&G.id){B(_e),R("");try{await o$(G.id,_e),i(Je=>Je.map(ft=>ft.id===G.id?{...ft,status:_e}:ft))}catch(Je){R(((Ge=(we=Je.response)==null?void 0:we.data)==null?void 0:Ge.error)||Je.message)}finally{B("")}}},Ee=()=>{const _e=G!=null&&G.id?`?leadId=${G.id}`:"";e(`/admin/wizard/create${_e}`)};return S.jsxs("div",{className:"min-h-screen bg-void-black text-white relative overflow-hidden font-sans",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsx("div",{className:"absolute -top-28 -right-28 h-72 w-72 rounded-full bg-neon-purple/20 blur-[120px]"}),S.jsx("div",{className:"absolute bottom-0 left-0 h-96 w-96 rounded-full bg-neon-cyan/10 blur-[140px]"}),S.jsxs("div",{className:"relative z-10 mx-auto max-w-6xl px-6 py-10",children:[S.jsx(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"glass-panel rounded-3xl p-8 border border-white/10",children:S.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-6",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Sales Console"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold tracking-tight",children:"Seller Dialer"}),S.jsx("p",{className:"mt-2 text-white/60",children:"Focused call operations for assigned leads."})]}),S.jsx("button",{className:"button-primary",onClick:Ee,children:"Create Client Deployment"})]})}),S.jsxs("div",{className:"mt-8 grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[S.jsxs(Ft.div,{className:"glass-panel rounded-3xl p-6 border border-white/10",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:[S.jsxs("div",{className:"flex items-center justify-between mb-4",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Lead List"}),S.jsx("div",{className:"text-sm text-white/60",children:c?"Loading leads...":`${t.length} assigned`})]}),S.jsx("button",{className:"button-primary",onClick:()=>window.location.reload(),children:"Refresh"})]}),C?S.jsx("div",{className:"text-neon-pink",children:C}):null,S.jsx("div",{className:"space-y-3 max-h-[520px] overflow-y-auto pr-2",children:c?S.jsx("div",{className:"text-white/60",children:"Fetching leads..."}):t.length?t.map(_e=>S.jsx("button",{type:"button",className:"w-full text-left rounded-2xl border border-white/5 bg-black/40 p-4 hover:border-neon-cyan/40 transition",onClick:()=>J(_e),children:S.jsxs("div",{className:"flex items-start justify-between gap-3",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold",children:_e.business_name||_e.name||"Unnamed Lead"}),S.jsxs("div",{className:"text-xs text-white/50 mt-1",children:[_e.phone||"No phone"," "," ",_e.status||"new"]})]}),S.jsx("div",{className:"text-xs text-white/40 font-mono",children:y8(_e.created_at)})]})},_e.id)):S.jsx("div",{className:"text-white/60",children:"No leads assigned."})})]}),S.jsxs(Ft.div,{className:"glass-panel rounded-3xl p-6 border border-white/10",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Call Controls"}),S.jsxs("div",{className:"mt-4 glass-panel rounded-2xl p-4 border border-white/10",children:[S.jsx("div",{className:"text-xs text-white/50",children:"Active Lead"}),S.jsx("div",{className:"mt-1 text-lg font-semibold",children:(G==null?void 0:G.business_name)||(G==null?void 0:G.name)||"Select a lead"}),S.jsx("div",{className:"text-xs text-white/50",children:(G==null?void 0:G.phone)||"No phone"})]}),S.jsx("div",{className:"mt-4",children:S.jsx("input",{className:"input-field",value:m,onChange:_e=>f(_e.target.value),placeholder:"Dial number"})}),S.jsx("div",{className:"mt-4 grid grid-cols-3 gap-3",children:g8.map(_e=>S.jsx("button",{className:"button-primary",type:"button",onClick:()=>H(_e),children:_e},_e))}),S.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[S.jsx("button",{className:"button-primary",onClick:Q,children:X==="calling"?"CALLING...":"START CALL"}),S.jsx("button",{className:"button-primary",onClick:le,children:"END CALL"}),S.jsx("button",{className:"button-primary",onClick:()=>f(""),children:"CLEAR"})]}),S.jsxs("div",{className:"mt-6",children:[S.jsx("div",{className:"text-xs uppercase tracking-widest text-white/40",children:"Dispositions"}),S.jsx("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:m8.map(_e=>S.jsx("button",{className:"button-primary",onClick:()=>ve(_e.id),disabled:L===_e.id,children:L===_e.id?"UPDATING...":_e.label},_e.id))})]})]})]})]})]})}var fR={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.16.0/LICENSE.txt
 */(function(e,t){(function(i,o){e.exports=o()})(Gj,function(){var i={},o={};function h(f,c,E){if(o[f]=E,f==="index"){var C="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",R={};return o.shared(R),o.index(i,R),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),i}}h("shared",["exports"],function(f){function c(a,n,s,u){return new(s||(s=Promise))(function(p,y){function _(k){try{T(u.next(k))}catch(I){y(I)}}function b(k){try{T(u.throw(k))}catch(I){y(I)}}function T(k){var I;k.done?p(k.value):(I=k.value,I instanceof s?I:new s(function(D){D(I)})).then(_,b)}T((u=u.apply(a,n||[])).next())})}function E(a,n){this.x=a,this.y=n}function C(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var R,L;typeof SuppressedError=="function"&&SuppressedError,E.prototype={clone(){return new E(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,n){return this.clone()._rotateAround(a,n)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const n=a.x-this.x,s=a.y-this.y;return n*n+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult(a){const n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const n=Math.cos(a),s=Math.sin(a),u=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=u,this},_rotateAround(a,n){const s=Math.cos(a),u=Math.sin(a),p=n.y+u*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-u*(this.y-n.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:E},E.convert=function(a){if(a instanceof E)return a;if(Array.isArray(a))return new E(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new E(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var B=function(){if(L)return R;function a(n,s,u,p){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=u,this.p2y=p}return L=1,R=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,p=0;p<8;p++){var y=this.sampleCurveX(u)-n;if(Math.abs(y)<s)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=y/_}var b=0,T=1;for(u=n,p=0;p<20&&(y=this.sampleCurveX(u),!(Math.abs(y-n)<s));p++)n>y?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},R}(),X=C(B);let W,te;function G(){return W==null&&(W=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),W}function J(){if(te==null&&(te=!1,G())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let u=0;u<5*5;u++){const p=4*u;n.fillStyle=`rgb(${p},${p+1},${p+2})`,n.fillRect(u%5,Math.floor(u/5),1,1)}const s=n.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&s[u]!==u){te=!0;break}}}return te||!1}var H=1e-6,Q=typeof Float32Array<"u"?Float32Array:Array;function le(){var a=new Q(9);return Q!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function ve(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ee(){var a=new Q(3);return Q!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function _e(a){var n=a[0],s=a[1],u=a[2];return Math.sqrt(n*n+s*s+u*u)}function we(a,n,s){var u=new Q(3);return u[0]=a,u[1]=n,u[2]=s,u}function Ge(a,n,s){return a[0]=n[0]+s[0],a[1]=n[1]+s[1],a[2]=n[2]+s[2],a}function Je(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a}function ft(a,n,s){var u=n[0],p=n[1],y=n[2],_=s[0],b=s[1],T=s[2];return a[0]=p*T-y*b,a[1]=y*_-u*T,a[2]=u*b-p*_,a}var At,kt=_e;function gt(a,n,s){var u=n[0],p=n[1],y=n[2],_=n[3];return a[0]=s[0]*u+s[4]*p+s[8]*y+s[12]*_,a[1]=s[1]*u+s[5]*p+s[9]*y+s[13]*_,a[2]=s[2]*u+s[6]*p+s[10]*y+s[14]*_,a[3]=s[3]*u+s[7]*p+s[11]*y+s[15]*_,a}function We(){var a=new Q(4);return Q!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function wt(a,n,s,u){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",y=Math.PI/360;n*=y,u*=y,s*=y;var _=Math.sin(n),b=Math.cos(n),T=Math.sin(s),k=Math.cos(s),I=Math.sin(u),D=Math.cos(u);switch(p){case"xyz":a[0]=_*k*D+b*T*I,a[1]=b*T*D-_*k*I,a[2]=b*k*I+_*T*D,a[3]=b*k*D-_*T*I;break;case"xzy":a[0]=_*k*D-b*T*I,a[1]=b*T*D-_*k*I,a[2]=b*k*I+_*T*D,a[3]=b*k*D+_*T*I;break;case"yxz":a[0]=_*k*D+b*T*I,a[1]=b*T*D-_*k*I,a[2]=b*k*I-_*T*D,a[3]=b*k*D+_*T*I;break;case"yzx":a[0]=_*k*D+b*T*I,a[1]=b*T*D+_*k*I,a[2]=b*k*I-_*T*D,a[3]=b*k*D-_*T*I;break;case"zxy":a[0]=_*k*D-b*T*I,a[1]=b*T*D+_*k*I,a[2]=b*k*I+_*T*D,a[3]=b*k*D-_*T*I;break;case"zyx":a[0]=_*k*D-b*T*I,a[1]=b*T*D+_*k*I,a[2]=b*k*I-_*T*D,a[3]=b*k*D+_*T*I;break;default:throw new Error("Unknown angle order "+p)}return a}function bt(){var a=new Q(2);return Q!=Float32Array&&(a[0]=0,a[1]=0),a}function Ye(a,n){var s=new Q(2);return s[0]=a,s[1]=n,s}Ee(),At=new Q(4),Q!=Float32Array&&(At[0]=0,At[1]=0,At[2]=0,At[3]=0),Ee(),we(1,0,0),we(0,1,0),We(),We(),le(),bt();const Pe=8192;function at(a,n,s){return n*(Pe/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}function mt(a,n){return(a%n+n)%n}function Pt(a,n,s){return a*(1-s)+n*s}function sn(a){if(a<=0)return 0;if(a>=1)return 1;const n=a*a,s=n*a;return 4*(a<.5?s:3*(a-n)+s-.75)}function an(a,n,s,u){const p=new X(a,n,s,u);return y=>p.solve(y)}const tn=an(.25,.1,.25,1);function fn(a,n,s){return Math.min(s,Math.max(n,a))}function Yn(a,n,s){const u=s-n,p=((a-n)%u+u)%u+n;return p===n?s:p}function vr(a,...n){for(const s of n)for(const u in s)a[u]=s[u];return a}let wn=1;function Nr(a,n,s){const u={};for(const p in a)u[p]=n.call(this,a[p],p,a);return u}function Ca(a,n,s){const u={};for(const p in a)n.call(this,a[p],p,a)&&(u[p]=a[p]);return u}function ki(a){return Array.isArray(a)?a.map(ki):typeof a=="object"&&a?Nr(a,ki):a}const zs={};function ir(a){zs[a]||(typeof console<"u"&&console.warn(a),zs[a]=!0)}function mi(a,n,s){return(s.y-a.y)*(n.x-a.x)>(n.y-a.y)*(s.x-a.x)}function Fi(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let In=null;function tt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Dt(a,n,s,u,p){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(a,{timestamp:0});try{const _=y==null?void 0:y.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const b=_.startsWith("BGR"),T=new Uint8ClampedArray(u*p*4);if(yield y.copyTo(T,function(k,I,D,N,z){const V=4*Math.max(-I,0),U=(Math.max(0,D)-D)*N*4+V,q=4*N,ee=Math.max(0,I),ue=Math.max(0,D);return{rect:{x:ee,y:ue,width:Math.min(k.width,I+N)-ee,height:Math.min(k.height,D+z)-ue},layout:[{offset:U,stride:q}]}}(a,n,s,u,p)),b)for(let k=0;k<T.length;k+=4){const I=T[k];T[k]=T[k+2],T[k+2]=I}return T}finally{y.close()}})}let Wt,Ct;function Lr(a,n,s,u){return a.addEventListener(n,s,u),{unsubscribe:()=>{a.removeEventListener(n,s,u)}}}function ei(a){return a*Math.PI/180}function Mn(a){return a/Math.PI*180}const Ce={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},K={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Z="AbortError";class re extends Error{constructor(n=Z){super(n instanceof Error?n.message:n),this.name=Z,n instanceof Error&&n.stack&&(this.stack=n.stack)}}function ye(a){return a.name===Z}const be={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ie(a){return be.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const ke="global-dispatcher";class Se extends Error{constructor(n,s,u,p){super(`AJAXError: ${s} (${n}): ${u}`),this.status=n,this.statusText=s,this.url=u,this.body=p}}const Le=()=>Fi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Xe=function(a,n){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const u=Ie(a.url);if(u)return u(a,n);if(Fi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:ke},n)}if(!(/^file:/.test(s=a.url)||/^file:/.test(Le())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(u,p){return c(this,void 0,void 0,function*(){const y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:Le(),signal:p.signal});let _,b;u.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{_=yield fetch(y)}catch(k){throw ye(k)?k:new Se(0,k.message,u.url,new Blob)}if(!_.ok){const k=yield _.blob();throw new Se(_.status,_.statusText,u.url,k)}b=u.type==="arrayBuffer"||u.type==="image"?_.arrayBuffer():u.type==="json"?_.json():_.text();const T=yield b;return p.signal.throwIfAborted(),{data:T,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(a,n);if(Fi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:ke},n)}var s;return function(u,p){return new Promise((y,_)=>{var b;const T=new XMLHttpRequest;T.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(T.responseType="arraybuffer");for(const k in u.headers)T.setRequestHeader(k,u.headers[k]);u.type==="json"&&(T.responseType="text",!((b=u.headers)===null||b===void 0)&&b.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=u.credentials==="include",T.onerror=()=>{_(new Error(T.statusText))},T.onload=()=>{if(!p.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let k=T.response;if(u.type==="json")try{k=JSON.parse(T.response)}catch(I){return void _(I)}y({data:k,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const k=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});_(new Se(T.status,T.statusText,u.url,k))}},p.signal.addEventListener("abort",()=>{T.abort(),_(new re(p.signal.reason))}),T.send(u.body)})}(a,n)};function qe(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const n=new URL(a),s=window.location;return n.protocol===s.protocol&&n.host===s.host}function ut(a,n,s){s[a]&&s[a].indexOf(n)!==-1||(s[a]=s[a]||[],s[a].push(n))}function yt(a,n,s){if(s&&s[a]){const u=s[a].indexOf(n);u!==-1&&s[a].splice(u,1)}}class It{constructor(n,s={}){vr(this,s),this.type=n}}class dn extends It{constructor(n,s={}){super("error",vr({error:n},s))}}class nn{on(n,s){return this._listeners=this._listeners||{},ut(n,s,this._listeners),{unsubscribe:()=>{this.off(n,s)}}}off(n,s){return yt(n,s,this._listeners),yt(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},ut(n,s,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,s){typeof n=="string"&&(n=new It(n,s||{}));const u=n.type;if(this.listens(u)){n.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of p)b.call(this,n);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of y)yt(u,b,this._oneTimeListeners),b.call(this,n);const _=this._eventedParent;_&&(vr(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof dn&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var Re={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const mn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zr(a,n){const s={};for(const u in a)u!=="ref"&&(s[u]=a[u]);return mn.forEach(u=>{u in n&&(s[u]=n[u])}),s}function Mt(a,n){if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(let s=0;s<a.length;s++)if(!Mt(a[s],n[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&n!==null){if(typeof n!="object"||Object.keys(a).length!==Object.keys(n).length)return!1;for(const s in a)if(!Mt(a[s],n[s]))return!1;return!0}return a===n}function un(a,n){a.push(n)}function Or(a,n,s){un(s,{command:"addSource",args:[a,n[a]]})}function Cn(a,n,s){un(n,{command:"removeSource",args:[a]}),s[a]=!0}function Un(a,n,s,u){Cn(a,s,u),Or(a,n,s)}function gn(a,n,s){let u;for(u in a[s])if(Object.prototype.hasOwnProperty.call(a[s],u)&&u!=="data"&&!Mt(a[s][u],n[s][u]))return!1;for(u in n[s])if(Object.prototype.hasOwnProperty.call(n[s],u)&&u!=="data"&&!Mt(a[s][u],n[s][u]))return!1;return!0}function dr(a,n,s,u,p,y){a=a||{},n=n||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(Mt(a[_],n[_])||s.push({command:y,args:[u,_,n[_],p]}));for(const _ in n)Object.prototype.hasOwnProperty.call(n,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(Mt(a[_],n[_])||s.push({command:y,args:[u,_,n[_],p]}))}function El(a){return a.id}function Pl(a,n){return a[n.id]=n,a}class Qe{constructor(n,s,u,p){this.message=(n?`${n}: `:"")+u,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function ti(a,...n){for(const s of n)for(const u in s)a[u]=s[u];return a}class ni extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Jc{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[u,p]of s)this.bindings[u]=p}concat(n){return new Jc(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Bi={kind:"null"},lt={kind:"number"},$t={kind:"string"},Gt={kind:"boolean"},Ai={kind:"color"},Qc={kind:"projectionDefinition"},Os={kind:"object"},Bt={kind:"value"},Cl={kind:"collator"},kl={kind:"formatted"},eu={kind:"padding"},yo={kind:"colorArray"},Al={kind:"numberArray"},_o={kind:"resolvedImage"},Il={kind:"variableAnchorOffsetCollection"};function ri(a,n){return{kind:"array",itemType:a,N:n}}function hn(a){if(a.kind==="array"){const n=hn(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}const tu=[Bi,lt,$t,Gt,Ai,Qc,kl,Os,ri(Bt),eu,Al,yo,_o,Il];function vo(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!vo(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(const s of tu)if(!vo(s,n))return null}}return`Expected ${hn(a)} but found ${hn(n)} instead.`}function Ml(a,n){return n.some(s=>s.kind===a.kind)}function ka(a,n){return n.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function es(a,n){return a.kind==="array"&&n.kind==="array"?a.itemType.kind===n.itemType.kind&&typeof a.N=="number":a.kind===n.kind}const Zf=.96422,Aa=.82521,nu=4/29,$n=6/29,Hf=3*$n*$n,Kf=$n*$n*$n,Rl=Math.PI/180,Xf=180/Math.PI;function Yf(a){return(a%=360)<0&&(a+=360),a}function Jf([a,n,s,u]){let p,y;const _=ld((.2225045*(a=ru(a))+.7168786*(n=ru(n))+.0606169*(s=ru(s)))/1);a===n&&n===s?p=y=_:(p=ld((.4360747*a+.3850649*n+.1430804*s)/Zf),y=ld((.0139322*a+.0971045*n+.7141733*s)/Aa));const b=116*_-16;return[b<0?0:b,500*(p-_),200*(_-y),u]}function ru(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ld(a){return a>Kf?Math.pow(a,1/3):a/Hf+nu}function cd([a,n,s,u]){let p=(a+16)/116,y=isNaN(n)?p:p+n/500,_=isNaN(s)?p:p-s/200;return p=1*hd(p),y=Zf*hd(y),_=Aa*hd(_),[ud(3.1338561*y-1.6168667*p-.4906146*_),ud(-.9787684*y+1.9161415*p+.033454*_),ud(.0719453*y-.2289914*p+1.4052427*_),u]}function ud(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function hd(a){return a>$n?a*a*a:Hf*(a-nu)}const D_=Object.hasOwn||function(a,n){return Object.prototype.hasOwnProperty.call(a,n)};function Dl(a,n){return D_(a,n)?a[n]:void 0}function iu(a){return parseInt(a.padEnd(2,a),16)/255}function Qf(a,n){return xo(n?a/100:a,0,1)}function xo(a,n,s){return Math.min(Math.max(n,a),s)}function dd(a){return!a.some(Number.isNaN)}const jl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function sa(a,n,s){return a+s*(n-a)}function bo(a,n,s){return a.map((u,p)=>sa(u,n[p],s))}class qt{constructor(n,s,u,p=1,y=!0){this.r=n,this.g=s,this.b=u,this.a=p,y||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[n,s,u,p]))}static parse(n){if(n instanceof qt)return n;if(typeof n!="string")return;const s=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Dl(jl,u);if(p){const[_,b,T]=p;return[_/255,b/255,T/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const _=u.length<6?1:2;let b=1;return[iu(u.slice(b,b+=_)),iu(u.slice(b,b+=_)),iu(u.slice(b,b+=_)),iu(u.slice(b,b+_)||"ff")]}if(u.startsWith("rgb")){const _=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,T,k,I,D,N,z,V,U,q,ee,ue]=_,ne=[I||" ",z||" ",q].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const ie=[k,N,U].join(""),de=ie==="%%%"?100:ie===""?255:0;if(de){const me=[xo(+T/de,0,1),xo(+D/de,0,1),xo(+V/de,0,1),ee?Qf(+ee,ue):1];if(dd(me))return me}}return}}const y=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[_,b,T,k,I,D,N,z,V]=y,U=[T||" ",I||" ",N].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const q=[+b,xo(+k,0,100),xo(+D,0,100),z?Qf(+z,V):1];if(dd(q))return function([ee,ue,ne,ie]){function de(me){const Ae=(me+ee/30)%12,$e=ue*Math.min(ne,1-ne);return ne-$e*Math.max(-1,Math.min(Ae-3,9-Ae,1))}return ee=Yf(ee),ue/=100,ne/=100,[de(0),de(8),de(4),ie]}(q)}}}(n);return s?new qt(...s,!1):void 0}get rgb(){const{r:n,g:s,b:u,a:p}=this,y=p||1/0;return this.overwriteGetter("rgb",[n/y,s/y,u/y,p])}get hcl(){return this.overwriteGetter("hcl",function(n){const[s,u,p,y]=Jf(n),_=Math.sqrt(u*u+p*p);return[Math.round(1e4*_)?Yf(Math.atan2(p,u)*Xf):NaN,_,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Jf(this.rgb))}overwriteGetter(n,s){return Object.defineProperty(this,n,{value:s}),s}toString(){const[n,s,u,p]=this.rgb;return`rgba(${[n,s,u].map(y=>Math.round(255*y)).join(",")},${p})`}static interpolate(n,s,u,p="rgb"){switch(p){case"rgb":{const[y,_,b,T]=bo(n.rgb,s.rgb,u);return new qt(y,_,b,T,!1)}case"hcl":{const[y,_,b,T]=n.hcl,[k,I,D,N]=s.hcl;let z,V;if(isNaN(y)||isNaN(k))isNaN(y)?isNaN(k)?z=NaN:(z=k,b!==1&&b!==0||(V=I)):(z=y,D!==1&&D!==0||(V=_));else{let ne=k-y;k>y&&ne>180?ne-=360:k<y&&y-k>180&&(ne+=360),z=y+u*ne}const[U,q,ee,ue]=function([ne,ie,de,me]){return ne=isNaN(ne)?0:ne*Rl,cd([de,Math.cos(ne)*ie,Math.sin(ne)*ie,me])}([z,V??sa(_,I,u),sa(b,D,u),sa(T,N,u)]);return new qt(U,q,ee,ue,!1)}case"lab":{const[y,_,b,T]=cd(bo(n.lab,s.lab,u));return new qt(y,_,b,T,!1)}}}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class pd{constructor(n,s,u){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const j_=["bottom","center","top"];class fd{constructor(n,s,u,p,y,_){this.text=n,this.image=s,this.scale=u,this.fontStack=p,this.textColor=y,this.verticalAlign=_}}class gi{constructor(n){this.sections=n}static fromString(n){return new gi([new fd(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof gi?n:gi.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Wr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Wr)return n;if(typeof n=="number")return new Wr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const s of n)if(typeof s!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Wr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,u){return new Wr(bo(n.values,s.values,u))}}class zn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof zn)return n;if(typeof n=="number")return new zn([n]);if(Array.isArray(n)){for(const s of n)if(typeof s!="number")return;return new zn(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,u){return new zn(bo(n.values,s.values,u))}}class Et{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Et)return n;if(typeof n=="string"){const u=qt.parse(n);return u?new Et([u]):void 0}if(!Array.isArray(n))return;const s=[];for(const u of n){if(typeof u!="string")return;const p=qt.parse(u);if(!p)return;s.push(p)}return new Et(s)}toString(){return JSON.stringify(this.values)}static interpolate(n,s,u,p="rgb"){const y=[];if(n.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${n.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let _=0;_<n.values.length;_++)y.push(qt.interpolate(n.values[_],s.values[_],u,p));return new Et(y)}}class yn extends Error{constructor(n){super(n),this.name="RuntimeError"}toJSON(){return this.message}}const aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ii{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof ii)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let s=0;s<n.length;s+=2){const u=n[s],p=n[s+1];if(typeof u!="string"||!aa.has(u)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new ii(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,u){const p=n.values,y=s.values;if(p.length!==y.length)throw new yn(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${s.toString()}`);const _=[];for(let b=0;b<p.length;b+=2){if(p[b]!==y[b])throw new yn(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${p[b]}, to[${b}]: ${y[b]}`);_.push(p[b]);const[T,k]=p[b+1],[I,D]=y[b+1];_.push([sa(T,I,u),sa(k,D,u)])}return new ii(_)}}class Ii{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Ii({name:n,available:!1}):null}}class si{constructor(n,s,u){this.from=n,this.to=s,this.transition=u}static interpolate(n,s,u){return new si(n,s,u)}static parse(n){return n instanceof si?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new si(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new si(n.from,n.to,n.transition):typeof n=="string"?new si(n,n,1):void 0}}function wo(a,n,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,n,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,n,s,u]:[a,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oa(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof si||a instanceof qt||a instanceof pd||a instanceof gi||a instanceof Wr||a instanceof zn||a instanceof Et||a instanceof ii||a instanceof Ii)return!0;if(Array.isArray(a)){for(const n of a)if(!oa(n))return!1;return!0}if(typeof a=="object"){for(const n in a)if(!oa(a[n]))return!1;return!0}return!1}function Jn(a){if(a===null)return Bi;if(typeof a=="string")return $t;if(typeof a=="boolean")return Gt;if(typeof a=="number")return lt;if(a instanceof qt)return Ai;if(a instanceof si)return Qc;if(a instanceof pd)return Cl;if(a instanceof gi)return kl;if(a instanceof Wr)return eu;if(a instanceof zn)return Al;if(a instanceof Et)return yo;if(a instanceof ii)return Il;if(a instanceof Ii)return _o;if(Array.isArray(a)){const n=a.length;let s;for(const u of a){const p=Jn(u);if(s){if(s===p)continue;s=Bt;break}s=p}return ri(s||Bt,n)}return Os}function Ia(a){const n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof qt||a instanceof si||a instanceof gi||a instanceof Wr||a instanceof zn||a instanceof Et||a instanceof ii||a instanceof Ii?a.toString():JSON.stringify(a)}class Ss{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!oa(n[1]))return s.error("invalid value");const u=n[1];let p=Jn(u);const y=s.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Ss(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const su={string:$t,number:lt,boolean:Gt,object:Os};class yi{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let u,p=1;const y=n[0];if(y==="array"){let b,T;if(n.length>2){const k=n[1];if(typeof k!="string"||!(k in su)||k==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=su[k],p++}else b=Bt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=n[2],p++}u=ri(b,T)}else{if(!su[y])throw new Error(`Types doesn't contain name = ${y}`);u=su[y]}const _=[];for(;p<n.length;p++){const b=s.parse(n[p],p,Bt);if(!b)return null;_.push(b)}return new yi(u,_)}evaluate(n){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(n);if(!vo(this.type,Jn(u)))return u;if(s===this.args.length-1)throw new yn(`Expected value to be of type ${hn(this.type)}, but found ${hn(Jn(u))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Ma={"to-boolean":Gt,"to-color":Ai,"to-number":lt,"to-string":$t};class Fs{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const u=n[0];if(!Ma[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&n.length!==2)return s.error("Expected one argument.");const p=Ma[u],y=[];for(let _=1;_<n.length;_++){const b=s.parse(n[_],_,Bt);if(!b)return null;y.push(b)}return new Fs(p,y)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let s,u;for(const p of this.args){if(s=p.evaluate(n),u=null,s instanceof qt)return s;if(typeof s=="string"){const y=n.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:wo(s[0],s[1],s[2],s[3]),!u))return new qt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new yn(u||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const u of this.args){s=u.evaluate(n);const p=Wr.parse(s);if(p)return p}throw new yn(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const u of this.args){s=u.evaluate(n);const p=zn.parse(s);if(p)return p}throw new yn(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const u of this.args){s=u.evaluate(n);const p=Et.parse(s);if(p)return p}throw new yn(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const u of this.args){s=u.evaluate(n);const p=ii.parse(s);if(p)return p}throw new yn(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const u of this.args){if(s=u.evaluate(n),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new yn(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return gi.fromString(Ia(this.args[0].evaluate(n)));case"resolvedImage":return Ii.fromString(Ia(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return Ia(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const em=["Unknown","Point","LineString","Polygon"];class md{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?em[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let s=this._parseColorCache.get(n);return s||(s=qt.parse(n),this._parseColorCache.set(n,s)),s}}class Ra{constructor(n,s,u=[],p,y=new Jc,_=[]){this.registry=n,this.path=u,this.key=u.map(b=>`[${b}]`).join(""),this.scope=y,this.errors=_,this.expectedType=p,this._isConstant=s}parse(n,s,u,p,y={}){return s?this.concat(s,u,p)._parse(n,y):this._parse(n,y)}_parse(n,s){function u(p,y,_){return _==="assert"?new yi(y,[p]):_==="coerce"?new Fs(y,[p]):p}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=n[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let _=y.parse(n,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,T=_.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(T.kind)||b.kind==="colorArray"&&["value","string","array"].includes(T.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))_=u(_,b,s.typeAnnotation||"coerce");else if(this.checkSubtype(b,T))return null}else _=u(_,b,s.typeAnnotation||"assert")}if(!(_ instanceof Ss)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const b=new md;try{_=new Ss(_.type,_.evaluate(b))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,u){const p=typeof n=="number"?this.path.concat(n):this.path,y=u?this.scope.concat(u):this.scope;return new Ra(this.registry,this._isConstant,p,s||null,y,this.errors)}error(n,...s){const u=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new ni(u,n))}checkSubtype(n,s){const u=vo(n,s);return u&&this.error(u),u}}class _n{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let y=1;y<n.length-1;y+=2){const _=n[y];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const b=s.parse(n[y+1],y+1);if(!b)return null;u.push([_,b])}const p=s.parse(n[n.length-1],n.length-1,s.expectedType,u);return p?new _n(u,p):null}outputDefined(){return this.result.outputDefined()}}class So{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=n[1];return s.scope.has(u)?new So(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Yt{constructor(n,s,u){this.type=n,this.index=s,this.input=u}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,lt),p=s.parse(n[2],2,ri(s.expectedType||Bt));return u&&p?new Yt(p.type.itemType,u,p):null}evaluate(n){const s=this.index.evaluate(n),u=this.input.evaluate(n);if(s<0)throw new yn(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new yn(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new yn(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Vt{constructor(n,s){this.type=Gt,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Bt),p=s.parse(n[2],2,Bt);return u&&p?Ml(u.type,[Gt,$t,lt,Bi,Bt])?new Vt(u,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(u.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!u)return!1;if(!ka(s,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${hn(Jn(s))} instead.`);if(!ka(u,["string","array"]))throw new yn(`Expected second argument to be of type array or string, but found ${hn(Jn(u))} instead.`);return u.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class To{constructor(n,s,u){this.type=lt,this.needle=n,this.haystack=s,this.fromIndex=u}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Bt),p=s.parse(n[2],2,Bt);if(!u||!p)return null;if(!Ml(u.type,[Gt,$t,lt,Bi,Bt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(u.type)} instead`);if(n.length===4){const y=s.parse(n[3],3,lt);return y?new To(u,p,y):null}return new To(u,p)}evaluate(n){const s=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!ka(s,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${hn(Jn(s))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(n)),ka(u,["string"])){const y=u.indexOf(s,p);return y===-1?-1:[...u.slice(0,y)].length}if(ka(u,["array"]))return u.indexOf(s,p);throw new yn(`Expected second argument to be of type array or string, but found ${hn(Jn(u))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Jt{constructor(n,s,u,p,y,_){this.inputType=n,this.type=s,this.input=u,this.cases=p,this.outputs=y,this.otherwise=_}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let u,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const y={},_=[];for(let k=2;k<n.length-1;k+=2){let I=n[k];const D=n[k+1];Array.isArray(I)||(I=[I]);const N=s.concat(k);if(I.length===0)return N.error("Expected at least one branch label.");for(const V of I){if(typeof V!="number"&&typeof V!="string")return N.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,Jn(V)))return null}else u=Jn(V);if(y[String(V)]!==void 0)return N.error("Branch labels must be unique.");y[String(V)]=_.length}const z=s.parse(D,k,p);if(!z)return null;p=p||z.type,_.push(z)}const b=s.parse(n[1],1,Bt);if(!b)return null;const T=s.parse(n[n.length-1],n.length-1,p);return T?b.type.kind!=="value"&&s.concat(1).checkSubtype(u,b.type)?null:new Jt(u,p,b,y,_,T):null}evaluate(n){const s=this.input.evaluate(n);return(Jn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class Nl{constructor(n,s,u){this.type=n,this.branches=s,this.otherwise=u}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const p=[];for(let _=1;_<n.length-1;_+=2){const b=s.parse(n[_],_,Gt);if(!b)return null;const T=s.parse(n[_+1],_+1,u);if(!T)return null;p.push([b,T]),u=u||T.type}const y=s.parse(n[n.length-1],n.length-1,u);if(!y)return null;if(!u)throw new Error("Can't infer output type");return new Nl(u,p,y)}evaluate(n){for(const[s,u]of this.branches)if(s.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,u]of this.branches)n(s),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Vi{constructor(n,s,u,p){this.type=n,this.input=s,this.beginIndex=u,this.endIndex=p}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Bt),p=s.parse(n[2],2,lt);if(!u||!p)return null;if(!Ml(u.type,[ri(Bt),$t,Bt]))return s.error(`Expected first argument to be of type array or string, but found ${hn(u.type)} instead`);if(n.length===4){const y=s.parse(n[3],3,lt);return y?new Vi(u.type,u,p,y):null}return new Vi(u.type,u,p)}evaluate(n){const s=this.input.evaluate(n),u=this.beginIndex.evaluate(n);let p;if(this.endIndex&&(p=this.endIndex.evaluate(n)),ka(s,["string"]))return[...s].slice(u,p).join("");if(ka(s,["array"]))return s.slice(u,p);throw new yn(`Expected first argument to be of type array or string, but found ${hn(Jn(s))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function Eo(a,n){const s=a.length-1;let u,p,y=0,_=s,b=0;for(;y<=_;)if(b=Math.floor((y+_)/2),u=a[b],p=a[b+1],u<=n){if(b===s||n<p)return b;y=b+1}else{if(!(u>n))throw new yn("Input is not a number.");_=b-1}return 0}class la{constructor(n,s,u){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[p,y]of u)this.labels.push(p),this.outputs.push(y)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(n[1],1,lt);if(!u)return null;const p=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let _=1;_<n.length;_+=2){const b=_===1?-1/0:n[_],T=n[_+1],k=_,I=_+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(p.length&&p[p.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const D=s.parse(T,I,y);if(!D)return null;y=y||D.type,p.push([b,D])}return new la(y,u,p)}evaluate(n){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(n);const p=this.input.evaluate(n);if(p<=s[0])return u[0].evaluate(n);const y=s.length;return p>=s[y-1]?u[y-1].evaluate(n):u[Eo(s,p)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function tm(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Ll,gd,N_=function(){if(gd)return Ll;function a(n,s,u,p){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=u,this.p2y=p}return gd=1,Ll=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var u=n,p=0;p<8;p++){var y=this.sampleCurveX(u)-n;if(Math.abs(y)<s)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=y/_}var b=0,T=1;for(u=n,p=0;p<20&&(y=this.sampleCurveX(u),!(Math.abs(y-n)<s));p++)n>y?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},Ll}(),nm=tm(N_);class ai{constructor(n,s,u,p,y){this.type=n,this.operator=s,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[_,b]of y)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(n,s,u,p){let y=0;if(n.name==="exponential")y=Ts(s,n.base,u,p);else if(n.name==="linear")y=Ts(s,1,u,p);else if(n.name==="cubic-bezier"){const _=n.controlPoints;y=new nm(_[0],_[1],_[2],_[3]).solve(Ts(s,1,u,p))}return y}static parse(n,s){let[u,p,y,..._]=n;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const k=p[1];if(typeof k!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:k}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const k=p.slice(1);if(k.length!==4||k.some(I=>typeof I!="number"||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:k}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,lt),!y)return null;const b=[];let T=null;u!=="interpolate-hcl"&&u!=="interpolate-lab"||s.expectedType==yo?s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType):T=Ai;for(let k=0;k<_.length;k+=2){const I=_[k],D=_[k+1],N=k+3,z=k+4;if(typeof I!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(b.length&&b[b.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const V=s.parse(D,z,T);if(!V)return null;T=T||V.type,b.push([I,V])}return es(T,lt)||es(T,Qc)||es(T,Ai)||es(T,eu)||es(T,Al)||es(T,yo)||es(T,Il)||es(T,ri(lt))?new ai(T,u,p,y,b):s.error(`Type ${hn(T)} is not interpolatable.`)}evaluate(n){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(n);const p=this.input.evaluate(n);if(p<=s[0])return u[0].evaluate(n);const y=s.length;if(p>=s[y-1])return u[y-1].evaluate(n);const _=Eo(s,p),b=ai.interpolationFactor(this.interpolation,p,s[_],s[_+1]),T=u[_].evaluate(n),k=u[_+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return sa(T,k,b);case"color":return qt.interpolate(T,k,b);case"padding":return Wr.interpolate(T,k,b);case"colorArray":return Et.interpolate(T,k,b);case"numberArray":return zn.interpolate(T,k,b);case"variableAnchorOffsetCollection":return ii.interpolate(T,k,b);case"array":return bo(T,k,b);case"projectionDefinition":return si.interpolate(T,k,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return qt.interpolate(T,k,b,"hcl");case"colorArray":return Et.interpolate(T,k,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return qt.interpolate(T,k,b,"lab");case"colorArray":return Et.interpolate(T,k,b,"lab")}}}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Ts(a,n,s,u){const p=u-s,y=a-s;return p===0?0:n===1?y/p:(Math.pow(n,y)-1)/(Math.pow(n,p)-1)}const Rn={color:qt.interpolate,number:sa,padding:Wr.interpolate,numberArray:zn.interpolate,colorArray:Et.interpolate,variableAnchorOffsetCollection:ii.interpolate,array:bo};class Da{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let u=null;const p=s.expectedType;p&&p.kind!=="value"&&(u=p);const y=[];for(const b of n.slice(1)){const T=s.parse(b,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,y.push(T)}if(!u)throw new Error("No output type");const _=p&&y.some(b=>vo(p,b.type));return new Da(_?Bt:u,y)}evaluate(n){let s,u=null,p=0;for(const y of this.args)if(p++,u=y.evaluate(n),u&&u instanceof Ii&&!u.available&&(s||(s=u.name),u=null,p===this.args.length&&(u=s)),u!==null)break;return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function yd(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function zl(a,n,s,u){return u.compare(n,s)===0}function Gn(a,n,s){const u=a!=="=="&&a!=="!=";return class mR{constructor(y,_,b){this.type=Gt,this.lhs=y,this.rhs=_,this.collator=b,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const b=y[0];let T=_.parse(y[1],1,Bt);if(!T)return null;if(!yd(b,T.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${hn(T.type)}'.`);let k=_.parse(y[2],2,Bt);if(!k)return null;if(!yd(b,k.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${hn(k.type)}'.`);if(T.type.kind!==k.type.kind&&T.type.kind!=="value"&&k.type.kind!=="value")return _.error(`Cannot compare types '${hn(T.type)}' and '${hn(k.type)}'.`);u&&(T.type.kind==="value"&&k.type.kind!=="value"?T=new yi(k.type,[T]):T.type.kind!=="value"&&k.type.kind==="value"&&(k=new yi(T.type,[k])));let I=null;if(y.length===4){if(T.type.kind!=="string"&&k.type.kind!=="string"&&T.type.kind!=="value"&&k.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(y[3],3,Cl),!I)return null}return new mR(T,k,I)}evaluate(y){const _=this.lhs.evaluate(y),b=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const T=Jn(_),k=Jn(b);if(T.kind!==k.kind||T.kind!=="string"&&T.kind!=="number")throw new yn(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${k.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=Jn(_),k=Jn(b);if(T.kind!=="string"||k.kind!=="string")return n(y,_,b)}return this.collator?s(y,_,b,this.collator.evaluate(y)):n(y,_,b)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const rm=Gn("==",function(a,n,s){return n===s},zl),_d=Gn("!=",function(a,n,s){return n!==s},function(a,n,s,u){return!zl(0,n,s,u)}),im=Gn("<",function(a,n,s){return n<s},function(a,n,s,u){return u.compare(n,s)<0}),L_=Gn(">",function(a,n,s){return n>s},function(a,n,s,u){return u.compare(n,s)>0}),Po=Gn("<=",function(a,n,s){return n<=s},function(a,n,s,u){return u.compare(n,s)<=0}),au=Gn(">=",function(a,n,s){return n>=s},function(a,n,s,u){return u.compare(n,s)>=0});class Co{constructor(n,s,u){this.type=Cl,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const p=s.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Gt);if(!p)return null;const y=s.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Gt);if(!y)return null;let _=null;return u.locale&&(_=s.parse(u.locale,1,$t),!_)?null:new Co(p,y,_)}evaluate(n){return new pd(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class vd{constructor(n,s,u,p,y){this.type=$t,this.number=n,this.locale=s,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const u=s.parse(n[1],1,lt);if(!u)return null;const p=n[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=s.parse(p.locale,1,$t),!y))return null;let _=null;if(p.currency&&(_=s.parse(p.currency,1,$t),!_))return null;let b=null;if(p["min-fraction-digits"]&&(b=s.parse(p["min-fraction-digits"],1,lt),!b))return null;let T=null;return p["max-fraction-digits"]&&(T=s.parse(p["max-fraction-digits"],1,lt),!T)?null:new vd(u,y,_,b,T)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class Ol{constructor(n){this.type=kl,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const p=[];let y=!1;for(let _=1;_<=n.length-1;++_){const b=n[_];if(y&&typeof b=="object"&&!Array.isArray(b)){y=!1;let T=null;if(b["font-scale"]&&(T=s.parse(b["font-scale"],1,lt),!T))return null;let k=null;if(b["text-font"]&&(k=s.parse(b["text-font"],1,ri($t)),!k))return null;let I=null;if(b["text-color"]&&(I=s.parse(b["text-color"],1,Ai),!I))return null;let D=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!j_.includes(b["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(D=s.parse(b["vertical-align"],1,$t),!D)return null}const N=p[p.length-1];N.scale=T,N.font=k,N.textColor=I,N.verticalAlign=D}else{const T=s.parse(n[_],1,Bt);if(!T)return null;const k=T.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ol(p)}evaluate(n){return new gi(this.sections.map(s=>{const u=s.content.evaluate(n);return Jn(u)===_o?new fd("",u,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(n):null):new fd(Ia(u),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null,s.verticalAlign?s.verticalAlign.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor),s.verticalAlign&&n(s.verticalAlign)}outputDefined(){return!1}}class ko{constructor(n){this.type=_o,this.input=n}static parse(n,s){if(n.length!==2)return s.error("Expected two arguments.");const u=s.parse(n[1],1,$t);return u?new ko(u):s.error("No image name provided.")}evaluate(n){const s=this.input.evaluate(n),u=Ii.fromString(s);return u&&n.availableImages&&(u.available=n.availableImages.indexOf(s)>-1),u}eachChild(n){n(this.input)}outputDefined(){return!1}}class Ao{constructor(n){this.type=lt,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=s.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${hn(u.type)} instead.`):new Ao(u):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new yn(`Expected value to be of type string or array, but found ${hn(Jn(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const pr=8192;function sm(a,n){const s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,n.z);return[Math.round(s*p*pr),Math.round(u*p*pr)]}function Io(a,n){const s=Math.pow(2,n.z);return[(p=(a[0]/pr+n.x)/s,360*p-180),(u=(a[1]/pr+n.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,p}function Fl(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function ja(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function z_(a,n,s){const u=a[0]-n[0],p=a[1]-n[1],y=a[0]-s[0],_=a[1]-s[1];return u*_-y*p==0&&u*y<=0&&p*_<=0}function ou(a,n,s,u){return(p=[u[0]-s[0],u[1]-s[1]])[0]*(y=[n[0]-a[0],n[1]-a[1]])[1]-p[1]*y[0]!=0&&!(!xd(a,n,s,u)||!xd(s,u,a,n));var p,y}function O_(a,n,s){for(const u of s)for(let p=0;p<u.length-1;++p)if(ou(a,n,u[p],u[p+1]))return!0;return!1}function Mo(a,n,s=!1){let u=!1;for(const b of n)for(let T=0;T<b.length-1;T++){if(z_(a,b[T],b[T+1]))return s;(y=b[T])[1]>(p=a)[1]!=(_=b[T+1])[1]>p[1]&&p[0]<(_[0]-y[0])*(p[1]-y[1])/(_[1]-y[1])+y[0]&&(u=!u)}var p,y,_;return u}function lu(a,n){for(const s of n)if(Mo(a,s))return!0;return!1}function am(a,n){for(const s of a)if(!Mo(s,n))return!1;for(let s=0;s<a.length-1;++s)if(O_(a[s],a[s+1],n))return!1;return!0}function om(a,n){for(const s of n)if(am(a,s))return!0;return!1}function xd(a,n,s,u){const p=u[0]-s[0],y=u[1]-s[1],_=(a[0]-s[0])*y-p*(a[1]-s[1]),b=(n[0]-s[0])*y-p*(n[1]-s[1]);return _>0&&b<0||_<0&&b>0}function bd(a,n,s){const u=[];for(let p=0;p<a.length;p++){const y=[];for(let _=0;_<a[p].length;_++){const b=sm(a[p][_],s);Fl(n,b),y.push(b)}u.push(y)}return u}function wd(a,n,s){const u=[];for(let p=0;p<a.length;p++){const y=bd(a[p],n,s);u.push(y)}return u}function lm(a,n,s,u){if(a[0]<s[0]||a[0]>s[2]){const p=.5*u;let y=a[0]-s[0]>p?-u:s[0]-a[0]>p?u:0;y===0&&(y=a[0]-s[2]>p?-u:s[2]-a[0]>p?u:0),a[0]+=y}Fl(n,a)}function cm(a,n,s,u){const p=Math.pow(2,u.z)*pr,y=[u.x*pr,u.y*pr],_=[];for(const b of a)for(const T of b){const k=[T.x+y[0],T.y+y[1]];lm(k,n,s,p),_.push(k)}return _}function um(a,n,s,u){const p=Math.pow(2,u.z)*pr,y=[u.x*pr,u.y*pr],_=[];for(const T of a){const k=[];for(const I of T){const D=[I.x+y[0],I.y+y[1]];Fl(n,D),k.push(D)}_.push(k)}if(n[2]-n[0]<=p/2){(b=n)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of _)for(const k of T)lm(k,n,s,p)}var b;return _}class Na{constructor(n,s){this.type=Gt,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(oa(n[1])){const u=n[1];if(u.type==="FeatureCollection"){const p=[];for(const y of u.features){const{type:_,coordinates:b}=y.geometry;_==="Polygon"&&p.push(b),_==="MultiPolygon"&&p.push(...b)}if(p.length)return new Na(u,{type:"MultiPolygon",coordinates:p})}else if(u.type==="Feature"){const p=u.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Na(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Na(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(u.type==="Polygon"){const b=bd(u.coordinates,y,_),T=cm(s.geometry(),p,y,_);if(!ja(p,y))return!1;for(const k of T)if(!Mo(k,b))return!1}if(u.type==="MultiPolygon"){const b=wd(u.coordinates,y,_),T=cm(s.geometry(),p,y,_);if(!ja(p,y))return!1;for(const k of T)if(!lu(k,b))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(u.type==="Polygon"){const b=bd(u.coordinates,y,_),T=um(s.geometry(),p,y,_);if(!ja(p,y))return!1;for(const k of T)if(!am(k,b))return!1}if(u.type==="MultiPolygon"){const b=wd(u.coordinates,y,_),T=um(s.geometry(),p,y,_);if(!ja(p,y))return!1;for(const k of T)if(!om(k,b))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let hm=class{constructor(a=[],n=(s,u)=>s<u?-1:s>u?1:0){if(this.data=a,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:n,compare:s}=this,u=n[a];for(;a>0;){const p=a-1>>1,y=n[p];if(s(u,y)>=0)break;n[a]=y,a=p}n[a]=u}_down(a){const{data:n,compare:s}=this,u=this.length>>1,p=n[a];for(;a<u;){let y=1+(a<<1);const _=y+1;if(_<this.length&&s(n[_],n[y])<0&&(y=_),s(n[y],p)>=0)break;n[a]=n[y],a=y}n[a]=p}};function Sd(a,n,s=0,u=a.length-1,p=dm){for(;u>s;){if(u-s>600){const T=u-s+1,k=n-s+1,I=Math.log(T),D=.5*Math.exp(2*I/3),N=.5*Math.sqrt(I*D*(T-D)/T)*(k-T/2<0?-1:1);Sd(a,n,Math.max(s,Math.floor(n-k*D/T+N)),Math.min(u,Math.floor(n+(T-k)*D/T+N)),p)}const y=a[n];let _=s,b=u;for(Ro(a,s,n),p(a[u],y)>0&&Ro(a,s,u);_<b;){for(Ro(a,_,b),_++,b--;p(a[_],y)<0;)_++;for(;p(a[b],y)>0;)b--}p(a[s],y)===0?Ro(a,s,b):(b++,Ro(a,b,u)),b<=n&&(s=b+1),n<=b&&(u=b-1)}}function Ro(a,n,s){const u=a[n];a[n]=a[s],a[s]=u}function dm(a,n){return a<n?-1:a>n?1:0}function cu(a,n){if(a.length<=1)return[a];const s=[];let u,p;for(const y of a){const _=B_(y);_!==0&&(y.area=Math.abs(_),p===void 0&&(p=_<0),p===_<0?(u&&s.push(u),u=[y]):u.push(y))}if(u&&s.push(u),n>1)for(let y=0;y<s.length;y++)s[y].length<=n||(Sd(s[y],n,1,s[y].length-1,F_),s[y]=s[y].slice(0,n));return s}function F_(a,n){return n.area-a.area}function B_(a){let n=0;for(let s,u,p=0,y=a.length,_=y-1;p<y;_=p++)s=a[p],u=a[_],n+=(u.x-s.x)*(s.y+u.y);return n}const pm=1/298.257223563,Bl=pm*(2-pm),fm=Math.PI/180;class Td{constructor(n){const s=6378.137*fm*1e3,u=Math.cos(n*fm),p=1/(1-Bl*(1-u*u)),y=Math.sqrt(p);this.kx=s*y*u,this.ky=s*y*p*(1-Bl)}distance(n,s){const u=this.wrap(n[0]-s[0])*this.kx,p=(n[1]-s[1])*this.ky;return Math.sqrt(u*u+p*p)}pointOnLine(n,s){let u,p,y,_,b=1/0;for(let T=0;T<n.length-1;T++){let k=n[T][0],I=n[T][1],D=this.wrap(n[T+1][0]-k)*this.kx,N=(n[T+1][1]-I)*this.ky,z=0;D===0&&N===0||(z=(this.wrap(s[0]-k)*this.kx*D+(s[1]-I)*this.ky*N)/(D*D+N*N),z>1?(k=n[T+1][0],I=n[T+1][1]):z>0&&(k+=D/this.kx*z,I+=N/this.ky*z)),D=this.wrap(s[0]-k)*this.kx,N=(s[1]-I)*this.ky;const V=D*D+N*N;V<b&&(b=V,u=k,p=I,y=T,_=z)}return{point:[u,p],index:y,t:Math.max(0,Math.min(1,_))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function mm(a,n){return n[0]-a[0]}function uu(a){return a[1]-a[0]+1}function ts(a,n){return a[1]>=a[0]&&a[1]<n}function hu(a,n){if(a[0]>a[1])return[null,null];const s=uu(a);if(n){if(s===2)return[a,null];const p=Math.floor(s/2);return[[a[0],a[0]+p],[a[0]+p,a[1]]]}if(s===1)return[a,null];const u=Math.floor(s/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}function Ed(a,n){if(!ts(n,a.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let u=n[0];u<=n[1];++u)Fl(s,a[u]);return s}function Pd(a){const n=[1/0,1/0,-1/0,-1/0];for(const s of a)for(const u of s)Fl(n,u);return n}function Cd(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function du(a,n,s){if(!Cd(a)||!Cd(n))return NaN;let u=0,p=0;return a[2]<n[0]&&(u=n[0]-a[2]),a[0]>n[2]&&(u=a[0]-n[2]),a[1]>n[3]&&(p=a[1]-n[3]),a[3]<n[1]&&(p=n[1]-a[3]),s.distance([0,0],[u,p])}function La(a,n,s){const u=s.pointOnLine(n,a);return s.distance(a,u.point)}function kd(a,n,s,u,p){const y=Math.min(La(a,[s,u],p),La(n,[s,u],p)),_=Math.min(La(s,[a,n],p),La(u,[a,n],p));return Math.min(y,_)}function V_(a,n,s,u,p){if(!ts(n,a.length)||!ts(u,s.length))return 1/0;let y=1/0;for(let _=n[0];_<n[1];++_){const b=a[_],T=a[_+1];for(let k=u[0];k<u[1];++k){const I=s[k],D=s[k+1];if(ou(b,T,I,D))return 0;y=Math.min(y,kd(b,T,I,D,p))}}return y}function gm(a,n,s,u,p){if(!ts(n,a.length)||!ts(u,s.length))return NaN;let y=1/0;for(let _=n[0];_<=n[1];++_)for(let b=u[0];b<=u[1];++b)if(y=Math.min(y,p.distance(a[_],s[b])),y===0)return y;return y}function U_(a,n,s){if(Mo(a,n,!0))return 0;let u=1/0;for(const p of n){const y=p[0],_=p[p.length-1];if(y!==_&&(u=Math.min(u,La(a,[_,y],s)),u===0))return u;const b=s.pointOnLine(p,a);if(u=Math.min(u,s.distance(a,b.point)),u===0)return u}return u}function $_(a,n,s,u){if(!ts(n,a.length))return NaN;for(let y=n[0];y<=n[1];++y)if(Mo(a[y],s,!0))return 0;let p=1/0;for(let y=n[0];y<n[1];++y){const _=a[y],b=a[y+1];for(const T of s)for(let k=0,I=T.length,D=I-1;k<I;D=k++){const N=T[D],z=T[k];if(ou(_,b,N,z))return 0;p=Math.min(p,kd(_,b,N,z,u))}}return p}function ym(a,n){for(const s of a)for(const u of s)if(Mo(u,n,!0))return!0;return!1}function G_(a,n,s,u=1/0){const p=Pd(a),y=Pd(n);if(u!==1/0&&du(p,y,s)>=u)return u;if(ja(p,y)){if(ym(a,n))return 0}else if(ym(n,a))return 0;let _=1/0;for(const b of a)for(let T=0,k=b.length,I=k-1;T<k;I=T++){const D=b[I],N=b[T];for(const z of n)for(let V=0,U=z.length,q=U-1;V<U;q=V++){const ee=z[q],ue=z[V];if(ou(D,N,ee,ue))return 0;_=Math.min(_,kd(D,N,ee,ue,s))}}return _}function rn(a,n,s,u,p,y){if(!y)return;const _=du(Ed(u,y),p,s);_<n&&a.push([_,y,[0,0]])}function pu(a,n,s,u,p,y,_){if(!y||!_)return;const b=du(Ed(u,y),Ed(p,_),s);b<n&&a.push([b,y,_])}function fu(a,n,s,u,p=1/0){let y=Math.min(u.distance(a[0],s[0][0]),p);if(y===0)return y;const _=new hm([[0,[0,a.length-1],[0,0]]],mm),b=Pd(s);for(;_.length>0;){const T=_.pop();if(T[0]>=y)continue;const k=T[1],I=n?50:100;if(uu(k)<=I){if(!ts(k,a.length))return NaN;if(n){const D=$_(a,k,s,u);if(isNaN(D)||D===0)return D;y=Math.min(y,D)}else for(let D=k[0];D<=k[1];++D){const N=U_(a[D],s,u);if(y=Math.min(y,N),y===0)return 0}}else{const D=hu(k,n);rn(_,y,u,a,b,D[0]),rn(_,y,u,a,b,D[1])}}return y}function mu(a,n,s,u,p,y=1/0){let _=Math.min(y,p.distance(a[0],s[0]));if(_===0)return _;const b=new hm([[0,[0,a.length-1],[0,s.length-1]]],mm);for(;b.length>0;){const T=b.pop();if(T[0]>=_)continue;const k=T[1],I=T[2],D=n?50:100,N=u?50:100;if(uu(k)<=D&&uu(I)<=N){if(!ts(k,a.length)&&ts(I,s.length))return NaN;let z;if(n&&u)z=V_(a,k,s,I,p),_=Math.min(_,z);else if(n&&!u){const V=a.slice(k[0],k[1]+1);for(let U=I[0];U<=I[1];++U)if(z=La(s[U],V,p),_=Math.min(_,z),_===0)return _}else if(!n&&u){const V=s.slice(I[0],I[1]+1);for(let U=k[0];U<=k[1];++U)if(z=La(a[U],V,p),_=Math.min(_,z),_===0)return _}else z=gm(a,k,s,I,p),_=Math.min(_,z)}else{const z=hu(k,n),V=hu(I,u);pu(b,_,p,a,s,z[0],V[0]),pu(b,_,p,a,s,z[0],V[1]),pu(b,_,p,a,s,z[1],V[0]),pu(b,_,p,a,s,z[1],V[1])}}return _}function Ad(a){return a.type==="MultiPolygon"?a.coordinates.map(n=>({type:"Polygon",coordinates:n})):a.type==="MultiLineString"?a.coordinates.map(n=>({type:"LineString",coordinates:n})):a.type==="MultiPoint"?a.coordinates.map(n=>({type:"Point",coordinates:n})):[a]}class za{constructor(n,s){this.type=lt,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(oa(n[1])){const u=n[1];if(u.type==="FeatureCollection")return new za(u,u.features.map(p=>Ad(p.geometry)).flat());if(u.type==="Feature")return new za(u,Ad(u.geometry));if("type"in u&&"coordinates"in u)return new za(u,Ad(u))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,u){const p=s.geometry(),y=p.flat().map(T=>Io([T.x,T.y],s.canonical));if(p.length===0)return NaN;const _=new Td(y[0][1]);let b=1/0;for(const T of u){switch(T.type){case"Point":b=Math.min(b,mu(y,!1,[T.coordinates],!1,_,b));break;case"LineString":b=Math.min(b,mu(y,!1,T.coordinates,!0,_,b));break;case"Polygon":b=Math.min(b,fu(y,!1,T.coordinates,_,b))}if(b===0)return b}return b}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,u){const p=s.geometry(),y=p.flat().map(T=>Io([T.x,T.y],s.canonical));if(p.length===0)return NaN;const _=new Td(y[0][1]);let b=1/0;for(const T of u){switch(T.type){case"Point":b=Math.min(b,mu(y,!0,[T.coordinates],!1,_,b));break;case"LineString":b=Math.min(b,mu(y,!0,T.coordinates,!0,_,b));break;case"Polygon":b=Math.min(b,fu(y,!0,T.coordinates,_,b))}if(b===0)return b}return b}(n,this.geometries);if(n.geometryType()==="Polygon")return function(s,u){const p=s.geometry();if(p.length===0||p[0].length===0)return NaN;const y=cu(p,0).map(T=>T.map(k=>k.map(I=>Io([I.x,I.y],s.canonical)))),_=new Td(y[0][0][0][1]);let b=1/0;for(const T of u)for(const k of y){switch(T.type){case"Point":b=Math.min(b,fu([T.coordinates],!1,k,_,b));break;case"LineString":b=Math.min(b,fu(T.coordinates,!0,k,_,b));break;case"Polygon":b=Math.min(b,G_(k,T.coordinates,_,b))}if(b===0)return b}return b}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Vl{constructor(n){this.type=Bt,this.key=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=n[1];return u==null?s.error("Global state property must be defined."):typeof u!="string"?s.error(`Global state property must be string, but found ${typeof n[1]} instead.`):new Vl(u)}evaluate(n){var s;const u=(s=n.globals)===null||s===void 0?void 0:s.globalState;return u&&Object.keys(u).length!==0?Dl(u,this.key):null}eachChild(){}outputDefined(){return!1}}const Do={"==":rm,"!=":_d,">":L_,"<":im,">=":au,"<=":Po,array:yi,at:Yt,boolean:yi,case:Nl,coalesce:Da,collator:Co,format:Ol,image:ko,in:Vt,"index-of":To,interpolate:ai,"interpolate-hcl":ai,"interpolate-lab":ai,length:Ao,let:_n,literal:Ss,match:Jt,number:yi,"number-format":vd,object:yi,slice:Vi,step:la,string:yi,"to-boolean":Fs,"to-color":Fs,"to-number":Fs,"to-string":Fs,var:So,within:Na,distance:za,"global-state":Vl};class Ui{constructor(n,s,u,p){this.name=n,this.type=s,this._evaluate=u,this.args=p}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,s){const u=n[0],p=Ui.definitions[u];if(!p)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,b=_.filter(([k])=>!Array.isArray(k)||k.length===n.length-1);let T=null;for(const[k,I]of b){T=new Ra(s.registry,gu,s.path,null,s.scope);const D=[];let N=!1;for(let z=1;z<n.length;z++){const V=n[z],U=Array.isArray(k)?k[z-1]:k.type,q=T.parse(V,1+D.length,U);if(!q){N=!0;break}D.push(q)}if(!N)if(Array.isArray(k)&&k.length!==D.length)T.error(`Expected ${k.length} arguments, but found ${D.length} instead.`);else{for(let z=0;z<D.length;z++){const V=Array.isArray(k)?k[z]:k.type,U=D[z];T.concat(z+1).checkSubtype(V,U.type)}if(T.errors.length===0)return new Ui(u,y,I,D)}}if(b.length===1)s.errors.push(...T.errors);else{const k=(b.length?b:_).map(([D])=>{return N=D,Array.isArray(N)?`(${N.map(hn).join(", ")})`:`(${hn(N.type)}...)`;var N}).join(" | "),I=[];for(let D=1;D<n.length;D++){const N=s.parse(n[D],1+I.length);if(!N)return null;I.push(hn(N.type))}s.error(`Expected arguments of type ${k}, but found (${I.join(", ")}) instead.`)}return null}static register(n,s){Ui.definitions=s;for(const u in s)n[u]=Ui}}function _m(a,[n,s,u,p]){n=n.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const y=p?p.evaluate(a):1,_=wo(n,s,u,y);if(_)throw new yn(_);return new qt(n/255,s/255,u/255,y,!1)}function vm(a,n){return a in n}function Id(a,n){const s=n[a];return s===void 0?null:s}function Oa(a){return{type:a}}function gu(a){if(a instanceof So)return gu(a.boundExpression);if(a instanceof Ui&&a.name==="error"||a instanceof Co||a instanceof Na||a instanceof za||a instanceof Vl)return!1;const n=a instanceof Fs||a instanceof yi;let s=!0;return a.eachChild(u=>{s=n?s&&gu(u):s&&u instanceof Ss}),!!s&&yu(a)&&_u(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function yu(a){if(a instanceof Ui&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Na||a instanceof za)return!1;let n=!0;return a.eachChild(s=>{n&&!yu(s)&&(n=!1)}),n}function Ul(a){if(a instanceof Ui&&a.name==="feature-state")return!1;let n=!0;return a.eachChild(s=>{n&&!Ul(s)&&(n=!1)}),n}function _u(a,n){if(a instanceof Ui&&n.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!_u(u,n)&&(s=!1)}),s}function xm(a){return{result:"success",value:a}}function jo(a){return{result:"error",value:a}}function No(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function bm(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Md(a){return!!a.expression&&a.expression.interpolated}function Zt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function vu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&Jn(a)===Os}function q_(a){return a}function wm(a,n){const s=a.stops&&typeof a.stops[0][0]=="object",u=s||!(s||a.property!==void 0),p=a.type||(Md(n)?"exponential":"interval"),y=function(I){switch(I.type){case"color":return qt.parse;case"padding":return Wr.parse;case"numberArray":return zn.parse;case"colorArray":return Et.parse;default:return null}}(n);if(y&&((a=ti({},a)).stops&&(a.stops=a.stops.map(I=>[I[0],y(I[1])])),a.default=y(a.default?a.default:n.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const b=function(I){switch(I){case"exponential":return Sm;case"interval":return Z_;case"categorical":return W_;case"identity":return H_;default:throw new Error(`Unknown function type "${I}"`)}}(p);let T,k;if(p==="categorical"){T=Object.create(null);for(const I of a.stops)T[I[0]]=I[1];k=typeof a.stops[0][0]}if(s){const I={},D=[];for(let V=0;V<a.stops.length;V++){const U=a.stops[V],q=U[0].zoom;I[q]===void 0&&(I[q]={zoom:q,type:a.type,property:a.property,default:a.default,stops:[]},D.push(q)),I[q].stops.push([U[0].value,U[1]])}const N=[];for(const V of D)N.push([I[V].zoom,wm(I[V],n)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:ai.interpolationFactor.bind(void 0,z),zoomStops:N.map(V=>V[0]),evaluate:({zoom:V},U)=>Sm({stops:N,base:a.base},n,V).evaluate(V,U)}}if(u){const I=p==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:ai.interpolationFactor.bind(void 0,I),zoomStops:a.stops.map(D=>D[0]),evaluate:({zoom:D})=>b(a,n,D,T,k)}}return{kind:"source",evaluate(I,D){const N=D&&D.properties?D.properties[a.property]:void 0;return N===void 0?$l(a.default,n.default):b(a,n,N,T,k)}}}function $l(a,n,s){return a!==void 0?a:n!==void 0?n:s!==void 0?s:void 0}function W_(a,n,s,u,p){return $l(typeof s===p?u[s]:void 0,a.default,n.default)}function Z_(a,n,s){if(Zt(s)!=="number")return $l(a.default,n.default);const u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];const p=Eo(a.stops.map(y=>y[0]),s);return a.stops[p][1]}function Sm(a,n,s){const u=a.base!==void 0?a.base:1;if(Zt(s)!=="number")return $l(a.default,n.default);const p=a.stops.length;if(p===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[p-1][0])return a.stops[p-1][1];const y=Eo(a.stops.map(I=>I[0]),s),_=function(I,D,N,z){const V=z-N,U=I-N;return V===0?0:D===1?U/V:(Math.pow(D,U)-1)/(Math.pow(D,V)-1)}(s,u,a.stops[y][0],a.stops[y+1][0]),b=a.stops[y][1],T=a.stops[y+1][1],k=Rn[n.type]||q_;return typeof b.evaluate=="function"?{evaluate(...I){const D=b.evaluate.apply(void 0,I),N=T.evaluate.apply(void 0,I);if(D!==void 0&&N!==void 0)return k(D,N,_,a.colorSpace)}}:k(b,T,_,a.colorSpace)}function H_(a,n,s){switch(n.type){case"color":s=qt.parse(s);break;case"formatted":s=gi.fromString(s.toString());break;case"resolvedImage":s=Ii.fromString(s.toString());break;case"padding":s=Wr.parse(s);break;case"colorArray":s=Et.parse(s);break;case"numberArray":s=zn.parse(s);break;default:Zt(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0)}return $l(s,a.default,n.default)}Ui.register(Do,{error:[{kind:"error"},[$t],(a,[n])=>{throw new yn(n.evaluate(a))}],typeof:[$t,[Bt],(a,[n])=>hn(Jn(n.evaluate(a)))],"to-rgba":[ri(lt,4),[Ai],(a,[n])=>{const[s,u,p,y]=n.evaluate(a).rgb;return[255*s,255*u,255*p,y]}],rgb:[Ai,[lt,lt,lt],_m],rgba:[Ai,[lt,lt,lt,lt],_m],has:{type:Gt,overloads:[[[$t],(a,[n])=>vm(n.evaluate(a),a.properties())],[[$t,Os],(a,[n,s])=>vm(n.evaluate(a),s.evaluate(a))]]},get:{type:Bt,overloads:[[[$t],(a,[n])=>Id(n.evaluate(a),a.properties())],[[$t,Os],(a,[n,s])=>Id(n.evaluate(a),s.evaluate(a))]]},"feature-state":[Bt,[$t],(a,[n])=>Id(n.evaluate(a),a.featureState||{})],properties:[Os,[],a=>a.properties()],"geometry-type":[$t,[],a=>a.geometryType()],id:[Bt,[],a=>a.id()],zoom:[lt,[],a=>a.globals.zoom],"heatmap-density":[lt,[],a=>a.globals.heatmapDensity||0],elevation:[lt,[],a=>a.globals.elevation||0],"line-progress":[lt,[],a=>a.globals.lineProgress||0],accumulated:[Bt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[lt,Oa(lt),(a,n)=>{let s=0;for(const u of n)s+=u.evaluate(a);return s}],"*":[lt,Oa(lt),(a,n)=>{let s=1;for(const u of n)s*=u.evaluate(a);return s}],"-":{type:lt,overloads:[[[lt,lt],(a,[n,s])=>n.evaluate(a)-s.evaluate(a)],[[lt],(a,[n])=>-n.evaluate(a)]]},"/":[lt,[lt,lt],(a,[n,s])=>n.evaluate(a)/s.evaluate(a)],"%":[lt,[lt,lt],(a,[n,s])=>n.evaluate(a)%s.evaluate(a)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(a,[n,s])=>Math.pow(n.evaluate(a),s.evaluate(a))],sqrt:[lt,[lt],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[lt,[lt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[lt,[lt],(a,[n])=>Math.log(n.evaluate(a))],log2:[lt,[lt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN2],sin:[lt,[lt],(a,[n])=>Math.sin(n.evaluate(a))],cos:[lt,[lt],(a,[n])=>Math.cos(n.evaluate(a))],tan:[lt,[lt],(a,[n])=>Math.tan(n.evaluate(a))],asin:[lt,[lt],(a,[n])=>Math.asin(n.evaluate(a))],acos:[lt,[lt],(a,[n])=>Math.acos(n.evaluate(a))],atan:[lt,[lt],(a,[n])=>Math.atan(n.evaluate(a))],min:[lt,Oa(lt),(a,n)=>Math.min(...n.map(s=>s.evaluate(a)))],max:[lt,Oa(lt),(a,n)=>Math.max(...n.map(s=>s.evaluate(a)))],abs:[lt,[lt],(a,[n])=>Math.abs(n.evaluate(a))],round:[lt,[lt],(a,[n])=>{const s=n.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[lt,[lt],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[lt,[lt],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[Gt,[$t,Bt],(a,[n,s])=>a.properties()[n.value]===s.value],"filter-id-==":[Gt,[Bt],(a,[n])=>a.id()===n.value],"filter-type-==":[Gt,[$t],(a,[n])=>a.geometryType()===n.value],"filter-<":[Gt,[$t,Bt],(a,[n,s])=>{const u=a.properties()[n.value],p=s.value;return typeof u==typeof p&&u<p}],"filter-id-<":[Gt,[Bt],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s<u}],"filter->":[Gt,[$t,Bt],(a,[n,s])=>{const u=a.properties()[n.value],p=s.value;return typeof u==typeof p&&u>p}],"filter-id->":[Gt,[Bt],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s>u}],"filter-<=":[Gt,[$t,Bt],(a,[n,s])=>{const u=a.properties()[n.value],p=s.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[Gt,[Bt],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s<=u}],"filter->=":[Gt,[$t,Bt],(a,[n,s])=>{const u=a.properties()[n.value],p=s.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[Gt,[Bt],(a,[n])=>{const s=a.id(),u=n.value;return typeof s==typeof u&&s>=u}],"filter-has":[Gt,[Bt],(a,[n])=>n.value in a.properties()],"filter-has-id":[Gt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Gt,[ri($t)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[Gt,[ri(Bt)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[Gt,[$t,ri(Bt)],(a,[n,s])=>s.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[Gt,[$t,ri(Bt)],(a,[n,s])=>function(u,p,y,_){for(;y<=_;){const b=y+_>>1;if(p[b]===u)return!0;p[b]>u?_=b-1:y=b+1}return!1}(a.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(a,[n,s])=>n.evaluate(a)&&s.evaluate(a)],[Oa(Gt),(a,n)=>{for(const s of n)if(!s.evaluate(a))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(a,[n,s])=>n.evaluate(a)||s.evaluate(a)],[Oa(Gt),(a,n)=>{for(const s of n)if(s.evaluate(a))return!0;return!1}]]},"!":[Gt,[Gt],(a,[n])=>!n.evaluate(a)],"is-supported-script":[Gt,[$t],(a,[n])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(n.evaluate(a))}],upcase:[$t,[$t],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[$t,[$t],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[$t,Oa(Bt),(a,n)=>n.map(s=>Ia(s.evaluate(a))).join("")],"resolved-locale":[$t,[Cl],(a,[n])=>n.evaluate(a).resolvedLocale()]});class Rd{constructor(n,s,u){this.expression=n,this._warningHistory={},this._evaluator=new md,this._defaultValue=s?function(p){if(p.type==="color"&&vu(p.default))return new qt(0,0,0,0);switch(p.type){case"color":return qt.parse(p.default)||null;case"padding":return Wr.parse(p.default)||null;case"numberArray":return zn.parse(p.default)||null;case"colorArray":return Et.parse(p.default)||null;case"variableAnchorOffsetCollection":return ii.parse(p.default)||null;case"projectionDefinition":return si.parse(p.default)||null;default:return p.default===void 0?null:p.default}}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this._globalState=u}evaluateWithoutErrorHandling(n,s,u,p,y,_){return this._globalState&&(n=Fa(n,this._globalState)),this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(n,s,u,p,y,_){this._globalState&&(n=Fa(n,this._globalState)),this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new yn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Lo(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Do}function Gl(a,n,s){const u=new Ra(Do,gu,[],n?function(y){const _={color:Ai,string:$t,number:lt,enum:$t,boolean:Gt,formatted:kl,padding:eu,numberArray:Al,colorArray:yo,projectionDefinition:Qc,resolvedImage:_o,variableAnchorOffsetCollection:Il};return y.type==="array"?ri(_[y.value]||Bt,y.length):_[y.type]}(n):void 0),p=u.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?xm(new Rd(p,n,s)):jo(u.errors)}class xu{constructor(n,s,u){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!Ul(s.expression),this.globalStateRefs=ca(s.expression),this._globalState=u}evaluateWithoutErrorHandling(n,s,u,p,y,_){return this._globalState&&(n=Fa(n,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(n,s,u,p,y,_)}evaluate(n,s,u,p,y,_){return this._globalState&&(n=Fa(n,this._globalState)),this._styleExpression.evaluate(n,s,u,p,y,_)}}class Dd{constructor(n,s,u,p,y){this.kind=n,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!Ul(s.expression),this.globalStateRefs=ca(s.expression),this.interpolationType=p,this._globalState=y}evaluateWithoutErrorHandling(n,s,u,p,y,_){return this._globalState&&(n=Fa(n,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(n,s,u,p,y,_)}evaluate(n,s,u,p,y,_){return this._globalState&&(n=Fa(n,this._globalState)),this._styleExpression.evaluate(n,s,u,p,y,_)}interpolationFactor(n,s,u){return this.interpolationType?ai.interpolationFactor(this.interpolationType,n,s,u):0}}function jd(a,n,s){const u=Gl(a,n,s);if(u.result==="error")return u;const p=u.value.expression,y=yu(p);if(!y&&!No(n))return jo([new ni("","data expressions not supported")]);const _=_u(p,["zoom"]);if(!_&&!bm(n))return jo([new ni("","zoom expressions not supported")]);const b=wu(p);return b||_?b instanceof ni?jo([b]):b instanceof ai&&!Md(n)?jo([new ni("",'"interpolate" expressions cannot be used with this property')]):xm(b?new Dd(y?"camera":"composite",u.value,b.labels,b instanceof ai?b.interpolation:void 0,s):new xu(y?"constant":"source",u.value,s)):jo([new ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class bu{constructor(n,s){this._parameters=n,this._specification=s,ti(this,wm(this._parameters,this._specification))}static deserialize(n){return new bu(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function wu(a){let n=null;if(a instanceof _n)n=wu(a.result);else if(a instanceof Da){for(const s of a.args)if(n=wu(s),n)break}else(a instanceof la||a instanceof ai)&&a.input instanceof Ui&&a.input.name==="zoom"&&(n=a);return n instanceof ni||a.eachChild(s=>{const u=wu(s);u instanceof ni?n=u:!n&&u?n=new ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&u&&n!==u&&(n=new ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function ca(a,n=new Set){return a instanceof Vl&&n.add(a.key),a.eachChild(s=>{ca(s,n)}),n}function Fa(a,n){const{zoom:s,heatmapDensity:u,elevation:p,lineProgress:y,isSupportedScript:_,accumulated:b}=a??{};return{zoom:s,heatmapDensity:u,elevation:p,lineProgress:y,isSupportedScript:_,accumulated:b,globalState:n}}function Nd(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const n of a.slice(1))if(!Nd(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const K_={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ql(a,n){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Nd(a)||(a=Wl(a));const s=Gl(a,K_,n);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,p,y)=>s.value.evaluate(u,p,{},y),needGeometry:Tm(a),getGlobalStateRefs:()=>ca(s.value.expression)}}function X_(a,n){return a<n?-1:a>n?1:0}function Tm(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let n=1;n<a.length;n++)if(Tm(a[n]))return!0;return!1}function Wl(a){if(!a)return!0;const n=a[0];return a.length<=1?n!=="any":n==="=="?Su(a[1],a[2],"=="):n==="!="?Zl(Su(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Su(a[1],a[2],n):n==="any"?(s=a.slice(1),["any"].concat(s.map(Wl))):n==="all"?["all"].concat(a.slice(1).map(Wl)):n==="none"?["all"].concat(a.slice(1).map(Wl).map(Zl)):n==="in"?Em(a[1],a.slice(2)):n==="!in"?Zl(Em(a[1],a.slice(2))):n==="has"?Pm(a[1]):n!=="!has"||Zl(Pm(a[1]));var s}function Su(a,n,s){switch(a){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,a,n]}}function Em(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",a,["literal",n.sort(X_)]]:["filter-in-small",a,["literal",n]]}}function Pm(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Zl(a){return["!",a]}function Tu(a){const n=typeof a;if(n==="number"||n==="boolean"||n==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let p="[";for(const y of a)p+=`${Tu(y)},`;return`${p}]`}const s=Object.keys(a).sort();let u="{";for(let p=0;p<s.length;p++)u+=`${JSON.stringify(s[p])}:${Tu(a[s[p]])},`;return`${u}}`}function Cm(a){let n="";for(const s of mn)n+=`/${Tu(a[s])}`;return n}function km(a){const n=a.value;return n?[new Qe(a.key,n,"constants have been deprecated as of v8")]:[]}function Qn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ba(a){if(Array.isArray(a))return a.map(Ba);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const n={};for(const s in a)n[s]=Ba(a[s]);return n}return Qn(a)}function Mi(a){const n=a.key,s=a.value,u=a.valueSpec||{},p=a.objectElementValidators||{},y=a.style,_=a.styleSpec,b=a.validateSpec;let T=[];const k=Zt(s);if(k!=="object")return[new Qe(n,s,`object expected, ${k} found`)];for(const I in s){const D=I.split(".")[0],N=Dl(u,D)||u["*"];let z;if(Dl(p,D))z=p[D];else if(Dl(u,D)){if(s[I]===void 0)continue;z=b}else if(p["*"])z=p["*"];else{if(!u["*"]){T.push(new Qe(n,s[I],`unknown property "${I}"`));continue}z=b}T=T.concat(z({key:(n&&`${n}.`)+I,value:s[I],valueSpec:N,style:y,styleSpec:_,object:s,objectKey:I,validateSpec:b},s))}for(const I in u)p[I]||u[I].required&&u[I].default===void 0&&s[I]===void 0&&T.push(new Qe(n,s,`missing required property "${I}"`));return T}function Eu(a){const n=a.value,s=a.valueSpec,u=a.style,p=a.styleSpec,y=a.key,_=a.arrayElementValidator||a.validateSpec;if(Zt(n)!=="array")return[new Qe(y,n,`array expected, ${Zt(n)} found`)];if(s.length&&n.length!==s.length)return[new Qe(y,n,`array length ${s.length} expected, length ${n.length} found`)];let b={type:s.value,values:s.values};p.$version<7&&(b.function=s.function),Zt(s.value)==="object"&&(b=s.value);let T=[];for(let k=0;k<n.length;k++)T=T.concat(_({array:n,arrayIndex:k,value:n[k],valueSpec:b,validateSpec:a.validateSpec,style:u,styleSpec:p,key:`${y}[${k}]`}));return T}function Hl(a){const n=a.key,s=a.value,u=a.valueSpec;let p=Zt(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new Qe(n,s,`number expected, ${p} found`)]:"minimum"in u&&s<u.minimum?[new Qe(n,s,`${s} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&s>u.maximum?[new Qe(n,s,`${s} is greater than the maximum value ${u.maximum}`)]:[]}function Pu(a){const n=a.valueSpec,s=Qn(a.value.type);let u,p,y,_={};const b=s!=="categorical"&&a.value.property===void 0,T=!b,k=Zt(a.value.stops)==="array"&&Zt(a.value.stops[0])==="array"&&Zt(a.value.stops[0][0])==="object",I=Mi({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(z){if(s==="identity")return[new Qe(z.key,z.value,'identity function may not have a "stops" property')];let V=[];const U=z.value;return V=V.concat(Eu({key:z.key,value:U,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:D})),Zt(U)==="array"&&U.length===0&&V.push(new Qe(z.key,U,"array must have at least one stop")),V},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:n,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return s==="identity"&&b&&I.push(new Qe(a.key,a.value,'missing required property "property"')),s==="identity"||a.value.stops||I.push(new Qe(a.key,a.value,'missing required property "stops"')),s==="exponential"&&a.valueSpec.expression&&!Md(a.valueSpec)&&I.push(new Qe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!No(a.valueSpec)?I.push(new Qe(a.key,a.value,"property functions not supported")):b&&!bm(a.valueSpec)&&I.push(new Qe(a.key,a.value,"zoom functions not supported"))),s!=="categorical"&&!k||a.value.property!==void 0||I.push(new Qe(a.key,a.value,'"property" property is required')),I;function D(z){let V=[];const U=z.value,q=z.key;if(Zt(U)!=="array")return[new Qe(q,U,`array expected, ${Zt(U)} found`)];if(U.length!==2)return[new Qe(q,U,`array length 2 expected, length ${U.length} found`)];if(k){if(Zt(U[0])!=="object")return[new Qe(q,U,`object expected, ${Zt(U[0])} found`)];if(U[0].zoom===void 0)return[new Qe(q,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new Qe(q,U,"object stop key must have value")];if(y&&y>Qn(U[0].zoom))return[new Qe(q,U[0].zoom,"stop zoom values must appear in ascending order")];Qn(U[0].zoom)!==y&&(y=Qn(U[0].zoom),p=void 0,_={}),V=V.concat(Mi({key:`${q}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Hl,value:N}}))}else V=V.concat(N({key:`${q}[0]`,value:U[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},U));return Lo(Ba(U[1]))?V.concat([new Qe(`${q}[1]`,U[1],"expressions are not allowed in function stops.")]):V.concat(z.validateSpec({key:`${q}[1]`,value:U[1],valueSpec:n,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function N(z,V){const U=Zt(z.value),q=Qn(z.value),ee=z.value!==null?z.value:V;if(u){if(U!==u)return[new Qe(z.key,ee,`${U} stop domain type must match previous stop domain type ${u}`)]}else u=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new Qe(z.key,ee,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&s!=="categorical"){let ue=`number expected, ${U} found`;return No(n)&&s===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(z.key,ee,ue)]}return s!=="categorical"||U!=="number"||isFinite(q)&&Math.floor(q)===q?s!=="categorical"&&U==="number"&&p!==void 0&&q<p?[new Qe(z.key,ee,"stop domain values must appear in ascending order")]:(p=q,s==="categorical"&&q in _?[new Qe(z.key,ee,"stop domain values must be unique")]:(_[q]=!0,[])):[new Qe(z.key,ee,`integer expected, found ${q}`)]}}function ua(a){const n=(a.expressionContext==="property"?jd:Gl)(Ba(a.value),a.valueSpec);if(n.result==="error")return n.value.map(u=>new Qe(`${a.key}${u.key}`,a.value,u.message));const s=n.value.expression||n.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!s.outputDefined())return[new Qe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Ul(s))return[new Qe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Ul(s))return[new Qe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!_u(s,["zoom","feature-state"]))return[new Qe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!yu(s))return[new Qe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kl(a){const n=a.key,s=a.value,u=Zt(s);return u!=="string"?[new Qe(n,s,`color expected, ${u} found`)]:qt.parse(String(s))?[]:[new Qe(n,s,`color expected, "${s}" found`)]}function Va(a){const n=a.key,s=a.value,u=a.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(Qn(s))===-1&&p.push(new Qe(n,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(u.values).indexOf(Qn(s))===-1&&p.push(new Qe(n,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function zo(a){return Nd(Ba(a.value))?ua(ti({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Am(a)}function Am(a){const n=a.value,s=a.key;if(Zt(n)!=="array")return[new Qe(s,n,`array expected, ${Zt(n)} found`)];const u=a.styleSpec;let p,y=[];if(n.length<1)return[new Qe(s,n,"filter array must have at least 1 element")];switch(y=y.concat(Va({key:`${s}[0]`,value:n[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),Qn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Qn(n[1])==="$type"&&y.push(new Qe(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new Qe(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(p=Zt(n[1]),p!=="string"&&y.push(new Qe(`${s}[1]`,n[1],`string expected, ${p} found`)));for(let _=2;_<n.length;_++)p=Zt(n[_]),Qn(n[1])==="$type"?y=y.concat(Va({key:`${s}[${_}]`,value:n[_],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new Qe(`${s}[${_}]`,n[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)y=y.concat(Am({key:`${s}[${_}]`,value:n[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Zt(n[1]),n.length!==2?y.push(new Qe(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new Qe(`${s}[1]`,n[1],`string expected, ${p} found`))}return y}function Im(a,n){const s=a.key,u=a.validateSpec,p=a.style,y=a.styleSpec,_=a.value,b=a.objectKey,T=y[`${n}_${a.layerType}`];if(!T)return[];const k=b.match(/^(.*)-transition$/);if(n==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return u({key:s,value:_,valueSpec:y.transition,style:p,styleSpec:y});const I=a.valueSpec||T[b];if(!I)return[new Qe(s,_,`unknown property "${b}"`)];let D;if(Zt(_)==="string"&&No(I)&&!I.tokens&&(D=/^{([^}]+)}$/.exec(_)))return[new Qe(s,_,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const N=[];return a.layerType==="symbol"&&b==="text-font"&&vu(Ba(_))&&Qn(_.type)==="identity"&&N.push(new Qe(s,_,'"text-font" does not support identity functions')),N.concat(u({key:a.key,value:_,valueSpec:I,style:p,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:b}))}function Mm(a){return Im(a,"paint")}function Rm(a){return Im(a,"layout")}function Dm(a){let n=[];const s=a.value,u=a.key,p=a.style,y=a.styleSpec;if(Zt(s)!=="object")return[new Qe(u,s,`object expected, ${Zt(s)} found`)];s.type||s.ref||n.push(new Qe(u,s,'either "type" or "ref" is required'));let _=Qn(s.type);const b=Qn(s.ref);if(s.id){const T=Qn(s.id);for(let k=0;k<a.arrayIndex;k++){const I=p.layers[k];Qn(I.id)===T&&n.push(new Qe(u,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(k=>{k in s&&n.push(new Qe(u,s[k],`"${k}" is prohibited for ref layers`))}),p.layers.forEach(k=>{Qn(k.id)===b&&(T=k)}),T?T.ref?n.push(new Qe(u,s.ref,"ref cannot reference another ref layer")):_=Qn(T.type):n.push(new Qe(u,s.ref,`ref layer "${b}" not found`))}else if(_!=="background")if(s.source){const T=p.sources&&p.sources[s.source],k=T&&Qn(T.type);T?k==="vector"&&_==="raster"?n.push(new Qe(u,s.source,`layer "${s.id}" requires a raster source`)):k!=="raster-dem"&&_==="hillshade"||k!=="raster-dem"&&_==="color-relief"?n.push(new Qe(u,s.source,`layer "${s.id}" requires a raster-dem source`)):k==="raster"&&_!=="raster"?n.push(new Qe(u,s.source,`layer "${s.id}" requires a vector source`)):k!=="vector"||s["source-layer"]?k==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?n.push(new Qe(u,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!s.paint||!s.paint["line-gradient"]||k==="geojson"&&T.lineMetrics||n.push(new Qe(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Qe(u,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new Qe(u,s.source,`source "${s.source}" not found`))}else n.push(new Qe(u,s,'missing required property "source"'));return n=n.concat(Mi({key:u,value:s,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${u}.type`,value:s.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:s,objectKey:"type"}),filter:zo,layout:T=>Mi({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>Rm(ti({layerType:_},k))}}),paint:T=>Mi({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>Mm(ti({layerType:_},k))}})}})),n}function ha(a){const n=a.value,s=a.key,u=Zt(n);return u!=="string"?[new Qe(s,n,`string expected, ${u} found`)]:[]}const Ld={promoteId:function({key:a,value:n}){if(Zt(n)==="string")return ha({key:a,value:n});{const s=[];for(const u in n)s.push(...ha({key:`${a}.${u}`,value:n[u]}));return s}}};function zd(a){const n=a.value,s=a.key,u=a.styleSpec,p=a.style,y=a.validateSpec;if(!n.type)return[new Qe(s,n,'"type" is required')];const _=Qn(n.type);let b;switch(_){case"vector":case"raster":return b=Mi({key:s,value:n,valueSpec:u[`source_${_.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Ld,validateSpec:y}),b;case"raster-dem":return b=function(T){var k;const I=(k=T.sourceName)!==null&&k!==void 0?k:"",D=T.value,N=T.styleSpec,z=N.source_raster_dem,V=T.style;let U=[];const q=Zt(D);if(D===void 0)return U;if(q!=="object")return U.push(new Qe("source_raster_dem",D,`object expected, ${q} found`)),U;const ee=Qn(D.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],ne=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ie in D)!ee&&ue.includes(ie)?U.push(new Qe(ie,D[ie],`In "${I}": "${ie}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):z[ie]?U=U.concat(T.validateSpec({key:ie,value:D[ie],valueSpec:z[ie],validateSpec:T.validateSpec,style:V,styleSpec:N})):U.push(new Qe(ie,D[ie],`unknown property "${ie}"`));return U}({sourceName:s,value:n,style:a.style,styleSpec:u,validateSpec:y}),b;case"geojson":if(b=Mi({key:s,value:n,valueSpec:u.source_geojson,style:p,styleSpec:u,validateSpec:y,objectElementValidators:Ld}),n.cluster)for(const T in n.clusterProperties){const[k,I]=n.clusterProperties[T],D=typeof k=="string"?[k,["accumulated"],["get",T]]:k;b.push(...ua({key:`${s}.${T}.map`,value:I,expressionContext:"cluster-map"})),b.push(...ua({key:`${s}.${T}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return b;case"video":return Mi({key:s,value:n,valueSpec:u.source_video,style:p,validateSpec:y,styleSpec:u});case"image":return Mi({key:s,value:n,valueSpec:u.source_image,style:p,validateSpec:y,styleSpec:u});case"canvas":return[new Qe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Va({key:`${s}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Xl(a){const n=a.value,s=a.styleSpec,u=s.light,p=a.style;let y=[];const _=Zt(n);if(n===void 0)return y;if(_!=="object")return y=y.concat([new Qe("light",n,`object expected, ${_} found`)]),y;for(const b in n){const T=b.match(/^(.*)-transition$/);y=y.concat(T&&u[T[1]]&&u[T[1]].transition?a.validateSpec({key:b,value:n[b],valueSpec:s.transition,validateSpec:a.validateSpec,style:p,styleSpec:s}):u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],validateSpec:a.validateSpec,style:p,styleSpec:s}):[new Qe(b,n[b],`unknown property "${b}"`)])}return y}function jm(a){const n=a.value,s=a.styleSpec,u=s.sky,p=a.style,y=Zt(n);if(n===void 0)return[];if(y!=="object")return[new Qe("sky",n,`object expected, ${y} found`)];let _=[];for(const b in n)_=_.concat(u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],style:p,styleSpec:s}):[new Qe(b,n[b],`unknown property "${b}"`)]);return _}function Od(a){const n=a.value,s=a.styleSpec,u=s.terrain,p=a.style;let y=[];const _=Zt(n);if(n===void 0)return y;if(_!=="object")return y=y.concat([new Qe("terrain",n,`object expected, ${_} found`)]),y;for(const b in n)y=y.concat(u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],validateSpec:a.validateSpec,style:p,styleSpec:s}):[new Qe(b,n[b],`unknown property "${b}"`)]);return y}function Fd(a){let n=[];const s=a.value,u=a.key;if(Array.isArray(s)){const p=[],y=[];for(const _ in s)s[_].id&&p.includes(s[_].id)&&n.push(new Qe(u,s,`all the sprites' ids must be unique, but ${s[_].id} is duplicated`)),p.push(s[_].id),s[_].url&&y.includes(s[_].url)&&n.push(new Qe(u,s,`all the sprites' URLs must be unique, but ${s[_].url} is duplicated`)),y.push(s[_].url),n=n.concat(Mi({key:`${u}[${_}]`,value:s[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return n}return ha({key:u,value:s})}function Nm(a){return!!a&&a.constructor===Object}function Bd(a){return Nm(a.value)?[]:[new Qe(a.key,a.value,`object expected, ${Zt(a.value)} found`)]}const Vd={"*":()=>[],array:Eu,boolean:function(a){const n=a.value,s=a.key,u=Zt(n);return u!=="boolean"?[new Qe(s,n,`boolean expected, ${u} found`)]:[]},number:Hl,color:Kl,constants:km,enum:Va,filter:zo,function:Pu,layer:Dm,object:Mi,source:zd,light:Xl,sky:jm,terrain:Od,projection:function(a){const n=a.value,s=a.styleSpec,u=s.projection,p=a.style,y=Zt(n);if(n===void 0)return[];if(y!=="object")return[new Qe("projection",n,`object expected, ${y} found`)];let _=[];for(const b in n)_=_.concat(u[b]?a.validateSpec({key:b,value:n[b],valueSpec:u[b],style:p,styleSpec:s}):[new Qe(b,n[b],`unknown property "${b}"`)]);return _},projectionDefinition:function(a){const n=a.key;let s=a.value;s=s instanceof String?s.valueOf():s;const u=Zt(s);return u!=="array"||function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"}(s)||function(p){return!!["interpolate","step","literal"].includes(p[0])}(s)?["array","string"].includes(u)?[]:[new Qe(n,s,`projection expected, invalid type "${u}" found`)]:[new Qe(n,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:ha,formatted:function(a){return ha(a).length===0?[]:ua(a)},resolvedImage:function(a){return ha(a).length===0?[]:ua(a)},padding:function(a){const n=a.key,s=a.value;if(Zt(s)==="array"){if(s.length<1||s.length>4)return[new Qe(n,s,`padding requires 1 to 4 values; ${s.length} values found`)];const u={type:"number"};let p=[];for(let y=0;y<s.length;y++)p=p.concat(a.validateSpec({key:`${n}[${y}]`,value:s[y],validateSpec:a.validateSpec,valueSpec:u}));return p}return Hl({key:n,value:s,valueSpec:{}})},numberArray:function(a){const n=a.key,s=a.value;if(Zt(s)==="array"){const u={type:"number"};if(s.length<1)return[new Qe(n,s,"array length at least 1 expected, length 0 found")];let p=[];for(let y=0;y<s.length;y++)p=p.concat(a.validateSpec({key:`${n}[${y}]`,value:s[y],validateSpec:a.validateSpec,valueSpec:u}));return p}return Hl({key:n,value:s,valueSpec:{}})},colorArray:function(a){const n=a.key,s=a.value;if(Zt(s)==="array"){if(s.length<1)return[new Qe(n,s,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<s.length;p++)u=u.concat(Kl({key:`${n}[${p}]`,value:s[p]}));return u}return Kl({key:n,value:s})},variableAnchorOffsetCollection:function(a){const n=a.key,s=a.value,u=Zt(s),p=a.styleSpec;if(u!=="array"||s.length<1||s.length%2!=0)return[new Qe(n,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let _=0;_<s.length;_+=2)y=y.concat(Va({key:`${n}[${_}]`,value:s[_],valueSpec:p.layout_symbol["text-anchor"]})),y=y.concat(Eu({key:`${n}[${_+1}]`,value:s[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:p}));return y},sprite:Fd,state:Bd,fontFaces:function(a){const n=a.key,s=a.value,u=a.validateSpec,p=a.styleSpec,y=a.style;if(!Nm(s))return[new Qe(n,s,`object expected, ${Zt(s)} found`)];const _=[];for(const b in s){const T=s[b],k=Zt(T);if(k==="string")_.push(...ha({key:`${n}.${b}`,value:T}));else if(k==="array"){const I={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[D,N]of T.entries())_.push(...Mi({key:`${n}.${b}[${D}]`,value:N,valueSpec:I,styleSpec:p,style:y,validateSpec:u}))}else _.push(new Qe(`${n}.${b}`,T,`string or array expected, ${k} found`))}return _}};function da(a){const n=a.value,s=a.valueSpec,u=a.styleSpec;return a.validateSpec=da,s.expression&&vu(Qn(n))?Pu(a):s.expression&&Lo(Ba(n))?ua(a):s.type&&Vd[s.type]?Vd[s.type](a):Mi(ti({},a,{valueSpec:s.type?u[s.type]:s}))}function Lm(a){const n=a.value,s=a.key,u=ha(a);return u.length||(n.indexOf("{fontstack}")===-1&&u.push(new Qe(s,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&u.push(new Qe(s,n,'"glyphs" url must include a "{range}" token'))),u}function $i(a,n=Re){let s=[];return s=s.concat(da({key:"",value:a,valueSpec:n.$root,styleSpec:n,style:a,validateSpec:da,objectElementValidators:{glyphs:Lm,"*":()=>[]}})),a.constants&&(s=s.concat(km({key:"constants",value:a.constants}))),zm(s)}function ns(a){return function(n){return a(Object.assign({},n,{validateSpec:da}))}}function zm(a){return[].concat(a).sort((n,s)=>n.line-s.line)}function rs(a){return function(...n){return zm(a.apply(this,n))}}$i.source=rs(ns(zd)),$i.sprite=rs(ns(Fd)),$i.glyphs=rs(ns(Lm)),$i.light=rs(ns(Xl)),$i.sky=rs(ns(jm)),$i.terrain=rs(ns(Od)),$i.state=rs(ns(Bd)),$i.layer=rs(ns(Dm)),$i.filter=rs(ns(zo)),$i.paintProperty=rs(ns(Mm)),$i.layoutProperty=rs(ns(Rm));const Y_={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Yl{constructor(n,s){this._globalState=s,this.setValue(n)}evaluate(){var n;return(n=this._literalValue)!==null&&n!==void 0?n:this._compiledValue.evaluate({})}setValue(n){if(n==null||n==="visible"||n==="none")return this._literalValue=n==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const s=Gl(n,Y_,this._globalState);if(s.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));this._literalValue=void 0,this._compiledValue=s.value,this._globalStateRefs=ca(s.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Jl=Re,Pr=$i,Ql=Pr.light,Om=Pr.sky,J_=Pr.paintProperty,Q_=Pr.layoutProperty;function Oo(a,n){let s=!1;if(n&&n.length)for(const u of n)a.fire(new dn(new Error(u.message))),s=!0;return s}class Fo{constructor(n,s,u){const p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(s=_[1])+2*(u=_[2]);for(let T=0;T<this.d*this.d;T++){const k=_[3+T],I=_[3+T+1];p.push(k===I?null:_.subarray(k,I))}const b=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],b),this.bboxes=_.subarray(b),this.insert=this._insertReadonly}else{this.d=s+2*u;for(let _=0;_<this.d*this.d;_++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=n,this.padding=u,this.scale=s/n,this.uid=0;const y=u/s*n;this.min=-y,this.max=n+y}insert(n,s,u,p,y){this._forEachCell(s,u,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,s,u,p,y,_){this.cells[y].push(_)}query(n,s,u,p,y){const _=this.min,b=this.max;if(n<=_&&s<=_&&b<=u&&b<=p&&!y)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(n,s,u,p,this._queryCell,T,{},y),T}}_queryCell(n,s,u,p,y,_,b,T){const k=this.cells[y];if(k!==null){const I=this.keys,D=this.bboxes;for(let N=0;N<k.length;N++){const z=k[N];if(b[z]===void 0){const V=4*z;(T?T(D[V+0],D[V+1],D[V+2],D[V+3]):n<=D[V+2]&&s<=D[V+3]&&u>=D[V+0]&&p>=D[V+1])?(b[z]=!0,_.push(I[z])):b[z]=!1}}}}_forEachCell(n,s,u,p,y,_,b,T){const k=this._convertToCellCoord(n),I=this._convertToCellCoord(s),D=this._convertToCellCoord(u),N=this._convertToCellCoord(p);for(let z=k;z<=D;z++)for(let V=I;V<=N;V++){const U=this.d*V+z;if((!T||T(this._convertFromCellCoord(z),this._convertFromCellCoord(V),this._convertFromCellCoord(z+1),this._convertFromCellCoord(V+1)))&&y.call(this,n,s,u,p,U,_,b,T))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,s=3+this.cells.length+1+1;let u=0;for(let _=0;_<this.cells.length;_++)u+=this.cells[_].length;const p=new Int32Array(s+u+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=s;for(let _=0;_<n.length;_++){const b=n[_];p[3+_]=y,p.set(b,y),y+=b.length}return p[3+n.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+n.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(n,s){const u=n.toArrayBuffer();return s&&s.push(u),{buffer:u}}static deserialize(n){return new Fo(n.buffer)}}const is={};function dt(a,n,s={}){if(is[a])throw new Error(`${a} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:a,writeable:!1}),is[a]={klass:n,omit:s.omit||[],shallow:s.shallow||[]}}dt("Object",Object),dt("Set",Set),dt("TransferableGridIndex",Fo),dt("Color",qt),dt("Error",Error),dt("AJAXError",Se),dt("ResolvedImage",Ii),dt("StylePropertyFunction",bu),dt("StyleExpression",Rd,{omit:["_evaluator"]}),dt("ZoomDependentExpression",Dd),dt("ZoomConstantExpression",xu),dt("CompoundExpression",Ui,{omit:["_evaluate"]});for(const a in Do)Do[a]._classRegistryKey||dt(`Expression_${a}`,Do[a]);function Cu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ud(a){return a.$name||a.constructor._classRegistryKey}function Bo(a){return!function(n){if(n===null||typeof n!="object")return!1;const s=Ud(n);return!(!s||s==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||Cu(a)||tt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function ec(a,n){if(Bo(a))return(Cu(a)||tt(a))&&n&&n.push(a),ArrayBuffer.isView(a)&&n&&n.push(a.buffer),a instanceof ImageData&&n&&n.push(a.data.buffer),a;if(Array.isArray(a)){const y=[];for(const _ of a)y.push(ec(_,n));return y}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const s=Ud(a);if(!s)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!is[s])throw new Error(`${s} is not registered.`);const{klass:u}=is[s],p=u.serialize?u.serialize(a,n):{};if(u.serialize){if(n&&p===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in a){if(!a.hasOwnProperty(y)||is[s].omit.indexOf(y)>=0)continue;const _=a[y];p[y]=is[s].shallow.indexOf(y)>=0?_:ec(_,n)}a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(p.$name=s),p}function tc(a){if(Bo(a))return a;if(Array.isArray(a))return a.map(tc);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const n=Ud(a)||"Object";if(!is[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:s}=is[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(a);const u=Object.create(s.prototype);for(const p of Object.keys(a)){if(p==="$name")continue;const y=a[p];u[p]=is[n].shallow.indexOf(p)>=0?y:tc(y)}return u}class $d{constructor(){this.first=!0}update(n,s){const u=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=u,!0))}}function nc(a){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(a))}function Gd(a){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(a))}function Fm(a){return/\s/u.test(String.fromCodePoint(a))}function Vo(a){for(const n of a)if(Gd(n.codePointAt(0)))return!0;return!1}function ev(a){for(const n of a)if(!Bm(n.codePointAt(0)))return!1;return!0}function ku(a){const n=a.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(n.join("|"),"u")}const Au=ku(["Arab","Dupl","Mong","Ougr","Syrc"]);function Bm(a){return!Au.test(String.fromCodePoint(a))}function qd(a){return!(Gd(a)||(n=a,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(n))));var n}const Vm=ku(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Wd(a){return Vm.test(String.fromCodePoint(a))}function Zd(a,n){return!(!n&&Wd(a)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(a)))}function Um(a){for(const n of a)if(Wd(n.codePointAt(0)))return!0;return!1}const pa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(pa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,n){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const s=a.pluginURL,u=new Promise(y=>{this.loadScriptResolve=y});n(s);const p=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([u,p]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:s};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class pn{constructor(n,s){this.isSupportedScript=tv,this.zoom=n,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new $d,this.transition=s.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $d,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,s=n-Math.floor(n),u=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*s}}}function tv(a){return function(n,s){for(const u of n)if(!Zd(u.codePointAt(0),s))return!1;return!0}(a,pa.getRTLTextPluginStatus()==="loaded")}const rc="-transition";class Iu{constructor(n,s,u){this.property=n,this.value=s,this.expression=function(p,y,_){if(vu(p))return new bu(p,y);if(Lo(p)){const b=jd(p,y,_);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=p;return y.type==="color"&&typeof p=="string"?b=qt.parse(p):y.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?y.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?y.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?b=ii.parse(p):y.type==="projectionDefinition"&&typeof p=="string"&&(b=si.parse(p)):b=Et.parse(p):b=zn.parse(p):b=Wr.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>b}}}(s===void 0?n.specification.default:s,n.specification,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(n,s,u){return this.property.possiblyEvaluate(this,n,s,u)}}class Mu{constructor(n,s){this.property=n,this.value=new Iu(n,void 0,s)}transitioned(n,s){return new $m(this.property,this.value,s,vr({},n.transition,this.transition),n.now)}untransitioned(){return new $m(this.property,this.value,null,{},0)}}class Hd{constructor(n,s){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._globalState=s}getValue(n){return ki(this._values[n].value.value)}setValue(n,s){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Mu(this._values[n].property,this._globalState)),this._values[n].value=new Iu(this._values[n].property,s===null?void 0:ki(s),this._globalState)}getTransition(n){return ki(this._values[n].transition)}setTransition(n,s){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Mu(this._values[n].property,this._globalState)),this._values[n].transition=ki(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(n[s]=u);const p=this.getTransition(s);p!==void 0&&(n[`${s}${rc}`]=p)}return n}transitioned(n,s){const u=new Gm(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(n,s._values[p]);return u}untransitioned(){const n=new Gm(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class $m{constructor(n,s,u,p,y){this.property=n,this.value=s,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,n.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(n,s,u){const p=n.now||0,y=this.value.possiblyEvaluate(n,s,u),_=this.prior;if(_){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return _.possiblyEvaluate(n,s,u);{const b=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,s,u),y,sn(b))}}return y}}class Gm{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,u){const p=new ic(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(n,s,u);return p}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class qm{constructor(n,s){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._globalState=s}hasValue(n){return this._values[n].value!==void 0}getValue(n){return ki(this._values[n].value)}setValue(n,s){this._values[n]=new Iu(this._values[n].property,s===null?void 0:ki(s),this._globalState)}serialize(){const n={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(n[s]=u)}return n}possiblyEvaluate(n,s,u){const p=new ic(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(n,s,u);return p}}class ss{constructor(n,s,u){this.property=n,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,u,p){return this.property.evaluate(this.value,this.parameters,n,s,u,p)}}class ic{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class _t{constructor(n){this.specification=n}possiblyEvaluate(n,s){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(s)}interpolate(n,s,u){const p=Rn[this.specification.type];return p?p(n,s,u):n}}class St{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,u,p){return new ss(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},u,p)}:n.expression,s)}interpolate(n,s,u){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new ss(this,{kind:"constant",value:void 0},n.parameters);const p=Rn[this.specification.type];if(p){const y=p(n.value.value,s.value.value,u);return new ss(this,{kind:"constant",value:y},n.parameters)}return n}evaluate(n,s,u,p,y,_){return n.kind==="constant"?n.value:n.evaluate(s,u,p,y,_)}}class sc extends St{possiblyEvaluate(n,s,u,p){if(n.value===void 0)return new ss(this,{kind:"constant",value:void 0},s);if(n.expression.kind==="constant"){const y=n.expression.evaluate(s,null,{},u,p),_=n.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,b=this._calculate(_,_,_,s);return new ss(this,{kind:"constant",value:b},s)}if(n.expression.kind==="camera"){const y=this._calculate(n.expression.evaluate({zoom:s.zoom-1}),n.expression.evaluate({zoom:s.zoom}),n.expression.evaluate({zoom:s.zoom+1}),s);return new ss(this,{kind:"constant",value:y},s)}return new ss(this,n.expression,s)}evaluate(n,s,u,p,y,_){if(n.kind==="source"){const b=n.evaluate(s,u,p,y,_);return this._calculate(b,b,b,s)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(s.zoom)-1},u,p),n.evaluate({zoom:Math.floor(s.zoom)},u,p),n.evaluate({zoom:Math.floor(s.zoom)+1},u,p),s):n.value}_calculate(n,s,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:u,to:s}}interpolate(n){return n}}class Ru{constructor(n){this.specification=n}possiblyEvaluate(n,s,u,p){if(n.value!==void 0){if(n.expression.kind==="constant"){const y=n.expression.evaluate(s,null,{},u,p);return this._calculate(y,y,y,s)}return this._calculate(n.expression.evaluate(new pn(Math.floor(s.zoom-1),s)),n.expression.evaluate(new pn(Math.floor(s.zoom),s)),n.expression.evaluate(new pn(Math.floor(s.zoom+1),s)),s)}}_calculate(n,s,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:u,to:s}}interpolate(n){return n}}class Du{constructor(n){this.specification=n}possiblyEvaluate(n,s,u,p){return!!n.expression.evaluate(s,null,{},u,p)}interpolate(){return!1}}class oi{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in n){const u=n[s];u.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new Iu(u,void 0,void 0),y=this.defaultTransitionablePropertyValues[s]=new Mu(u,void 0);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}dt("DataDrivenProperty",St),dt("DataConstantProperty",_t),dt("CrossFadedDataDrivenProperty",sc),dt("CrossFadedProperty",Ru),dt("ColorRampProperty",Du);class Gi extends nn{constructor(n,s,u){if(super(),this.id=n.id,this.type=n.type,this._globalState=u,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=function(p,y){return new Yl(p,y)}(this.visibility,u),n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter,this._featureFilter=ql(n.filter,u)),s.layout&&(this._unevaluatedLayout=new qm(s.layout,u)),s.paint)){this._transitionablePaint=new Hd(s.paint,u);for(const p in n.paint)this.setPaintProperty(p,n.paint[p],{validate:!1});for(const p in n.layout)this.setLayoutProperty(p,n.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ic(s.paint)}}setFilter(n){this.filter=n,this._featureFilter=ql(n,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}getLayoutAffectingGlobalStateRefs(){const n=new Set;for(const s of this._visibilityExpression.getGlobalStateRefs())n.add(s);if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const u=this._unevaluatedLayout._values[s];for(const p of u.getGlobalStateRefs())n.add(p)}for(const s of this._featureFilter.getGlobalStateRefs())n.add(s);return n}getPaintAffectingGlobalStateRefs(){var n;const s=new globalThis.Map;if(this._transitionablePaint)for(const u in this._transitionablePaint._values){const p=this._transitionablePaint._values[u].value;for(const y of p.getGlobalStateRefs()){const _=(n=s.get(y))!==null&&n!==void 0?n:[];_.push({name:u,value:p.value}),s.set(y,_)}}return s}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(n,s,u={}){if(s==null||!this._validate(Q_,`layers.${this.id}.layout.${n}`,n,s,u))return n==="visibility"?(this.visibility=s,this._visibilityExpression.setValue(s),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(n,s)}getPaintProperty(n){return n.endsWith(rc)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s,u={}){if(s!=null&&this._validate(J_,`layers.${this.id}.paint.${n}`,n,s,u))return!1;if(n.endsWith(rc))return this._transitionablePaint.setTransition(n.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[n],y=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(n,s),this._handleSpecialPaintPropertyUpdate(n);const T=this._transitionablePaint._values[n].value;return T.isDataDriven()||_||y||this._handleOverridablePaintPropertyUpdate(n,b,T)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,s,u){return!1}isHidden(n=this.minzoom,s=!1){return!!(this.minzoom&&n<(s?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&n>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(n,s){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Ca(n,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}_validate(n,s,u,p,y={}){return(!y||y.validate!==!1)&&Oo(this,n.call(Pr,{key:s,layerType:this.type,objectKey:u,value:p,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof ss&&No(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}let Kd;var Wm={get paint(){return Kd=Kd||new oi({"raster-opacity":new _t(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(Re.paint_raster["raster-saturation"]),"raster-contrast":new _t(Re.paint_raster["raster-contrast"]),"raster-resampling":new _t(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(Re.paint_raster["raster-fade-duration"])})}};class nv extends Gi{constructor(n,s){super(n,Wm,s)}}const rv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ac{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class On{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function er(a,n=1){let s=0,u=0;return{members:a.map(p=>{const y=rv[p.type].BYTES_PER_ELEMENT,_=s=Ua(s,Math.max(n,y)),b=p.components||1;return u=Math.max(u,y),s+=y*b,{name:p.name,type:p.type,components:b,offset:_}}),size:Ua(s,Math.max(u,n)),alignment:n}}function Ua(a,n){return Math.ceil(a/n)*n}class oc extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const p=2*n;return this.int16[p+0]=s,this.int16[p+1]=u,n}}oc.prototype.bytesPerElement=4,dt("StructArrayLayout2i4",oc);class ju extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u)}emplace(n,s,u,p){const y=3*n;return this.int16[y+0]=s,this.int16[y+1]=u,this.int16[y+2]=p,n}}ju.prototype.bytesPerElement=6,dt("StructArrayLayout3i6",ju);class Xd extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,s,u,p)}emplace(n,s,u,p,y){const _=4*n;return this.int16[_+0]=s,this.int16[_+1]=u,this.int16[_+2]=p,this.int16[_+3]=y,n}}Xd.prototype.bytesPerElement=8,dt("StructArrayLayout4i8",Xd);class Nu extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,u,p,y,_)}emplace(n,s,u,p,y,_,b){const T=6*n;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=p,this.int16[T+3]=y,this.int16[T+4]=_,this.int16[T+5]=b,n}}Nu.prototype.bytesPerElement=12,dt("StructArrayLayout2i4i12",Nu);class Yd extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,u,p,y,_)}emplace(n,s,u,p,y,_,b){const T=4*n,k=8*n;return this.int16[T+0]=s,this.int16[T+1]=u,this.uint8[k+4]=p,this.uint8[k+5]=y,this.uint8[k+6]=_,this.uint8[k+7]=b,n}}Yd.prototype.bytesPerElement=8,dt("StructArrayLayout2i4ub8",Yd);class lc extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const p=2*n;return this.float32[p+0]=s,this.float32[p+1]=u,n}}lc.prototype.bytesPerElement=8,dt("StructArrayLayout2f8",lc);class Bs extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_,b,T,k,I){const D=this.length;return this.resize(D+1),this.emplace(D,n,s,u,p,y,_,b,T,k,I)}emplace(n,s,u,p,y,_,b,T,k,I,D){const N=10*n;return this.uint16[N+0]=s,this.uint16[N+1]=u,this.uint16[N+2]=p,this.uint16[N+3]=y,this.uint16[N+4]=_,this.uint16[N+5]=b,this.uint16[N+6]=T,this.uint16[N+7]=k,this.uint16[N+8]=I,this.uint16[N+9]=D,n}}Bs.prototype.bytesPerElement=20,dt("StructArrayLayout10ui20",Bs);class Lu extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_,b,T){const k=this.length;return this.resize(k+1),this.emplace(k,n,s,u,p,y,_,b,T)}emplace(n,s,u,p,y,_,b,T,k){const I=8*n;return this.uint16[I+0]=s,this.uint16[I+1]=u,this.uint16[I+2]=p,this.uint16[I+3]=y,this.uint16[I+4]=_,this.uint16[I+5]=b,this.uint16[I+6]=T,this.uint16[I+7]=k,n}}Lu.prototype.bytesPerElement=16,dt("StructArrayLayout8ui16",Lu);class cc extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_,b,T,k,I,D,N){const z=this.length;return this.resize(z+1),this.emplace(z,n,s,u,p,y,_,b,T,k,I,D,N)}emplace(n,s,u,p,y,_,b,T,k,I,D,N,z){const V=12*n;return this.int16[V+0]=s,this.int16[V+1]=u,this.int16[V+2]=p,this.int16[V+3]=y,this.uint16[V+4]=_,this.uint16[V+5]=b,this.uint16[V+6]=T,this.uint16[V+7]=k,this.int16[V+8]=I,this.int16[V+9]=D,this.int16[V+10]=N,this.int16[V+11]=z,n}}cc.prototype.bytesPerElement=24,dt("StructArrayLayout4i4ui4i24",cc);class zu extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u)}emplace(n,s,u,p){const y=3*n;return this.float32[y+0]=s,this.float32[y+1]=u,this.float32[y+2]=p,n}}zu.prototype.bytesPerElement=12,dt("StructArrayLayout3f12",zu);class uc extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}uc.prototype.bytesPerElement=4,dt("StructArrayLayout1ul4",uc);class Jd extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_,b,T,k){const I=this.length;return this.resize(I+1),this.emplace(I,n,s,u,p,y,_,b,T,k)}emplace(n,s,u,p,y,_,b,T,k,I){const D=10*n,N=5*n;return this.int16[D+0]=s,this.int16[D+1]=u,this.int16[D+2]=p,this.int16[D+3]=y,this.int16[D+4]=_,this.int16[D+5]=b,this.uint32[N+3]=T,this.uint16[D+8]=k,this.uint16[D+9]=I,n}}Jd.prototype.bytesPerElement=20,dt("StructArrayLayout6i1ul2ui20",Jd);class Uo extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,u,p,y,_)}emplace(n,s,u,p,y,_,b){const T=6*n;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=p,this.int16[T+3]=y,this.int16[T+4]=_,this.int16[T+5]=b,n}}Uo.prototype.bytesPerElement=12,dt("StructArrayLayout2i2i2i12",Uo);class $a extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,u,p,y)}emplace(n,s,u,p,y,_){const b=4*n,T=8*n;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=p,this.int16[T+6]=y,this.int16[T+7]=_,n}}$a.prototype.bytesPerElement=16,dt("StructArrayLayout2f1f2i16",$a);class Qd extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,u,p,y,_)}emplace(n,s,u,p,y,_,b){const T=16*n,k=4*n,I=8*n;return this.uint8[T+0]=s,this.uint8[T+1]=u,this.float32[k+1]=p,this.float32[k+2]=y,this.int16[I+6]=_,this.int16[I+7]=b,n}}Qd.prototype.bytesPerElement=16,dt("StructArrayLayout2ub2f2i16",Qd);class hc extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u)}emplace(n,s,u,p){const y=3*n;return this.uint16[y+0]=s,this.uint16[y+1]=u,this.uint16[y+2]=p,n}}hc.prototype.bytesPerElement=6,dt("StructArrayLayout3ui6",hc);class Ga extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_,b,T,k,I,D,N,z,V,U,q,ee){const ue=this.length;return this.resize(ue+1),this.emplace(ue,n,s,u,p,y,_,b,T,k,I,D,N,z,V,U,q,ee)}emplace(n,s,u,p,y,_,b,T,k,I,D,N,z,V,U,q,ee,ue){const ne=24*n,ie=12*n,de=48*n;return this.int16[ne+0]=s,this.int16[ne+1]=u,this.uint16[ne+2]=p,this.uint16[ne+3]=y,this.uint32[ie+2]=_,this.uint32[ie+3]=b,this.uint32[ie+4]=T,this.uint16[ne+10]=k,this.uint16[ne+11]=I,this.uint16[ne+12]=D,this.float32[ie+7]=N,this.float32[ie+8]=z,this.uint8[de+36]=V,this.uint8[de+37]=U,this.uint8[de+38]=q,this.uint32[ie+10]=ee,this.int16[ne+22]=ue,n}}Ga.prototype.bytesPerElement=48,dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ga);class ep extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,p,y,_,b,T,k,I,D,N,z,V,U,q,ee,ue,ne,ie,de,me,Ae,$e,Fe,Ze,rt,Ke){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,n,s,u,p,y,_,b,T,k,I,D,N,z,V,U,q,ee,ue,ne,ie,de,me,Ae,$e,Fe,Ze,rt,Ke)}emplace(n,s,u,p,y,_,b,T,k,I,D,N,z,V,U,q,ee,ue,ne,ie,de,me,Ae,$e,Fe,Ze,rt,Ke,Ve){const Ne=32*n,ht=16*n;return this.int16[Ne+0]=s,this.int16[Ne+1]=u,this.int16[Ne+2]=p,this.int16[Ne+3]=y,this.int16[Ne+4]=_,this.int16[Ne+5]=b,this.int16[Ne+6]=T,this.int16[Ne+7]=k,this.uint16[Ne+8]=I,this.uint16[Ne+9]=D,this.uint16[Ne+10]=N,this.uint16[Ne+11]=z,this.uint16[Ne+12]=V,this.uint16[Ne+13]=U,this.uint16[Ne+14]=q,this.uint16[Ne+15]=ee,this.uint16[Ne+16]=ue,this.uint16[Ne+17]=ne,this.uint16[Ne+18]=ie,this.uint16[Ne+19]=de,this.uint16[Ne+20]=me,this.uint16[Ne+21]=Ae,this.uint16[Ne+22]=$e,this.uint32[ht+12]=Fe,this.float32[ht+13]=Ze,this.float32[ht+14]=rt,this.uint16[Ne+30]=Ke,this.uint16[Ne+31]=Ve,n}}ep.prototype.bytesPerElement=64,dt("StructArrayLayout8i15ui1ul2f2ui64",ep);class Ou extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}Ou.prototype.bytesPerElement=4,dt("StructArrayLayout1f4",Ou);class Fu extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u)}emplace(n,s,u,p){const y=3*n;return this.uint16[6*n+0]=s,this.float32[y+1]=u,this.float32[y+2]=p,n}}Fu.prototype.bytesPerElement=12,dt("StructArrayLayout1ui2f12",Fu);class tp extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u)}emplace(n,s,u,p){const y=4*n;return this.uint32[2*n+0]=s,this.uint16[y+2]=u,this.uint16[y+3]=p,n}}tp.prototype.bytesPerElement=8,dt("StructArrayLayout1ul2ui8",tp);class v extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const p=2*n;return this.uint16[p+0]=s,this.uint16[p+1]=u,n}}v.prototype.bytesPerElement=4,dt("StructArrayLayout2ui4",v);class r extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}r.prototype.bytesPerElement=2,dt("StructArrayLayout1ui2",r);class l extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,s,u,p)}emplace(n,s,u,p,y){const _=4*n;return this.float32[_+0]=s,this.float32[_+1]=u,this.float32[_+2]=p,this.float32[_+3]=y,n}}l.prototype.bytesPerElement=16,dt("StructArrayLayout4f16",l);class d extends ac{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}d.prototype.size=20;class g extends Jd{get(n){return new d(this,n)}}dt("CollisionBoxArray",g);class x extends ac{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}x.prototype.size=48;class w extends Ga{get(n){return new x(this,n)}}dt("PlacedSymbolArray",w);class P extends ac{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}P.prototype.size=64;class A extends ep{get(n){return new P(this,n)}}dt("SymbolInstanceArray",A);class M extends Ou{getoffsetX(n){return this.float32[1*n+0]}}dt("GlyphOffsetArray",M);class j extends ju{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}dt("SymbolLineVertexArray",j);class F extends ac{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}F.prototype.size=12;class O extends Fu{get(n){return new F(this,n)}}dt("TextAnchorOffsetArray",O);class $ extends ac{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$.prototype.size=8;class Y extends tp{get(n){return new $(this,n)}}dt("FeatureIndexArray",Y);class se extends oc{}class oe extends oc{}class ae extends oc{}class he extends Nu{}class ge extends Yd{}class ce extends lc{}class fe extends Bs{}class xe extends Lu{}class pe extends cc{}class Te extends zu{}class Oe extends uc{}class Me extends Uo{}class De extends Qd{}class je extends hc{}class et extends v{}const nt=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:He}=nt;class it{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,s,u,p){const y=this.segments[this.segments.length-1];return n>it.MAX_VERTEX_ARRAY_LENGTH&&ir(`Max vertices per segment is ${it.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${it.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+n>it.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p?this.createNewSegment(s,u,p):y}createNewSegment(n,s,u){const p={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return u!==void 0&&(p.sortKey=u),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(n,s,u){return this.prepareSegment(0,n,s,u)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,u,p){return new it([{vertexOffset:n,primitiveOffset:s,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}function Rt(a,n){return 256*(a=fn(Math.floor(a),0,255))+fn(Math.floor(n),0,255)}it.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dt("SegmentVector",it);const ln=er([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),kn=er([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var vn,Dn,xn,qn={exports:{}},jn={exports:{}},Cr={exports:{}},sr=function(){if(xn)return qn.exports;xn=1;var a=(vn||(vn=1,jn.exports=function(s,u){var p,y,_,b,T,k,I,D;for(y=s.length-(p=3&s.length),_=u,T=3432918353,k=461845907,D=0;D<y;)I=255&s.charCodeAt(D)|(255&s.charCodeAt(++D))<<8|(255&s.charCodeAt(++D))<<16|(255&s.charCodeAt(++D))<<24,++D,_=27492+(65535&(b=5*(65535&(_=(_^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*k+(((I>>>16)*k&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(I=0,p){case 3:I^=(255&s.charCodeAt(D+2))<<16;case 2:I^=(255&s.charCodeAt(D+1))<<8;case 1:_^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(D)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*k+(((I>>>16)*k&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),jn.exports),n=(Dn||(Dn=1,Cr.exports=function(s,u){for(var p,y=s.length,_=u^y,b=0;y>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(p>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++b;switch(y){case 3:_^=(255&s.charCodeAt(b+2))<<16;case 2:_^=(255&s.charCodeAt(b+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(b)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Cr.exports);return qn.exports=a,qn.exports.murmur3=a,qn.exports.murmur2=n,qn.exports}(),tr=C(sr);class Fr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,s,u,p){this.ids.push(fa(n)),this.positions.push(s,u,p)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=fa(n);let u=0,p=this.ids.length-1;for(;u<p;){const _=u+p>>1;this.ids[_]>=s?p=_:u=_+1}const y=[];for(;this.ids[u]===s;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(n,s){const u=new Float64Array(n.ids),p=new Uint32Array(n.positions);return Vs(u,p,0,u.length-1),s&&s.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(n){const s=new Fr;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s}}function fa(a){const n=+a;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:tr(String(a))}function Vs(a,n,s,u){for(;s<u;){const p=a[s+u>>1];let y=s-1,_=u+1;for(;;){do y++;while(a[y]<p);do _--;while(a[_]>p);if(y>=_)break;Es(a,y,_),Es(n,3*y,3*_),Es(n,3*y+1,3*_+1),Es(n,3*y+2,3*_+2)}_-s<u-_?(Vs(a,n,s,_),s=_+1):(Vs(a,n,_+1,u),u=_)}}function Es(a,n,s){const u=a[n];a[n]=a[s],a[s]=u}dt("FeaturePositionMap",Fr);class _i{constructor(n,s){this.gl=n.gl,this.location=s}}class qa extends _i{constructor(n,s){super(n,s),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class dc extends _i{constructor(n,s){super(n,s),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Wa extends _i{constructor(n,s){super(n,s),this.current=qt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const qi=new Float32Array(16);function Ps(a){return[Rt(255*a.r,255*a.g),Rt(255*a.b,255*a.a)]}class as{constructor(n,s,u){this.value=n,this.uniformNames=s.map(p=>`u_${p}`),this.type=u}setUniform(n,s,u){n.set(u.constantOr(this.value))}getBinding(n,s,u){return this.type==="color"?new Wa(n,s):new qa(n,s)}}class os{constructor(n,s){this.uniformNames=s.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=n.tlbr}setConstantDashPositions(n,s){this.dashTo=[0,n.y,n.height,n.width],this.dashFrom=[0,s.y,s.height,s.width]}setUniform(n,s,u,p){let y=null;p==="u_pattern_to"?y=this.patternTo:p==="u_pattern_from"?y=this.patternFrom:p==="u_dasharray_to"?y=this.dashTo:p==="u_dasharray_from"?y=this.dashFrom:p==="u_pixel_ratio_to"?y=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(y=this.pixelRatioFrom),y!==null&&n.set(y)}getBinding(n,s,u){return u.substr(0,9)==="u_pattern"||u.substr(0,12)==="u_dasharray_"?new dc(n,s):new qa(n,s)}}class Sn{constructor(n,s,u,p){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(n,s,u){const p=this.paintVertexArray.length,y=this.expression.evaluate(new pn(0,u),s,{},u.canonical,[],u.formattedSection);this.paintVertexArray.resize(n),this._setPaintValue(p,n,y)}updatePaintArray(n,s,u,p,y){const _=this.expression.evaluate(new pn(0,y),u,p);this._setPaintValue(n,s,_)}_setPaintValue(n,s,u){if(this.type==="color"){const p=Ps(u);for(let y=n;y<s;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=n;p<s;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bn{constructor(n,s,u,p,y,_){this.expression=n,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,s,u){const p=this.expression.evaluate(new pn(this.zoom,u),s,{},u.canonical,[],u.formattedSection),y=this.expression.evaluate(new pn(this.zoom+1,u),s,{},u.canonical,[],u.formattedSection),_=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(_,n,p,y)}updatePaintArray(n,s,u,p,y){const _=this.expression.evaluate(new pn(this.zoom,y),u,p),b=this.expression.evaluate(new pn(this.zoom+1,y),u,p);this._setPaintValue(n,s,_,b)}_setPaintValue(n,s,u,p){if(this.type==="color"){const y=Ps(u),_=Ps(p);for(let b=n;b<s;b++)this.paintVertexArray.emplace(b,y[0],y[1],_[0],_[1])}else{for(let y=n;y<s;y++)this.paintVertexArray.emplace(y,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s){const u=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=fn(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(p)}getBinding(n,s,u){return new qa(n,s)}}class xr{constructor(n,s,u,p,y,_){this.expression=n,this.type=s,this.useIntegerZoom=u,this.zoom=p,this.layerId=_,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(n,s,u){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(p,n,this.getPositionIds(s),u)}updatePaintArray(n,s,u,p,y){this._setPaintValues(n,s,this.getPositionIds(u),y)}_setPaintValues(n,s,u,p){const y=this.getPositions(p);if(!y||!u)return;const _=y[u.min],b=y[u.mid],T=y[u.max];if(_&&b&&T)for(let k=n;k<s;k++)this.emplace(this.zoomInPaintVertexArray,k,b,_),this.emplace(this.zoomOutPaintVertexArray,k,b,T)}upload(n){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const s=this.getVertexAttributes();this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,s,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,s,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class br extends xr{getPositions(n){return n.imagePositions}getPositionIds(n){return n.patterns&&n.patterns[this.layerId]}getVertexAttributes(){return ln.members}emplace(n,s,u,p){n.emplace(s,u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],u.pixelRatio,p.pixelRatio)}}class Zm extends xr{getPositions(n){return n.dashPositions}getPositionIds(n){return n.dashes&&n.dashes[this.layerId]}getVertexAttributes(){return kn.members}emplace(n,s,u,p){n.emplace(s,0,u.y,u.height,u.width,0,p.y,p.height,p.width)}}class Hm{constructor(n,s,u){this.binders={},this._buffers=[];const p=[];for(const y in n.paint._values){if(!u(y))continue;const _=n.paint.get(y);if(!(_ instanceof ss&&No(_.property.specification)))continue;const b=iv(y,n.type),T=_.value,k=_.property.specification.type,I=_.property.useIntegerZoom,D=_.property.specification["property-type"],N=D==="cross-faded"||D==="cross-faded-data-driven";if(T.kind==="constant")this.binders[y]=N?new os(T.value,b):new as(T.value,b,k),p.push(`/u_${y}`);else if(T.kind==="source"||N){const z=Km(y,k,"source");this.binders[y]=N?y==="line-dasharray"?new Zm(T,k,I,s,z,n.id):new br(T,k,I,s,z,n.id):new Sn(T,b,k,z),p.push(`/a_${y}`)}else{const z=Km(y,k,"composite");this.binders[y]=new bn(T,b,k,I,s,z),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof Sn||s instanceof bn?s.maxValue:0}populatePaintArrays(n,s,u){for(const p in this.binders){const y=this.binders[p];(y instanceof Sn||y instanceof bn||y instanceof xr)&&y.populatePaintArray(n,s,u)}}setConstantPatternPositions(n,s){for(const u in this.binders){const p=this.binders[u];p instanceof os&&p.setConstantPatternPositions(n,s)}}setConstantDashPositions(n,s){for(const u in this.binders){const p=this.binders[u];p instanceof os&&p.setConstantDashPositions(n,s)}}updatePaintArrays(n,s,u,p,y){let _=!1;for(const b in n){const T=s.getPositions(b);for(const k of T){const I=u.feature(k.index);for(const D in this.binders){const N=this.binders[D];if((N instanceof Sn||N instanceof bn||N instanceof xr)&&N.expression.isStateDependent===!0){const z=p.paint.get(D);N.expression=z.value,N.updatePaintArray(k.start,k.end,I,n[b],y),_=!0}}}}return _}defines(){const n=[];for(const s in this.binders){const u=this.binders[s];(u instanceof as||u instanceof os)&&n.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Sn||u instanceof bn)for(let p=0;p<u.paintVertexAttributes.length;p++)n.push(u.paintVertexAttributes[p].name);else if(u instanceof xr){const p=u.getVertexAttributes();for(const y of p)n.push(y.name)}}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof as||u instanceof os||u instanceof bn)for(const p of u.uniformNames)n.push(p)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,s){const u=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof as||y instanceof os||y instanceof bn){for(const _ of y.uniformNames)if(s[_]){const b=y.getBinding(n,s[_],_);u.push({name:_,property:p,binding:b})}}}return u}setUniforms(n,s,u,p){for(const{name:y,property:_,binding:b}of s)this.binders[_].setUniform(b,p,u.get(_),y)}updatePaintBuffers(n){this._buffers=[];for(const s in this.binders){const u=this.binders[s];if(n&&u instanceof xr){const p=n.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof Sn||u instanceof bn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(n){for(const s in this.binders){const u=this.binders[s];(u instanceof Sn||u instanceof bn||u instanceof xr)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof Sn||s instanceof bn||s instanceof xr)&&s.destroy()}}}class Za{constructor(n,s,u=()=>!0){this.programConfigurations={};for(const p of n)this.programConfigurations[p.id]=new Hm(p,s,u);this.needsUpload=!1,this._featureMap=new Fr,this._bufferOffset=0}populatePaintArrays(n,s,u,p){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(n,s,p);s.id!==void 0&&this._featureMap.add(s.id,u,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,u,p){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(n,this._featureMap,s,y,p)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function iv(a,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}function Km(a,n,s){const u={color:{source:lc,composite:l},number:{source:Ou,composite:lc}},p=function(y){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe},"line-dasharray":{source:xe,composite:xe}}[y]}(a);return p&&p[s]||u[n][s]}dt("ConstantBinder",as),dt("CrossFadedConstantBinder",os),dt("SourceExpressionBinder",Sn),dt("CrossFadedPatternBinder",br),dt("CrossFadedDasharrayBinder",Zm),dt("CompositeExpressionBinder",bn),dt("ProgramConfiguration",Hm,{omit:["_buffers"]}),dt("ProgramConfigurationSet",Za);const np=Math.pow(2,14)-1,ma=-np-1;function ga(a){const n=Pe/a.extent,s=a.loadGeometry();for(let u=0;u<s.length;u++){const p=s[u];for(let y=0;y<p.length;y++){const _=p[y],b=Math.round(_.x*n),T=Math.round(_.y*n);_.x=fn(b,ma,np),_.y=fn(T,ma,np),(b<_.x||b>_.x+1||T<_.y||T>_.y+1)&&ir("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function ya(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?ga(a):[]}}const rp=-32768;function ip(a,n,s,u,p){a.emplaceBack(rp+8*n+u,rp+8*s+p)}class Bu{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasDependencies=!1,this.layoutVertexArray=new oe,this.indexArray=new je,this.segments=new it,this.programConfigurations=new Za(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,u){const p=this.layers[0],y=[];let _=null,b=!1,T=p.type==="heatmap";if(p.type==="circle"){const I=p;_=I.layout.get("circle-sort-key"),b=!_.isConstant(),T=T||I.paint.get("circle-pitch-alignment")==="map"}const k=T?s.subdivisionGranularity.circle:1;for(const{feature:I,id:D,index:N,sourceLayerIndex:z}of n){const V=this.layers[0]._featureFilter.needGeometry,U=ya(I,V);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),U,u))continue;const q=b?_.evaluate(U,{},u):void 0,ee={id:D,properties:I.properties,type:I.type,sourceLayerIndex:z,index:N,geometry:V?U.geometry:ga(I),patterns:{},sortKey:q};y.push(ee)}b&&y.sort((I,D)=>I.sortKey-D.sortKey);for(const I of y){const{geometry:D,index:N,sourceLayerIndex:z}=I,V=n[N].feature;this.addFeature(I,D,N,u,k),s.featureIndex.insert(V,D,N,z,this.index)}}update(n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:u})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,He),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,u,p,y=1){let _;switch(y){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const b=_.length;for(const T of s)for(const k of T){const I=k.x,D=k.y;if(I<0||I>=Pe||D<0||D>=Pe)continue;const N=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,n.sortKey),z=N.vertexLength;for(let V=0;V<b;V++)for(let U=0;U<b;U++)ip(this.layoutVertexArray,I,D,_[U],_[V]);for(let V=0;V<b-1;V++)for(let U=0;U<b-1;U++){const q=z+V*b+U,ee=z+(V+1)*b+U;this.indexArray.emplaceBack(q,ee+1,q+1),this.indexArray.emplaceBack(q,ee,ee+1)}N.vertexLength+=b*b,N.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{imagePositions:{},canonical:p})}}function Vu(a,n){for(let s=0;s<a.length;s++)if(Uu(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(Uu(a,n[s]))return!0;return!!sv(a,n)}function Xm(a,n,s){return!!Uu(a,n)||!!av(n,a,s)}function T1(a,n){if(a.length===1)return P1(n,a[0]);for(let s=0;s<n.length;s++){const u=n[s];for(let p=0;p<u.length;p++)if(Uu(a,u[p]))return!0}for(let s=0;s<a.length;s++)if(P1(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(sv(a,n[s]))return!0;return!1}function yR(a,n,s){if(a.length>1){if(sv(a,n))return!0;for(let u=0;u<n.length;u++)if(av(n[u],a,s))return!0}for(let u=0;u<a.length;u++)if(av(a[u],n,s))return!0;return!1}function sv(a,n){if(a.length===0||n.length===0)return!1;for(let s=0;s<a.length-1;s++){const u=a[s],p=a[s+1];for(let y=0;y<n.length-1;y++)if(_R(u,p,n[y],n[y+1]))return!0}return!1}function _R(a,n,s,u){return mi(a,s,u)!==mi(n,s,u)&&mi(a,n,s)!==mi(a,n,u)}function av(a,n,s){const u=s*s;if(n.length===1)return a.distSqr(n[0])<u;for(let p=1;p<n.length;p++)if(E1(a,n[p-1],n[p])<u)return!0;return!1}function E1(a,n,s){const u=n.distSqr(s);if(u===0)return a.distSqr(n);const p=((a.x-n.x)*(s.x-n.x)+(a.y-n.y)*(s.y-n.y))/u;return a.distSqr(p<0?n:p>1?s:s.sub(n)._mult(p)._add(n))}function P1(a,n){let s,u,p,y=!1;for(let _=0;_<a.length;_++){s=a[_];for(let b=0,T=s.length-1;b<s.length;T=b++)u=s[b],p=s[T],u.y>n.y!=p.y>n.y&&n.x<(p.x-u.x)*(n.y-u.y)/(p.y-u.y)+u.x&&(y=!y)}return y}function Uu(a,n){let s=!1;for(let u=0,p=a.length-1;u<a.length;p=u++){const y=a[u],_=a[p];y.y>n.y!=_.y>n.y&&n.x<(_.x-y.x)*(n.y-y.y)/(_.y-y.y)+y.x&&(s=!s)}return s}function vR(a,n,s){const u=s[0],p=s[2];if(a.x<u.x&&n.x<u.x||a.x>p.x&&n.x>p.x||a.y<u.y&&n.y<u.y||a.y>p.y&&n.y>p.y)return!1;const y=mi(a,n,s[0]);return y!==mi(a,n,s[1])||y!==mi(a,n,s[2])||y!==mi(a,n,s[3])}function $u(a,n,s){const u=n.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(n.id).getMaxValue(a)}function Ym(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Jm(a,n,s,u,p){if(!n[0]&&!n[1])return a;const y=E.convert(n)._mult(p);s==="viewport"&&y._rotate(-u);const _=[];for(let b=0;b<a.length;b++)_.push(a[b].sub(y));return _}function xR(a){const n=[];for(let s=0;s<a.length;s++){const u=a[s],p=n.at(-1);(s===0||p&&!u.equals(p))&&n.push(u)}return n}function bR({queryGeometry:a,size:n},s){return Xm(a,s,n)}function wR({queryGeometry:a,size:n,transform:s,unwrappedTileID:u,getElevation:p},y){return Xm(a,y,n*(s.projectTileCoordinates(y.x,y.y,u,p).signedDistanceFromCamera/s.cameraToCenterDistance))}function SR({queryGeometry:a,size:n,transform:s,unwrappedTileID:u,getElevation:p},y){const _=s.projectTileCoordinates(y.x,y.y,u,p).signedDistanceFromCamera,b=n*(s.cameraToCenterDistance/_);return Xm(a,ov(y,s,u,p),b)}function TR({queryGeometry:a,size:n,transform:s,unwrappedTileID:u,getElevation:p},y){return Xm(a,ov(y,s,u,p),n)}function C1({queryGeometry:a,size:n,transform:s,unwrappedTileID:u,getElevation:p,pitchAlignment:y="map",pitchScale:_="map"},b){const T=y==="map"?_==="map"?bR:wR:_==="map"?SR:TR,k={queryGeometry:a,size:n,transform:s,unwrappedTileID:u,getElevation:p};for(const I of b)for(const D of I)if(T(k,D))return!0;return!1}function ov(a,n,s,u){const p=n.projectTileCoordinates(a.x,a.y,s,u).point;return new E((.5*p.x+.5)*n.width,(.5*-p.y+.5)*n.height)}let k1,A1;dt("CircleBucket",Bu,{omit:["layers"]});var ER={get paint(){return A1=A1||new oi({"circle-radius":new St(Re.paint_circle["circle-radius"]),"circle-color":new St(Re.paint_circle["circle-color"]),"circle-blur":new St(Re.paint_circle["circle-blur"]),"circle-opacity":new St(Re.paint_circle["circle-opacity"]),"circle-translate":new _t(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Re.paint_circle["circle-stroke-opacity"])})},get layout(){return k1=k1||new oi({"circle-sort-key":new St(Re.layout_circle["circle-sort-key"])})}};class PR extends Gi{constructor(n,s){super(n,ER,s)}createBucket(n){return new Bu(n)}queryRadius(n){const s=n;return $u("circle-radius",this,s)+$u("circle-stroke-width",this,s)+Ym(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:u,geometry:p,transform:y,pixelsToTileUnits:_,unwrappedTileID:b,getElevation:T}){const k=Jm(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,_),I=this.paint.get("circle-radius").evaluate(s,u)+this.paint.get("circle-stroke-width").evaluate(s,u),D=this.paint.get("circle-pitch-scale"),N=this.paint.get("circle-pitch-alignment");let z,V;return N==="map"?(z=k,V=I*_):(z=function(U,q,ee,ue){return U.map(ne=>ov(ne,q,ee,ue))}(k,y,b,T),V=I),C1({queryGeometry:z,size:V,transform:y,unwrappedTileID:b,getElevation:T,pitchAlignment:N,pitchScale:D},p)}}class I1 extends Bu{}let M1;dt("HeatmapBucket",I1,{omit:["layers"]});var CR={get paint(){return M1=M1||new oi({"heatmap-radius":new St(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Du(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(Re.paint_heatmap["heatmap-opacity"])})}};function lv(a,{width:n,height:s},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==n*s*u)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${n*s*u}`)}else p=new Uint8Array(n*s*u);return a.width=n,a.height=s,a.data=p,a}function R1(a,{width:n,height:s},u){if(n===a.width&&s===a.height)return;const p=lv({},{width:n,height:s},u);cv(a,p,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,n),height:Math.min(a.height,s)},u),a.width=n,a.height=s,a.data=p.data}function cv(a,n,s,u,p,y){if(p.width===0||p.height===0)return n;if(p.width>a.width||p.height>a.height||s.x>a.width-p.width||s.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>n.width||p.height>n.height||u.x>n.width-p.width||u.y>n.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,b=n.data;if(_===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<p.height;T++){const k=((s.y+T)*a.width+s.x)*y,I=((u.y+T)*n.width+u.x)*y;for(let D=0;D<p.width*y;D++)b[I+D]=_[k+D]}return n}class sp{constructor(n,s){lv(this,n,1,s)}resize(n){R1(this,n,1)}clone(){return new sp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,u,p,y){cv(n,s,u,p,y,1)}}class Ri{constructor(n,s){lv(this,n,4,s)}resize(n){R1(this,n,4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ri({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,u,p,y){cv(n,s,u,p,y,4)}setPixel(n,s,u){const p=4*(n*this.width+s);this.data[p+0]=Math.round(255*u.r/u.a),this.data[p+1]=Math.round(255*u.g/u.a),this.data[p+2]=Math.round(255*u.b/u.a),this.data[p+3]=Math.round(255*u.a)}}function D1(a){const n={},s=a.resolution||256,u=a.clips?a.clips.length:1,p=a.image||new Ri({width:s,height:u});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(_,b,T)=>{n[a.evaluationKey]=T;const k=a.expression.evaluate(n);p.setPixel(_/4/s,b/4,k)};if(a.clips)for(let _=0,b=0;_<u;++_,b+=4*s)for(let T=0,k=0;T<s;T++,k+=4){const I=T/(s-1),{start:D,end:N}=a.clips[_];y(b,k,D*(1-I)+N*I)}else for(let _=0,b=0;_<s;_++,b+=4)y(0,b,_/(s-1));return p}dt("AlphaImage",sp),dt("RGBAImage",Ri);const uv="big-fb";class kR extends Gi{createBucket(n){return new I1(n)}constructor(n,s){super(n,CR,s),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=D1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(uv)&&this.heatmapFbos.delete(uv)}queryRadius(n){return $u("heatmap-radius",this,n)}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:u,geometry:p,transform:y,pixelsToTileUnits:_,unwrappedTileID:b,getElevation:T}){return C1({queryGeometry:n,size:this.paint.get("heatmap-radius").evaluate(s,u)*_,transform:y,unwrappedTileID:b,getElevation:T},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let j1;var AR={get paint(){return j1=j1||new oi({"hillshade-illumination-direction":new _t(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new _t(Re.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new _t(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new _t(Re.paint_hillshade["hillshade-method"])})}};class IR extends Gi{constructor(n,s){super(n,AR,s),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let n=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,u=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const y=Math.max(n.length,s.length,u.length,p.length);n=n.concat(Array(y-n.length).fill(n.at(-1))),s=s.concat(Array(y-s.length).fill(s.at(-1))),u=u.concat(Array(y-u.length).fill(u.at(-1))),p=p.concat(Array(y-p.length).fill(p.at(-1)));const _=s.map(ei);return{directionRadians:n.map(ei),altitudeRadians:_,shadowColor:p,highlightColor:u}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let N1;var MR={get paint(){return N1=N1||new oi({"color-relief-opacity":new _t(Re["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Du(Re["paint_color-relief"]["color-relief-color"])})}};class hv{constructor(n,s,u,p){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(s,p)}update(n,s,u){const{width:p,height:y}=n,_=!(this.size&&this.size[0]===p&&this.size[1]===y||u),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),_)this.size=[p,y],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||tt(n)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,n):T.texImage2D(T.TEXTURE_2D,0,this.format,p,y,0,this.format,T.UNSIGNED_BYTE,n.data);else{const{x:k,y:I}=u||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||tt(n)?T.texSubImage2D(T.TEXTURE_2D,0,k,I,T.RGBA,T.UNSIGNED_BYTE,n):T.texSubImage2D(T.TEXTURE_2D,0,k,I,p,y,T.RGBA,T.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,s,u){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),u!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=y.LINEAR),n!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,n),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,u||n),this.filter=n),s!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class L1{constructor(n,s,u,p=1,y=1,_=1,b=0){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void ir(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const T=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=y,this.blueFactor=_,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<T;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(T,k)]=this.data[this._idx(T-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,T)]=this.data[this._idx(k,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<T;k++)for(let I=0;I<T;I++){const D=this.get(k,I);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(n,s){const u=new Uint8Array(this.data.buffer),p=4*this._idx(n,s);return this.unpack(u[p],u[p+1],u[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${n}, y: ${s}, dim: ${this.dim}`);return(s+1)*this.stride+(n+1)}unpack(n,s,u){return n*this.redFactor+s*this.greenFactor+u*this.blueFactor-this.baseShift}pack(n){return z1(n,this.getUnpackVector())}getPixels(){return new Ri({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,s,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,y=s*this.dim+this.dim,_=u*this.dim,b=u*this.dim+this.dim;switch(s){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:_=b-1;break;case 1:b=_+1}const T=-s*this.dim,k=-u*this.dim;for(let I=_;I<b;I++)for(let D=p;D<y;D++)this.data[this._idx(D,I)]=n.data[this._idx(D+T,I+k)]}}function z1(a,n){const s=n[0],u=n[1],p=n[2],y=n[3],_=Math.min(s,u,p),b=Math.round((a+y)/_);return{r:Math.floor(b*_/s)%256,g:Math.floor(b*_/u)%256,b:Math.floor(b*_/p)%256}}dt("DEMData",L1);class RR extends Gi{constructor(n,s){super(n,MR,s)}_createColorRamp(n){const s={elevationStops:[],colorStops:[]},u=this._transitionablePaint._values["color-relief-color"].value.expression;if(u instanceof xu&&u._styleExpression.expression instanceof ai){this.colorRampExpression=u;const _=u._styleExpression.expression;s.elevationStops=_.labels,s.colorStops=[];for(const b of s.elevationStops)s.colorStops.push(_.evaluate({globals:{elevation:b}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[qt.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=n)return s;const p={elevationStops:[],colorStops:[]},y=(s.elevationStops.length-1)/(n-1);for(let _=0;_<s.elevationStops.length-.5;_+=y)p.elevationStops.push(s.elevationStops[Math.round(_)]),p.colorStops.push(s.colorStops[Math.round(_)]);return ir(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${n}, provided: ${s.elevationStops.length}`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(n,s,u){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(s),y=new Ri({width:p.colorStops.length,height:1}),_=new Ri({width:p.colorStops.length,height:1});for(let b=0;b<p.elevationStops.length;b++){const T=z1(p.elevationStops[b],u);_.setPixel(0,b,new qt(T.r/255,T.g/255,T.b/255,1)),y.setPixel(0,b,p.colorStops[b])}return this.colorRampTextures={elevationTexture:new hv(n,_,n.gl.RGBA),colorTexture:new hv(n,y,n.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const DR=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:jR}=DR;function Qm(a,n,s){const u=s.patternDependencies;let p=!1;for(const y of n){const _=y.paint.get(`${a}-pattern`);_.isConstant()||(p=!0);const b=_.constantOr(null);b&&(p=!0,u[b.to]=!0,u[b.from]=!0)}return p}function dv(a,n,s,u,p){const{zoom:y}=u,_=p.patternDependencies;for(const b of n){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let k=T.evaluate({zoom:y-1},s,{},p.availableImages),I=T.evaluate({zoom:y},s,{},p.availableImages),D=T.evaluate({zoom:y+1},s,{},p.availableImages);k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,D=D&&D.name?D.name:D,_[k]=!0,_[I]=!0,_[D]=!0,s.patterns[b.id]={min:k,mid:I,max:D}}}return s}function O1(a,n,s,u,p){let y;if(p===function(_,b,T,k){let I=0;for(let D=b,N=T-k;D<T;D+=k)I+=(_[N]-_[D])*(_[D+1]+_[N+1]),N=D;return I}(a,n,s,u)>0)for(let _=n;_<s;_+=u)y=U1(_/u|0,a[_],a[_+1],y);else for(let _=s-u;_>=n;_-=u)y=U1(_/u|0,a[_],a[_+1],y);return y&&Gu(y,y.next)&&(cp(y),y=y.next),y}function pc(a,n){if(!a)return a;n||(n=a);let s,u=a;do if(s=!1,u.steiner||!Gu(u,u.next)&&ar(u.prev,u,u.next)!==0)u=u.next;else{if(cp(u),u=n=u.prev,u===u.next)break;s=!0}while(s||u!==n);return n}function ap(a,n,s,u,p,y,_){if(!a)return;!_&&y&&function(T,k,I,D){let N=T;do N.z===0&&(N.z=pv(N.x,N.y,k,I,D)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==T);N.prevZ.nextZ=null,N.prevZ=null,function(z){let V,U=1;do{let q,ee=z;z=null;let ue=null;for(V=0;ee;){V++;let ne=ee,ie=0;for(let me=0;me<U&&(ie++,ne=ne.nextZ,ne);me++);let de=U;for(;ie>0||de>0&&ne;)ie!==0&&(de===0||!ne||ee.z<=ne.z)?(q=ee,ee=ee.nextZ,ie--):(q=ne,ne=ne.nextZ,de--),ue?ue.nextZ=q:z=q,q.prevZ=ue,ue=q;ee=ne}ue.nextZ=null,U*=2}while(V>1)}(N)}(a,u,p,y);let b=a;for(;a.prev!==a.next;){const T=a.prev,k=a.next;if(y?LR(a,u,p,y):NR(a))n.push(T.i,a.i,k.i),cp(a),a=k.next,b=k.next;else if((a=k)===b){_?_===1?ap(a=zR(pc(a),n),n,s,u,p,y,2):_===2&&OR(a,n,s,u,p,y):ap(pc(a),n,s,u,p,y,1);break}}}function NR(a){const n=a.prev,s=a,u=a.next;if(ar(n,s,u)>=0)return!1;const p=n.x,y=s.x,_=u.x,b=n.y,T=s.y,k=u.y,I=Math.min(p,y,_),D=Math.min(b,T,k),N=Math.max(p,y,_),z=Math.max(b,T,k);let V=u.next;for(;V!==n;){if(V.x>=I&&V.x<=N&&V.y>=D&&V.y<=z&&op(p,b,y,T,_,k,V.x,V.y)&&ar(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function LR(a,n,s,u){const p=a.prev,y=a,_=a.next;if(ar(p,y,_)>=0)return!1;const b=p.x,T=y.x,k=_.x,I=p.y,D=y.y,N=_.y,z=Math.min(b,T,k),V=Math.min(I,D,N),U=Math.max(b,T,k),q=Math.max(I,D,N),ee=pv(z,V,n,s,u),ue=pv(U,q,n,s,u);let ne=a.prevZ,ie=a.nextZ;for(;ne&&ne.z>=ee&&ie&&ie.z<=ue;){if(ne.x>=z&&ne.x<=U&&ne.y>=V&&ne.y<=q&&ne!==p&&ne!==_&&op(b,I,T,D,k,N,ne.x,ne.y)&&ar(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ie.x>=z&&ie.x<=U&&ie.y>=V&&ie.y<=q&&ie!==p&&ie!==_&&op(b,I,T,D,k,N,ie.x,ie.y)&&ar(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;ne&&ne.z>=ee;){if(ne.x>=z&&ne.x<=U&&ne.y>=V&&ne.y<=q&&ne!==p&&ne!==_&&op(b,I,T,D,k,N,ne.x,ne.y)&&ar(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ie&&ie.z<=ue;){if(ie.x>=z&&ie.x<=U&&ie.y>=V&&ie.y<=q&&ie!==p&&ie!==_&&op(b,I,T,D,k,N,ie.x,ie.y)&&ar(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function zR(a,n){let s=a;do{const u=s.prev,p=s.next.next;!Gu(u,p)&&B1(u,s,s.next,p)&&lp(u,p)&&lp(p,u)&&(n.push(u.i,s.i,p.i),cp(s),cp(s.next),s=a=p),s=s.next}while(s!==a);return pc(s)}function OR(a,n,s,u,p,y){let _=a;do{let b=_.next.next;for(;b!==_.prev;){if(_.i!==b.i&&$R(_,b)){let T=V1(_,b);return _=pc(_,_.next),T=pc(T,T.next),ap(_,n,s,u,p,y,0),void ap(T,n,s,u,p,y,0)}b=b.next}_=_.next}while(_!==a)}function FR(a,n){let s=a.x-n.x;return s===0&&(s=a.y-n.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(n.next.y-n.y)/(n.next.x-n.x)),s}function BR(a,n){const s=function(p,y){let _=y;const b=p.x,T=p.y;let k,I=-1/0;if(Gu(p,_))return _;do{if(Gu(p,_.next))return _.next;if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const U=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(U<=b&&U>I&&(I=U,k=_.x<_.next.x?_:_.next,U===b))return k}_=_.next}while(_!==y);if(!k)return null;const D=k,N=k.x,z=k.y;let V=1/0;_=k;do{if(b>=_.x&&_.x>=N&&b!==_.x&&F1(T<z?b:I,T,N,z,T<z?I:b,T,_.x,_.y)){const U=Math.abs(T-_.y)/(b-_.x);lp(_,p)&&(U<V||U===V&&(_.x>k.x||_.x===k.x&&VR(k,_)))&&(k=_,V=U)}_=_.next}while(_!==D);return k}(a,n);if(!s)return n;const u=V1(s,a);return pc(u,u.next),pc(s,s.next)}function VR(a,n){return ar(a.prev,a,n.prev)<0&&ar(n.next,a,a.next)<0}function pv(a,n,s,u,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function UR(a){let n=a,s=a;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==a);return s}function F1(a,n,s,u,p,y,_,b){return(p-_)*(n-b)>=(a-_)*(y-b)&&(a-_)*(u-b)>=(s-_)*(n-b)&&(s-_)*(y-b)>=(p-_)*(u-b)}function op(a,n,s,u,p,y,_,b){return!(a===_&&n===b)&&F1(a,n,s,u,p,y,_,b)}function $R(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!function(s,u){let p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==u.i&&p.next.i!==u.i&&B1(p,p.next,s,u))return!0;p=p.next}while(p!==s);return!1}(a,n)&&(lp(a,n)&&lp(n,a)&&function(s,u){let p=s,y=!1;const _=(s.x+u.x)/2,b=(s.y+u.y)/2;do p.y>b!=p.next.y>b&&p.next.y!==p.y&&_<(p.next.x-p.x)*(b-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==s);return y}(a,n)&&(ar(a.prev,a,n.prev)||ar(a,n.prev,n))||Gu(a,n)&&ar(a.prev,a,a.next)>0&&ar(n.prev,n,n.next)>0)}function ar(a,n,s){return(n.y-a.y)*(s.x-n.x)-(n.x-a.x)*(s.y-n.y)}function Gu(a,n){return a.x===n.x&&a.y===n.y}function B1(a,n,s,u){const p=tg(ar(a,n,s)),y=tg(ar(a,n,u)),_=tg(ar(s,u,a)),b=tg(ar(s,u,n));return p!==y&&_!==b||!(p!==0||!eg(a,s,n))||!(y!==0||!eg(a,u,n))||!(_!==0||!eg(s,a,u))||!(b!==0||!eg(s,n,u))}function eg(a,n,s){return n.x<=Math.max(a.x,s.x)&&n.x>=Math.min(a.x,s.x)&&n.y<=Math.max(a.y,s.y)&&n.y>=Math.min(a.y,s.y)}function tg(a){return a>0?1:a<0?-1:0}function lp(a,n){return ar(a.prev,a,a.next)<0?ar(a,n,a.next)>=0&&ar(a,a.prev,n)>=0:ar(a,n,a.prev)<0||ar(a,a.next,n)<0}function V1(a,n){const s=fv(a.i,a.x,a.y),u=fv(n.i,n.x,n.y),p=a.next,y=n.prev;return a.next=n,n.prev=a,s.next=p,p.prev=s,u.next=s,s.prev=u,y.next=u,u.prev=y,u}function U1(a,n,s,u){const p=fv(a,n,s);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function cp(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function fv(a,n,s){return{i:a,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class qu{constructor(n,s){if(s>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=s}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class ng{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}ng.noSubdivision=new ng({fill:new qu(0,0),line:new qu(0,0),tile:new qu(0,0),stencil:new qu(0,0),circle:1}),dt("SubdivisionGranularityExpression",qu),dt("SubdivisionGranularitySetting",ng);const Wu=-32768,up=32767;class GR{constructor(n,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Pe/n,this._canonical=s}_getKey(n,s){return(n+=32768)<<16|s+32768}_vertexToIndex(n,s){if(n<-32768||s<-32768||n>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const u=0|Math.round(n),p=0|Math.round(s),y=this._getKey(u,p);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,_),this._vertexBuffer.push(u,p),_}_subdivideTrianglesScanline(n){if(this._granularity<2)return function(p,y){const _=[];for(let b=0;b<y.length;b+=3){const T=y[b],k=y[b+1],I=y[b+2],D=p[2*T],N=p[2*T+1];(p[2*k]-D)*(p[2*I+1]-N)-(p[2*k+1]-N)*(p[2*I]-D)>0?(_.push(T),_.push(I),_.push(k)):(_.push(T),_.push(k),_.push(I))}return _}(this._vertexBuffer,n);const s=[],u=n.length;for(let p=0;p<u;p+=3){const y=[n[p+0],n[p+1],n[p+2]],_=[this._vertexBuffer[2*n[p+0]+0],this._vertexBuffer[2*n[p+0]+1],this._vertexBuffer[2*n[p+1]+0],this._vertexBuffer[2*n[p+1]+1],this._vertexBuffer[2*n[p+2]+0],this._vertexBuffer[2*n[p+2]+1]];let b=1/0,T=1/0,k=-1/0,I=-1/0;for(let U=0;U<3;U++){const q=_[2*U],ee=_[2*U+1];b=Math.min(b,q),k=Math.max(k,q),T=Math.min(T,ee),I=Math.max(I,ee)}if(b===k||T===I)continue;const D=Math.floor(b/this._granularityCellSize),N=Math.ceil(k/this._granularityCellSize),z=Math.floor(T/this._granularityCellSize),V=Math.ceil(I/this._granularityCellSize);if(D!==N||z!==V)for(let U=z;U<V;U++){const q=this._scanlineGenerateVertexRingForCellRow(U,_,y);qR(this._vertexBuffer,q,s)}else s.push(...y)}return s}_scanlineGenerateVertexRingForCellRow(n,s,u){const p=n*this._granularityCellSize,y=p+this._granularityCellSize,_=[];for(let b=0;b<3;b++){const T=s[2*b],k=s[2*b+1],I=s[2*(b+1)%6],D=s[(2*(b+1)+1)%6],N=s[2*(b+2)%6],z=s[(2*(b+2)+1)%6],V=I-T,U=D-k,q=V===0,ee=U===0,ue=(p-k)/U,ne=(y-k)/U,ie=Math.min(ue,ne),de=Math.max(ue,ne);if(!ee&&(ie>=1||de<=0)||ee&&(k<p||k>y)){D>=p&&D<=y&&_.push(u[(b+1)%3]);continue}!ee&&ie>0&&_.push(this._vertexToIndex(T+V*ie,k+U*ie));const me=T+V*Math.max(ie,0),Ae=T+V*Math.min(de,1);q||this._generateIntraEdgeVertices(_,T,k,I,D,me,Ae),!ee&&de<1&&_.push(this._vertexToIndex(T+V*de,k+U*de)),(ee||D>=p&&D<=y)&&_.push(u[(b+1)%3]),!ee&&(D<=p||D>=y)&&this._generateInterEdgeVertices(_,T,k,I,D,N,z,Ae,p,y)}return _}_generateIntraEdgeVertices(n,s,u,p,y,_,b){const T=p-s,k=y-u,I=k===0,D=I?Math.min(s,p):Math.min(_,b),N=I?Math.max(s,p):Math.max(_,b),z=Math.floor(D/this._granularityCellSize)+1,V=Math.ceil(N/this._granularityCellSize)-1;if(I?s<p:_<b)for(let U=z;U<=V;U++){const q=U*this._granularityCellSize;n.push(this._vertexToIndex(q,u+k*(q-s)/T))}else for(let U=V;U>=z;U--){const q=U*this._granularityCellSize;n.push(this._vertexToIndex(q,u+k*(q-s)/T))}}_generateInterEdgeVertices(n,s,u,p,y,_,b,T,k,I){const D=y-u,N=_-p,z=b-y,V=(k-y)/z,U=(I-y)/z,q=Math.min(V,U),ee=Math.max(V,U),ue=p+N*q;let ne=Math.floor(Math.min(ue,T)/this._granularityCellSize)+1,ie=Math.ceil(Math.max(ue,T)/this._granularityCellSize)-1,de=T<ue;const me=z===0;if(me&&(b===k||b===I))return;if(me||q>=1||ee<=0){const $e=u-b,Fe=_+(s-_)*Math.min((k-b)/$e,(I-b)/$e);ne=Math.floor(Math.min(Fe,T)/this._granularityCellSize)+1,ie=Math.ceil(Math.max(Fe,T)/this._granularityCellSize)-1,de=T<Fe}const Ae=D>0?I:k;if(de)for(let $e=ne;$e<=ie;$e++)n.push(this._vertexToIndex($e*this._granularityCellSize,Ae));else for(let $e=ie;$e>=ne;$e--)n.push(this._vertexToIndex($e*this._granularityCellSize,Ae))}_generateOutline(n){const s=[];for(const u of n){const p=fc(u,this._granularity,!0),y=this._pointArrayToIndices(p),_=[];for(let b=1;b<y.length;b++)_.push(y[b-1]),_.push(y[b]);s.push(_)}return s}_handlePoles(n){let s=!1,u=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(u=!0)),(s||u)&&this._fillPoles(n,s,u)}_ensureNoPoleVertices(){const n=this._vertexBuffer;for(let s=0;s<n.length;s+=2){const u=n[s+1];u===Wu&&(n[s+1]=-32767),u===up&&(n[s+1]=32766)}}_generatePoleQuad(n,s,u,p,y,_){p>y!=(_===Wu)?(n.push(s),n.push(u),n.push(this._vertexToIndex(p,_)),n.push(u),n.push(this._vertexToIndex(y,_)),n.push(this._vertexToIndex(p,_))):(n.push(u),n.push(s),n.push(this._vertexToIndex(p,_)),n.push(this._vertexToIndex(y,_)),n.push(u),n.push(this._vertexToIndex(p,_)))}_fillPoles(n,s,u){const p=this._vertexBuffer,y=Pe,_=n.length;for(let b=2;b<_;b+=3){const T=n[b-2],k=n[b-1],I=n[b],D=p[2*T],N=p[2*T+1],z=p[2*k],V=p[2*k+1],U=p[2*I],q=p[2*I+1];s&&(N===0&&V===0&&this._generatePoleQuad(n,T,k,D,z,Wu),V===0&&q===0&&this._generatePoleQuad(n,k,I,z,U,Wu),q===0&&N===0&&this._generatePoleQuad(n,I,T,U,D,Wu)),u&&(N===y&&V===y&&this._generatePoleQuad(n,T,k,D,z,up),V===y&&q===y&&this._generatePoleQuad(n,k,I,z,U,up),q===y&&N===y&&this._generatePoleQuad(n,I,T,U,D,up))}}_initializeVertices(n){for(let s=0;s<n.length;s+=2)this._vertexToIndex(n[s],n[s+1])}subdividePolygonInternal(n,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:u,holeIndices:p}=function(b){const T=[],k=[];for(const I of b)if(I.length!==0){I!==b[0]&&T.push(k.length/2);for(let D=0;D<I.length;D++)k.push(I[D].x),k.push(I[D].y)}return{flattened:k,holeIndices:T}}(n);let y;this._initializeVertices(u);try{const b=function(k,I,D=2){const N=I&&I.length,z=N?I[0]*D:k.length;let V=O1(k,0,z,D,!0);const U=[];if(!V||V.next===V.prev)return U;let q,ee,ue;if(N&&(V=function(ne,ie,de,me){const Ae=[];for(let $e=0,Fe=ie.length;$e<Fe;$e++){const Ze=O1(ne,ie[$e]*me,$e<Fe-1?ie[$e+1]*me:ne.length,me,!1);Ze===Ze.next&&(Ze.steiner=!0),Ae.push(UR(Ze))}Ae.sort(FR);for(let $e=0;$e<Ae.length;$e++)de=BR(Ae[$e],de);return de}(k,I,V,D)),k.length>80*D){q=k[0],ee=k[1];let ne=q,ie=ee;for(let de=D;de<z;de+=D){const me=k[de],Ae=k[de+1];me<q&&(q=me),Ae<ee&&(ee=Ae),me>ne&&(ne=me),Ae>ie&&(ie=Ae)}ue=Math.max(ne-q,ie-ee),ue=ue!==0?32767/ue:0}return ap(V,U,D,q,ee,ue,0),U}(u,p),T=this._convertIndices(u,b);y=this._subdivideTrianglesScanline(T)}catch(b){console.error(b)}let _=[];return s&&(_=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:_}}_convertIndices(n,s){const u=[];for(let p=0;p<s.length;p++)u.push(this._vertexToIndex(n[2*s[p]],n[2*s[p]+1]));return u}_pointArrayToIndices(n){const s=[];for(let u=0;u<n.length;u++){const p=n[u];s.push(this._vertexToIndex(p.x,p.y))}return s}}function $1(a,n,s,u=!0){return new GR(s,n).subdividePolygonInternal(a,u)}function fc(a,n,s=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const u=a[0],p=a[a.length-1],y=s&&(u.x!==p.x||u.y!==p.y);if(n<2)return y?[...a,a[0]]:[...a];const _=Math.floor(Pe/n),b=[];b.push(new E(a[0].x,a[0].y));const T=a.length,k=y?T:T-1;for(let I=0;I<k;I++){const D=a[I],N=I<T-1?a[I+1]:a[0],z=D.x,V=D.y,U=N.x,q=N.y,ee=z!==U,ue=V!==q;if(!ee&&!ue)continue;const ne=U-z,ie=q-V,de=Math.abs(ne),me=Math.abs(ie);let Ae=z,$e=V;for(;;){const Ze=ne>0?(Math.floor(Ae/_)+1)*_:(Math.ceil(Ae/_)-1)*_,rt=ie>0?(Math.floor($e/_)+1)*_:(Math.ceil($e/_)-1)*_,Ke=Math.abs(Ae-Ze),Ve=Math.abs($e-rt),Ne=Math.abs(Ae-U),ht=Math.abs($e-q),ct=ee?Ke/de:Number.POSITIVE_INFINITY,pt=ue?Ve/me:Number.POSITIVE_INFINITY;if((Ne<=Ke||!ee)&&(ht<=Ve||!ue))break;if(ct<pt&&ee||!ue){Ae=Ze,$e+=ie*ct;const ot=new E(Ae,Math.round($e));b[b.length-1].x===ot.x&&b[b.length-1].y===ot.y||b.push(ot)}else{Ae+=ne*pt,$e=rt;const ot=new E(Math.round(Ae),$e);b[b.length-1].x===ot.x&&b[b.length-1].y===ot.y||b.push(ot)}}const Fe=new E(U,q);b[b.length-1].x===Fe.x&&b[b.length-1].y===Fe.y||b.push(Fe)}return b}function qR(a,n,s){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let u=0,p=a[2*n[0]];for(let T=1;T<n.length;T++){const k=a[2*n[T]];k<p&&(p=k,u=T)}const y=n.length;let _=u,b=(_+1)%y;for(;;){const T=_-1>=0?_-1:y-1,k=(b+1)%y,I=a[2*n[T]],D=a[2*n[k]],N=a[2*n[_]],z=a[2*n[_]+1],V=a[2*n[b]+1];let U=!1;if(I<D)U=!0;else if(I>D)U=!1;else{const q=V-z,ee=-(a[2*n[b]]-N),ue=z<V?1:-1;((I-N)*q+(a[2*n[T]+1]-z)*ee)*ue>((D-N)*q+(a[2*n[k]+1]-z)*ee)*ue&&(U=!0)}if(U){const q=n[T],ee=n[_],ue=n[b];q!==ee&&q!==ue&&ee!==ue&&s.push(ue,ee,q),_--,_<0&&(_=y-1)}else{const q=n[k],ee=n[_],ue=n[b];q!==ee&&q!==ue&&ee!==ue&&s.push(ue,ee,q),b++,b>=y&&(b=0)}if(T===k)break}}function G1(a,n,s,u,p,y,_,b,T){const k=p.length/2,I=_&&b&&T;if(k<it.MAX_VERTEX_ARRAY_LENGTH){const D=n.prepareSegment(k,s,u),N=D.vertexLength;for(let U=0;U<y.length;U+=3)u.emplaceBack(N+y[U],N+y[U+1],N+y[U+2]);let z,V;D.vertexLength+=k,D.primitiveLength+=y.length/3,I&&(V=_.prepareSegment(k,s,b),z=V.vertexLength,V.vertexLength+=k);for(let U=0;U<p.length;U+=2)a(p[U],p[U+1]);if(I)for(let U=0;U<T.length;U++){const q=T[U];for(let ee=1;ee<q.length;ee+=2)b.emplaceBack(z+q[ee-1],z+q[ee]);V.primitiveLength+=q.length/2}}else(function(D,N,z,V,U,q){const ee=[];for(let me=0;me<V.length/2;me++)ee.push(-1);const ue={count:0};let ne=0,ie=D.getOrCreateLatestSegment(N,z),de=ie.vertexLength;for(let me=2;me<U.length;me+=3){const Ae=U[me-2],$e=U[me-1],Fe=U[me];let Ze=ee[Ae]<ne,rt=ee[$e]<ne,Ke=ee[Fe]<ne;ie.vertexLength+((Ze?1:0)+(rt?1:0)+(Ke?1:0))>it.MAX_VERTEX_ARRAY_LENGTH&&(ie=D.createNewSegment(N,z),ne=ue.count,Ze=!0,rt=!0,Ke=!0,de=0);const Ve=hp(ee,V,q,ue,Ae,Ze,ie),Ne=hp(ee,V,q,ue,$e,rt,ie),ht=hp(ee,V,q,ue,Fe,Ke,ie);z.emplaceBack(de+Ve-ne,de+Ne-ne,de+ht-ne),ie.primitiveLength++}})(n,s,u,p,y,a),I&&function(D,N,z,V,U,q){const ee=[];for(let me=0;me<V.length/2;me++)ee.push(-1);const ue={count:0};let ne=0,ie=D.getOrCreateLatestSegment(N,z),de=ie.vertexLength;for(let me=0;me<U.length;me++){const Ae=U[me];for(let $e=1;$e<U[me].length;$e+=2){const Fe=Ae[$e-1],Ze=Ae[$e];let rt=ee[Fe]<ne,Ke=ee[Ze]<ne;ie.vertexLength+((rt?1:0)+(Ke?1:0))>it.MAX_VERTEX_ARRAY_LENGTH&&(ie=D.createNewSegment(N,z),ne=ue.count,rt=!0,Ke=!0,de=0);const Ve=hp(ee,V,q,ue,Fe,rt,ie),Ne=hp(ee,V,q,ue,Ze,Ke,ie);z.emplaceBack(de+Ve-ne,de+Ne-ne),ie.primitiveLength++}}}(_,s,b,p,T,a),n.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function hp(a,n,s,u,p,y,_){if(y){const b=u.count;return s(n[2*p],n[2*p+1]),a[p]=u.count,u.count++,_.vertexLength++,b}return a[p]}class mv{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ae,this.indexArray=new je,this.indexArray2=new et,this.programConfigurations=new Za(n.layers,n.zoom),this.segments=new it,this.segments2=new it,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,u){this.hasDependencies=Qm("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),_=[];for(const{feature:b,id:T,index:k,sourceLayerIndex:I}of n){const D=this.layers[0]._featureFilter.needGeometry,N=ya(b,D);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),N,u))continue;const z=y?p.evaluate(N,{},u,s.availableImages):void 0,V={id:T,properties:b.properties,type:b.type,sourceLayerIndex:I,index:k,geometry:D?N.geometry:ga(b),patterns:{},sortKey:z};_.push(V)}y&&_.sort((b,T)=>b.sortKey-T.sortKey);for(const b of _){const{geometry:T,index:k,sourceLayerIndex:I}=b;if(this.hasDependencies){const D=dv("fill",this.layers,b,{zoom:this.zoom},s);this.patternFeatures.push(D)}else this.addFeature(b,T,k,u,{},s.subdivisionGranularity);s.featureIndex.insert(n[k].feature,T,k,I,this.index)}}update(n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:u})}addFeatures(n,s,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,u,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,jR),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,u,p,y,_){for(const b of cu(s,500)){const T=$1(b,p,_.fill.getGranularityForZoomLevel(p.z)),k=this.layoutVertexArray;G1((I,D)=>{k.emplaceBack(I,D)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{imagePositions:y,canonical:p})}}let q1,W1;dt("FillBucket",mv,{omit:["layers","patternFeatures"]});var WR={get paint(){return W1=W1||new oi({"fill-antialias":new _t(Re.paint_fill["fill-antialias"]),"fill-opacity":new St(Re.paint_fill["fill-opacity"]),"fill-color":new St(Re.paint_fill["fill-color"]),"fill-outline-color":new St(Re.paint_fill["fill-outline-color"]),"fill-translate":new _t(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new sc(Re.paint_fill["fill-pattern"])})},get layout(){return q1=q1||new oi({"fill-sort-key":new St(Re.layout_fill["fill-sort-key"])})}};class ZR extends Gi{constructor(n,s){super(n,WR,s)}recalculate(n,s){super.recalculate(n,s);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new mv(n)}queryRadius(){return Ym(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:s,transform:u,pixelsToTileUnits:p}){return T1(Jm(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-u.bearingInRadians,p),s)}isTileClipped(){return!0}}const HR=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),KR=er([{name:"a_centroid",components:2,type:"Int16"}],4),{members:XR}=HR;class dp{constructor(n,s,u,p,y){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=p,this._values=y,n.readFields(YR,this,s)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const s=n.readVarint()+n.pos,u=[];let p,y=1,_=0,b=0,T=0;for(;n.pos<s;){if(_<=0){const k=n.readVarint();y=7&k,_=k>>3}if(_--,y===1||y===2)b+=n.readSVarint(),T+=n.readSVarint(),y===1&&(p&&u.push(p),p=[]),p&&p.push(new E(b,T));else{if(y!==7)throw new Error(`unknown command ${y}`);p&&p.push(p[0].clone())}}return p&&u.push(p),u}bbox(){const n=this._pbf;n.pos=this._geometry;const s=n.readVarint()+n.pos;let u=1,p=0,y=0,_=0,b=1/0,T=-1/0,k=1/0,I=-1/0;for(;n.pos<s;){if(p<=0){const D=n.readVarint();u=7&D,p=D>>3}if(p--,u===1||u===2)y+=n.readSVarint(),_+=n.readSVarint(),y<b&&(b=y),y>T&&(T=y),_<k&&(k=_),_>I&&(I=_);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,k,T,I]}toGeoJSON(n,s,u){const p=this.extent*Math.pow(2,u),y=this.extent*n,_=this.extent*s,b=this.loadGeometry();function T(N){return[360*(N.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+_)/p)*Math.PI))-90]}function k(N){return N.map(T)}let I;if(this.type===1){const N=[];for(const V of b)N.push(V[0]);const z=k(N);I=N.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){const N=b.map(k);I=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=Z1(b),z=[];for(const V of N)z.push(V.map(k));I=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}const D={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function YR(a,n,s){a===1?n.id=s.readVarint():a===2?function(u,p){const y=u.readVarint()+u.pos;for(;u.pos<y;){const _=p._keys[u.readVarint()],b=p._values[u.readVarint()];p.properties[_]=b}}(s,n):a===3?n.type=s.readVarint():a===4&&(n._geometry=s.pos)}function Z1(a){const n=a.length;if(n<=1)return[a];const s=[];let u,p;for(let y=0;y<n;y++){const _=JR(a[y]);_!==0&&(p===void 0&&(p=_<0),p===_<0?(u&&s.push(u),u=[a[y]]):u&&u.push(a[y]))}return u&&s.push(u),s}function JR(a){let n=0;for(let s,u,p=0,y=a.length,_=y-1;p<y;_=p++)s=a[p],u=a[_],n+=(u.x-s.x)*(s.y+u.y);return n}dp.types=["Unknown","Point","LineString","Polygon"];class QR{constructor(n,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(eD,this,s),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const s=this._pbf.readVarint()+this._pbf.pos;return new dp(this._pbf,s,this.extent,this._keys,this._values)}}function eD(a,n,s){a===15?n.version=s.readVarint():a===1?n.name=s.readString():a===5?n.extent=s.readVarint():a===2?n._features.push(s.pos):a===3?n._keys.push(s.readString()):a===4&&n._values.push(function(u){let p=null;const y=u.readVarint()+u.pos;for(;u.pos<y;){const _=u.readVarint()>>3;p=_===1?u.readString():_===2?u.readFloat():_===3?u.readDouble():_===4?u.readVarint64():_===5?u.readVarint():_===6?u.readSVarint():_===7?u.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(s))}class H1{constructor(n,s){this.layers=n.readFields(tD,{},s)}}function tD(a,n,s){if(a===3){const u=new QR(s,s.readVarint()+s.pos);u.length&&(n[u.name]=u)}}const gv=Math.pow(2,13);function pp(a,n,s,u,p,y,_,b){a.emplaceBack(n,s,2*Math.floor(u*gv)+_,p*gv*2,y*gv*2,Math.round(b))}class yv{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasDependencies=!1,this.layoutVertexArray=new he,this.centroidVertexArray=new se,this.indexArray=new je,this.programConfigurations=new Za(n.layers,n.zoom),this.segments=new it,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,u){this.features=[],this.hasDependencies=Qm("fill-extrusion",this.layers,s);for(const{feature:p,id:y,index:_,sourceLayerIndex:b}of n){const T=this.layers[0]._featureFilter.needGeometry,k=ya(p,T);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),k,u))continue;const I={id:y,sourceLayerIndex:b,index:_,geometry:T?k.geometry:ga(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(dv("fill-extrusion",this.layers,I,{zoom:this.zoom},s)):this.addFeature(I,I.geometry,_,u,{},s.subdivisionGranularity),s.featureIndex.insert(p,I.geometry,_,b,this.index,!0)}}addFeatures(n,s,u){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,s,u,n.subdivisionGranularity)}}update(n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:u})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,XR),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,KR.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,s,u,p,y,_){for(const b of cu(s,500)){const T={x:0,y:0,sampleCount:0},k=this.layoutVertexArray.length;this.processPolygon(T,p,n,b,_);const I=this.layoutVertexArray.length-k,D=Math.floor(T.x/T.sampleCount),N=Math.floor(T.y/T.sampleCount);for(let z=0;z<I;z++)this.centroidVertexArray.emplaceBack(D,N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{imagePositions:y,canonical:p})}processPolygon(n,s,u,p,y){if(p.length<1||K1(p[0]))return;for(const D of p)D.length!==0&&nD(n,D);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=y.fill.getGranularityForZoomLevel(s.z),T=dp.types[u.type]==="Polygon";for(const D of p){if(D.length===0||K1(D))continue;const N=fc(D,b,T);this._generateSideFaces(N,_)}if(!T)return;const k=$1(p,s,b,!1),I=this.layoutVertexArray;G1((D,N)=>{pp(I,D,N,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles)}_generateSideFaces(n,s){let u=0;for(let p=1;p<n.length;p++){const y=n[p],_=n[p-1];if(rD(y,_))continue;s.segment.vertexLength+4>it.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const b=y.sub(_)._perp()._unit(),T=_.dist(y);u+T>32768&&(u=0),pp(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,0,u),pp(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,1,u),u+=T,pp(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,0,u),pp(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,1,u);const k=s.segment.vertexLength;this.indexArray.emplaceBack(k,k+2,k+1),this.indexArray.emplaceBack(k+1,k+2,k+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function nD(a,n){for(let s=0;s<n.length;s++){const u=n[s];s===n.length-1&&n[0].x===u.x&&n[0].y===u.y||(a.x+=u.x,a.y+=u.y,a.sampleCount++)}}function rD(a,n){return a.x===n.x&&(a.x<0||a.x>Pe)||a.y===n.y&&(a.y<0||a.y>Pe)}function K1(a){return a.every(n=>n.x<0)||a.every(n=>n.x>Pe)||a.every(n=>n.y<0)||a.every(n=>n.y>Pe)}let X1;dt("FillExtrusionBucket",yv,{omit:["layers","features"]});var iD={get paint(){return X1=X1||new oi({"fill-extrusion-opacity":new _t(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sc(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class sD extends Gi{constructor(n,s){super(n,iD,s)}createBucket(n){return new yv(n)}queryRadius(){return Ym(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:u,geometry:p,transform:y,pixelsToTileUnits:_,pixelPosMatrix:b}){const T=Jm(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,_),k=this.paint.get("fill-extrusion-height").evaluate(s,u),I=this.paint.get("fill-extrusion-base").evaluate(s,u),D=function(z,V){const U=[];for(const q of z){const ee=[q.x,q.y,0,1];gt(ee,ee,V),U.push(new E(ee[0]/ee[3],ee[1]/ee[3]))}return U}(T,b),N=function(z,V,U,q){const ee=[],ue=[],ne=q[8]*V,ie=q[9]*V,de=q[10]*V,me=q[11]*V,Ae=q[8]*U,$e=q[9]*U,Fe=q[10]*U,Ze=q[11]*U;for(const rt of z){const Ke=[],Ve=[];for(const Ne of rt){const ht=Ne.x,ct=Ne.y,pt=q[0]*ht+q[4]*ct+q[12],ot=q[1]*ht+q[5]*ct+q[13],vt=q[2]*ht+q[6]*ct+q[14],Qt=q[3]*ht+q[7]*ct+q[15],Ht=vt+de,Nn=Qt+me,Kr=pt+Ae,fr=ot+$e,Ln=vt+Fe,An=Qt+Ze,on=new E((pt+ne)/Nn,(ot+ie)/Nn);on.z=Ht/Nn,Ke.push(on);const Wn=new E(Kr/An,fr/An);Wn.z=Ln/An,Ve.push(Wn)}ee.push(Ke),ue.push(Ve)}return[ee,ue]}(p,I,k,b);return function(z,V,U){let q=1/0;T1(U,V)&&(q=Y1(U,V[0]));for(let ee=0;ee<V.length;ee++){const ue=V[ee],ne=z[ee];for(let ie=0;ie<ue.length-1;ie++){const de=ue[ie],me=[de,ue[ie+1],ne[ie+1],ne[ie],de];Vu(U,me)&&(q=Math.min(q,Y1(U,me)))}}return q!==1/0&&q}(N[0],N[1],D)}}function fp(a,n){return a.x*n.x+a.y*n.y}function Y1(a,n){if(a.length===1){let s=0;const u=n[s++];let p;for(;!p||u.equals(p);)if(p=n[s++],!p)return 1/0;for(;s<n.length;s++){const y=n[s],_=a[0],b=p.sub(u),T=y.sub(u),k=_.sub(u),I=fp(b,b),D=fp(b,T),N=fp(T,T),z=fp(k,b),V=fp(k,T),U=I*N-D*D,q=(N*z-D*V)/U,ee=(I*V-D*z)/U,ue=u.z*(1-q-ee)+p.z*q+y.z*ee;if(isFinite(ue))return ue}return 1/0}{let s=1/0;for(const u of n)s=Math.min(s,u.z);return s}}const aD=er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:oD}=aD,lD=er([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:cD}=lD,uD=Math.cos(Math.PI/180*37.5),J1=Math.pow(2,14)/.5;class _v{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ge,this.layoutVertexArray2=new ce,this.indexArray=new je,this.programConfigurations=new Za(n.layers,n.zoom),this.segments=new it,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,u){this.hasDependencies=Qm("line",this.layers,s)||this.hasLineDasharray(this.layers);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),_=[];for(const{feature:b,id:T,index:k,sourceLayerIndex:I}of n){const D=this.layers[0]._featureFilter.needGeometry,N=ya(b,D);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),N,u))continue;const z=y?p.evaluate(N,{},u):void 0,V={id:T,properties:b.properties,type:b.type,sourceLayerIndex:I,index:k,geometry:D?N.geometry:ga(b),patterns:{},dashes:{},sortKey:z};_.push(V)}y&&_.sort((b,T)=>b.sortKey-T.sortKey);for(const b of _){const{geometry:T,index:k,sourceLayerIndex:I}=b;this.hasDependencies?(Qm("line",this.layers,s)?dv("line",this.layers,b,{zoom:this.zoom},s):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,b,this.zoom,s),this.patternFeatures.push(b)):this.addFeature(b,T,k,u,{},{},s.subdivisionGranularity),s.featureIndex.insert(n[k].feature,T,k,I,this.index)}}update(n,s,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:u,dashPositions:p})}addFeatures(n,s,u,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,u,p,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,cD)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,oD),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,u,p,y,_,b){const T=this.layers[0].layout,k=T.get("line-join").evaluate(n,{}),I=T.get("line-cap"),D=T.get("line-miter-limit"),N=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const z of s)this.addLine(z,n,k,I,D,N,p,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{imagePositions:y,dashPositions:_,canonical:p})}addLine(n,s,u,p,y,_,b,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=fc(n,b?T.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<n.length-1;ne++)this.totalDistance+=n[ne].dist(n[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k=dp.types[s.type]==="Polygon";let I=n.length;for(;I>=2&&n[I-1].equals(n[I-2]);)I--;let D=0;for(;D<I-1&&n[D].equals(n[D+1]);)D++;if(I<(k?3:2))return;u==="bevel"&&(y=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let V,U,q,ee,ue;this.e1=this.e2=-1,k&&(V=n[I-2],ue=n[D].sub(V)._unit()._perp());for(let ne=D;ne<I;ne++){if(q=ne===I-1?k?n[D+1]:void 0:n[ne+1],q&&n[ne].equals(q))continue;ue&&(ee=ue),V&&(U=V),V=n[ne],ue=q?q.sub(V)._unit()._perp():ee,ee=ee||ue;let ie=ee.add(ue);ie.x===0&&ie.y===0||ie._unit();const de=ee.x*ue.x+ee.y*ue.y,me=ie.x*ue.x+ie.y*ue.y,Ae=me!==0?1/me:1/0,$e=2*Math.sqrt(2-2*me),Fe=me<uD&&U&&q,Ze=ee.x*ue.y-ee.y*ue.x>0;if(Fe&&ne>D){const Ve=V.dist(U);if(Ve>2*N){const Ne=V.sub(V.sub(U)._mult(N/Ve)._round());this.updateDistance(U,Ne),this.addCurrentVertex(Ne,ee,0,0,z),U=Ne}}const rt=U&&q;let Ke=rt?u:k?"butt":p;if(rt&&Ke==="round"&&(Ae<_?Ke="miter":Ae<=2&&(Ke="fakeround")),Ke==="miter"&&Ae>y&&(Ke="bevel"),Ke==="bevel"&&(Ae>2&&(Ke="flipbevel"),Ae<y&&(Ke="miter")),U&&this.updateDistance(U,V),Ke==="miter")ie._mult(Ae),this.addCurrentVertex(V,ie,0,0,z);else if(Ke==="flipbevel"){if(Ae>100)ie=ue.mult(-1);else{const Ve=Ae*ee.add(ue).mag()/ee.sub(ue).mag();ie._perp()._mult(Ve*(Ze?-1:1))}this.addCurrentVertex(V,ie,0,0,z),this.addCurrentVertex(V,ie.mult(-1),0,0,z)}else if(Ke==="bevel"||Ke==="fakeround"){const Ve=-Math.sqrt(Ae*Ae-1),Ne=Ze?Ve:0,ht=Ze?0:Ve;if(U&&this.addCurrentVertex(V,ee,Ne,ht,z),Ke==="fakeround"){const ct=Math.round(180*$e/Math.PI/20);for(let pt=1;pt<ct;pt++){let ot=pt/ct;if(ot!==.5){const Qt=ot-.5;ot+=ot*Qt*(ot-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*Qt*Qt+(.848013+de*(.215638*de-1.06021)))}const vt=ue.sub(ee)._mult(ot)._add(ee)._unit()._mult(Ze?-1:1);this.addHalfVertex(V,vt.x,vt.y,!1,Ze,0,z)}}q&&this.addCurrentVertex(V,ue,-Ne,-ht,z)}else if(Ke==="butt")this.addCurrentVertex(V,ie,0,0,z);else if(Ke==="square"){const Ve=U?1:-1;this.addCurrentVertex(V,ie,Ve,Ve,z)}else Ke==="round"&&(U&&(this.addCurrentVertex(V,ee,0,0,z),this.addCurrentVertex(V,ee,1,1,z,!0)),q&&(this.addCurrentVertex(V,ue,-1,-1,z,!0),this.addCurrentVertex(V,ue,0,0,z)));if(Fe&&ne<I-1){const Ve=V.dist(q);if(Ve>2*N){const Ne=V.add(q.sub(V)._mult(N/Ve)._round());this.updateDistance(V,Ne),this.addCurrentVertex(Ne,ue,0,0,z),V=Ne}}}}addCurrentVertex(n,s,u,p,y,_=!1){const b=s.y*p-s.x,T=-s.y-s.x*p;this.addHalfVertex(n,s.x+s.y*u,s.y-s.x*u,_,!1,u,y),this.addHalfVertex(n,b,T,_,!0,-p,y),this.distance>J1/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,s,u,p,y,_))}addHalfVertex({x:n,y:s},u,p,y,_,b,T){const k=.5*(this.lineClips?this.scaledDistance*(J1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(y?1:0),(s<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(b===0?0:b<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),T.primitiveLength++),_?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}hasLineDasharray(n){for(const s of n){const u=s.paint.get("line-dasharray");if(u&&!u.isConstant())return!0}return!1}addLineDashDependencies(n,s,u,p){for(const y of n){const _=y.paint.get("line-dasharray");if(!_||_.value.kind==="constant")continue;const b=y.layout.get("line-cap")==="round",T={dasharray:_.value.evaluate({zoom:u-1},s,{}),round:b},k={dasharray:_.value.evaluate({zoom:u},s,{}),round:b},I={dasharray:_.value.evaluate({zoom:u+1},s,{}),round:b},D=`${T.dasharray.join(",")},${T.round}`,N=`${k.dasharray.join(",")},${k.round}`,z=`${I.dasharray.join(",")},${I.round}`;p.dashDependencies[D]=T,p.dashDependencies[N]=k,p.dashDependencies[z]=I,s.dashes[y.id]={min:D,mid:N,max:z}}}}let Q1,eS;dt("LineBucket",_v,{omit:["layers","patternFeatures"]});var tS={get paint(){return eS=eS||new oi({"line-opacity":new St(Re.paint_line["line-opacity"]),"line-color":new St(Re.paint_line["line-color"]),"line-translate":new _t(Re.paint_line["line-translate"]),"line-translate-anchor":new _t(Re.paint_line["line-translate-anchor"]),"line-width":new St(Re.paint_line["line-width"]),"line-gap-width":new St(Re.paint_line["line-gap-width"]),"line-offset":new St(Re.paint_line["line-offset"]),"line-blur":new St(Re.paint_line["line-blur"]),"line-dasharray":new sc(Re.paint_line["line-dasharray"]),"line-pattern":new sc(Re.paint_line["line-pattern"]),"line-gradient":new Du(Re.paint_line["line-gradient"])})},get layout(){return Q1=Q1||new oi({"line-cap":new _t(Re.layout_line["line-cap"]),"line-join":new St(Re.layout_line["line-join"]),"line-miter-limit":new _t(Re.layout_line["line-miter-limit"]),"line-round-limit":new _t(Re.layout_line["line-round-limit"]),"line-sort-key":new St(Re.layout_line["line-sort-key"])})}};class hD extends St{possiblyEvaluate(n,s){return s=new pn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(n,s)}evaluate(n,s,u,p){return s=vr({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,u,p)}}let rg;class dD extends Gi{constructor(n,s){super(n,tS,s),this.gradientVersion=0,rg||(rg=new hD(tS.paint.properties["line-width"].specification),rg.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof la,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,s){super.recalculate(n,s),this.paint._values["line-floorwidth"]=rg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new _v(n)}queryRadius(n){const s=n,u=nS($u("line-width",this,s),$u("line-gap-width",this,s)),p=$u("line-offset",this,s);return u/2+Math.abs(p)+Ym(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:u,geometry:p,transform:y,pixelsToTileUnits:_}){const b=Jm(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,_),T=_/2*nS(this.paint.get("line-width").evaluate(s,u),this.paint.get("line-gap-width").evaluate(s,u)),k=this.paint.get("line-offset").evaluate(s,u);return k&&(p=function(I,D){const N=[];for(let z=0;z<I.length;z++){const V=xR(I[z]),U=[];for(let q=0;q<V.length;q++){const ee=V[q],ue=V[q-1],ne=V[q+1],ie=q===0?new E(0,0):ee.sub(ue)._unit()._perp(),de=q===V.length-1?new E(0,0):ne.sub(ee)._unit()._perp(),me=ie._add(de)._unit(),Ae=me.x*de.x+me.y*de.y;Ae!==0&&me._mult(1/Ae),U.push(me._mult(D)._add(ee))}N.push(U)}return N}(p,k*_)),function(I,D,N){for(let z=0;z<D.length;z++){const V=D[z];if(I.length>=3){for(let U=0;U<V.length;U++)if(Uu(I,V[U]))return!0}if(yR(I,V,N))return!0}return!1}(b,p,T)}isTileClipped(){return!0}}function nS(a,n){return n>0?n+2*a:a}const pD=er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fD=er([{name:"a_projected_pos",components:3,type:"Float32"}],4);er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mD=er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);er([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rS=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gD=er([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function yD(a,n,s){return a.sections.forEach(u=>{u.text=function(p,y,_){const b=y.layout.get("text-transform").evaluate(_,{});return b==="uppercase"?p=p.toLocaleUpperCase():b==="lowercase"&&(p=p.toLocaleLowerCase()),pa.applyArabicShaping&&(p=pa.applyArabicShaping(p)),p}(u.text,n,s)}),a}er([{name:"triangle",components:3,type:"Uint16"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),er([{type:"Float32",name:"offsetX"}]),er([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),er([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var kr=24;const mp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},_D={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},vD={40:!0};function iS(a,n,s,u,p,y){if("fontStack"in n){const _=s[n.fontStack],b=_&&_[a];return b?b.metrics.advance*n.scale+p:0}{const _=u[n.imageName];return _?_.displaySize[0]*n.scale*kr/y+p:0}}function sS(a,n,s,u){const p=Math.pow(a-n,2);return u?a<n?p/2:2*p:p+Math.abs(s)*s}function xD(a,n,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function aS(a,n,s,u,p,y){let _=null,b=sS(n,s,p,y);for(const T of u){const k=sS(n-T.x,s,p,y)+T.badness;k<=b&&(_=T,b=k)}return{index:a,x:n,priorBreak:_,badness:b}}function oS(a){return a?oS(a.priorBreak).concat(a.index):[]}class Zu{constructor(n="",s=[],u=[]){this.text=n,this.sections=s,this.sectionIndex=u,this.imageSectionID=null}static fromFeature(n,s){const u=new Zu;for(let p=0;p<n.sections.length;p++){const y=n.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,s)}return u}length(){return[...this.text].length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}verticalizePunctuation(){this.text=function(n){let s="",u={premature:!0,value:void 0};const p=n[Symbol.iterator]();let y=p.next();const _=n[Symbol.iterator]();_.next();let b=_.next();for(;!y.done;)s+=!b.done&&qd(b.value.codePointAt(0))&&!mp[b.value]||!u.premature&&qd(u.value.codePointAt(0))&&!mp[u.value]||!mp[y.value]?y.value:mp[y.value],u={value:y.value,premature:!1},y=p.next(),b=_.next();return s}(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const n=this.text.match(/^\s*/),s=n?n[0].length:0,u=this.text.match(/\S\s*$/),p=u?u[0].length-1:0;this.text=this.text.substring(s,this.text.length-p),this.sectionIndex=this.sectionIndex.slice(s,this.sectionIndex.length-p)}substring(n,s){const u=[...this.text].slice(n,s).join(""),p=this.sectionIndex.slice(n,s);return new Zu(u,this.sections,p)}toCodeUnitIndex(n){return[...this.text].slice(0,n).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}getMaxImageSize(n){let s=0,u=0;for(let p=0;p<this.length();p++){const y=this.getSection(p);if("imageName"in y){const _=n[y.imageName];if(!_)continue;const b=_.displaySize;s=Math.max(s,b[0]),u=Math.max(u,b[1])}}return{maxImageWidth:s,maxImageHeight:u}}addTextSection(n,s){this.text+=n.text,this.sections.push({scale:n.scale||1,verticalAlign:n.verticalAlign||"bottom",fontStack:n.fontStack||s});const u=this.sections.length-1;this.sectionIndex.push(...[...n.text].map(()=>u))}addImageSection(n){const s=n.image?n.image.name:"";if(s.length===0)return void ir("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push({scale:1,verticalAlign:n.verticalAlign||"bottom",imageName:s}),this.sectionIndex.push(this.sections.length-1)):ir("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(n,s,u,p,y){const _=[],b=this.determineAverageLineWidth(n,s,u,p,y),T=this.hasZeroWidthSpaces();let k=0,I=0;const D=this.text[Symbol.iterator]();let N=D.next();const z=this.text[Symbol.iterator]();z.next();let V=z.next();const U=this.text[Symbol.iterator]();U.next(),U.next();let q=U.next();for(;!N.done;){const ee=this.getSection(I),ue=N.value.codePointAt(0);if(Fm(ue)||(k+=iS(ue,ee,u,p,n,y)),!V.done){const ne=nc(ue),ie=V.value.codePointAt(0);(_D[ue]||ne||"imageName"in ee||!q.done&&vD[ie])&&_.push(aS(I+1,k,b,_,xD(ue,ie,ne&&T),!1))}I++,N=D.next(),V=z.next(),q=U.next()}return oS(aS(this.length(),k,b,_,0,!0))}determineAverageLineWidth(n,s,u,p,y){let _=0,b=0;for(const T of this.text){const k=this.getSection(b);_+=iS(T.codePointAt(0),k,u,p,n,y),b++}return _/Math.max(1,Math.ceil(_/s))}}const vv=4294967296,lS=1/vv,cS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class ig{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,s,u=this.length){for(;this.pos<u;){const p=this.readVarint(),y=p>>3,_=this.pos;this.type=7&p,n(y,s,this),this.pos===_&&this.skip(p)}return s}readMessage(n,s){return this.readFields(n,s,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*vv;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*vv;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const s=this.buf;let u,p;return p=s[this.pos++],u=127&p,p<128?u:(p=s[this.pos++],u|=(127&p)<<7,p<128?u:(p=s[this.pos++],u|=(127&p)<<14,p<128?u:(p=s[this.pos++],u|=(127&p)<<21,p<128?u:(p=s[this.pos],u|=(15&p)<<28,function(y,_,b){const T=b.buf;let k,I;if(I=T[b.pos++],k=(112&I)>>4,I<128||(I=T[b.pos++],k|=(127&I)<<3,I<128)||(I=T[b.pos++],k|=(127&I)<<10,I<128)||(I=T[b.pos++],k|=(127&I)<<17,I<128)||(I=T[b.pos++],k|=(127&I)<<24,I<128)||(I=T[b.pos++],k|=(1&I)<<31,I<128))return Hu(y,k,_);throw new Error("Expected varint not more than 10 bytes")}(u,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,s=this.pos;return this.pos=n,n-s>=12&&cS?cS.decode(this.buf.subarray(s,n)):function(u,p,y){let _="",b=p;for(;b<y;){const T=u[b];let k,I,D,N=null,z=T>239?4:T>223?3:T>191?2:1;if(b+z>y)break;z===1?T<128&&(N=T):z===2?(k=u[b+1],(192&k)==128&&(N=(31&T)<<6|63&k,N<=127&&(N=null))):z===3?(k=u[b+1],I=u[b+2],(192&k)==128&&(192&I)==128&&(N=(15&T)<<12|(63&k)<<6|63&I,(N<=2047||N>=55296&&N<=57343)&&(N=null))):z===4&&(k=u[b+1],I=u[b+2],D=u[b+3],(192&k)==128&&(192&I)==128&&(192&D)==128&&(N=(15&T)<<18|(63&k)<<12|(63&I)<<6|63&D,(N<=65535||N>=1114112)&&(N=null))),N===null?(N=65533,z=1):N>65535&&(N-=65536,_+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),_+=String.fromCharCode(N),b+=z}return _}(this.buf,s,n)}readBytes(){const n=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,n);return this.pos=n,s}readPackedVarint(n=[],s){const u=this.readPackedEnd();for(;this.pos<u;)n.push(this.readVarint(s));return n}readPackedSVarint(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const s=7&n;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(n,s){this.writeVarint(n<<3|s)}realloc(n){let s=this.length||16;for(;s<this.pos+n;)s*=2;if(s!==this.length){const u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.dataView=new DataView(u.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*lS),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*lS),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(s,u){let p,y;if(s>=0?(p=s%4294967296|0,y=s/4294967296|0):(p=~(-s%4294967296),y=~(-s/4294967296),4294967295^p?p=p+1|0:(p=0,y=y+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(_,b,T){T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,T.buf[T.pos]=127&(_>>>=7)}(p,0,u),function(_,b){const T=(7&_)<<4;b.buf[b.pos++]|=T|((_>>>=3)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_)))))}(y,u)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const s=this.pos;this.pos=function(p,y,_){for(let b,T,k=0;k<y.length;k++){if(b=y.charCodeAt(k),b>55295&&b<57344){if(!T){b>56319||k+1===y.length?(p[_++]=239,p[_++]=191,p[_++]=189):T=b;continue}if(b<56320){p[_++]=239,p[_++]=191,p[_++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(p[_++]=239,p[_++]=191,p[_++]=189,T=null);b<128?p[_++]=b:(b<2048?p[_++]=b>>6|192:(b<65536?p[_++]=b>>12|224:(p[_++]=b>>18|240,p[_++]=b>>12&63|128),p[_++]=b>>6&63|128),p[_++]=63&b|128)}return _}(this.buf,n,this.pos);const u=this.pos-s;u>=128&&uS(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const s=n.length;this.writeVarint(s),this.realloc(s);for(let u=0;u<s;u++)this.buf[this.pos++]=n[u]}writeRawMessage(n,s){this.pos++;const u=this.pos;n(s,this);const p=this.pos-u;p>=128&&uS(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p}writeMessage(n,s,u){this.writeTag(n,2),this.writeRawMessage(s,u)}writePackedVarint(n,s){s.length&&this.writeMessage(n,bD,s)}writePackedSVarint(n,s){s.length&&this.writeMessage(n,wD,s)}writePackedBoolean(n,s){s.length&&this.writeMessage(n,ED,s)}writePackedFloat(n,s){s.length&&this.writeMessage(n,SD,s)}writePackedDouble(n,s){s.length&&this.writeMessage(n,TD,s)}writePackedFixed32(n,s){s.length&&this.writeMessage(n,PD,s)}writePackedSFixed32(n,s){s.length&&this.writeMessage(n,CD,s)}writePackedFixed64(n,s){s.length&&this.writeMessage(n,kD,s)}writePackedSFixed64(n,s){s.length&&this.writeMessage(n,AD,s)}writeBytesField(n,s){this.writeTag(n,2),this.writeBytes(s)}writeFixed32Field(n,s){this.writeTag(n,5),this.writeFixed32(s)}writeSFixed32Field(n,s){this.writeTag(n,5),this.writeSFixed32(s)}writeFixed64Field(n,s){this.writeTag(n,1),this.writeFixed64(s)}writeSFixed64Field(n,s){this.writeTag(n,1),this.writeSFixed64(s)}writeVarintField(n,s){this.writeTag(n,0),this.writeVarint(s)}writeSVarintField(n,s){this.writeTag(n,0),this.writeSVarint(s)}writeStringField(n,s){this.writeTag(n,2),this.writeString(s)}writeFloatField(n,s){this.writeTag(n,5),this.writeFloat(s)}writeDoubleField(n,s){this.writeTag(n,1),this.writeDouble(s)}writeBooleanField(n,s){this.writeVarintField(n,+s)}}function Hu(a,n,s){return s?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function uS(a,n,s){const u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(u);for(let p=s.pos-1;p>=a;p--)s.buf[p+u]=s.buf[p]}function bD(a,n){for(let s=0;s<a.length;s++)n.writeVarint(a[s])}function wD(a,n){for(let s=0;s<a.length;s++)n.writeSVarint(a[s])}function SD(a,n){for(let s=0;s<a.length;s++)n.writeFloat(a[s])}function TD(a,n){for(let s=0;s<a.length;s++)n.writeDouble(a[s])}function ED(a,n){for(let s=0;s<a.length;s++)n.writeBoolean(a[s])}function PD(a,n){for(let s=0;s<a.length;s++)n.writeFixed32(a[s])}function CD(a,n){for(let s=0;s<a.length;s++)n.writeSFixed32(a[s])}function kD(a,n){for(let s=0;s<a.length;s++)n.writeFixed64(a[s])}function AD(a,n){for(let s=0;s<a.length;s++)n.writeSFixed64(a[s])}function ID(a,n,s){a===1&&s.readMessage(MD,n)}function MD(a,n,s){if(a===3){const{id:u,bitmap:p,width:y,height:_,left:b,top:T,advance:k}=s.readMessage(RD,{});n.push({id:u,bitmap:new sp({width:y+6,height:_+6},p),metrics:{width:y,height:_,left:b,top:T,advance:k}})}}function RD(a,n,s){a===1?n.id=s.readVarint():a===2?n.bitmap=s.readBytes():a===3?n.width=s.readVarint():a===4?n.height=s.readVarint():a===5?n.left=s.readSVarint():a===6?n.top=s.readSVarint():a===7&&(n.advance=s.readVarint())}function hS(a){let n=0,s=0;for(const _ of a)n+=_.w*_.h,s=Math.max(s,_.w);a.sort((_,b)=>b.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let p=0,y=0;for(const _ of a)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,y=Math.max(y,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===T.w&&_.h===T.h){const k=u.pop();k&&b<u.length&&(u[b]=k)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(u.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:p,h:y,fill:n/(p*y)||0}}class xv{constructor(n,{pixelRatio:s,version:u,stretchX:p,stretchY:y,content:_,textFitWidth:b,textFitHeight:T}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=p,this.stretchY=y,this.content=_,this.version=u,this.textFitWidth=b,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class dS{constructor(n,s){const u={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(n,u,y),this.addImages(s,p,y);const{w:_,h:b}=hS(y),T=new Ri({width:_||1,height:b||1});for(const k in n){const I=n[k],D=u[k].paddedRect;Ri.copy(I.data,T,{x:0,y:0},{x:D.x+1,y:D.y+1},I.data)}for(const k in s){const I=s[k],D=p[k].paddedRect,N=D.x+1,z=D.y+1,V=I.data.width,U=I.data.height;Ri.copy(I.data,T,{x:0,y:0},{x:N,y:z},I.data),Ri.copy(I.data,T,{x:0,y:U-1},{x:N,y:z-1},{width:V,height:1}),Ri.copy(I.data,T,{x:0,y:0},{x:N,y:z+U},{width:V,height:1}),Ri.copy(I.data,T,{x:V-1,y:0},{x:N-1,y:z},{width:1,height:U}),Ri.copy(I.data,T,{x:0,y:0},{x:N+V,y:z},{width:1,height:U})}this.image=T,this.iconPositions=u,this.patternPositions=p}addImages(n,s,u){for(const p in n){const y=n[p],_={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(_),s[p]=new xv(_,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(n,s){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in n.updatedImages)this.patchUpdatedImage(this.iconPositions[u],n.getImage(u),s),this.patchUpdatedImage(this.patternPositions[u],n.getImage(u),s)}patchUpdatedImage(n,s,u){if(!n||!s||n.version===s.version)return;n.version=s.version;const[p,y]=n.tl;u.update(s.data,void 0,{x:p,y})}}var $o;function sg(a,n,s,u,p,y,_,b,T,k,I,D,N,z,V){const U=Zu.fromFeature(a,p);let q;D===f.az.vertical&&U.verticalizePunctuation();let ee=U.determineLineBreaks(k,y,n,u,z);const{processBidirectionalText:ue,processStyledBidirectionalText:ne}=pa;if(ue&&U.sections.length===1){q=[],ee=ee.map(Ae=>U.toCodeUnitIndex(Ae));const me=ue(U.toString(),ee);for(const Ae of me){const $e=[...Ae].map(()=>0);q.push(new Zu(Ae,U.sections,$e))}}else if(ne){q=[],ee=ee.map(Fe=>U.toCodeUnitIndex(Fe));let me=0;const Ae=[];for(const Fe of U.text)Ae.push(...Array(Fe.length).fill(U.sectionIndex[me])),me++;const $e=ne(U.text,Ae,ee);for(const Fe of $e){const Ze=[];let rt="";for(const Ke of Fe[0])Ze.push(Fe[1][rt.length]),rt+=Ke;q.push(new Zu(Fe[0],U.sections,Ze))}}else q=function(me,Ae){const $e=[];let Fe=0;for(const Ze of Ae)$e.push(me.substring(Fe,Ze)),Fe=Ze;return Fe<me.length()&&$e.push(me.substring(Fe,me.length())),$e}(U,ee);const ie=[],de={positionedLines:ie,text:U.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(me,Ae,$e,Fe,Ze,rt,Ke,Ve,Ne,ht,ct,pt){let ot=0,vt=0,Qt=0,Ht=0;const Nn=Ve==="right"?1:Ve==="left"?0:.5,Kr=kr/pt;let fr=0;for(const on of Ze){on.trim();const Wn=on.getMaxScale(),nr={positionedGlyphs:[],lineOffset:0};me.positionedLines[fr]=nr;const Tn=nr.positionedGlyphs;let Di=0;if(!on.length()){vt+=rt,++fr;continue}const Xr=DD(Fe,on,Kr);let ji=0;for(const Mr of on.text){const Fn=on.getSection(ji),mr=Mr.codePointAt(0),Zn=jD(Ne,ct,mr),Rr={glyph:mr,imageName:null,x:ot,y:vt+-17,vertical:Zn,scale:1,fontStack:"",sectionIndex:on.getSectionIndex(ji),metrics:null,rect:null};let Xa;if("fontStack"in Fn){if(Xa=ND(Fn,mr,Zn,Xr,Ae,$e),!Xa)continue;Rr.fontStack=Fn.fontStack}else{if(me.iconsInText=!0,Fn.scale*=Kr,Xa=LD(Fn,Zn,Wn,Xr,Fe),!Xa)continue;Di=Math.max(Di,Xa.imageOffset),Rr.imageName=Fn.imageName}const{rect:Gs,metrics:wp,baselineOffset:Ho}=Xa;Rr.y+=Ho,Rr.scale=Fn.scale,Rr.metrics=wp,Rr.rect=Gs,Tn.push(Rr),Zn?(me.verticalizable=!0,ot+=("imageName"in Fn?wp.advance:kr)*Fn.scale+ht):ot+=wp.advance*Fn.scale+ht,ji++}Tn.length!==0&&(Qt=Math.max(ot-ht,Qt),zD(Tn,0,Tn.length-1,Nn)),ot=0,nr.lineOffset=Math.max(Di,(Wn-1)*kr);const Cs=rt*Wn+Di;vt+=Cs,Ht=Math.max(Cs,Ht),++fr}const{horizontalAlign:Ln,verticalAlign:An}=bv(Ke);(function(on,Wn,nr,Tn,Di,Xr,ji,Cs,Mr){const Fn=(Wn-nr)*Di;let mr=0;mr=Xr!==ji?-Cs*Tn- -17:-Tn*Mr*ji+.5*ji;for(const Zn of on)for(const Rr of Zn.positionedGlyphs)Rr.x+=Fn,Rr.y+=mr})(me.positionedLines,Nn,Ln,An,Qt,Ht,rt,vt,Ze.length),me.top+=-An*vt,me.bottom=me.top+vt,me.left+=-Ln*Qt,me.right=me.left+Qt}(de,n,s,u,q,_,b,T,D,k,N,V),!function(me){for(const Ae of me)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(ie)&&de}function bv(a){let n=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function DD(a,n,s){const u=n.getMaxScale()*kr,{maxImageWidth:p,maxImageHeight:y}=n.getMaxImageSize(a),_=Math.max(u,y*s);return{verticalLineContentWidth:Math.max(u,p*s),horizontalLineContentHeight:_}}function pS(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function jD(a,n,s){return!(a===f.az.horizontal||!n&&!Gd(s)||n&&(Fm(s)||(u=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(u)))));var u}function ND(a,n,s,u,p,y){const _=y[a.fontStack],b=function(k,I,D,N){if(k&&k.rect)return k;const z=I[D.fontStack],V=z&&z[N];return V?{rect:null,metrics:V.metrics}:null}(_&&_[n],p,a,n);if(b===null)return null;let T;if(s)T=u.verticalLineContentWidth-a.scale*kr;else{const k=pS(a.verticalAlign);T=(u.horizontalLineContentHeight-a.scale*kr)*k}return{rect:b.rect,metrics:b.metrics,baselineOffset:T}}function LD(a,n,s,u,p){const y=p[a.imageName];if(!y)return null;const _=y.paddedRect,b=y.displaySize,T={width:b[0],height:b[1],left:1,top:-3,advance:n?b[1]:b[0]};let k;if(n)k=u.verticalLineContentWidth-b[1]*a.scale;else{const I=pS(a.verticalAlign);k=(u.horizontalLineContentHeight-b[1]*a.scale)*I}return{rect:_,metrics:T,baselineOffset:k,imageOffset:(n?b[0]:b[1])*a.scale-kr*s}}function zD(a,n,s,u){if(u===0)return;const p=a[s],y=(a[s].x+p.metrics.advance*p.scale)*u;for(let _=n;_<=s;_++)a[_].x-=y}function OD(a,n,s){const{horizontalAlign:u,verticalAlign:p}=bv(s),y=n[0]-a.displaySize[0]*u,_=n[1]-a.displaySize[1]*p;return{image:a,top:_,bottom:_+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function fS(a){var n,s;let u=a.left,p=a.top,y=a.right-u,_=a.bottom-p;const b=(n=a.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",T=(s=a.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",k=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(T==="proportional"){if(b==="stretchOnly"&&y/_<k||b==="proportional"){const I=Math.ceil(_*k);u*=I/y,y=I}}else if(b==="proportional"&&T==="stretchOnly"&&k!==0&&y/_>k){const I=Math.ceil(y/k);p*=I/_,_=I}return{x1:u,y1:p,x2:u+y,y2:p+_}}function mS(a,n,s,u,p,y){const _=a.image;let b;if(_.content){const q=_.content,ee=_.pixelRatio||1;b=[q[0]/ee,q[1]/ee,_.displaySize[0]-q[2]/ee,_.displaySize[1]-q[3]/ee]}const T=n.left*y,k=n.right*y;let I,D,N,z;s==="width"||s==="both"?(z=p[0]+T-u[3],D=p[0]+k+u[1]):(z=p[0]+(T+k-_.displaySize[0])/2,D=z+_.displaySize[0]);const V=n.top*y,U=n.bottom*y;return s==="height"||s==="both"?(I=p[1]+V-u[0],N=p[1]+U+u[2]):(I=p[1]+(V+U-_.displaySize[1])/2,N=I+_.displaySize[1]),{image:_,top:I,right:D,bottom:N,left:z,collisionPadding:b}}dt("ImagePosition",xv),dt("ImageAtlas",dS),f.az=void 0,($o=f.az||(f.az={}))[$o.none=0]="none",$o[$o.horizontal=1]="horizontal",$o[$o.vertical=2]="vertical",$o[$o.horizontalOnly=3]="horizontalOnly";const Ha=128,Go=32640;function gS(a,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new pn(a+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=s;let y=0;for(;y<u.length&&u[y]<=a;)y++;y=Math.max(0,y-1);let _=y;for(;_<u.length&&u[_]<a+1;)_++;_=Math.min(u.length-1,_);const b=u[y],T=u[_];return s.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:T,minSize:s.evaluate(new pn(b)),maxSize:s.evaluate(new pn(T)),interpolationType:p}}}function wv(a,n,s){let u="never";const p=a.get(n);return p?u=p:a.get(s)&&(u="always"),u}const FD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ag(a,n,s,u,p,y,_,b,T,k,I,D,N){const z=b?Math.min(Go,Math.round(b[0])):0,V=b?Math.min(Go,Math.round(b[1])):0;a.emplaceBack(n,s,Math.round(32*u),Math.round(32*p),y,_,(z<<1)+(T?1:0),V,16*k,16*I,256*D,256*N)}function Sv(a,n,s){a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s)}function BD(a){for(const n of a.sections)if(Um(n.text))return!0;return!1}class Tv{constructor(n){this.layoutVertexArray=new pe,this.indexArray=new je,this.programConfigurations=n,this.segments=new it,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new Oe,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,s,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,pD.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,fD.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,FD,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}dt("SymbolBuffers",Tv);class Ev{constructor(n,s,u){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new u,this.segments=new it,this.collisionVertexArray=new De}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,mD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}dt("CollisionBuffers",Ev);class Ku{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gS(this.zoom,s["text-size"]),this.iconSizeData=gS(this.zoom,s["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=wv(u,"text-overlap","text-allow-overlap")!=="never"||wv(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(_=>f.az[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID}createArrays(){this.text=new Tv(new Za(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Tv(new Za(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new M,this.lineVertexArray=new j,this.symbolInstances=new A,this.textAnchorOffsets=new O}calculateGlyphDependencies(n,s,u,p,y){for(const _ of n)if(s[_.codePointAt(0)]=!0,(u||p)&&y){const b=mp[_];b&&(s[b.codePointAt(0)]=!0)}}populate(n,s,u){const p=this.layers[0],y=p.layout,_=y.get("text-font"),b=y.get("text-field"),T=y.get("icon-image"),k=(b.value.kind!=="constant"||b.value.value instanceof gi&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,D=y.get("symbol-sort-key");if(this.features=[],!k&&!I)return;const N=s.iconDependencies,z=s.glyphDependencies,V=s.availableImages,U=new pn(this.zoom);for(const{feature:q,id:ee,index:ue,sourceLayerIndex:ne}of n){const ie=p._featureFilter.needGeometry,de=ya(q,ie);if(!p._featureFilter.filter(U,de,u))continue;let me,Ae;if(ie||(de.geometry=ga(q)),k){const Fe=p.getValueAndResolveTokens("text-field",de,u,V),Ze=gi.factory(Fe),rt=this.hasRTLText=this.hasRTLText||BD(Ze);(!rt||pa.getRTLTextPluginStatus()==="unavailable"||rt&&pa.isParsed())&&(me=yD(Ze,p,de))}if(I){const Fe=p.getValueAndResolveTokens("icon-image",de,u,V);Ae=Fe instanceof Ii?Fe:Ii.fromString(Fe)}if(!me&&!Ae)continue;const $e=this.sortFeaturesByKey?D.evaluate(de,{},u):void 0;if(this.features.push({id:ee,text:me,icon:Ae,index:ue,sourceLayerIndex:ne,geometry:de.geometry,properties:q.properties,type:dp.types[q.type],sortKey:$e}),Ae&&(N[Ae.name]=!0),me){const Fe=_.evaluate(de,{},u).join(","),Ze=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.az.vertical)>=0;for(const rt of me.sections)if(rt.image)N[rt.image.name]=!0;else{const Ke=Vo(me.toString()),Ve=rt.fontStack||Fe,Ne=z[Ve]=z[Ve]||{};this.calculateGlyphDependencies(rt.text,Ne,Ze,this.allowVerticalPlacement,Ke)}}}y.get("symbol-placement")==="line"&&(this.features=function(q){const ee={},ue={},ne=[];let ie=0;function de(Fe){ne.push(q[Fe]),ie++}function me(Fe,Ze,rt){const Ke=ue[Fe];return delete ue[Fe],ue[Ze]=Ke,ne[Ke].geometry[0].pop(),ne[Ke].geometry[0]=ne[Ke].geometry[0].concat(rt[0]),Ke}function Ae(Fe,Ze,rt){const Ke=ee[Ze];return delete ee[Ze],ee[Fe]=Ke,ne[Ke].geometry[0].shift(),ne[Ke].geometry[0]=rt[0].concat(ne[Ke].geometry[0]),Ke}function $e(Fe,Ze,rt){const Ke=rt?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Fe}:${Ke.x}:${Ke.y}`}for(let Fe=0;Fe<q.length;Fe++){const Ze=q[Fe],rt=Ze.geometry,Ke=Ze.text?Ze.text.toString():null;if(!Ke){de(Fe);continue}const Ve=$e(Ke,rt),Ne=$e(Ke,rt,!0);if(Ve in ue&&Ne in ee&&ue[Ve]!==ee[Ne]){const ht=Ae(Ve,Ne,rt),ct=me(Ve,Ne,ne[ht].geometry);delete ee[Ve],delete ue[Ne],ue[$e(Ke,ne[ct].geometry,!0)]=ct,ne[ht].geometry=null}else Ve in ue?me(Ve,Ne,rt):Ne in ee?Ae(Ve,Ne,rt):(de(Fe),ee[Ve]=ie-1,ue[Ne]=ie-1)}return ne.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,ee)=>q.sortKey-ee.sortKey)}update(n,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,{imagePositions:u}),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,{imagePositions:u}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const u=this.lineVertexArray.length;if(n.segment!==void 0){let p=n.dist(s[n.segment+1]),y=n.dist(s[n.segment]);const _={};for(let b=n.segment+1;b<s.length;b++)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:p},b<s.length-1&&(p+=s[b+1].dist(s[b]));for(let b=n.segment||0;b>=0;b--)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:y},b>0&&(y+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const T=_[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,s,u,p,y,_,b,T,k,I,D,N){const z=n.indexArray,V=n.layoutVertexArray,U=n.segments.prepareSegment(4*s.length,V,z,this.canOverlap?_.sortKey:void 0),q=this.glyphOffsetArray.length,ee=U.vertexLength,ue=this.allowVerticalPlacement&&b===f.az.vertical?Math.PI/2:0,ne=_.text&&_.text.sections;for(let ie=0;ie<s.length;ie++){const{tl:de,tr:me,bl:Ae,br:$e,tex:Fe,pixelOffsetTL:Ze,pixelOffsetBR:rt,minFontScaleX:Ke,minFontScaleY:Ve,glyphOffset:Ne,isSDF:ht,sectionIndex:ct}=s[ie],pt=U.vertexLength,ot=Ne[1];ag(V,T.x,T.y,de.x,ot+de.y,Fe.x,Fe.y,u,ht,Ze.x,Ze.y,Ke,Ve),ag(V,T.x,T.y,me.x,ot+me.y,Fe.x+Fe.w,Fe.y,u,ht,rt.x,Ze.y,Ke,Ve),ag(V,T.x,T.y,Ae.x,ot+Ae.y,Fe.x,Fe.y+Fe.h,u,ht,Ze.x,rt.y,Ke,Ve),ag(V,T.x,T.y,$e.x,ot+$e.y,Fe.x+Fe.w,Fe.y+Fe.h,u,ht,rt.x,rt.y,Ke,Ve),Sv(n.dynamicLayoutVertexArray,T,ue),z.emplaceBack(pt,pt+2,pt+1),z.emplaceBack(pt+1,pt+2,pt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),ie!==s.length-1&&ct===s[ie+1].sectionIndex||n.programConfigurations.populatePaintArrays(V.length,_,_.index,{imagePositions:{},canonical:N,formattedSection:ne&&ne[ct]})}n.placedSymbolArray.emplaceBack(T.x,T.y,q,this.glyphOffsetArray.length-q,ee,k,I,T.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],b,0,!1,0,D)}_addCollisionDebugVertex(n,s,u,p,y,_){return s.emplaceBack(0,0),n.emplaceBack(u.x,u.y,p,y,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(n,s,u,p,y,_,b){const T=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=T.vertexLength,I=y.layoutVertexArray,D=y.collisionVertexArray,N=b.anchorX,z=b.anchorY;this._addCollisionDebugVertex(I,D,_,N,z,new E(n,s)),this._addCollisionDebugVertex(I,D,_,N,z,new E(u,s)),this._addCollisionDebugVertex(I,D,_,N,z,new E(u,p)),this._addCollisionDebugVertex(I,D,_,N,z,new E(n,p)),T.vertexLength+=4;const V=y.indexArray;V.emplaceBack(k,k+1),V.emplaceBack(k+1,k+2),V.emplaceBack(k+2,k+3),V.emplaceBack(k+3,k),T.primitiveLength+=4}addDebugCollisionBoxes(n,s,u,p){for(let y=n;y<s;y++){const _=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,p?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ev(Me,rS.members,et),this.iconCollisionBox=new Ev(Me,rS.members,et);for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(n,s,u,p,y,_,b,T,k){const I={};for(let D=s;D<u;D++){const N=n.get(D);I.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},I.textFeatureIndex=N.featureIndex;break}for(let D=p;D<y;D++){const N=n.get(D);I.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},I.verticalTextFeatureIndex=N.featureIndex;break}for(let D=_;D<b;D++){const N=n.get(D);I.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},I.iconFeatureIndex=N.featureIndex;break}for(let D=T;D<k;D++){const N=n.get(D);I.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},I.verticalIconFeatureIndex=N.featureIndex;break}return I}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,s){const u=n.placedSymbolArray.get(s),p=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<p;y+=4)n.indexArray.emplaceBack(y,y+2,y+1),n.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),u=Math.cos(n),p=[],y=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const T=this.symbolInstances.get(b);p.push(0|Math.round(s*T.anchorX+u*T.anchorY)),y.push(T.featureIndex)}return _.sort((b,T)=>p[b]-p[T]||y[T]-y[b]),_}addToSortKeyRanges(n,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,y,_)=>{p>=0&&_.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yS,_S;dt("SymbolBucket",Ku,{omit:["layers","collisionBoxArray","features","compareText"]}),Ku.MAX_GLYPHS=65535,Ku.addDynamicAttributes=Sv;var Pv={get paint(){return _S=_S||new oi({"icon-opacity":new St(Re.paint_symbol["icon-opacity"]),"icon-color":new St(Re.paint_symbol["icon-color"]),"icon-halo-color":new St(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new St(Re.paint_symbol["text-opacity"]),"text-color":new St(Re.paint_symbol["text-color"],{runtimeType:Ai,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new St(Re.paint_symbol["text-halo-color"]),"text-halo-width":new St(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Re.paint_symbol["text-halo-blur"]),"text-translate":new _t(Re.paint_symbol["text-translate"]),"text-translate-anchor":new _t(Re.paint_symbol["text-translate-anchor"])})},get layout(){return yS=yS||new oi({"symbol-placement":new _t(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(Re.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(Re.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Re.layout_symbol["icon-size"]),"icon-text-fit":new _t(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Re.layout_symbol["icon-image"]),"icon-rotate":new St(Re.layout_symbol["icon-rotate"]),"icon-padding":new St(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Re.layout_symbol["icon-offset"]),"icon-anchor":new St(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(Re.layout_symbol["text-rotation-alignment"]),"text-field":new St(Re.layout_symbol["text-field"]),"text-font":new St(Re.layout_symbol["text-font"]),"text-size":new St(Re.layout_symbol["text-size"]),"text-max-width":new St(Re.layout_symbol["text-max-width"]),"text-line-height":new _t(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Re.layout_symbol["text-letter-spacing"]),"text-justify":new St(Re.layout_symbol["text-justify"]),"text-radial-offset":new St(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(Re.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new St(Re.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new St(Re.layout_symbol["text-anchor"]),"text-max-angle":new _t(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(Re.layout_symbol["text-writing-mode"]),"text-rotate":new St(Re.layout_symbol["text-rotate"]),"text-padding":new _t(Re.layout_symbol["text-padding"]),"text-keep-upright":new _t(Re.layout_symbol["text-keep-upright"]),"text-transform":new St(Re.layout_symbol["text-transform"]),"text-offset":new St(Re.layout_symbol["text-offset"]),"text-allow-overlap":new _t(Re.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(Re.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(Re.layout_symbol["text-ignore-placement"]),"text-optional":new _t(Re.layout_symbol["text-optional"])})}};class vS{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Bi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dt("FormatSectionOverride",vS,{omit:["defaultValue"]});class og extends Gi{constructor(n,s){super(n,Pv,s)}recalculate(n,s){if(super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const y of u)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,s,u,p){const y=this.layout.get(n).evaluate(s,{},u,p),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Lo(_.value)||!y?y:function(b,T){return T.replace(/{([^{}]+)}/g,(k,I)=>b&&I in b?String(b[I]):"")}(s.properties,y)}createBucket(n){return new Ku(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Pv.paint.overridableProperties){if(!og.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),u=new vS(s),p=new Rd(u,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new xu("source",p):new Dd("composite",p,s.value.zoomStops),this.paint._values[n]=new ss(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&og.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const u=n.get("text-field"),p=Pv.paint.properties[s];let y=!1;const _=b=>{for(const T of b)if(p.overrides&&p.overrides.hasOverride(T))return void(y=!0)};if(u.value.kind==="constant"&&u.value.value instanceof gi)_(u.value.value.sections);else if(u.value.kind==="source"||u.value.kind==="composite"){const b=k=>{y||(k instanceof Ss&&Jn(k.value)===kl?_(k.value.sections):k instanceof Ol?_(k.sections):k.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return y}}let xS;var VD={get paint(){return xS=xS||new oi({"background-color":new _t(Re.paint_background["background-color"]),"background-pattern":new Ru(Re.paint_background["background-pattern"]),"background-opacity":new _t(Re.paint_background["background-opacity"])})}};class UD extends Gi{constructor(n,s){super(n,VD,s)}}class $D extends Gi{constructor(n,s){super(n,{},s),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class GD{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qD={once:!0},Cv=63710088e-1;class qo{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qo(Yn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,u=this.lat*s,p=n.lat*s,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((n.lng-this.lng)*s);return Cv*Math.acos(Math.min(y,1))}static convert(n){if(n instanceof qo)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new qo(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new qo(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const bS=2*Math.PI*Cv;function wS(a){return bS*Math.cos(a*Math.PI/180)}function SS(a){return(180+a)/360}function TS(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ES(a,n){return a/wS(n)}function PS(a){return 360*a-180}function lg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function CS(a,n){return a*wS(lg(n))}class gp{constructor(n,s,u=0){this.x=+n,this.y=+s,this.z=+u}static fromLngLat(n,s=0){const u=qo.convert(n);return new gp(SS(u.lng),TS(u.lat),ES(s,u.lat))}toLngLat(){return new qo(PS(this.x),lg(this.y))}toAltitude(){return CS(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/bS*(n=lg(this.y),1/Math.cos(n*Math.PI/180));var n}}function kS(a,n,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,n*u-2*Math.PI*6378137/2]}class kv{constructor(n,s,u){if(!function(p,y,_){return!(p<0||p>25||_<0||_>=Math.pow(2,p)||y<0||y>=Math.pow(2,p))}(n,s,u))throw new Error(`x=${s}, y=${u}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=s,this.y=u,this.key=Xu(0,n,n,s,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s,u){const p=function(_,b,T){var k=kS(256*_,256*(b=Math.pow(2,T)-b-1),T),I=kS(256*(_+1),256*(b+1),T);return k[0]+","+k[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),y=function(_,b,T){let k,I="";for(let D=_;D>0;D--)k=1<<D-1,I+=(b&k?1:0)+(T&k?2:0);return I}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,y).replace(/{bbox-epsg-3857}/g,p)}isChildOf(n){const s=this.z-n.z;return s>0&&n.x===this.x>>s&&n.y===this.y>>s}getTilePoint(n){const s=Math.pow(2,this.z);return new E((n.x*s-this.x)*Pe,(n.y*s-this.y)*Pe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class AS{constructor(n,s){this.wrap=n,this.canonical=s,this.key=Xu(n,s.z,s.z,s.x,s.y)}}class ls{constructor(n,s,u,p,y){if(this.terrainRttPosMatrix32f=null,n<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${u}`);this.overscaledZ=n,this.wrap=s,this.canonical=new kv(u,+p,+y),this.key=Xu(s,n,u,p,y)}clone(){return new ls(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-n;return n>this.canonical.z?new ls(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(n,s){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-n;return n>this.canonical.z?Xu(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y):Xu(this.wrap*+s,n,n,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(n){if(n.wrap!==this.wrap||this.overscaledZ-n.overscaledZ<=0)return!1;if(n.overscaledZ===0)return this.overscaledZ>0;const s=this.canonical.z-n.canonical.z;return!(s<0)&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new ls(s,this.wrap,s,u,p),new ls(s,this.wrap,s,u+1,p),new ls(s,this.wrap,s,u,p+1),new ls(s,this.wrap,s,u+1,p+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ls(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new AS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new gp(n.x-this.wrap,n.y))}}function Xu(a,n,s,u,p){(a*=2)<0&&(a=-1*a-1);const y=1<<s;return(y*y*a+y*p+u).toString(36)+s.toString(36)+n.toString(36)}function Av(a,n){return n?a.properties[n]:a.id}function WD(a,n){const s={id:a.id};if(n.removeAllProperties&&(delete a.removeProperties,delete a.addOrUpdateProperties,delete n.removeProperties),n.removeProperties)for(const u of n.removeProperties){const p=a.addOrUpdateProperties.findIndex(y=>y.key===u);p>-1&&a.addOrUpdateProperties.splice(p,1)}return(a.removeAllProperties||n.removeAllProperties)&&(s.removeAllProperties=!0),(a.removeProperties||n.removeProperties)&&(s.removeProperties=[...a.removeProperties||[],...n.removeProperties||[]]),(a.addOrUpdateProperties||n.addOrUpdateProperties)&&(s.addOrUpdateProperties=[...a.addOrUpdateProperties||[],...n.addOrUpdateProperties||[]]),(a.newGeometry||n.newGeometry)&&(s.newGeometry=n.newGeometry||a.newGeometry),s}function IS(a){var n,s;if(!a)return{};const u={};return u.removeAll=a.removeAll,u.remove=new Set(a.remove||[]),u.add=new Map((n=a.add)===null||n===void 0?void 0:n.map(p=>[p.id,p])),u.update=new Map((s=a.update)===null||s===void 0?void 0:s.map(p=>[p.id,p])),u}dt("CanonicalTileID",kv),dt("OverscaledTileID",ls,{omit:["terrainRttPosMatrix32f"]});class mc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(n){return this.minX=Math.min(this.minX,n.x),this.minY=Math.min(this.minY,n.y),this.maxX=Math.max(this.maxX,n.x),this.maxY=Math.max(this.maxY,n.y),this}expandBy(n){return this.minX-=n,this.minY-=n,this.maxX+=n,this.maxY+=n,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(n){return this.expandBy(-n)}map(n){const s=new mc;return s.extend(n(new E(this.minX,this.minY))),s.extend(n(new E(this.maxX,this.minY))),s.extend(n(new E(this.minX,this.maxY))),s.extend(n(new E(this.maxX,this.maxY))),s}static fromPoints(n){const s=new mc;for(const u of n)s.extend(u);return s}contains(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(n){return!this.empty()&&!n.empty()&&n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY}intersects(n){return!this.empty()&&!n.empty()&&n.minX<=this.maxX&&n.maxX>=this.minX&&n.minY<=this.maxY&&n.maxY>=this.minY}}class MS{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const u=n[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class RS{constructor(n,s,u,p,y){this.type="Feature",this._vectorTileFeature=n,this._x=u,this._y=p,this._z=s,this.properties=n.properties,this.id=y}projectPoint(n,s,u,p){return[360*(n.x+s)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(n.y+u)/p)*Math.PI))-90]}projectLine(n,s,u,p){return n.map(y=>this.projectPoint(y,s,u,p))}get geometry(){if(this._geometry)return this._geometry;const n=this._vectorTileFeature,s=n.extent*Math.pow(2,this._z),u=n.extent*this._x,p=n.extent*this._y,y=n.loadGeometry();switch(n.type){case 1:{const _=[];for(const T of y)_.push(T[0]);const b=this.projectLine(_,u,p,s);this._geometry=_.length===1?{type:"Point",coordinates:b[0]}:{type:"MultiPoint",coordinates:b};break}case 2:{const _=y.map(b=>this.projectLine(b,u,p,s));this._geometry=_.length===1?{type:"LineString",coordinates:_[0]}:{type:"MultiLineString",coordinates:_};break}case 3:{const _=Z1(y),b=[];for(const T of _)b.push(T.map(k=>this.projectLine(k,u,p,s)));this._geometry=b.length===1?{type:"Polygon",coordinates:b[0]}:{type:"MultiPolygon",coordinates:b};break}default:throw new Error(`unknown feature type: ${n.type}`)}return this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&s!=="_x"&&s!=="_y"&&s!=="_z"&&(n[s]=this[s]);return n}}class Yu{constructor(n,s,u){Ot(this,"_name");Ot(this,"dataBuffer");Ot(this,"nullabilityBuffer");Ot(this,"_size");this._name=n,this.dataBuffer=s,typeof u=="number"?this._size=u:(this.nullabilityBuffer=u,this._size=u.size())}getValue(n){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(n)?null:this.getValueFromBuffer(n)}has(n){return this.nullabilityBuffer&&this.nullabilityBuffer.get(n)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class cg extends Yu{}class Iv extends cg{getValueFromBuffer(n){return this.dataBuffer[n]}}class Mv extends cg{getValueFromBuffer(n){return this.dataBuffer[n]}}class DS extends Yu{constructor(s,u,p,y){super(s,u,y);Ot(this,"delta");this.delta=p}}class Rv extends DS{constructor(n,s,u,p){super(n,Int32Array.of(s),u,p)}getValueFromBuffer(n){return this.dataBuffer[0]+n*this.delta}}class Dv extends Yu{constructor(n,s,u){super(n,Int32Array.of(s),u)}getValueFromBuffer(n){return this.dataBuffer[0]}}class ZD{constructor(n,s,u,p,y=4096){Ot(this,"_name");Ot(this,"_geometryVector");Ot(this,"_idVector");Ot(this,"_propertyVectors");Ot(this,"_extent");Ot(this,"propertyVectorsMap");this._name=n,this._geometryVector=s,this._idVector=u,this._propertyVectors=p,this._extent=y}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(n){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(s=>[s.name,s]))),this.propertyVectorsMap.get(n)}*[Symbol.iterator](){const n=this.geometryVector[Symbol.iterator]();let s=0;for(;s<this.numFeatures;){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(s)):this.idVector.getValue(s));const p=n==null?void 0:n.next().value,y={};for(const _ of this.propertyVectors){if(!_)continue;const b=_.name,T=_.getValue(s);T!==null&&(y[b]=T)}s++,yield{id:u,geometry:p,properties:y}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const n=[],s=this.geometryVector.getGeometries();for(let u=0;u<this.numFeatures;u++){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(u)):this.idVector.getValue(u));const y={coordinates:s[u],type:this.geometryVector.geometryType(u)},_={};for(const b of this.propertyVectors){if(!b)continue;const T=b.name,k=b.getValue(u);k!==null&&(_[T]=k)}n.push({id:p,geometry:y,properties:_})}return n}containsMaxSaveIntegerValues(n){return n instanceof Iv||n instanceof Dv&&n instanceof Rv||n instanceof Mv}}class HD{constructor(n){Ot(this,"value");this.value=n}get(){return this.value}set(n){this.value=n}increment(){return this.value++}add(n){this.value+=n}}var Kt,Ka,Zr,Us,gc,Wi,Ar,Ir,jS,cs;function Br(a,n,s){const u=new Int32Array(s);let p=0,y=n.get();for(let _=0;_<u.length;_++){let b=a[y++],T=127&b;b<128||(b=a[y++],T|=(127&b)<<7,b<128||(b=a[y++],T|=(127&b)<<14,b<128||(b=a[y++],T|=(127&b)<<21,b<128||(b=a[y++],T|=(15&b)<<28)))),u[p++]=T}return n.set(y),u}function ug(a,n,s){const u=new BigInt64Array(s);for(let p=0;p<u.length;p++)u[p]=XD(a,n);return u}function KD(a,n){let s,u;return u=a[n.get()],n.increment(),s=127&u,u<128?s:(u=a[n.get()],n.increment(),s|=(127&u)<<7,u<128?s:(u=a[n.get()],n.increment(),s|=(127&u)<<14,u<128?s:(u=a[n.get()],n.increment(),s|=(127&u)<<21,u<128?s:(u=a[n.get()],s|=(15&u)<<28,function(p,y,_){let b,T;if(T=y[_.get()],_.increment(),b=(112&T)>>4,T<128||(T=y[_.get()],_.increment(),b|=(127&T)<<3,T<128)||(T=y[_.get()],_.increment(),b|=(127&T)<<10,T<128)||(T=y[_.get()],_.increment(),b|=(127&T)<<17,T<128)||(T=y[_.get()],_.increment(),b|=(127&T)<<24,T<128)||(T=y[_.get()],_.increment(),b|=(1&T)<<31,T<128))return 4294967296*b+(p>>>0);throw new Error("Expected varint not more than 10 bytes")}(s,a,n)))))}function NS(a,n,s,u){throw new Error("FastPFor is not implemented yet.")}function yc(a){return a>>>1^-(1&a)}function Ju(a){return a>>1n^-(1n&a)}function XD(a,n){let s=0n,u=0,p=n.get();for(;p<a.length;){const y=a[p++];if(s|=BigInt(127&y)<<BigInt(u),!(128&y))break;if(u+=7,u>=64)throw new Error("Varint too long")}return n.set(p),s}function LS(a,n,s){const u=new Int32Array(s);let p=0;for(let y=0;y<n;y++){const _=a[y];u.fill(a[y+n],p,p+_),p+=_}return u}function zS(a,n,s){const u=new BigInt64Array(s);let p=0;for(let y=0;y<n;y++){const _=Number(a[y]);u.fill(a[y+n],p,p+_),p+=_}return u}function OS(a,n,s){const u=new Float64Array(s);let p=0;for(let y=0;y<n;y++){const _=a[y];u.fill(a[y+n],p,p+_),p+=_}return u}function jv(a){const n=a.length/4*4;let s=1;if(n>=4)for(let u=a[0];s<n-4;s+=4)u=a[s]+=u,u=a[s+1]+=u,u=a[s+2]+=u,u=a[s+3]+=u;for(;s!=a.length;)a[s]+=a[s-1],++s}function FS(a){a[0]=a[0]>>>1^-(1&a[0]),a[1]=a[1]>>>1^-(1&a[1]);const n=a.length/4*4;let s=2;if(n>=4)for(;s<n-4;s+=4){const u=a[s],p=a[s+1],y=a[s+2],_=a[s+3];a[s]=(u>>>1^-(1&u))+a[s-2],a[s+1]=(p>>>1^-(1&p))+a[s-1],a[s+2]=(y>>>1^-(1&y))+a[s],a[s+3]=(_>>>1^-(1&_))+a[s+1]}for(;s!=a.length;s+=2)a[s]=(a[s]>>>1^-(1&a[s]))+a[s-2],a[s+1]=(a[s+1]>>>1^-(1&a[s+1]))+a[s-1]}(function(a){a.NONE="NONE",a.DELTA="DELTA",a.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",a.RLE="RLE",a.MORTON="MORTON",a.PDE="PDE"})(Kt||(Kt={})),function(a){a.NONE="NONE",a.FAST_PFOR="FAST_PFOR",a.VARINT="VARINT",a.ALP="ALP"}(Ka||(Ka={})),function(a){a.PRESENT="PRESENT",a.DATA="DATA",a.OFFSET="OFFSET",a.LENGTH="LENGTH"}(Zr||(Zr={}));class Nv{constructor(n,s,u){Ot(this,"_dictionaryType");Ot(this,"_offsetType");Ot(this,"_lengthType");this._dictionaryType=n,this._offsetType=s,this._lengthType=u}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function vi(a,n){const s=function(u,p){const y=u[p.get()],_=Object.values(Zr)[y>>4];let b=null;switch(_){case Zr.DATA:b=new Nv(Object.values(Us)[15&y]);break;case Zr.OFFSET:b=new Nv(null,Object.values(gc)[15&y]);break;case Zr.LENGTH:b=new Nv(null,null,Object.values(Wi)[15&y])}p.increment();const T=u[p.get()],k=Object.values(Kt)[T>>5],I=Object.values(Kt)[T>>2&7],D=Object.values(Ka)[3&T];p.increment();const N=Br(u,p,2),z=N[0];return{physicalStreamType:_,logicalStreamType:b,logicalLevelTechnique1:k,logicalLevelTechnique2:I,physicalLevelTechnique:D,numValues:z,byteLength:N[1],decompressedCount:z}}(a,n);return s.logicalLevelTechnique1===Kt.MORTON?function(u,p,y){const _=Br(p,y,2);return{physicalStreamType:u.physicalStreamType,logicalStreamType:u.logicalStreamType,logicalLevelTechnique1:u.logicalLevelTechnique1,logicalLevelTechnique2:u.logicalLevelTechnique2,physicalLevelTechnique:u.physicalLevelTechnique,numValues:u.numValues,byteLength:u.byteLength,decompressedCount:u.decompressedCount,numBits:_[0],coordinateShift:_[1]}}(s,a,n):Kt.RLE!==s.logicalLevelTechnique1&&Kt.RLE!==s.logicalLevelTechnique2||Ka.NONE===s.physicalLevelTechnique?s:function(u,p,y){const _=Br(p,y,2);return{physicalStreamType:u.physicalStreamType,logicalStreamType:u.logicalStreamType,logicalLevelTechnique1:u.logicalLevelTechnique1,logicalLevelTechnique2:u.logicalLevelTechnique2,physicalLevelTechnique:u.physicalLevelTechnique,numValues:u.numValues,byteLength:u.byteLength,decompressedCount:_[1],runs:_[0],numRleValues:_[1]}}(s,a,n)}(function(a){a.NONE="NONE",a.SINGLE="SINGLE",a.SHARED="SHARED",a.VERTEX="VERTEX",a.MORTON="MORTON",a.FSST="FSST"})(Us||(Us={})),function(a){a.VERTEX="VERTEX",a.INDEX="INDEX",a.STRING="STRING",a.KEY="KEY"}(gc||(gc={})),function(a){a.VAR_BINARY="VAR_BINARY",a.GEOMETRIES="GEOMETRIES",a.PARTS="PARTS",a.RINGS="RINGS",a.TRIANGLES="TRIANGLES",a.SYMBOL="SYMBOL",a.DICTIONARY="DICTIONARY"}(Wi||(Wi={})),function(a){a[a.FLAT=0]="FLAT",a[a.CONST=1]="CONST",a[a.SEQUENCE=2]="SEQUENCE",a[a.DICTIONARY=3]="DICTIONARY",a[a.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(Ar||(Ar={}));class $s{constructor(n,s){Ot(this,"values");Ot(this,"_size");this.values=n,this._size=s}get(n){const s=Math.floor(n/8);return(this.values[s]>>n%8&1)==1}set(n,s){const u=Math.floor(n/8);this.values[u]=this.values[u]|(s?1:0)<<n%8}getInt(n){const s=Math.floor(n/8);return this.values[s]>>n%8&1}size(){return this._size}getBuffer(){return this.values}}function xi(a,n,s,u,p){return function(y,_,b){switch(_.logicalLevelTechnique1){case Kt.DELTA:return _.logicalLevelTechnique2===Kt.RLE?function(T,k,I){const D=new Int32Array(I);let N=0,z=0;for(let V=0;V<k;V++){const U=T[V],q=yc(T[V+k]);for(let ee=0;ee<U;ee++)z+=q,D[N++]=z}return D}(y,_.runs,_.numRleValues):(function(T){T[0]=T[0]>>>1^-(1&T[0]);const k=T.length/4*4;let I=1;if(k>=4)for(;I<k-4;I+=4){const D=T[I],N=T[I+1],z=T[I+2],V=T[I+3];T[I]=(D>>>1^-(1&D))+T[I-1],T[I+1]=(N>>>1^-(1&N))+T[I],T[I+2]=(z>>>1^-(1&z))+T[I+1],T[I+3]=(V>>>1^-(1&V))+T[I+2]}for(;I!=T.length;++I)T[I]=(T[I]>>>1^-(1&T[I]))+T[I-1]}(y),y);case Kt.RLE:return function(T,k,I){return I?function(D,N,z){const V=new Int32Array(z);let U=0;for(let q=0;q<N;q++){const ee=D[q];let ue=D[q+N];ue=ue>>>1^-(1&ue),V.fill(ue,U,U+ee),U+=ee}return V}(T,k.runs,k.numRleValues):LS(T,k.runs,k.numRleValues)}(y,_,b);case Kt.MORTON:return jv(y),y;case Kt.COMPONENTWISE_DELTA:return FS(y),y;case Kt.NONE:return b&&function(T){for(let k=0;k<T.length;k++){const I=T[k];T[k]=I>>>1^-(1&I)}}(y),y;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}}(hg(a,n,s),s,u)}function Wo(a,n,s){return function(u,p){if(p.logicalLevelTechnique1===Kt.DELTA&&p.logicalLevelTechnique2===Kt.NONE)return function(_){const b=new Int32Array(_.length+1);b[0]=0,b[1]=yc(_[0]);let T=b[1],k=2;for(;k!=b.length;++k){const I=_[k-1];T+=I>>>1^-(1&I),b[k]=b[k-1]+T}return b}(u);if(p.logicalLevelTechnique1===Kt.RLE&&p.logicalLevelTechnique2===Kt.NONE)return function(_,b,T){const k=new Int32Array(T+1);k[0]=0;let I=1,D=k[0];for(let N=0;N<b;N++){const z=_[N],V=_[N+b];for(let U=I;U<I+z;U++)k[U]=V+D,D=k[U];I+=z}return k}(u,p.runs,p.numRleValues);if(p.logicalLevelTechnique1===Kt.NONE&&p.logicalLevelTechnique2===Kt.NONE){(function(_){let b=0;for(let T=0;T<_.length;T++)_[T]+=b,b=_[T]})(u);const y=new Int32Array(p.numValues+1);return y[0]=0,y.set(u,1),y}if(p.logicalLevelTechnique1===Kt.DELTA&&p.logicalLevelTechnique2===Kt.RLE){const y=function(_,b,T){const k=new Int32Array(T+1);k[0]=0;let I=1,D=k[0];for(let N=0;N<b;N++){const z=_[N];let V=_[N+b];V=V>>>1^-(1&V);for(let U=I;U<I+z;U++)k[U]=V+D,D=k[U];I+=z}return k}(u,p.runs,p.numRleValues);return jv(y),y}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}(hg(a,n,s),s)}function hg(a,n,s){const u=s.physicalLevelTechnique;if(u===Ka.FAST_PFOR)return NS();if(u===Ka.VARINT)return Br(a,n,s.numValues);if(u===Ka.NONE){const p=n.get();n.add(s.byteLength);const y=a.subarray(p,n.get());return new Int32Array(y)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Lv(a,n,s,u){const p=hg(a,n,s);if(p.length===1){const y=p[0];return u?yc(y):y}return u?function(y){return yc(y[1])}(p):function(y){return y[1]}(p)}function BS(a,n,s){return function(u){if(u.length==2){const p=yc(u[1]);return[p,p]}return[yc(u[2]),yc(u[3])]}(hg(a,n,s))}function VS(a,n,s){return function(u){if(u.length==2){const p=Ju(u[1]);return[p,p]}return[Ju(u[2]),Ju(u[3])]}(ug(a,n,s.numValues))}function US(a,n,s,u){return function(p,y,_){switch(y.logicalLevelTechnique1){case Kt.DELTA:return y.logicalLevelTechnique2===Kt.RLE?function(b,T,k){const I=new BigInt64Array(k);let D=0,N=0n;for(let z=0;z<T;z++){const V=Number(b[z]),U=Ju(b[z+T]);for(let q=0;q<V;q++)N+=U,I[D++]=N}return I}(p,y.runs,y.numRleValues):(function(b){b[0]=b[0]>>1n^-(1n&b[0]);const T=b.length/4*4;let k=1;if(T>=4)for(;k<T-4;k+=4){const I=b[k],D=b[k+1],N=b[k+2],z=b[k+3];b[k]=(I>>1n^-(1n&I))+b[k-1],b[k+1]=(D>>1n^-(1n&D))+b[k],b[k+2]=(N>>1n^-(1n&N))+b[k+1],b[k+3]=(z>>1n^-(1n&z))+b[k+2]}for(;k!=b.length;++k)b[k]=(b[k]>>1n^-(1n&b[k]))+b[k-1]}(p),p);case Kt.RLE:return function(b,T,k){return k?function(I,D,N){const z=new BigInt64Array(N);let V=0;for(let U=0;U<D;U++){const q=Number(I[U]);let ee=I[U+D];ee=ee>>1n^-(1n&ee),z.fill(ee,V,V+q),V+=q}return z}(b,T.runs,T.numRleValues):zS(b,T.runs,T.numRleValues)}(p,y,_);case Kt.NONE:return _&&function(b){for(let T=0;T<b.length;T++){const k=b[T];b[T]=k>>1n^-(1n&k)}}(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}}(ug(a,n,s.numValues),s,u)}function $S(a,n,s,u){const p=ug(a,n,s.numValues);if(p.length===1){const y=p[0];return u?Ju(y):y}return u?function(y){return Ju(y[1])}(p):function(y){return y[1]}(p)}function zv(a,n,s,u,p){return function(y,_,b,T){switch(_.logicalLevelTechnique1){case Kt.DELTA:return _.logicalLevelTechnique2===Kt.RLE&&(y=LS(y,_.runs,_.numRleValues)),function(k,I){const D=new Int32Array(k.size());let N=0;k.get(0)?(D[0]=k.get(0)?I[0]>>>1^-(1&I[0]):0,N=1):D[0]=0;let z=1;for(;z!=D.length;++z)D[z]=k.get(z)?D[z-1]+(I[N]>>>1^-(1&I[N++])):D[z-1];return D}(T,y);case Kt.RLE:return function(k,I,D,N){const z=I;return D?function(V,U,q){const ee=new Int32Array(V.size());let ue=0;for(let ne=0;ne<q;ne++){const ie=U[ne];let de=U[ne+q];de=de>>>1^-(1&de);for(let me=ue;me<ue+ie;me++)V.get(me)?ee[me]=de:(ee[me]=0,ue++);ue+=ie}return ee}(N,k,z.runs):function(V,U,q){const ee=new Int32Array(V.size());let ue=0;for(let ne=0;ne<q;ne++){const ie=U[ne],de=U[ne+q];for(let me=ue;me<ue+ie;me++)V.get(me)?ee[me]=de:(ee[me]=0,ue++);ue+=ie}return ee}(N,k,z.runs)}(y,_,b,T);case Kt.MORTON:return jv(y),y;case Kt.COMPONENTWISE_DELTA:return FS(y),y;case Kt.NONE:return y=b?function(k,I){const D=new Int32Array(k.size());let N=0,z=0;for(;z!=D.length;++z)if(k.get(z)){const V=I[N++];D[z]=V>>>1^-(1&V)}else D[z]=0;return D}(T,y):function(k,I){const D=new Int32Array(k.size());let N=0,z=0;for(;z!=D.length;++z)D[z]=k.get(z)?I[N++]:0;return D}(T,y),y;default:throw new Error("The specified Logical level technique is not supported")}}(s.physicalLevelTechnique===Ka.FAST_PFOR?NS():Br(a,n,s.numValues),s,u,p)}function dg(a,n,s,u){const p=a.logicalLevelTechnique1;if(p===Kt.RLE)return a.runs===1?Ar.CONST:Ar.FLAT;const y=n instanceof $s?n.size():n;if(p===Kt.DELTA&&a.logicalLevelTechnique2===Kt.RLE){const _=a.runs,b=2;if(a.numRleValues!==y)return Ar.FLAT;if(_===1)return Ar.SEQUENCE;if(_===2){const T=u.get();let k;if(a.physicalLevelTechnique===Ka.VARINT)k=Br(s,u,4);else{const I=u.get();k=new Int32Array(s.buffer,s.byteOffset+I,4)}if(u.set(T),k[2]===b&&k[3]===b)return Ar.SEQUENCE}}return a.numValues===1?Ar.CONST:Ar.FLAT}class GS extends cg{getValueFromBuffer(n){return this.dataBuffer[n]}}class qS extends DS{constructor(n,s,u,p){super(n,BigInt64Array.of(s),u,p)}getValueFromBuffer(n){return this.dataBuffer[0]+BigInt(n)*this.delta}}class Qu{constructor(n,s,u){Ot(this,"_geometryOffsets");Ot(this,"_partOffsets");Ot(this,"_ringOffsets");this._geometryOffsets=n,this._partOffsets=s,this._ringOffsets=u}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Ov(a,n,s){return{x:WS(a,n)-s,y:WS(a>>1,n)-s}}function WS(a,n){let s=0;for(let u=0;u<n;u++)s|=(a&1<<2*u)>>u;return s}(function(a){a[a.POINT=0]="POINT",a[a.LINESTRING=1]="LINESTRING",a[a.POLYGON=2]="POLYGON",a[a.MULTIPOINT=3]="MULTIPOINT",a[a.MULTILINESTRING=4]="MULTILINESTRING",a[a.MULTIPOLYGON=5]="MULTIPOLYGON"})(Ir||(Ir={})),function(a){a[a.POINT=0]="POINT",a[a.LINESTRING=1]="LINESTRING",a[a.POLYGON=2]="POLYGON"}(jS||(jS={})),function(a){a[a.MORTON=0]="MORTON",a[a.VEC_2=1]="VEC_2",a[a.VEC_3=2]="VEC_3"}(cs||(cs={}));class YD{createPoint(n){return[[n]]}createMultiPoint(n){return n.map(s=>[s])}createLineString(n){return[n]}createMultiLineString(n){return n}createPolygon(n,s){return[n].concat(s)}createMultiPolygon(n){return n.flat()}}function ZS(a){const n=new Array(a.numGeometries);let s=1,u=1,p=1,y=0;const _=new YD;let b=0,T=0;const k=a.mortonSettings,I=a.topologyVector,D=I.geometryOffsets,N=I.partOffsets,z=I.ringOffsets,V=a.vertexOffsets,U=a.containsPolygonGeometry(),q=a.vertexBuffer;for(let ee=0;ee<a.numGeometries;ee++){const ue=a.geometryType(ee);if(ue===Ir.POINT){if(V&&V.length!==0)if(a.vertexBufferType===cs.VEC_2){const ne=2*V[T++],ie=new E(q[ne],q[ne+1]);n[y++]=_.createPoint(ie)}else{const ne=Ov(q[V[T++]],k.numBits,k.coordinateShift),ie=new E(ne.x,ne.y);n[y++]=_.createPoint(ie)}else{const ne=new E(q[b++],q[b++]);n[y++]=_.createPoint(ne)}D&&p++,N&&s++,z&&u++}else if(ue===Ir.MULTIPOINT){const ne=D[p]-D[p-1];p++;const ie=new Array(ne);if(V&&V.length!==0){for(let de=0;de<ne;de++){const me=2*V[T++];ie[de]=new E(q[me],q[me+1])}n[y++]=_.createMultiPoint(ie)}else{for(let de=0;de<ne;de++){const me=q[b++],Ae=q[b++];ie[de]=new E(me,Ae)}n[y++]=_.createMultiPoint(ie)}}else if(ue===Ir.LINESTRING){let ne,ie=0;U?(ie=z[u]-z[u-1],u++):ie=N[s]-N[s-1],s++,V&&V.length!==0?(ne=a.vertexBufferType===cs.VEC_2?Bv(q,V,T,ie,!1):Vv(q,V,T,ie,!1,k),T+=ie):(ne=Fv(q,b,ie,!1),b+=2*ie),n[y++]=_.createLineString(ne),D&&p++}else if(ue===Ir.POLYGON){const ne=N[s]-N[s-1];s++;const ie=new Array(ne-1);let de=z[u]-z[u-1];if(u++,V&&V.length!==0){const me=a.vertexBufferType===cs.VEC_2?fg(q,V,T,de):mg(q,V,T,de,0,k);T+=de;for(let Ae=0;Ae<ie.length;Ae++)de=z[u]-z[u-1],u++,ie[Ae]=a.vertexBufferType===cs.VEC_2?fg(q,V,T,de):mg(q,V,T,de,0,k),T+=de;n[y++]=_.createPolygon(me,ie)}else{const me=pg(q,b,de);b+=2*de;for(let Ae=0;Ae<ie.length;Ae++)de=z[u]-z[u-1],u++,ie[Ae]=pg(q,b,de),b+=2*de;n[y++]=_.createPolygon(me,ie)}D&&p++}else if(ue===Ir.MULTILINESTRING){const ne=D[p]-D[p-1];p++;const ie=new Array(ne);if(V&&V.length!==0){for(let de=0;de<ne;de++){let me=0;U?(me=z[u]-z[u-1],u++):me=N[s]-N[s-1],s++;const Ae=a.vertexBufferType===cs.VEC_2?Bv(q,V,T,me,!1):Vv(q,V,T,me,!1,k);ie[de]=Ae,T+=me}n[y++]=_.createMultiLineString(ie)}else{for(let de=0;de<ne;de++){let me=0;U?(me=z[u]-z[u-1],u++):me=N[s]-N[s-1],s++,ie[de]=Fv(q,b,me,!1),b+=2*me}n[y++]=_.createMultiLineString(ie)}}else{if(ue!==Ir.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ne=D[p]-D[p-1];p++;const ie=new Array(ne);let de=0;if(V&&V.length!==0){for(let me=0;me<ne;me++){const Ae=N[s]-N[s-1];s++;const $e=new Array(Ae-1);de=z[u]-z[u-1],u++;const Fe=a.vertexBufferType===cs.VEC_2?fg(q,V,T,de):mg(q,V,T,de,0,k);T+=de;for(let Ze=0;Ze<$e.length;Ze++)de=z[u]-z[u-1],u++,$e[Ze]=a.vertexBufferType===cs.VEC_2?fg(q,V,T,de):mg(q,V,T,de,0,k),T+=de;ie[me]=_.createPolygon(Fe,$e)}n[y++]=_.createMultiPolygon(ie)}else{for(let me=0;me<ne;me++){const Ae=N[s]-N[s-1];s++;const $e=new Array(Ae-1);de=z[u]-z[u-1],u++;const Fe=pg(q,b,de);b+=2*de;for(let Ze=0;Ze<$e.length;Ze++){const rt=z[u]-z[u-1];u++,$e[Ze]=pg(q,b,rt),b+=2*rt}ie[me]=_.createPolygon(Fe,$e)}n[y++]=_.createMultiPolygon(ie)}}}}return n}function pg(a,n,s){return Fv(a,n,s,!0)}function fg(a,n,s,u){return Bv(a,n,s,u,!0)}function mg(a,n,s,u,p,y){return Vv(a,n,s,u,!0,y)}function Fv(a,n,s,u){const p=new Array(u?s+1:s);for(let y=0;y<2*s;y+=2)p[y/2]=new E(a[n+y],a[n+y+1]);return u&&(p[p.length-1]=p[0]),p}function Bv(a,n,s,u,p){const y=new Array(p?u+1:u);for(let _=0;_<2*u;_+=2){const b=2*n[s+_/2];y[_/2]=new E(a[b],a[b+1])}return p&&(y[y.length-1]=y[0]),y}function Vv(a,n,s,u,p,y){const _=new Array(p?u+1:u);for(let b=0;b<u;b++){const T=Ov(a[n[s+b]],y.numBits,y.coordinateShift);_[b]=new E(T.x,T.y)}return p&&(_[_.length-1]=_[0]),_}class HS{constructor(n,s,u,p,y){Ot(this,"_vertexBufferType");Ot(this,"_topologyVector");Ot(this,"_vertexOffsets");Ot(this,"_vertexBuffer");Ot(this,"_mortonSettings");this._vertexBufferType=n,this._topologyVector=s,this._vertexOffsets=u,this._vertexBuffer=p,this._mortonSettings=y}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const n=ZS(this);let s=0;for(;s<this.numGeometries;)yield{coordinates:n[s],type:this.geometryType(s)},s++}getSimpleEncodedVertex(n){const s=this.vertexOffsets?2*this.vertexOffsets[n]:2*n;return[this.vertexBuffer[s],this.vertexBuffer[s+1]]}getVertex(n){if(this.vertexOffsets&&this.mortonSettings){const u=Ov(this.vertexBuffer[this.vertexOffsets[n]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[u.x,u.y]}const s=this.vertexOffsets?2*this.vertexOffsets[n]:2*n;return[this.vertexBuffer[s],this.vertexBuffer[s+1]]}getGeometries(){return ZS(this)}get mortonSettings(){return this._mortonSettings}}class KS extends HS{constructor(s,u,p,y,_,b,T){super(p,y,_,b,T);Ot(this,"_numGeometries");Ot(this,"_geometryType");this._numGeometries=s,this._geometryType=u}geometryType(s){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Ir.POLYGON||this._geometryType===Ir.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class XS extends HS{constructor(s,u,p,y,_,b){super(s,p,y,_,b);Ot(this,"_geometryTypes");this._geometryTypes=u}geometryType(s){return this._geometryTypes[s]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let s=0;s<this.numGeometries;s++)if(this.geometryType(s)===Ir.POLYGON||this.geometryType(s)===Ir.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class YS{constructor(n,s,u,p){Ot(this,"_triangleOffsets");Ot(this,"_indexBuffer");Ot(this,"_vertexBuffer");Ot(this,"_topologyVector");this._triangleOffsets=n,this._indexBuffer=s,this._vertexBuffer=u,this._topologyVector=p}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const n=new Array(this.numGeometries),s=this._topologyVector,u=s.partOffsets,p=s.ringOffsets,y=s.geometryOffsets;let _=0,b=1,T=1,k=1;for(let I=0;I<this.numGeometries;I++)switch(this.geometryType(I)){case Ir.POLYGON:{const D=u[b]-u[b-1];b++;const N=[];for(let z=0;z<D;z++){const V=p[T]-p[T-1];T++;const U=[];for(let q=0;q<V;q++){const ee=this._vertexBuffer[_++],ue=this._vertexBuffer[_++];U.push(new E(ee,ue))}U.length>0&&U.push(U[0]),N.push(U)}n[I]=N,y&&k++}break;case Ir.MULTIPOLYGON:{const D=y[k]-y[k-1];k++;const N=[];for(let z=0;z<D;z++){const V=u[b]-u[b-1];b++;for(let U=0;U<V;U++){const q=p[T]-p[T-1];T++;const ee=[];for(let ue=0;ue<q;ue++){const ne=this._vertexBuffer[_++],ie=this._vertexBuffer[_++];ee.push(new E(ne,ie))}ee.length>0&&ee.push(ee[0]),N.push(ee)}}n[I]=N}}return n}[Symbol.iterator](){return null}}function JS(a,n,s,u,p,y){return new JD(a,n,s,u,p,y)}class JD extends YS{constructor(s,u,p,y,_,b){super(p,y,_,b);Ot(this,"_numGeometries");Ot(this,"_geometryType");this._numGeometries=s,this._geometryType=u}geometryType(s){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function QS(a,n,s,u,p){return new QD(a,n,s,u,p)}class QD extends YS{constructor(s,u,p,y,_){super(u,p,y,_);Ot(this,"_geometryTypes");this._geometryTypes=s}geometryType(s){return this._geometryTypes[s]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function ej(a,n,s,u,p){const y=vi(a,s);let _=null,b=null,T=null,k=null,I=null,D=null,N=null,z=null;if(dg(y,u,a,s)===Ar.CONST){const U=Lv(a,s,y,!1);for(let q=0;q<n-1;q++){const ee=vi(a,s);switch(ee.physicalStreamType){case Zr.LENGTH:switch(ee.logicalStreamType.lengthType){case Wi.GEOMETRIES:_=Wo(a,s,ee);break;case Wi.PARTS:b=Wo(a,s,ee);break;case Wi.RINGS:T=Wo(a,s,ee);break;case Wi.TRIANGLES:N=Wo(a,s,ee)}break;case Zr.OFFSET:switch(ee.logicalStreamType.offsetType){case gc.VERTEX:k=xi(a,s,ee,!1);break;case gc.INDEX:z=xi(a,s,ee,!1)}break;case Zr.DATA:Us.VERTEX===ee.logicalStreamType.dictionaryType?I=xi(a,s,ee,!0):(D={numBits:ee.numBits,coordinateShift:ee.coordinateShift},I=xi(a,s,ee,!1))}}return z!==null?_!=null||b!=null?JS(u,U,N,z,I,new Qu(_,b,T)):JS(u,U,N,z,I):D===null?function(q,ee,ue,ne,ie){return new KS(q,ee,cs.VEC_2,ue,ne,ie)}(u,U,new Qu(_,b,T),k,I):function(q,ee,ue,ne,ie,de){return new KS(q,ee,cs.MORTON,ue,ne,ie,de)}(u,U,new Qu(_,b,T),k,I,D)}const V=xi(a,s,y,!1);for(let U=0;U<n-1;U++){const q=vi(a,s);switch(q.physicalStreamType){case Zr.LENGTH:switch(q.logicalStreamType.lengthType){case Wi.GEOMETRIES:_=xi(a,s,q,!1);break;case Wi.PARTS:b=xi(a,s,q,!1);break;case Wi.RINGS:T=xi(a,s,q,!1);break;case Wi.TRIANGLES:N=Wo(a,s,q)}break;case Zr.OFFSET:switch(q.logicalStreamType.offsetType){case gc.VERTEX:k=xi(a,s,q,!1);break;case gc.INDEX:z=xi(a,s,q,!1)}break;case Zr.DATA:Us.VERTEX===q.logicalStreamType.dictionaryType?I=xi(a,s,q,!0):(D={numBits:q.numBits,coordinateShift:q.coordinateShift},I=xi(a,s,q,!1))}}return z!==null&&b===null?QS(V,N,z,I):(_!==null?(_=Uv(V,_,2),b!==null&&T!==null?(b=eT(V,_,b,!1),T=function(U,q,ee,ue){const ne=new Int32Array(ee[ee.length-1]+1);let ie=0;ne[0]=ie;let de=1,me=1,Ae=0;for(let $e=0;$e<U.length;$e++){const Fe=U[$e],Ze=q[$e+1]-q[$e];if(Fe!==0&&Fe!==3)for(let rt=0;rt<Ze;rt++){const Ke=ee[de]-ee[de-1];de++;for(let Ve=0;Ve<Ke;Ve++)ie=ne[me++]=ie+ue[Ae++]}else for(let rt=0;rt<Ze;rt++)ne[me++]=++ie,de++}return ne}(V,_,b,T)):b!==null&&(b=function(U,q,ee){const ue=new Int32Array(q[q.length-1]+1);let ne=0;ue[0]=ne;let ie=1,de=0;for(let me=0;me<U.length;me++){const Ae=U[me],$e=q[me+1]-q[me];if(Ae===4||Ae===1)for(let Fe=0;Fe<$e;Fe++)ne=ue[ie++]=ne+ee[de++];else for(let Fe=0;Fe<$e;Fe++)ue[ie++]=++ne}return ue}(V,_,b))):b!==null&&T!==null?(b=Uv(V,b,1),T=eT(V,b,T,!0)):b!==null&&(b=Uv(V,b,0)),z!==null?QS(V,N,z,I,new Qu(_,b,T)):D===null?function(U,q,ee,ue){return new XS(cs.VEC_2,U,q,ee,ue)}(V,new Qu(_,b,T),k,I):function(U,q,ee,ue,ne){return new XS(cs.MORTON,U,q,ee,ue,ne)}(V,new Qu(_,b,T),k,I,D))}function Uv(a,n,s){const u=new Int32Array(a.length+1);let p=0;u[0]=p;let y=0;for(let _=0;_<a.length;_++)p=u[_+1]=p+(a[_]>s?n[y++]:1);return u}function eT(a,n,s,u){const p=new Int32Array(n[n.length-1]+1);let y=0;p[0]=y;let _=1,b=0;for(let T=0;T<a.length;T++){const k=a[T],I=n[T+1]-n[T];if(k===5||k===2||u&&(k===4||k===1))for(let D=0;D<I;D++)y=p[_++]=y+s[b++];else for(let D=0;D<I;D++)p[_++]=++y}return p}class tj extends Yu{constructor(s,u,p){super(s,u.getBuffer(),p);Ot(this,"dataVector");this.dataVector=u}getValueFromBuffer(s){return this.dataVector.get(s)}}class nj extends cg{getValueFromBuffer(n){return this.dataBuffer[n]}}class tT extends Yu{constructor(n,s,u){super(n,BigInt64Array.of(s),u)}getValueFromBuffer(n){return this.dataBuffer[0]}}function yp(a,n,s){return nT(a,Math.ceil(n/8),s)}function nT(a,n,s){const u=new Uint8Array(n);let p=0;for(;p<n;){const y=a[s.increment()];if(y<=127){const _=y+3,b=a[s.increment()],T=p+_;u.fill(b,p,T),p=T}else{const _=256-y;for(let b=0;b<_;b++)u[p++]=a[s.increment()]}}return u}const rj=new TextDecoder;function $v(a,n,s){return s-n>=12?rj.decode(a.subarray(n,s)):function(u,p,y){let _="",b=p;for(;b<y;){const T=u[b];let k,I,D,N=null,z=T>239?4:T>223?3:T>191?2:1;if(b+z>y)break;z===1?T<128&&(N=T):z===2?(k=u[b+1],(192&k)==128&&(N=(31&T)<<6|63&k,N<=127&&(N=null))):z===3?(k=u[b+1],I=u[b+2],(192&k)==128&&(192&I)==128&&(N=(15&T)<<12|(63&k)<<6|63&I,(N<=2047||N>=55296&&N<=57343)&&(N=null))):z===4&&(k=u[b+1],I=u[b+2],D=u[b+3],(192&k)==128&&(192&I)==128&&(192&D)==128&&(N=(15&T)<<18|(63&k)<<12|(63&I)<<6|63&D,(N<=65535||N>=1114112)&&(N=null))),N===null?(N=65533,z=1):N>65535&&(N-=65536,_+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),_+=String.fromCharCode(N),b+=z}return _}(a,n,s)}class Gv extends Yu{constructor(s,u,p,y){super(s,p,y);Ot(this,"offsetBuffer");this.offsetBuffer=u}}class rT extends Gv{constructor(s,u,p,y){super(s,u,p,y??u.length-1);Ot(this,"textEncoder");this.textEncoder=new TextEncoder}getValueFromBuffer(s){return $v(this.dataBuffer,this.offsetBuffer[s],this.offsetBuffer[s+1])}}class eh extends Gv{constructor(s,u,p,y,_){super(s,p,y,_??u.length);Ot(this,"indexBuffer");Ot(this,"textEncoder");this.indexBuffer=u,this.indexBuffer=u,this.textEncoder=new TextEncoder}getValueFromBuffer(s){const u=this.indexBuffer[s];return $v(this.dataBuffer,this.offsetBuffer[u],this.offsetBuffer[u+1])}}class iT extends Gv{constructor(s,u,p,y,_,b,T){super(s,p,y,T);Ot(this,"indexBuffer");Ot(this,"symbolOffsetBuffer");Ot(this,"symbolTableBuffer");Ot(this,"textEncoder");Ot(this,"symbolLengthBuffer");Ot(this,"lengthBuffer");Ot(this,"decodedDictionary");this.indexBuffer=u,this.symbolOffsetBuffer=_,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(s){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(p,y,_){const b=[],T=new Array(y.length).fill(0);for(let k=1;k<y.length;k++)T[k]=T[k-1]+y[k-1];for(let k=0;k<_.length;k++)if(_[k]===255)b.push(_[++k]);else{const I=y[_[k]],D=T[_[k]];for(let N=0;N<I;N++)b.push(p[D+N])}return new Uint8Array(b)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const u=this.indexBuffer[s];return $v(this.decodedDictionary,this.offsetBuffer[u],this.offsetBuffer[u+1])}offsetToLengthBuffer(s){const u=new Uint32Array(s.length-1);let p=s[0];for(let y=1;y<s.length;y++){const _=s[y];u[y-1]=_-p,p=_}return u}}function ij(a,n,s,u,p,y){return s.type==="scalarType"?function(_,b,T,k,I,D){let N=null,z=0;if(_===0)return null;if(D.nullable){const U=vi(b,T);z=U.numValues;const q=T.get(),ee=yp(b,z,T);T.set(q+U.byteLength),N=new $s(ee,U.numValues)}const V=N??k;switch(I.physicalType){case 4:case 3:return function(U,q,ee,ue,ne){const ie=vi(U,q),de=dg(ie,ne,U,q),me=ue.physicalType===3;if(de===Ar.FLAT){const Ae=_p(ne)?zv(U,q,ie,me,ne):xi(U,q,ie,me);return new Iv(ee.name,Ae,ne)}if(de===Ar.SEQUENCE){const Ae=BS(U,q,ie);return new Rv(ee.name,Ae[0],Ae[1],ie.numRleValues)}{const Ae=Lv(U,q,ie,me);return new Dv(ee.name,Ae,ne)}}(b,T,D,I,V);case 9:return function(U,q,ee,ue,ne){let ie=null,de=null,me=null,Ae=null,$e=null,Fe=null,Ze=null,rt=null;for(let Ke=0;Ke<ue;Ke++){const Ve=vi(q,ee);if(Ve.byteLength!==0)switch(Ve.physicalStreamType){case Zr.PRESENT:{const Ne=yp(q,Ve.numValues,ee);Fe=new $s(Ne,Ve.numValues);break}case Zr.OFFSET:de=ne!=null||Fe!=null?zv(q,ee,Ve,!1,ne??Fe):xi(q,ee,Ve,!1);break;case Zr.LENGTH:{const Ne=Wo(q,ee,Ve);Wi.DICTIONARY===Ve.logicalStreamType.lengthType?ie=Ne:Wi.SYMBOL===Ve.logicalStreamType.lengthType?Ae=Ne:Ze=Ne;break}case Zr.DATA:{const Ne=q.subarray(ee.get(),ee.get()+Ve.byteLength);ee.add(Ve.byteLength);const ht=Ve.logicalStreamType.dictionaryType;Us.FSST===ht?$e=Ne:Us.SINGLE===ht||Us.SHARED===ht?me=Ne:Us.NONE===ht&&(rt=Ne);break}}}return function(Ke,Ve,Ne,ht,ct,pt,ot){return Ve?new iT(Ke,Ne,ht,ct,pt,Ve,ot):null}(U,$e,de,ie,me,Ae,ne??Fe)??function(Ke,Ve,Ne,ht,ct){return Ve?ct?new eh(Ke,Ne,ht,Ve,ct):new eh(Ke,Ne,ht,Ve):null}(U,me,de,ie,ne??Fe)??function(Ke,Ve,Ne,ht,ct){if(!Ve||!Ne)return null;if(ht)return ct?new eh(Ke,ht,Ve,Ne,ct):new eh(Ke,ht,Ve,Ne);if(ct&&ct.size()!==Ve.length-1){const pt=new Int32Array(ct.size());let ot=0;for(let vt=0;vt<ct.size();vt++)pt[vt]=ct.get(vt)?ot++:0;return new eh(Ke,pt,Ve,Ne,ct)}return ct?new rT(Ke,Ve,Ne,ct):new rT(Ke,Ve,Ne)}(U,Ze,rt,de,ne??Fe)}(D.name,b,T,D.nullable?_-1:_,N);case 0:return function(U,q,ee,ue,ne){const ie=vi(U,q),de=ie.numValues,me=q.get(),Ae=_p(ne)?function(Fe,Ze,rt,Ke){const Ve=nT(Fe,Math.ceil(Ze/8),rt),Ne=new $s(Ve,Ze),ht=Ke.size(),ct=new $s(new Uint8Array(ht),ht);let pt=0;for(let ot=0;ot<Ke.size();ot++){const vt=!!Ke.get(ot)&&Ne.get(pt++);ct.set(ot,vt)}return ct.getBuffer()}(U,de,q,ne):yp(U,de,q);q.set(me+ie.byteLength);const $e=new $s(Ae,de);return new tj(ee.name,$e,ne)}(b,T,D,0,V);case 6:case 5:return function(U,q,ee,ue,ne){const ie=vi(U,q),de=dg(ie,ue,U,q),me=ne.physicalType===5;if(de===Ar.FLAT){const Ae=_p(ue)?function($e,Fe,Ze,rt,Ke){return function(Ve,Ne,ht,ct){switch(Ne.logicalLevelTechnique1){case Kt.DELTA:return Ne.logicalLevelTechnique2===Kt.RLE&&(Ve=zS(Ve,Ne.runs,Ne.numRleValues)),function(pt,ot){const vt=new BigInt64Array(pt.size());let Qt=0;pt.get(0)?(vt[0]=pt.get(0)?ot[0]>>1n^-(1n&ot[0]):0n,Qt=1):vt[0]=0n;let Ht=1;for(;Ht!=vt.length;++Ht)vt[Ht]=pt.get(Ht)?vt[Ht-1]+(ot[Qt]>>1n^-(1n&ot[Qt++])):vt[Ht-1];return vt}(ct,Ve);case Kt.RLE:return function(pt,ot,vt,Qt){const Ht=ot;return vt?function(Nn,Kr,fr){const Ln=new BigInt64Array(Nn.size());let An=0;for(let on=0;on<fr;on++){const Wn=Number(Kr[on]);let nr=Kr[on+fr];nr=nr>>1n^-(1n&nr);for(let Tn=An;Tn<An+Wn;Tn++)Nn.get(Tn)?Ln[Tn]=nr:(Ln[Tn]=0n,An++);An+=Wn}return Ln}(Qt,pt,Ht.runs):function(Nn,Kr,fr){const Ln=new BigInt64Array(Nn.size());let An=0;for(let on=0;on<fr;on++){const Wn=Number(Kr[on]),nr=Kr[on+fr];for(let Tn=An;Tn<An+Wn;Tn++)Nn.get(Tn)?Ln[Tn]=nr:(Ln[Tn]=0n,An++);An+=Wn}return Ln}(Qt,pt,Ht.runs)}(Ve,Ne,ht,ct);case Kt.NONE:return Ve=ht?function(pt,ot){const vt=new BigInt64Array(pt.size());let Qt=0,Ht=0;for(;Ht!=vt.length;++Ht)if(pt.get(Ht)){const Nn=ot[Qt++];vt[Ht]=Nn>>1n^-(1n&Nn)}else vt[Ht]=0n;return vt}(ct,Ve):function(pt,ot){const vt=new BigInt64Array(pt.size());let Qt=0,Ht=0;for(;Ht!=vt.length;++Ht)vt[Ht]=pt.get(Ht)?ot[Qt++]:0n;return vt}(ct,Ve),Ve;default:throw new Error("The specified Logical level technique is not supported")}}(ug($e,Fe,Ze.numValues),Ze,rt,Ke)}(U,q,ie,me,ue):US(U,q,ie,me);return new GS(ee.name,Ae,ue)}if(de===Ar.SEQUENCE){const Ae=VS(U,q,ie);return new qS(ee.name,Ae[0],Ae[1],ie.numRleValues)}{const Ae=$S(U,q,ie,me);return new tT(ee.name,Ae,ue)}}(b,T,D,V,I);case 7:return function(U,q,ee,ue){const ne=vi(U,q),ie=_p(ue)?function(de,me,Ae,$e){const Fe=me.get(),Ze=Fe+$e*Float32Array.BYTES_PER_ELEMENT,rt=new Uint8Array(de.subarray(Fe,Ze)).buffer,Ke=new Float32Array(rt);me.set(Ze);const Ve=Ae.size(),Ne=new Float32Array(Ve);let ht=0;for(let ct=0;ct<Ve;ct++)Ne[ct]=Ae.get(ct)?Ke[ht++]:0;return Ne}(U,q,ue,ne.numValues):function(de,me,Ae){const $e=me.get(),Fe=$e+Ae*Float32Array.BYTES_PER_ELEMENT,Ze=new Uint8Array(de.subarray($e,Fe)).buffer,rt=new Float32Array(Ze);return me.set(Fe),rt}(U,q,ne.numValues);return new nj(ee.name,ie,ue)}(b,T,D,V);case 8:return function(U,q,ee,ue){const ne=vi(U,q),ie=_p(ue)?function(de,me,Ae,$e){const Fe=me.get(),Ze=Fe+$e*Float64Array.BYTES_PER_ELEMENT,rt=new Uint8Array(de.subarray(Fe,Ze)).buffer,Ke=new Float64Array(rt);me.set(Ze);const Ve=Ae.size(),Ne=new Float64Array(Ve);let ht=0;for(let ct=0;ct<Ve;ct++)Ne[ct]=Ae.get(ct)?Ke[ht++]:0;return Ne}(U,q,ue,ne.numValues):function(de,me,Ae){const $e=me.get(),Fe=$e+Ae*Float64Array.BYTES_PER_ELEMENT,Ze=new Uint8Array(de.subarray($e,Fe)).buffer,rt=new Float64Array(Ze);return me.set(Fe),rt}(U,q,ne.numValues);return new Mv(ee.name,ie,ue)}(b,T,D,V);default:throw new Error(`The specified data type for the field is currently not supported: ${I}`)}}(u,a,n,p,s.scalarType,s):u!=1?null:function(_,b,T,k){let I=null,D=null,N=null,z=null,V=!1;for(;!V;){const ue=vi(_,b);switch(ue.physicalStreamType){case Zr.LENGTH:Wi.DICTIONARY===ue.logicalStreamType.lengthType?I=Wo(_,b,ue):N=Wo(_,b,ue);break;case Zr.DATA:Us.SINGLE===ue.logicalStreamType.dictionaryType||Us.SHARED===ue.logicalStreamType.dictionaryType?(D=_.subarray(b.get(),b.get()+ue.byteLength),V=!0):z=_.subarray(b.get(),b.get()+ue.byteLength),b.add(ue.byteLength)}}const U=T.complexType.children,q=[];let ee=0;for(const ue of U){const ne=Br(_,b,1)[0];if(ne==0)continue;const ie=`${T.name}${ue.name==="default"?"":":"+ue.name}`;if(ne!==2||ue.type!=="scalarField"||ue.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const de=vi(_,b),me=yp(_,de.numValues,b),Ae=vi(_,b),$e=Ae.decompressedCount!==k?zv(_,b,Ae,!1,new $s(me,de.numValues)):xi(_,b,Ae,!1);q[ee++]=z?new iT(ie,$e,I,D,N,z,new $s(me,de.numValues)):new eh(ie,$e,I,D,new $s(me,de.numValues))}return q}(a,n,s,p)}function _p(a){return a instanceof $s}function sj(a){if(a.name==="id")return!1;if(a.type==="scalarType"){const n=a.scalarType;if(n.type==="physicalType")switch(n.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(n.type==="logicalType")return!1}else if(a.type==="complexType"){const n=a.complexType;if(n.type==="physicalType")switch(n.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",a),!1}const aj=new TextDecoder;function sT(a,n){const s=Br(a,n,1)[0];if(s===0)return"";const u=n.get(),p=a.subarray(u,u+s);return n.add(s),aj.decode(p)}function aT(a,n){const s=Br(a,n,1)[0]>>>0,u=!!(4&s),p=!!(2&s),y=Br(a,n,1)[0]>>>0,_={};if(1&s&&(_.nullable=!0),p){const b={};if(u?(b.type="logicalType",b.logicalType=y):(b.type="physicalType",b.physicalType=y),8&s){const T=Br(a,n,1)[0]>>>0;b.children=new Array(T);for(let k=0;k<T;k++)b.children[k]=aT(a,n)}_.type="complexField",_.complexField=b}else{const b={};u?(b.type="logicalType",b.logicalType=y):(b.type="physicalType",b.physicalType=y),_.type="scalarField",_.scalarField=b}return _}function oj(a,n){const s=Br(a,n,1)[0]>>>0,u=function(p){switch(p){case 0:case 1:case 2:case 3:{const y={};y.nullable=!!(1&p),y.columnScope=0;const _={};return _.physicalType=p>1?6:4,_.type="physicalType",y.scalarType=_,y.type="scalarType",y}case 4:{const y={nullable:!1,columnScope:0},_={type:"physicalType",physicalType:0};return y.type="complexType",y.complexType=_,y}case 30:{const y={nullable:!1,columnScope:0},_={type:"physicalType",physicalType:1};return y.type="complexType",y.complexType=_,y}default:return function(y){let _=null;switch(y){case 10:case 11:_=0;break;case 12:case 13:_=1;break;case 14:case 15:_=2;break;case 16:case 17:_=3;break;case 18:case 19:_=4;break;case 20:case 21:_=5;break;case 22:case 23:_=6;break;case 24:case 25:_=7;break;case 26:case 27:_=8;break;case 28:case 29:_=9;break;default:return null}const b={};b.nullable=!!(1&y),b.columnScope=0;const T={type:"physicalType"};return T.physicalType=_,b.type="scalarType",b.scalarType=T,b}(p)}}(s);if(!u)throw new Error(`Unsupported column type code: ${s}`);if(function(p){return p>=10}(s)?u.name=sT(a,n):s>=0&&s<=3?u.name="id":s===4&&(u.name="geometry"),function(p){return p===30}(s)){const p=Br(a,n,1)[0]>>>0,y=u.complexType;y.children=new Array(p);for(let _=0;_<p;_++)y.children[_]=aT(a,n)}return u}function lj(a,n){const s={featureTables:[]},u={};u.name=sT(a,n);const p=Br(a,n,1)[0]>>>0,y=Br(a,n,1)[0]>>>0;u.columns=new Array(y);for(let _=0;_<y;_++)u.columns[_]=oj(a,n);return s.featureTables.push(u),[s,p]}function cj(a,n,s,u,p,y,_=!1){const b=n.scalarType.physicalType,T=dg(p,y,a,s);if(b===4)switch(T){case Ar.FLAT:{const k=xi(a,s,p,!1);return new Iv(u,k,y)}case Ar.SEQUENCE:{const k=BS(a,s,p);return new Rv(u,k[0],k[1],p.numRleValues)}case Ar.CONST:{const k=Lv(a,s,p,!1);return new Dv(u,k,y)}}else switch(T){case Ar.FLAT:{if(_){const I=function(D,N,z,V){const U=function(q,ee,ue){const ne=new Float64Array(ee);for(let ie=0;ie<ee;ie++)ne[ie]=KD(q,ue);return ne}(D,z.numValues,N);return function(q,ee,ue){switch(ee.logicalLevelTechnique1){case Kt.DELTA:return ee.logicalLevelTechnique2===Kt.RLE&&(q=OS(q,ee.runs,ee.numRleValues)),function(ne){ne[0]=ne[0]%2==1?(ne[0]+1)/-2:ne[0]/2;const ie=ne.length/4*4;let de=1;if(ie>=4)for(;de<ie-4;de+=4){const me=ne[de],Ae=ne[de+1],$e=ne[de+2],Fe=ne[de+3];ne[de]=(me%2==1?(me+1)/-2:me/2)+ne[de-1],ne[de+1]=(Ae%2==1?(Ae+1)/-2:Ae/2)+ne[de],ne[de+2]=($e%2==1?($e+1)/-2:$e/2)+ne[de+1],ne[de+3]=(Fe%2==1?(Fe+1)/-2:Fe/2)+ne[de+2]}for(;de!=ne.length;++de)ne[de]=(ne[de]%2==1?(ne[de]+1)/-2:ne[de]/2)+ne[de-1]}(q),q;case Kt.RLE:return function(ne,ie,de){return OS(ne,ie.runs,ie.numRleValues)}(q,ee);case Kt.NONE:return q;default:throw new Error(`The specified Logical level technique is not supported: ${ee.logicalLevelTechnique1}`)}}(U,z)}(a,s,p);return new Mv(u,I,y)}const k=US(a,s,p,!1);return new GS(u,k,y)}case Ar.SEQUENCE:{const k=VS(a,s,p);return new qS(u,k[0],k[1],p.numRleValues)}case Ar.CONST:{const k=$S(a,s,p,!1);return new tT(u,k,y)}}throw new Error("Vector type not supported for id column.")}class uj{constructor(n,s){var u;switch(this._featureData=n,this.properties=this._featureData.properties||{},(u=this._featureData.geometry)===null||u===void 0?void 0:u.type){case Ir.POINT:case Ir.MULTIPOINT:this.type=1;break;case Ir.LINESTRING:case Ir.MULTILINESTRING:this.type=2;break;case Ir.POLYGON:case Ir.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=s,this.id=Number(this._featureData.id)}loadGeometry(){const n=[];for(const s of this._featureData.geometry.coordinates){const u=[];for(const p of s)u.push(new E(p.x,p.y));n.push(u)}return n}}class hj{constructor(n){this.features=[],this.featureTable=n,this.name=n.name,this.extent=n.extent,this.version=2,this.features=n.getFeatures(),this.length=this.features.length}feature(n){return new uj(this.features[n],this.extent)}}class oT{constructor(n){this.layers={};const s=function(u,p,y=!0){const _=new HD(0),b=[];for(;_.get()<u.length;){const T=Br(u,_,1)[0]>>>0,k=_.get()+T;if(k>u.length)throw new Error(`Block overruns tile: ${k} > ${u.length}`);if(Br(u,_,1)[0]>>>0!=1){_.set(k);continue}const I=lj(u,_),D=I[1],N=I[0].featureTables[0];let z=null,V=null;const U=[];let q=0;for(const ue of N.columns){const ne=ue.name;if(ne==="id"){let ie=null;if(ue.nullable){const me=vi(u,_),Ae=_.get(),$e=yp(u,me.numValues,_);_.set(Ae+me.byteLength),ie=new $s($e,me.numValues)}const de=vi(u,_);q=de.decompressedCount,z=cj(u,ue,_,ne,de,ie??q,y)}else if(ne==="geometry"){const ie=Br(u,_,1)[0];if(q===0){const de=_.get();q=vi(u,_).decompressedCount,_.set(de)}V=ej(u,ie,_,q)}else{const ie=sj(ue)?Br(u,_,1)[0]:1;if(ie===0&&ue.type==="scalarType")continue;const de=ij(u,_,ue,ie,q);if(de)if(Array.isArray(de))for(const me of de)U.push(me);else U.push(de)}}const ee=new ZD(N.name,V,z,U,D);b.push(ee),_.set(k)}return b}(new Uint8Array(n));this.layers=s.reduce((u,p)=>Object.assign(Object.assign({},u),{[p.name]:new hj(p)}),{})}}class dj{constructor(n,s){this.feature=n,this.type=n.type,this.properties=n.tags?n.tags:{},this.extent=s,"id"in n&&(typeof n.id=="string"?this.id=parseInt(n.id,10):typeof n.id!="number"||isNaN(n.id)||(this.id=n.id))}loadGeometry(){const n=[],s=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const u of s){const p=[];for(const y of u)p.push(new E(y[0],y[1]));n.push(p)}return n}}const vp="_geojsonTileLayer";function pj(a,n){n.writeVarintField(15,a.version||1),n.writeStringField(1,a.name||""),n.writeVarintField(5,a.extent||4096);const s={keys:[],values:[],keycache:{},valuecache:{}};for(let y=0;y<a.length;y++)s.feature=a.feature(y),n.writeMessage(2,fj,s);const u=s.keys;for(const y of u)n.writeStringField(3,y);const p=s.values;for(const y of p)n.writeMessage(4,yj,y)}function fj(a,n){if(!a.feature)return;const s=a.feature;s.id!==void 0&&n.writeVarintField(1,s.id),n.writeMessage(2,mj,a),n.writeVarintField(3,s.type),n.writeMessage(4,gj,s)}function mj(a,n){var s;for(const u in(s=a.feature)==null?void 0:s.properties){let p=a.feature.properties[u],y=a.keycache[u];if(p==null)continue;y===void 0&&(a.keys.push(u),y=a.keys.length-1,a.keycache[u]=y),n.writeVarint(y),typeof p!="string"&&typeof p!="boolean"&&typeof p!="number"&&(p=JSON.stringify(p));const _=typeof p+":"+p;let b=a.valuecache[_];b===void 0&&(a.values.push(p),b=a.values.length-1,a.valuecache[_]=b),n.writeVarint(b)}}function qv(a,n){return(n<<3)+(7&a)}function lT(a){return a<<1^a>>31}function gj(a,n){const s=a.loadGeometry(),u=a.type;let p=0,y=0;for(const _ of s){let b=1;u===1&&(b=_.length),n.writeVarint(qv(1,b));const T=u===3?_.length-1:_.length;for(let k=0;k<T;k++){k===1&&u!==1&&n.writeVarint(qv(2,T-1));const I=_[k].x-p,D=_[k].y-y;n.writeVarint(lT(I)),n.writeVarint(lT(D)),p+=I,y+=D}a.type===3&&n.writeVarint(qv(7,1))}}function yj(a,n){const s=typeof a;s==="string"?n.writeStringField(1,a):s==="boolean"?n.writeBooleanField(7,a):s==="number"&&(a%1!=0?n.writeDoubleField(3,a):a<0?n.writeSVarintField(6,a):n.writeVarintField(5,a))}class cT{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Fo(Pe,16,0),this.grid3D=new Fo(Pe,16,0),this.featureIndexArray=new Y,this.promoteId=s}insert(n,s,u,p,y,_){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);const T=_?this.grid3D:this.grid;for(let k=0;k<s.length;k++){const I=s[k],D=[1/0,1/0,-1/0,-1/0];for(let N=0;N<I.length;N++){const z=I[N];D[0]=Math.min(D[0],z.x),D[1]=Math.min(D[1],z.y),D[2]=Math.max(D[2],z.x),D[3]=Math.max(D[3],z.y)}D[0]<Pe&&D[1]<Pe&&D[2]>=0&&D[3]>=0&&T.insert(b,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new H1(new ig(this.rawTileData)).layers:new oT(this.rawTileData).layers,this.sourceLayerCoder=new MS(this.vtLayers?Object.keys(this.vtLayers).sort():[vp])),this.vtLayers}query(n,s,u,p){this.loadVTLayers();const y=n.params,_=Pe/n.tileSize/n.scale,b=ql(y.filter,y.globalState),T=n.queryGeometry,k=n.queryPadding*_,I=mc.fromPoints(T),D=this.grid.query(I.minX-k,I.minY-k,I.maxX+k,I.maxY+k),N=mc.fromPoints(n.cameraQueryGeometry).expandBy(k),z=this.grid3D.query(N.minX,N.minY,N.maxX,N.maxY,(q,ee,ue,ne)=>function(ie,de,me,Ae,$e){for(const Ze of ie)if(de<=Ze.x&&me<=Ze.y&&Ae>=Ze.x&&$e>=Ze.y)return!0;const Fe=[new E(de,me),new E(de,$e),new E(Ae,$e),new E(Ae,me)];if(ie.length>2){for(const Ze of Fe)if(Uu(ie,Ze))return!0}for(let Ze=0;Ze<ie.length-1;Ze++)if(vR(ie[Ze],ie[Ze+1],Fe))return!0;return!1}(n.cameraQueryGeometry,q-k,ee-k,ue+k,ne+k));for(const q of z)D.push(q);D.sort(_j);const V={};let U;for(let q=0;q<D.length;q++){const ee=D[q];if(ee===U)continue;U=ee;const ue=this.featureIndexArray.get(ee);let ne=null;this.loadMatchingFeature(V,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,b,y.layers,y.availableImages,s,u,p,(ie,de,me)=>(ne||(ne=ga(ie)),de.queryIntersectsFeature({queryGeometry:T,feature:ie,featureState:me,geometry:ne,zoom:this.z,transform:n.transform,pixelsToTileUnits:_,pixelPosMatrix:n.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:n.getElevation})))}return V}loadMatchingFeature(n,s,u,p,y,_,b,T,k,I,D){const N=this.bucketLayerIDs[s];if(_&&!N.some(q=>_.has(q)))return;const z=this.sourceLayerCoder.decode(u),V=this.vtLayers[z].feature(p);if(y.needGeometry){const q=ya(V,!0);if(!y.filter(new pn(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!y.filter(new pn(this.tileID.overscaledZ),V))return;const U=this.getId(V,z);for(let q=0;q<N.length;q++){const ee=N[q];if(_&&!_.has(ee))continue;const ue=T[ee];if(!ue)continue;let ne={};U&&I&&(ne=I.getState(ue.sourceLayer||vp,U));const ie=vr({},k[ee]);ie.paint=uT(ie.paint,ue.paint,V,ne,b),ie.layout=uT(ie.layout,ue.layout,V,ne,b);const de=!D||D(V,ue,ne);if(!de)continue;const me=new RS(V,this.z,this.x,this.y,U);me.layer=ie;let Ae=n[ee];Ae===void 0&&(Ae=n[ee]=[]),Ae.push({featureIndex:p,feature:me,intersectionZ:de})}}lookupSymbolFeatures(n,s,u,p,y,_,b,T){const k={};this.loadVTLayers();const I=ql(y.filterSpec,y.globalState);for(const D of n)this.loadMatchingFeature(k,u,p,D,I,_,b,T,s);return k}hasLayer(n){for(const s of this.bucketLayerIDs)for(const u of s)if(n===u)return!0;return!1}getId(n,s){var u;let p=n.id;return this.promoteId&&(p=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((u=n.properties)===null||u===void 0)&&u.cluster)&&this.promoteId&&(p=Number(n.properties.cluster_id))),p}}function uT(a,n,s,u,p){return Nr(a,(y,_)=>{const b=n instanceof ic?n.get(_):null;return b&&b.evaluate?b.evaluate(s,u,p):b})}function _j(a,n){return n-a}function hT(a,n,s,u,p){const y=[];for(let _=0;_<a.length;_++){const b=a[_];let T;for(let k=0;k<b.length-1;k++){let I=b[k],D=b[k+1];I.x<n&&D.x<n||(I.x<n?I=new E(n,I.y+(n-I.x)/(D.x-I.x)*(D.y-I.y))._round():D.x<n&&(D=new E(n,I.y+(n-I.x)/(D.x-I.x)*(D.y-I.y))._round()),I.y<s&&D.y<s||(I.y<s?I=new E(I.x+(s-I.y)/(D.y-I.y)*(D.x-I.x),s)._round():D.y<s&&(D=new E(I.x+(s-I.y)/(D.y-I.y)*(D.x-I.x),s)._round()),I.x>=u&&D.x>=u||(I.x>=u?I=new E(u,I.y+(u-I.x)/(D.x-I.x)*(D.y-I.y))._round():D.x>=u&&(D=new E(u,I.y+(u-I.x)/(D.x-I.x)*(D.y-I.y))._round()),I.y>=p&&D.y>=p||(I.y>=p?I=new E(I.x+(p-I.y)/(D.y-I.y)*(D.x-I.x),p)._round():D.y>=p&&(D=new E(I.x+(p-I.y)/(D.y-I.y)*(D.x-I.x),p)._round()),T&&I.equals(T[T.length-1])||(T=[I],y.push(T)),T.push(D)))))}}return y}function dT(a,n,s,u,p){switch(n){case 1:return function(y,_,b,T){const k=[];for(const I of y)for(const D of I){const N=T===0?D.x:D.y;N>=_&&N<=b&&k.push([D])}return k}(a,s,u,p);case 2:return pT(a,s,u,p,!1);case 3:return pT(a,s,u,p,!0)}return[]}function vj(a,n,s,u,p){const y=u===0?xj:bj;let _=[];const b=[];for(let I=0;I<a.length-1;I++){const D=a[I],N=a[I+1],z=u===0?D.x:D.y,V=u===0?N.x:N.y;let U=!1;z<n?V>n&&_.push(y(D,N,n)):z>s?V<s&&_.push(y(D,N,s)):_.push(D),V<n&&z>=n&&(_.push(y(D,N,n)),U=!0),V>s&&z<=s&&(_.push(y(D,N,s)),U=!0),!p&&U&&(b.push(_),_=[])}const T=a.length-1,k=u===0?a[T].x:a[T].y;return k>=n&&k<=s&&_.push(a[T]),p&&_.length>0&&!_[0].equals(_[_.length-1])&&_.push(new E(_[0].x,_[0].y)),_.length>0&&b.push(_),b}function pT(a,n,s,u,p){const y=[];for(const _ of a){const b=vj(_,n,s,u,p);b.length>0&&y.push(...b)}return y}function xj(a,n,s){return new E(s,a.y+(s-a.x)/(n.x-a.x)*(n.y-a.y))}function bj(a,n,s){return new E(a.x+(s-a.y)/(n.y-a.y)*(n.x-a.x),s)}dt("FeatureIndex",cT,{omit:["rawTileData","sourceLayerCoder"]});class Zo extends E{constructor(n,s,u,p){super(n,s),this.angle=u,p!==void 0&&(this.segment=p)}clone(){return new Zo(this.x,this.y,this.angle,this.segment)}}function fT(a,n,s,u,p){if(n.segment===void 0||s===0)return!0;let y=n,_=n.segment+1,b=0;for(;b>-s/2;){if(_--,_<0)return!1;b-=a[_].dist(y),y=a[_]}b+=a[_].dist(a[_+1]),_++;const T=[];let k=0;for(;b<s/2;){const I=a[_],D=a[_+1];if(!D)return!1;let N=a[_-1].angleTo(I)-I.angleTo(D);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:N}),k+=N;b-T[0].distance>u;)k-=T.shift().angleDelta;if(k>p)return!1;_++,b+=I.dist(D)}return!0}function mT(a){let n=0;for(let s=0;s<a.length-1;s++)n+=a[s].dist(a[s+1]);return n}function gT(a,n,s){return a?.6*n*s:0}function yT(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function wj(a,n,s,u,p,y){const _=gT(s,p,y),b=yT(s,u)*y;let T=0;const k=mT(a)/2;for(let I=0;I<a.length-1;I++){const D=a[I],N=a[I+1],z=D.dist(N);if(T+z>k){const V=(k-T)/z,U=Rn.number(D.x,N.x,V),q=Rn.number(D.y,N.y,V),ee=new Zo(U,q,N.angleTo(D),I);return ee._round(),!_||fT(a,ee,b,_,n)?ee:void 0}T+=z}}function Sj(a,n,s,u,p,y,_,b,T){const k=gT(u,y,_),I=yT(u,p),D=I*_,N=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return n-D<n/4&&(n=D+n/4),_T(a,N?n/2*b%n:(I/2+2*y)*_*b%n,n,k,s,D,N,!1,T)}function _T(a,n,s,u,p,y,_,b,T){const k=y/2,I=mT(a);let D=0,N=n-s,z=[];for(let V=0;V<a.length-1;V++){const U=a[V],q=a[V+1],ee=U.dist(q),ue=q.angleTo(U);for(;N+s<D+ee;){N+=s;const ne=(N-D)/ee,ie=Rn.number(U.x,q.x,ne),de=Rn.number(U.y,q.y,ne);if(ie>=0&&ie<T&&de>=0&&de<T&&N-k>=0&&N+k<=I){const me=new Zo(ie,de,ue,V);me._round(),u&&!fT(a,me,y,u,p)||z.push(me)}}D+=ee}return b||z.length||_||(z=_T(a,D/2,s,u,p,y,_,!0,T)),z}function vT(a,n,s,u){const p=[],y=a.image,_=y.pixelRatio,b=y.paddedRect.w-2,T=y.paddedRect.h-2;let k={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const I=y.stretchX||[[0,b]],D=y.stretchY||[[0,T]],N=(Ne,ht)=>Ne+ht[1]-ht[0],z=I.reduce(N,0),V=D.reduce(N,0),U=b-z,q=T-V;let ee=0,ue=z,ne=0,ie=V,de=0,me=U,Ae=0,$e=q;if(y.content&&u){const Ne=y.content,ht=Ne[2]-Ne[0],ct=Ne[3]-Ne[1];(y.textFitWidth||y.textFitHeight)&&(k=fS(a)),ee=gg(I,0,Ne[0]),ne=gg(D,0,Ne[1]),ue=gg(I,Ne[0],Ne[2]),ie=gg(D,Ne[1],Ne[3]),de=Ne[0]-ee,Ae=Ne[1]-ne,me=ht-ue,$e=ct-ie}const Fe=k.x1,Ze=k.y1,rt=k.x2-Fe,Ke=k.y2-Ze,Ve=(Ne,ht,ct,pt)=>{const ot=yg(Ne.stretch-ee,ue,rt,Fe),vt=_g(Ne.fixed-de,me,Ne.stretch,z),Qt=yg(ht.stretch-ne,ie,Ke,Ze),Ht=_g(ht.fixed-Ae,$e,ht.stretch,V),Nn=yg(ct.stretch-ee,ue,rt,Fe),Kr=_g(ct.fixed-de,me,ct.stretch,z),fr=yg(pt.stretch-ne,ie,Ke,Ze),Ln=_g(pt.fixed-Ae,$e,pt.stretch,V),An=new E(ot,Qt),on=new E(Nn,Qt),Wn=new E(Nn,fr),nr=new E(ot,fr),Tn=new E(vt/_,Ht/_),Di=new E(Kr/_,Ln/_),Xr=n*Math.PI/180;if(Xr){const Mr=Math.sin(Xr),Fn=Math.cos(Xr),mr=[Fn,-Mr,Mr,Fn];An._matMult(mr),on._matMult(mr),nr._matMult(mr),Wn._matMult(mr)}const ji=Ne.stretch+Ne.fixed,Cs=ht.stretch+ht.fixed;return{tl:An,tr:on,bl:nr,br:Wn,tex:{x:y.paddedRect.x+1+ji,y:y.paddedRect.y+1+Cs,w:ct.stretch+ct.fixed-ji,h:pt.stretch+pt.fixed-Cs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Tn,pixelOffsetBR:Di,minFontScaleX:me/_/rt,minFontScaleY:$e/_/Ke,isSDF:s}};if(u&&(y.stretchX||y.stretchY)){const Ne=xT(I,U,z),ht=xT(D,q,V);for(let ct=0;ct<Ne.length-1;ct++){const pt=Ne[ct],ot=Ne[ct+1];for(let vt=0;vt<ht.length-1;vt++)p.push(Ve(pt,ht[vt],ot,ht[vt+1]))}}else p.push(Ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return p}function gg(a,n,s){let u=0;for(const p of a)u+=Math.max(n,Math.min(s,p[1]))-Math.max(n,Math.min(s,p[0]));return u}function xT(a,n,s){const u=[{fixed:-1,stretch:0}];for(const[p,y]of a){const _=u[u.length-1];u.push({fixed:p-_.stretch,stretch:_.stretch}),u.push({fixed:p-_.stretch,stretch:_.stretch+(y-p)})}return u.push({fixed:n+1,stretch:s}),u}function yg(a,n,s,u){return a/n*s+u}function _g(a,n,s,u){return a-n*s/u}dt("Anchor",Zo);class vg{constructor(n,s,u,p,y,_,b,T,k,I){var D;if(this.boxStartIndex=n.length,k){let N=_.top,z=_.bottom;const V=_.collisionPadding;V&&(N-=V[1],z+=V[3]);let U=z-N;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const N=!((D=_.image)===null||D===void 0)&&D.content&&(_.image.textFitWidth||_.image.textFitHeight)?fS(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};N.y1=N.y1*b-T[0],N.y2=N.y2*b+T[2],N.x1=N.x1*b-T[3],N.x2=N.x2*b+T[1];const z=_.collisionPadding;if(z&&(N.x1-=z[0]*b,N.y1-=z[1]*b,N.x2+=z[2]*b,N.y2+=z[3]*b),I){const V=new E(N.x1,N.y1),U=new E(N.x2,N.y1),q=new E(N.x1,N.y2),ee=new E(N.x2,N.y2),ue=I*Math.PI/180;V._rotate(ue),U._rotate(ue),q._rotate(ue),ee._rotate(ue),N.x1=Math.min(V.x,U.x,q.x,ee.x),N.x2=Math.max(V.x,U.x,q.x,ee.x),N.y1=Math.min(V.y,U.y,q.y,ee.y),N.y2=Math.max(V.y,U.y,q.y,ee.y)}n.emplaceBack(s.x,s.y,N.x1,N.y1,N.x2,N.y2,u,p,y)}this.boxEndIndex=n.length}}class Tj{constructor(n=[],s=(u,p)=>u<p?-1:u>p?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:u}=this,p=s[n];for(;n>0;){const y=n-1>>1,_=s[y];if(u(p,_)>=0)break;s[n]=_,n=y}s[n]=p}_down(n){const{data:s,compare:u}=this,p=this.length>>1,y=s[n];for(;n<p;){let _=1+(n<<1);const b=_+1;if(b<this.length&&u(s[b],s[_])<0&&(_=b),u(s[_],y)>=0)break;s[n]=s[_],n=_}s[n]=y}}function Ej(a,n=1,s=!1){const u=mc.fromPoints(a[0]),p=Math.min(u.width(),u.height());let y=p/2;const _=new Tj([],Pj),{minX:b,minY:T,maxX:k,maxY:I}=u;if(p===0)return new E(b,T);for(let z=b;z<k;z+=p)for(let V=T;V<I;V+=p)_.push(new th(z+y,V+y,y,a));let D=function(z){let V=0,U=0,q=0;const ee=z[0];for(let ue=0,ne=ee.length,ie=ne-1;ue<ne;ie=ue++){const de=ee[ue],me=ee[ie],Ae=de.x*me.y-me.x*de.y;U+=(de.x+me.x)*Ae,q+=(de.y+me.y)*Ae,V+=3*Ae}return new th(U/V,q/V,0,z)}(a),N=_.length;for(;_.length;){const z=_.pop();(z.d>D.d||!D.d)&&(D=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,N)),z.max-D.d<=n||(y=z.h/2,_.push(new th(z.p.x-y,z.p.y-y,y,a)),_.push(new th(z.p.x+y,z.p.y-y,y,a)),_.push(new th(z.p.x-y,z.p.y+y,y,a)),_.push(new th(z.p.x+y,z.p.y+y,y,a)),N+=4)}return s&&(console.log(`num probes: ${N}`),console.log(`best distance: ${D.d}`)),D.p}function Pj(a,n){return n.max-a.max}function th(a,n,s,u){this.p=new E(a,n),this.h=s,this.d=function(p,y){let _=!1,b=1/0;for(let T=0;T<y.length;T++){const k=y[T];for(let I=0,D=k.length,N=D-1;I<D;N=I++){const z=k[I],V=k[N];z.y>p.y!=V.y>p.y&&p.x<(V.x-z.x)*(p.y-z.y)/(V.y-z.y)+z.x&&(_=!_),b=Math.min(b,E1(p,z,V))}}return(_?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var Hr;f.aP=void 0,(Hr=f.aP||(f.aP={}))[Hr.center=1]="center",Hr[Hr.left=2]="left",Hr[Hr.right=3]="right",Hr[Hr.top=4]="top",Hr[Hr.bottom=5]="bottom",Hr[Hr["top-left"]=6]="top-left",Hr[Hr["top-right"]=7]="top-right",Hr[Hr["bottom-left"]=8]="bottom-left",Hr[Hr["bottom-right"]=9]="bottom-right";const Wv=Number.POSITIVE_INFINITY;function bT(a,n){return n[1]!==Wv?function(s,u,p){let y=0,_=0;switch(u=Math.abs(u),p=Math.abs(p),s){case"top-right":case"top-left":case"top":_=p-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-p}switch(s){case"top-right":case"bottom-right":case"right":y=-u;break;case"top-left":case"bottom-left":case"left":y=u}return[y,_]}(a,n[0],n[1]):function(s,u){let p=0,y=0;u<0&&(u=0);const _=u/Math.SQRT2;switch(s){case"top-right":case"top-left":y=_-7;break;case"bottom-right":case"bottom-left":y=7-_;break;case"bottom":y=7-u;break;case"top":y=u-7}switch(s){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=u;break;case"right":p=-u}return[p,y]}(a,n[0])}function wT(a,n,s){var u;const p=a.layout,y=(u=p.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(n,{},s);if(y){const b=y.values,T=[];for(let k=0;k<b.length;k+=2){const I=T[k]=b[k],D=b[k+1].map(N=>N*kr);I.startsWith("top")?D[1]-=7:I.startsWith("bottom")&&(D[1]+=7),T[k+1]=D}return new ii(T)}const _=p.get("text-variable-anchor");if(_){let b;b=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(n,{},s)*kr,Wv]:p.get("text-offset").evaluate(n,{},s).map(k=>k*kr);const T=[];for(const k of _)T.push(k,bT(k,b));return new ii(T)}return null}function Zv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cj(a,n,s,u,p,y,_,b,T,k,I,D){let N=y.textMaxSize.evaluate(n,{});N===void 0&&(N=_);const z=a.layers[0].layout,V=z.get("icon-offset").evaluate(n,{},I),U=TT(s.horizontal),q=_/24,ee=a.tilePixelRatio*q,ue=a.tilePixelRatio*N/24,ne=a.tilePixelRatio*b,ie=a.tilePixelRatio*z.get("symbol-spacing"),de=z.get("text-padding")*a.tilePixelRatio,me=function(ct,pt,ot,vt=1){const Qt=ct.get("icon-padding").evaluate(pt,{},ot),Ht=Qt&&Qt.values;return[Ht[0]*vt,Ht[1]*vt,Ht[2]*vt,Ht[3]*vt]}(z,n,I,a.tilePixelRatio),Ae=z.get("text-max-angle")/180*Math.PI,$e=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",Fe=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ze=z.get("symbol-placement"),rt=ie/2,Ke=z.get("icon-text-fit");let Ve;u&&Ke!=="none"&&(a.allowVerticalPlacement&&s.vertical&&(Ve=mS(u,s.vertical,Ke,z.get("icon-text-fit-padding"),V,q)),U&&(u=mS(u,U,Ke,z.get("icon-text-fit-padding"),V,q)));const Ne=I?D.line.getGranularityForZoomLevel(I.z):1,ht=(ct,pt)=>{pt.x<0||pt.x>=Pe||pt.y<0||pt.y>=Pe||function(ot,vt,Qt,Ht,Nn,Kr,fr,Ln,An,on,Wn,nr,Tn,Di,Xr,ji,Cs,Mr,Fn,mr,Zn,Rr,Xa,Gs,wp){const Ho=ot.addToLineVertexArray(vt,Qt);let _c,nh,rh,ih,kT=0,AT=0,IT=0,MT=0,t0=-1,n0=-1;const Ya={};let RT=tr("");if(ot.allowVerticalPlacement&&Ht.vertical){const li=Ln.layout.get("text-rotate").evaluate(Zn,{},Gs)+90;rh=new vg(An,vt,on,Wn,nr,Ht.vertical,Tn,Di,Xr,li),fr&&(ih=new vg(An,vt,on,Wn,nr,fr,Cs,Mr,Xr,li))}if(Nn){const li=Ln.layout.get("icon-rotate").evaluate(Zn,{}),us=Ln.layout.get("icon-text-fit")!=="none",vc=vT(Nn,li,Xa,us),Ws=fr?vT(fr,li,Xa,us):void 0;nh=new vg(An,vt,on,Wn,nr,Nn,Cs,Mr,!1,li),kT=4*vc.length;const xc=ot.iconSizeData;let _a=null;xc.kind==="source"?(_a=[Ha*Ln.layout.get("icon-size").evaluate(Zn,{})],_a[0]>Go&&ir(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):xc.kind==="composite"&&(_a=[Ha*Rr.compositeIconSizes[0].evaluate(Zn,{},Gs),Ha*Rr.compositeIconSizes[1].evaluate(Zn,{},Gs)],(_a[0]>Go||_a[1]>Go)&&ir(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,vc,_a,mr,Fn,Zn,f.az.none,vt,Ho.lineStartIndex,Ho.lineLength,-1,Gs),t0=ot.icon.placedSymbolArray.length-1,Ws&&(AT=4*Ws.length,ot.addSymbols(ot.icon,Ws,_a,mr,Fn,Zn,f.az.vertical,vt,Ho.lineStartIndex,Ho.lineLength,-1,Gs),n0=ot.icon.placedSymbolArray.length-1)}const DT=Object.keys(Ht.horizontal);for(const li of DT){const us=Ht.horizontal[li];if(!_c){RT=tr(us.text);const Ws=Ln.layout.get("text-rotate").evaluate(Zn,{},Gs);_c=new vg(An,vt,on,Wn,nr,us,Tn,Di,Xr,Ws)}const vc=us.positionedLines.length===1;if(IT+=ST(ot,vt,us,Kr,Ln,Xr,Zn,ji,Ho,Ht.vertical?f.az.horizontal:f.az.horizontalOnly,vc?DT:[li],Ya,t0,Rr,Gs),vc)break}Ht.vertical&&(MT+=ST(ot,vt,Ht.vertical,Kr,Ln,Xr,Zn,ji,Ho,f.az.vertical,["vertical"],Ya,n0,Rr,Gs));const Ij=_c?_c.boxStartIndex:ot.collisionBoxArray.length,Mj=_c?_c.boxEndIndex:ot.collisionBoxArray.length,Rj=rh?rh.boxStartIndex:ot.collisionBoxArray.length,Dj=rh?rh.boxEndIndex:ot.collisionBoxArray.length,jj=nh?nh.boxStartIndex:ot.collisionBoxArray.length,Nj=nh?nh.boxEndIndex:ot.collisionBoxArray.length,Lj=ih?ih.boxStartIndex:ot.collisionBoxArray.length,zj=ih?ih.boxEndIndex:ot.collisionBoxArray.length;let qs=-1;const bg=(li,us)=>li&&li.circleDiameter?Math.max(li.circleDiameter,us):us;qs=bg(_c,qs),qs=bg(rh,qs),qs=bg(nh,qs),qs=bg(ih,qs);const jT=qs>-1?1:0;jT&&(qs*=wp/kr),ot.glyphOffsetArray.length>=Ku.MAX_GLYPHS&&ir("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,Zn.sortKey);const Oj=wT(Ln,Zn,Gs),[Fj,Bj]=function(li,us){const vc=li.length,Ws=us==null?void 0:us.values;if((Ws==null?void 0:Ws.length)>0)for(let xc=0;xc<Ws.length;xc+=2){const _a=Ws[xc+1];li.emplaceBack(f.aP[Ws[xc]],_a[0],_a[1])}return[vc,li.length]}(ot.textAnchorOffsets,Oj);ot.symbolInstances.emplaceBack(vt.x,vt.y,Ya.right>=0?Ya.right:-1,Ya.center>=0?Ya.center:-1,Ya.left>=0?Ya.left:-1,Ya.vertical||-1,t0,n0,RT,Ij,Mj,Rj,Dj,jj,Nj,Lj,zj,on,IT,MT,kT,AT,jT,0,Tn,qs,Fj,Bj)}(a,pt,ct,s,u,p,Ve,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,ee,[de,de,de,de],$e,T,ne,me,Fe,V,n,y,k,I,_)};if(Ze==="line")for(const ct of hT(n.geometry,0,0,Pe,Pe)){const pt=fc(ct,Ne),ot=Sj(pt,ie,Ae,s.vertical||U,u,24,ue,a.overscaling,Pe);for(const vt of ot)U&&kj(a,U.text,rt,vt)||ht(pt,vt)}else if(Ze==="line-center"){for(const ct of n.geometry)if(ct.length>1){const pt=fc(ct,Ne),ot=wj(pt,Ae,s.vertical||U,u,24,ue);ot&&ht(pt,ot)}}else if(n.type==="Polygon")for(const ct of cu(n.geometry,0)){const pt=Ej(ct,16);ht(fc(ct[0],Ne,!0),new Zo(pt.x,pt.y,0))}else if(n.type==="LineString")for(const ct of n.geometry){const pt=fc(ct,Ne);ht(pt,new Zo(pt[0].x,pt[0].y,0))}else if(n.type==="Point")for(const ct of n.geometry)for(const pt of ct)ht([pt],new Zo(pt.x,pt.y,0))}function ST(a,n,s,u,p,y,_,b,T,k,I,D,N,z,V){const U=function(ue,ne,ie,de,me,Ae,$e,Fe){const Ze=de.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,rt=[];for(const Ke of ne.positionedLines)for(const Ve of Ke.positionedGlyphs){if(!Ve.rect)continue;const Ne=Ve.rect||{};let ht=4,ct=!0,pt=1,ot=0;const vt=(me||Fe)&&Ve.vertical,Qt=Ve.metrics.advance*Ve.scale/2;if(Fe&&ne.verticalizable&&(ot=Ke.lineOffset/2-(Ve.imageName?-(kr-Ve.metrics.width*Ve.scale)/2:(Ve.scale-1)*kr)),Ve.imageName){const Mr=$e[Ve.imageName];ct=Mr.sdf,pt=Mr.pixelRatio,ht=1/pt}const Ht=me?[Ve.x+Qt,Ve.y]:[0,0];let Nn=me?[0,0]:[Ve.x+Qt+ie[0],Ve.y+ie[1]-ot],Kr=[0,0];vt&&(Kr=Nn,Nn=[0,0]);const fr=Ve.metrics.isDoubleResolution?2:1,Ln=(Ve.metrics.left-ht)*Ve.scale-Qt+Nn[0],An=(-Ve.metrics.top-ht)*Ve.scale+Nn[1],on=Ln+Ne.w/fr*Ve.scale/pt,Wn=An+Ne.h/fr*Ve.scale/pt,nr=new E(Ln,An),Tn=new E(on,An),Di=new E(Ln,Wn),Xr=new E(on,Wn);if(vt){const Mr=new E(-Qt,Qt- -17),Fn=-Math.PI/2,mr=12-Qt,Zn=new E(22-mr,-(Ve.imageName?mr:0)),Rr=new E(...Kr);nr._rotateAround(Fn,Mr)._add(Zn)._add(Rr),Tn._rotateAround(Fn,Mr)._add(Zn)._add(Rr),Di._rotateAround(Fn,Mr)._add(Zn)._add(Rr),Xr._rotateAround(Fn,Mr)._add(Zn)._add(Rr)}if(Ze){const Mr=Math.sin(Ze),Fn=Math.cos(Ze),mr=[Fn,-Mr,Mr,Fn];nr._matMult(mr),Tn._matMult(mr),Di._matMult(mr),Xr._matMult(mr)}const ji=new E(0,0),Cs=new E(0,0);rt.push({tl:nr,tr:Tn,bl:Di,br:Xr,tex:Ne,writingMode:ne.writingMode,glyphOffset:Ht,sectionIndex:Ve.sectionIndex,isSDF:ct,pixelOffsetTL:ji,pixelOffsetBR:Cs,minFontScaleX:0,minFontScaleY:0})}return rt}(0,s,b,p,y,_,u,a.allowVerticalPlacement),q=a.textSizeData;let ee=null;q.kind==="source"?(ee=[Ha*p.layout.get("text-size").evaluate(_,{})],ee[0]>Go&&ir(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(ee=[Ha*z.compositeTextSizes[0].evaluate(_,{},V),Ha*z.compositeTextSizes[1].evaluate(_,{},V)],(ee[0]>Go||ee[1]>Go)&&ir(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,U,ee,b,y,_,k,n,T.lineStartIndex,T.lineLength,N,V);for(const ue of I)D[ue]=a.text.placedSymbolArray.length-1;return 4*U.length}function TT(a){for(const n in a)return a[n];return null}function kj(a,n,s,u){const p=a.compareText;if(n in p){const y=p[n];for(let _=y.length-1;_>=0;_--)if(u.dist(y[_])<s)return!0}else p[n]=[];return p[n].push(u),!1}const ET=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hv{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=u>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=ET[15&u];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(n,2,1),[b]=new Uint32Array(n,4,1);return new Hv(b,_,y,n)}constructor(n,s=64,u=Float64Array,p){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const y=ET.indexOf(this.ArrayType),_=2*n*this.ArrayType.BYTES_PER_ELEMENT,b=n*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${u}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+T,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+_+b+T),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+T,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=s,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Kv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:b}=this,T=[0,y.length-1,0],k=[];for(;T.length;){const I=T.pop()||0,D=T.pop()||0,N=T.pop()||0;if(D-N<=b){for(let q=N;q<=D;q++){const ee=_[2*q],ue=_[2*q+1];ee>=n&&ee<=u&&ue>=s&&ue<=p&&k.push(y[q])}continue}const z=N+D>>1,V=_[2*z],U=_[2*z+1];V>=n&&V<=u&&U>=s&&U<=p&&k.push(y[z]),(I===0?n<=V:s<=U)&&(T.push(N),T.push(z-1),T.push(1-I)),(I===0?u>=V:p>=U)&&(T.push(z+1),T.push(D),T.push(1-I))}return k}within(n,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:_}=this,b=[0,p.length-1,0],T=[],k=u*u;for(;b.length;){const I=b.pop()||0,D=b.pop()||0,N=b.pop()||0;if(D-N<=_){for(let q=N;q<=D;q++)CT(y[2*q],y[2*q+1],n,s)<=k&&T.push(p[q]);continue}const z=N+D>>1,V=y[2*z],U=y[2*z+1];CT(V,U,n,s)<=k&&T.push(p[z]),(I===0?n-u<=V:s-u<=U)&&(b.push(N),b.push(z-1),b.push(1-I)),(I===0?n+u>=V:s+u>=U)&&(b.push(z+1),b.push(D),b.push(1-I))}return T}}function Kv(a,n,s,u,p,y){if(p-u<=s)return;const _=u+p>>1;PT(a,n,_,u,p,y),Kv(a,n,s,u,_-1,1-y),Kv(a,n,s,_+1,p,1-y)}function PT(a,n,s,u,p,y){for(;p>u;){if(p-u>600){const k=p-u+1,I=s-u+1,D=Math.log(k),N=.5*Math.exp(2*D/3),z=.5*Math.sqrt(D*N*(k-N)/k)*(I-k/2<0?-1:1);PT(a,n,s,Math.max(u,Math.floor(s-I*N/k+z)),Math.min(p,Math.floor(s+(k-I)*N/k+z)),y)}const _=n[2*s+y];let b=u,T=p;for(xp(a,n,u,s),n[2*p+y]>_&&xp(a,n,u,p);b<T;){for(xp(a,n,b,T),b++,T--;n[2*b+y]<_;)b++;for(;n[2*T+y]>_;)T--}n[2*u+y]===_?xp(a,n,u,T):(T++,xp(a,n,T,p)),T<=s&&(u=T+1),s<=T&&(p=T-1)}}function xp(a,n,s,u){Xv(a,s,u),Xv(n,2*s,2*u),Xv(n,2*s+1,2*u+1)}function Xv(a,n,s){const u=a[n];a[n]=a[s],a[s]=u}function CT(a,n,s,u){const p=a-s,y=n-u;return p*p+y*y}var Yv;f.cH=void 0,(Yv=f.cH||(f.cH={})).create="create",Yv.load="load",Yv.fullLoad="fullLoad";let xg=null,bp=[];const Jv=1e3/60,Qv="loadTime",e0="fullLoadTime",Aj={mark(a){performance.mark(a)},frame(a){const n=a;xg!=null&&bp.push(n-xg),xg=n},clearMetrics(){xg=null,bp=[],performance.clearMeasures(Qv),performance.clearMeasures(e0);for(const a in f.cH)performance.clearMarks(f.cH[a])},getPerformanceMetrics(){performance.measure(Qv,f.cH.create,f.cH.load),performance.measure(e0,f.cH.create,f.cH.fullLoad);const a=performance.getEntriesByName(Qv)[0].duration,n=performance.getEntriesByName(e0)[0].duration,s=bp.length,u=1/(bp.reduce((y,_)=>y+_,0)/s/1e3),p=bp.filter(y=>y>Jv).reduce((y,_)=>y+(_-Jv)/Jv,0);return{loadTime:a,fullLoadTime:n,fps:u,percentDroppedFrames:p/(s+p)*100,totalFrames:s}}};f.$=G,f.A=Q,f.B=Oo,f.C=Pr,f.D=_t,f.E=nn,f.F=function([a,n,s]){return n+=90,n*=Math.PI/180,s*=Math.PI/180,{x:a*Math.cos(n)*Math.sin(s),y:a*Math.sin(n)*Math.sin(s),z:a*Math.cos(s)}},f.G=Rn,f.H=pn,f.I=xv,f.J=Om,f.K=function(a){if(In==null){const n=a.navigator?a.navigator.userAgent:null;In=!!a.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return In},f.L=class{constructor(a,n){this.target=a,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new GD(()=>this.process()),this.subscription=Lr(this.target,"message",s=>this.receive(s),!1),this.globalScope=Fi(self)?a:window}registerMessageHandler(a,n){this.messageHandlers[a]=n}unregisterMessageHandler(a){delete this.messageHandlers[a]}sendAsync(a,n){return new Promise((s,u)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=n?Lr(n.signal,"abort",()=>{y==null||y.unsubscribe(),delete this.resolveRejects[p];const T={id:p,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},qD):null;this.resolveRejects[p]={resolve:T=>{y==null||y.unsubscribe(),s(T)},reject:T=>{y==null||y.unsubscribe(),u(T)}};const _=[],b=Object.assign(Object.assign({},a),{id:p,sourceMapId:this.mapId,origin:location.origin,data:ec(a.data,_)});this.target.postMessage(b,{transfer:_})})}receive(a){const n=a.data,s=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[s];const u=this.abortControllers[s];return delete this.abortControllers[s],void(u&&u.abort())}if(Fi(self)||n.mustQueue)return this.tasks[s]=n,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,n)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),n=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(a,n)}processTask(a,n){return c(this,void 0,void 0,function*(){if(n.type==="<response>"){const p=this.resolveRejects[a];return delete this.resolveRejects[a],p?void(n.error?p.reject(tc(n.error)):p.resolve(tc(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=tc(n.data),u=new AbortController;this.abortControllers[a]=u;try{const p=yield this.messageHandlers[n.type](n.sourceMapId,s,u);this.completeTask(a,null,p)}catch(p){this.completeTask(a,p)}})}completeTask(a,n,s){const u=[];delete this.abortControllers[a];const p={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?ec(n):null,data:ec(s,u)};this.target.postMessage(p,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.M=ke,f.N=function(){var a=new Q(16);return Q!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},f.O=function(a,n,s){var u,p,y,_,b,T,k,I,D,N,z,V,U=s[0],q=s[1],ee=s[2];return n===a?(a[12]=n[0]*U+n[4]*q+n[8]*ee+n[12],a[13]=n[1]*U+n[5]*q+n[9]*ee+n[13],a[14]=n[2]*U+n[6]*q+n[10]*ee+n[14],a[15]=n[3]*U+n[7]*q+n[11]*ee+n[15]):(p=n[1],y=n[2],_=n[3],b=n[4],T=n[5],k=n[6],I=n[7],D=n[8],N=n[9],z=n[10],V=n[11],a[0]=u=n[0],a[1]=p,a[2]=y,a[3]=_,a[4]=b,a[5]=T,a[6]=k,a[7]=I,a[8]=D,a[9]=N,a[10]=z,a[11]=V,a[12]=u*U+b*q+D*ee+n[12],a[13]=p*U+T*q+N*ee+n[13],a[14]=y*U+k*q+z*ee+n[14],a[15]=_*U+I*q+V*ee+n[15]),a},f.P=E,f.Q=function(a,n,s){var u=s[0],p=s[1],y=s[2];return a[0]=n[0]*u,a[1]=n[1]*u,a[2]=n[2]*u,a[3]=n[3]*u,a[4]=n[4]*p,a[5]=n[5]*p,a[6]=n[6]*p,a[7]=n[7]*p,a[8]=n[8]*y,a[9]=n[9]*y,a[10]=n[10]*y,a[11]=n[11]*y,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},f.R=Ri,f.S=function(a,n,s){var u=n[0],p=n[1],y=n[2],_=n[3],b=n[4],T=n[5],k=n[6],I=n[7],D=n[8],N=n[9],z=n[10],V=n[11],U=n[12],q=n[13],ee=n[14],ue=n[15],ne=s[0],ie=s[1],de=s[2],me=s[3];return a[0]=ne*u+ie*b+de*D+me*U,a[1]=ne*p+ie*T+de*N+me*q,a[2]=ne*y+ie*k+de*z+me*ee,a[3]=ne*_+ie*I+de*V+me*ue,a[4]=(ne=s[4])*u+(ie=s[5])*b+(de=s[6])*D+(me=s[7])*U,a[5]=ne*p+ie*T+de*N+me*q,a[6]=ne*y+ie*k+de*z+me*ee,a[7]=ne*_+ie*I+de*V+me*ue,a[8]=(ne=s[8])*u+(ie=s[9])*b+(de=s[10])*D+(me=s[11])*U,a[9]=ne*p+ie*T+de*N+me*q,a[10]=ne*y+ie*k+de*z+me*ee,a[11]=ne*_+ie*I+de*V+me*ue,a[12]=(ne=s[12])*u+(ie=s[13])*b+(de=s[14])*D+(me=s[15])*U,a[13]=ne*p+ie*T+de*N+me*q,a[14]=ne*y+ie*k+de*z+me*ee,a[15]=ne*_+ie*I+de*V+me*ue,a},f.T=hv,f.U=function(a,n){const s={};for(let u=0;u<n.length;u++){const p=n[u];p in a&&(s[p]=a[p])}return s},f.V=qo,f.W=Yn,f.X=TS,f.Y=SS,f.Z=ye,f._=c,f.a=re,f.a$=Je,f.a0=J,f.a1=Dt,f.a2=ls,f.a3=PS,f.a4=lg,f.a5=Pe,f.a6=function(a,n,s){if(!a)return n||{};if(!n)return a||{};const u=IS(a),p=IS(n);(function(_,b){b.removeAll&&(_.add.clear(),_.update.clear(),_.remove.clear(),b.remove.clear());for(const T of b.remove)_.add.delete(T),_.update.delete(T);for(const[T,k]of b.update){const I=_.update.get(T);I&&(b.update.set(T,WD(I,k)),_.update.delete(T))}})(u,p);const y={};if((u.removeAll||p.removeAll)&&(y.removeAll=!0),y.remove=new Set([...u.remove,...p.remove]),y.add=new Map([...u.add,...p.add]),y.update=new Map([...u.update,...p.update]),y.remove.size&&y.add.size)for(const _ of y.add.keys())y.remove.delete(_);return function(_){const b={};return _.removeAll&&(b.removeAll=_.removeAll),_.remove&&(b.remove=Array.from(_.remove)),_.add&&(b.add=Array.from(_.add.values())),_.update&&(b.update=Array.from(_.update.values())),b}(y)},f.a7=function(a,n){const s=new Map;if(a==null||a.type==null)return s;if(a.type==="Feature"){const u=Av(a,n);return u==null?void 0:(s.set(u,a),s)}if(a.type==="FeatureCollection"){const u=new Set;for(const p of a.features){const y=Av(p,n);if(y==null||u.has(y))return;u.add(y),s.set(y,p)}return s}},f.a8=function(a,n,s){var u,p;const y=[];if(n.removeAll)a.clear();else if(n.remove)for(const _ of n.remove){const b=a.get(_);b&&(y.push(b.geometry),a.delete(_))}if(n.add)for(const _ of n.add){const b=Av(_,s);if(b==null)continue;const T=a.get(b);T&&y.push(T.geometry),y.push(_.geometry),a.set(b,_)}if(n.update)for(const _ of n.update){const b=a.get(_.id);if(!b)continue;const T=!!_.newGeometry,k=_.removeAllProperties||((u=_.removeProperties)===null||u===void 0?void 0:u.length)>0||((p=_.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0;if(!T&&!k)continue;y.push(b.geometry);const I=Object.assign({},b);if(a.set(_.id,I),T&&(y.push(_.newGeometry),I.geometry=_.newGeometry),k){if(I.properties=_.removeAllProperties?{}:Object.assign({},I.properties||{}),_.removeProperties)for(const D of _.removeProperties)delete I.properties[D];if(_.addOrUpdateProperties)for(const{key:D,value:N}of _.addOrUpdateProperties)I.properties[D]=N}}return y},f.a9=gp,f.aA=function(a,{uSize:n,uSizeT:s},{lowerSize:u,upperSize:p}){return a.kind==="source"?u/Ha:a.kind==="composite"?Rn.number(u/Ha,p/Ha,s):n},f.aB=function(a,n){var s=n[0],u=n[1],p=n[2],y=n[3],_=n[4],b=n[5],T=n[6],k=n[7],I=n[8],D=n[9],N=n[10],z=n[11],V=n[12],U=n[13],q=n[14],ee=n[15],ue=s*b-u*_,ne=s*T-p*_,ie=s*k-y*_,de=u*T-p*b,me=u*k-y*b,Ae=p*k-y*T,$e=I*U-D*V,Fe=I*q-N*V,Ze=I*ee-z*V,rt=D*q-N*U,Ke=D*ee-z*U,Ve=N*ee-z*q,Ne=ue*Ve-ne*Ke+ie*rt+de*Ze-me*Fe+Ae*$e;return Ne?(a[0]=(b*Ve-T*Ke+k*rt)*(Ne=1/Ne),a[1]=(p*Ke-u*Ve-y*rt)*Ne,a[2]=(U*Ae-q*me+ee*de)*Ne,a[3]=(N*me-D*Ae-z*de)*Ne,a[4]=(T*Ze-_*Ve-k*Fe)*Ne,a[5]=(s*Ve-p*Ze+y*Fe)*Ne,a[6]=(q*ie-V*Ae-ee*ne)*Ne,a[7]=(I*Ae-N*ie+z*ne)*Ne,a[8]=(_*Ke-b*Ze+k*$e)*Ne,a[9]=(u*Ze-s*Ke-y*$e)*Ne,a[10]=(V*me-U*ie+ee*ue)*Ne,a[11]=(D*ie-I*me-z*ue)*Ne,a[12]=(b*Fe-_*rt-T*$e)*Ne,a[13]=(s*rt-u*Fe+p*$e)*Ne,a[14]=(U*ne-V*de-q*ue)*Ne,a[15]=(I*de-D*ne+N*ue)*Ne,a):null},f.aC=bt,f.aD=function(a){var n=a[0],s=a[1];return Math.sqrt(n*n+s*s)},f.aE=function(a){return a[0]=0,a[1]=0,a},f.aF=function(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a},f.aG=Sv,f.aH=gt,f.aI=function(a,n,s,u){const p=n.y-a.y,y=n.x-a.x,_=u.y-s.y,b=u.x-s.x,T=_*y-b*p;if(T===0)return null;const k=(b*(a.y-s.y)-_*(a.x-s.x))/T;return new E(a.x+k*y,a.y+k*p)},f.aJ=hT,f.aK=Vu,f.aL=function(a){let n=1/0,s=1/0,u=-1/0,p=-1/0;for(const y of a)n=Math.min(n,y.x),s=Math.min(s,y.y),u=Math.max(u,y.x),p=Math.max(p,y.y);return[n,s,u,p]},f.aM=kr,f.aN=at,f.aO=function(a,n,s,u,p=!1){if(!s[0]&&!s[1])return[0,0];const y=p?u==="map"?-a.bearingInRadians:0:u==="viewport"?a.bearingInRadians:0;if(y){const _=Math.sin(y),b=Math.cos(y);s=[s[0]*b-s[1]*_,s[0]*_+s[1]*b]}return[p?s[0]:at(n,s[0],a.zoom),p?s[1]:at(n,s[1],a.zoom)]},f.aQ=wv,f.aR=Zv,f.aS=bv,f.aT=Hv,f.aU=er,f.aV=ng,f.aW=se,f.aX=it,f.aY=je,f.aZ=Mn,f.a_=CS,f.aa=mc,f.ab=25,f.ac=kv,f.ad=a=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(s=>{n.onloadstart=()=>{s(n)};for(const u of a){const p=window.document.createElement("source");qe(u)||(n.crossOrigin="Anonymous"),p.src=u,n.appendChild(p)}})},f.ae=Qe,f.af=function(){return wn++},f.ag=g,f.ah=Ku,f.ai=vp,f.aj=ql,f.ak=ya,f.al=RS,f.am=function(a){const n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,p,y)=>{const _=p||y;return n[u]=!_||_.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n},f.an=fn,f.ao=85.051129,f.ap=ei,f.aq=function(a){return Math.pow(2,a)},f.ar=ve,f.as=ES,f.at=function(a){return Math.log(a)/Math.LN2},f.au=function(a){var n=a[0],s=a[1];return n*n+s*s},f.av=function(a){if(!a.length)return new Set;const n=Math.max(...a.map(T=>T.canonical.z));let s=1/0,u=-1/0,p=1/0,y=-1/0;const _=[];for(const T of a){const{x:k,y:I,z:D}=T.canonical,N=Math.pow(2,n-D),z=k*N,V=I*N;_.push({id:T,x:z,y:V}),z<s&&(s=z),z>u&&(u=z),V<p&&(p=V),V>y&&(y=V)}const b=new Set;for(const T of _)T.x!==s&&T.x!==u&&T.y!==p&&T.y!==y||b.add(T.id);return b},f.aw=function(a,n){const s=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return a.overscaledZ-n.overscaledZ||u-s||n.canonical.y-a.canonical.y||n.canonical.x-a.canonical.x},f.ax=class{constructor(a,n){this.max=a,this.onRemove=n,this.reset()}reset(){for(const a in this.data)for(const n of this.data[a])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(a,n,s){const u=a.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:n,timeout:void 0};if(s!==void 0&&(p.timeout=setTimeout(()=>{this.remove(a,p)},s)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const n=this.data[a].shift();return n.timeout&&clearTimeout(n.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),n.value}getByKey(a){const n=this.data[a];return n?n[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,n){if(!this.has(a))return this;const s=a.wrapped().key,u=n===void 0?0:this.data[s].indexOf(n),p=this.data[s][u];return this.data[s].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(a){const n=[];for(const s in this.data)for(const u of this.data[s])a(u.value)||n.push(u);for(const s of n)this.remove(s.value.tileID,s)}},f.ay=function(a,n){let s=0,u=0;if(a.kind==="constant")u=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:_}=a,b=p?fn(ai.interpolationFactor(p,n,y,_),0,1):0;a.kind==="camera"?u=Rn.number(a.minSize,a.maxSize,b):s=b}return{uSizeT:s,uSize:u}},f.b=tt,f.b$=Wa,f.b0=Ge,f.b1=function(a){var n=new Q(3);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n},f.b2=function(a,n,s){return a[0]=n[0]-s[0],a[1]=n[1]-s[1],a[2]=n[2]-s[2],a},f.b3=function(a,n){var s=n[0],u=n[1],p=n[2],y=s*s+u*u+p*p;return y>0&&(y=1/Math.sqrt(y)),a[0]=n[0]*y,a[1]=n[1]*y,a[2]=n[2]*y,a},f.b4=ft,f.b5=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]},f.b6=function(a,n,s){return a[0]=n[0]*s[0],a[1]=n[1]*s[1],a[2]=n[2]*s[2],a[3]=n[3]*s[3],a},f.b7=_e,f.b8=function(a,n,s){const u=n[0]*s[0]+n[1]*s[1]+n[2]*s[2];return u===0?null:(-(a[0]*s[0]+a[1]*s[1]+a[2]*s[2])-s[3])/u},f.b9=kt,f.bA=function(a,n,s,u){return a[0]=n[0]+s[0]*u,a[1]=n[1]+s[1]*u,a[2]=n[2]+s[2]*u,a},f.bB=wt,f.bC=function(a,n,s){var u=s[0],p=s[1],y=s[2],_=s[3],b=n[0],T=n[1],k=n[2],I=p*k-y*T,D=y*b-u*k,N=u*T-p*b;return a[0]=b+_*(I+=I)+p*(N+=N)-y*(D+=D),a[1]=T+_*D+y*I-u*N,a[2]=k+_*N+u*D-p*I,a},f.bD=function(a,n,s){const u=function(T){var k=T[3],I=T[4],D=T[5],N=T[6],z=T[7],V=T[8];return T[0]*(V*I-D*z)+T[1]*(-V*k+D*N)+T[2]*(z*k-I*N)}([a[0],a[1],a[2],n[0],n[1],n[2],s[0],s[1],s[2]]);if(u===0)return null;const p=ft([],[n[0],n[1],n[2]],[s[0],s[1],s[2]]),y=ft([],[s[0],s[1],s[2]],[a[0],a[1],a[2]]),_=ft([],[a[0],a[1],a[2]],[n[0],n[1],n[2]]),b=Je([],p,-a[3]);return Ge(b,b,Je([],y,-n[3])),Ge(b,b,Je([],_,-s[3])),Je(b,b,1/u),b},f.bE=Cv,f.bF=function(){return new Float64Array(4)},f.bG=function(a,n,s,u){var p=[],y=[];return p[0]=n[0]-s[0],p[1]=n[1]-s[1],p[2]=n[2]-s[2],y[0]=p[0]*Math.cos(u)-p[1]*Math.sin(u),y[1]=p[0]*Math.sin(u)+p[1]*Math.cos(u),y[2]=p[2],a[0]=y[0]+s[0],a[1]=y[1]+s[1],a[2]=y[2]+s[2],a},f.bH=function(a,n,s,u){var p=[],y=[];return p[0]=n[0]-s[0],p[1]=n[1]-s[1],p[2]=n[2]-s[2],y[0]=p[0],y[1]=p[1]*Math.cos(u)-p[2]*Math.sin(u),y[2]=p[1]*Math.sin(u)+p[2]*Math.cos(u),a[0]=y[0]+s[0],a[1]=y[1]+s[1],a[2]=y[2]+s[2],a},f.bI=function(a,n,s,u){var p=[],y=[];return p[0]=n[0]-s[0],p[1]=n[1]-s[1],p[2]=n[2]-s[2],y[0]=p[2]*Math.sin(u)+p[0]*Math.cos(u),y[1]=p[1],y[2]=p[2]*Math.cos(u)-p[0]*Math.sin(u),a[0]=y[0]+s[0],a[1]=y[1]+s[1],a[2]=y[2]+s[2],a},f.bJ=function(a,n,s){var u=Math.sin(s),p=Math.cos(s),y=n[0],_=n[1],b=n[2],T=n[3],k=n[8],I=n[9],D=n[10],N=n[11];return n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=y*p-k*u,a[1]=_*p-I*u,a[2]=b*p-D*u,a[3]=T*p-N*u,a[8]=y*u+k*p,a[9]=_*u+I*p,a[10]=b*u+D*p,a[11]=T*u+N*p,a},f.bK=function(a,n){const s=mt(a,360),u=mt(n,360),p=u-s,y=u>s?p-360:p+360;return Math.abs(p)<Math.abs(y)?p:y},f.bL=function(a){return a[0]=0,a[1]=0,a[2]=0,a},f.bM=function(a,n,s,u){const p=Math.sqrt(a*a+n*n),y=Math.sqrt(s*s+u*u);a/=p,n/=p,s/=y,u/=y;const _=Math.acos(a*s+n*u);return-n*s+a*u>0?_:-_},f.bN=function(a,n){const s=mt(a,2*Math.PI),u=mt(n,2*Math.PI);return Math.min(Math.abs(s-u),Math.abs(s-u+2*Math.PI),Math.abs(s-u-2*Math.PI))},f.bO=function(){const a={},n=Re.$version;for(const s in Re.$root){const u=Re.$root[s];if(u.required){let p=null;p=s==="version"?n:u.type==="array"?[]:{},p!=null&&(a[s]=p)}}return a},f.bP=Le,f.bQ=$d,f.bR=function a(n,s){if(Array.isArray(n)){if(!Array.isArray(s)||n.length!==s.length)return!1;for(let u=0;u<n.length;u++)if(!a(n[u],s[u]))return!1;return!0}if(typeof n=="object"&&n!==null&&s!==null){if(typeof s!="object"||Object.keys(n).length!==Object.keys(s).length)return!1;for(const u in n)if(!a(n[u],s[u]))return!1;return!0}return n===s},f.bS=function(a){a=a.slice();const n=Object.create(null);for(let s=0;s<a.length;s++)n[a[s].id]=a[s];for(let s=0;s<a.length;s++)"ref"in a[s]&&(a[s]=zr(a[s],n[a[s].ref]));return a},f.bT=function(a,n){if(a.type==="custom")return new $D(a,n);switch(a.type){case"background":return new UD(a,n);case"circle":return new PR(a,n);case"color-relief":return new RR(a,n);case"fill":return new ZR(a,n);case"fill-extrusion":return new sD(a,n);case"heatmap":return new kR(a,n);case"hillshade":return new IR(a,n);case"line":return new dD(a,n);case"raster":return new nv(a,n);case"symbol":return new og(a,n)}},f.bU=a=>a.type==="raster",f.bV=ki,f.bW=function(a,n){if(!a)return[{command:"setStyle",args:[n]}];let s=[];try{if(!Mt(a.version,n.version))return[{command:"setStyle",args:[n]}];Mt(a.center,n.center)||s.push({command:"setCenter",args:[n.center]}),Mt(a.state,n.state)||s.push({command:"setGlobalState",args:[n.state]}),Mt(a.centerAltitude,n.centerAltitude)||s.push({command:"setCenterAltitude",args:[n.centerAltitude]}),Mt(a.zoom,n.zoom)||s.push({command:"setZoom",args:[n.zoom]}),Mt(a.bearing,n.bearing)||s.push({command:"setBearing",args:[n.bearing]}),Mt(a.pitch,n.pitch)||s.push({command:"setPitch",args:[n.pitch]}),Mt(a.roll,n.roll)||s.push({command:"setRoll",args:[n.roll]}),Mt(a.sprite,n.sprite)||s.push({command:"setSprite",args:[n.sprite]}),Mt(a.glyphs,n.glyphs)||s.push({command:"setGlyphs",args:[n.glyphs]}),Mt(a.transition,n.transition)||s.push({command:"setTransition",args:[n.transition]}),Mt(a.light,n.light)||s.push({command:"setLight",args:[n.light]}),Mt(a.terrain,n.terrain)||s.push({command:"setTerrain",args:[n.terrain]}),Mt(a.sky,n.sky)||s.push({command:"setSky",args:[n.sky]}),Mt(a.projection,n.projection)||s.push({command:"setProjection",args:[n.projection]});const u={},p=[];(function(_,b,T,k){let I;for(I in b=b||{},_=_||{})Object.prototype.hasOwnProperty.call(_,I)&&(Object.prototype.hasOwnProperty.call(b,I)||Cn(I,T,k));for(I in b)Object.prototype.hasOwnProperty.call(b,I)&&(Object.prototype.hasOwnProperty.call(_,I)?Mt(_[I],b[I])||(_[I].type==="geojson"&&b[I].type==="geojson"&&gn(_,b,I)?un(T,{command:"setGeoJSONSourceData",args:[I,b[I].data]}):Un(I,b,T,k)):Or(I,b,T))})(a.sources,n.sources,p,u);const y=[];a.layers&&a.layers.forEach(_=>{"source"in _&&u[_.source]?s.push({command:"removeLayer",args:[_.id]}):y.push(_)}),s=s.concat(p),function(_,b,T){b=b||[];const k=(_=_||[]).map(El),I=b.map(El),D=_.reduce(Pl,{}),N=b.reduce(Pl,{}),z=k.slice(),V=Object.create(null);let U,q,ee,ue,ne;for(let ie=0,de=0;ie<k.length;ie++)U=k[ie],Object.prototype.hasOwnProperty.call(N,U)?de++:(un(T,{command:"removeLayer",args:[U]}),z.splice(z.indexOf(U,de),1));for(let ie=0,de=0;ie<I.length;ie++)U=I[I.length-1-ie],z[z.length-1-ie]!==U&&(Object.prototype.hasOwnProperty.call(D,U)?(un(T,{command:"removeLayer",args:[U]}),z.splice(z.lastIndexOf(U,z.length-de),1)):de++,ue=z[z.length-ie],un(T,{command:"addLayer",args:[N[U],ue]}),z.splice(z.length-ie,0,U),V[U]=!0);for(let ie=0;ie<I.length;ie++)if(U=I[ie],q=D[U],ee=N[U],!V[U]&&!Mt(q,ee))if(Mt(q.source,ee.source)&&Mt(q["source-layer"],ee["source-layer"])&&Mt(q.type,ee.type)){for(ne in dr(q.layout,ee.layout,T,U,null,"setLayoutProperty"),dr(q.paint,ee.paint,T,U,null,"setPaintProperty"),Mt(q.filter,ee.filter)||un(T,{command:"setFilter",args:[U,ee.filter]}),Mt(q.minzoom,ee.minzoom)&&Mt(q.maxzoom,ee.maxzoom)||un(T,{command:"setLayerZoomRange",args:[U,ee.minzoom,ee.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?dr(q[ne],ee[ne],T,U,ne.slice(6),"setPaintProperty"):Mt(q[ne],ee[ne])||un(T,{command:"setLayerProperty",args:[U,ne,ee[ne]]}));for(ne in ee)Object.prototype.hasOwnProperty.call(ee,ne)&&!Object.prototype.hasOwnProperty.call(q,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?dr(q[ne],ee[ne],T,U,ne.slice(6),"setPaintProperty"):Mt(q[ne],ee[ne])||un(T,{command:"setLayerProperty",args:[U,ne,ee[ne]]}))}else un(T,{command:"removeLayer",args:[U]}),ue=z[z.lastIndexOf(U)+1],un(T,{command:"addLayer",args:[ee,ue]})}(y,n.layers,s)}catch(u){console.warn("Unable to compute style diff:",u),s=[{command:"setStyle",args:[n]}]}return s},f.bX=function(a){const n=[],s=a.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},f.bY=Nr,f.bZ=Ca,f.b_=class extends _i{constructor(a,n){super(a,n),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},f.ba=function(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a[3]=n[3]*s,a},f.bb=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]+a[3]},f.bc=AS,f.bd=Xu,f.be=function(a,n,s,u,p){var y=1/Math.tan(n/2);if(a[0]=y/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,p!=null&&p!==1/0){var _=1/(u-p);a[10]=(p+u)*_,a[14]=2*p*u*_}else a[10]=-1,a[14]=-2*u;return a},f.bf=function(a){var n=new Q(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n},f.bg=function(a,n,s){var u=Math.sin(s),p=Math.cos(s),y=n[0],_=n[1],b=n[2],T=n[3],k=n[4],I=n[5],D=n[6],N=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=y*p+k*u,a[1]=_*p+I*u,a[2]=b*p+D*u,a[3]=T*p+N*u,a[4]=k*p-y*u,a[5]=I*p-_*u,a[6]=D*p-b*u,a[7]=N*p-T*u,a},f.bh=function(a,n,s){var u=Math.sin(s),p=Math.cos(s),y=n[4],_=n[5],b=n[6],T=n[7],k=n[8],I=n[9],D=n[10],N=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=y*p+k*u,a[5]=_*p+I*u,a[6]=b*p+D*u,a[7]=T*p+N*u,a[8]=k*p-y*u,a[9]=I*p-_*u,a[10]=D*p-b*u,a[11]=N*p-T*u,a},f.bi=function(){const a=new Float32Array(16);return ve(a),a},f.bj=function(){const a=new Float64Array(16);return ve(a),a},f.bk=function(){return new Float64Array(16)},f.bl=function(a,n,s){const u=new Float64Array(4);return wt(u,a,n-90,s),u},f.bm=function(a,n,s,u){var p,y,_,b,T,k=n[0],I=n[1],D=n[2],N=n[3],z=s[0],V=s[1],U=s[2],q=s[3];return(y=k*z+I*V+D*U+N*q)<0&&(y=-y,z=-z,V=-V,U=-U,q=-q),1-y>H?(p=Math.acos(y),_=Math.sin(p),b=Math.sin((1-u)*p)/_,T=Math.sin(u*p)/_):(b=1-u,T=u),a[0]=b*k+T*z,a[1]=b*I+T*V,a[2]=b*D+T*U,a[3]=b*N+T*q,a},f.bn=function(a){const n=new Float64Array(9);(function(y,_){var b=_[0],T=_[1],k=_[2],I=_[3],D=b+b,N=T+T,z=k+k,V=b*D,U=T*D,q=T*N,ee=k*D,ue=k*N,ne=k*z,ie=I*D,de=I*N,me=I*z;y[0]=1-q-ne,y[3]=U-me,y[6]=ee+de,y[1]=U+me,y[4]=1-V-ne,y[7]=ue-ie,y[2]=ee-de,y[5]=ue+ie,y[8]=1-V-q})(n,a);const s=Mn(-Math.asin(fn(n[2],-1,1)));let u,p;return Math.hypot(n[5],n[8])<.001?(u=0,p=-Mn(Math.atan2(n[3],n[4]))):(u=Mn(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),p=Mn(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:u,pitch:s+90,bearing:p}},f.bo=function(a,n){return a.roll==n.roll&&a.pitch==n.pitch&&a.bearing==n.bearing},f.bp=qt,f.bq=qa,f.br=Wu,f.bs=up,f.bt=qu,f.bu=Pt,f.bv=sn,f.bw=si,f.bx=function(a,n,s,u,p){return Pt(u,p,fn((a-n)/(s-n),0,1))},f.by=mt,f.bz=function(){return new Float64Array(3)},f.c=be,f.c$=function(a,n,s,u,p){return c(this,void 0,void 0,function*(){if(J())try{return yield Dt(a,n,s,u,p)}catch{}return function(y,_,b,T,k){const I=y.width,D=y.height;Wt&&Ct||(Wt=new OffscreenCanvas(I,D),Ct=Wt.getContext("2d",{willReadFrequently:!0})),Wt.width=I,Wt.height=D,Ct.drawImage(y,0,0,I,D);const N=Ct.getImageData(_,b,T,k);return Ct.clearRect(0,0,I,D),N.data}(a,n,s,u,p)})},f.c0=class extends _i{constructor(a,n){super(a,n),this.current=qi}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let n=1;n<16;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},f.c1=dc,f.c2=class extends _i{constructor(a,n){super(a,n),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},f.c3=class extends _i{constructor(a,n){super(a,n),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},f.c4=le,f.c5=function(a,n){var s=Math.sin(n),u=Math.cos(n);return a[0]=u,a[1]=s,a[2]=0,a[3]=-s,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},f.c6=function(a,n,s){var u=n[0],p=n[1],y=n[2];return a[0]=u*s[0]+p*s[3]+y*s[6],a[1]=u*s[1]+p*s[4]+y*s[7],a[2]=u*s[2]+p*s[5]+y*s[8],a},f.c7=function(a,n,s,u,p,y,_){var b=1/(n-s),T=1/(u-p),k=1/(y-_);return a[0]=-2*b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*k,a[11]=0,a[12]=(n+s)*b,a[13]=(p+u)*T,a[14]=(_+y)*k,a[15]=1,a},f.c8=class extends _i{constructor(a,n){super(a,n),this.current=new Array}set(a){if(a!=this.current){this.current=a;const n=new Float32Array(4*a.length);for(let s=0;s<a.length;s++)n[4*s]=a[s].r,n[4*s+1]=a[s].g,n[4*s+2]=a[s].b,n[4*s+3]=a[s].a;this.gl.uniform4fv(this.location,n)}}},f.c9=class extends _i{constructor(a,n){super(a,n),this.current=new Array}set(a){if(a!=this.current){this.current=a;const n=new Float32Array(a);this.gl.uniform1fv(this.location,n)}}},f.cA=function(a,n){return Ce[n]&&"touches"in a},f.cB=function(a){return Ce[a]||K[a]},f.cC=function(a,n,s){var u=n[0],p=n[1];return a[0]=s[0]*u+s[4]*p+s[12],a[1]=s[1]*u+s[5]*p+s[13],a},f.cD=function(a,n){const{x:s,y:u}=gp.fromLngLat(n);return!(a<0||a>25||u<0||u>=1||s<0||s>=1)},f.cE=function(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.cF=class extends ju{},f.cG=Aj,f.cI=Se,f.cJ=function(a,n){be.REGISTERED_PROTOCOLS[a]=n},f.cK=function(a){delete be.REGISTERED_PROTOCOLS[a]},f.cL=function(a,n){const s={};for(let p=0;p<a.length;p++){const y=n&&n[a[p].id]||Cm(a[p]);n&&(n[a[p].id]=y);let _=s[y];_||(_=s[y]=[]),_.push(a[p])}const u=[];for(const p in s)u.push(s[p]);return u},f.cM=dt,f.cN=MS,f.cO=cT,f.cP=dS,f.cQ=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Pe/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const n=a.bucket.layers[0],s=n.layout,u=n._unevaluatedLayout._values,p={layoutIconSize:u["icon-size"].possiblyEvaluate(new pn(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new pn(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new pn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=a.bucket.textSizeData;p.compositeTextSizes=[u["text-size"].possiblyEvaluate(new pn(k),a.canonical),u["text-size"].possiblyEvaluate(new pn(I),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=a.bucket.iconSizeData;p.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new pn(k),a.canonical),u["icon-size"].possiblyEvaluate(new pn(I),a.canonical)]}const y=s.get("text-line-height")*kr,_=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",b=s.get("text-keep-upright"),T=s.get("text-size");for(const k of a.bucket.features){const I=s.get("text-font").evaluate(k,{},a.canonical).join(","),D=T.evaluate(k,{},a.canonical),N=p.layoutTextSize.evaluate(k,{},a.canonical),z=p.layoutIconSize.evaluate(k,{},a.canonical),V={horizontal:{},vertical:void 0},U=k.text;let q,ee=[0,0];if(U){const ie=U.toString(),de=s.get("text-letter-spacing").evaluate(k,{},a.canonical)*kr,me=ev(ie)?de:0,Ae=s.get("text-anchor").evaluate(k,{},a.canonical),$e=wT(n,k,a.canonical);if(!$e){const Ke=s.get("text-radial-offset").evaluate(k,{},a.canonical);ee=Ke?bT(Ae,[Ke*kr,Wv]):s.get("text-offset").evaluate(k,{},a.canonical).map(Ve=>Ve*kr)}let Fe=_?"center":s.get("text-justify").evaluate(k,{},a.canonical);const Ze=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(k,{},a.canonical)*kr:1/0,rt=()=>{a.bucket.allowVerticalPlacement&&Vo(ie)&&(V.vertical=sg(U,a.glyphMap,a.glyphPositions,a.imagePositions,I,Ze,y,Ae,"left",me,ee,f.az.vertical,!0,N,D))};if(!_&&$e){const Ke=new Set;if(Fe==="auto")for(let Ne=0;Ne<$e.values.length;Ne+=2)Ke.add(Zv($e.values[Ne]));else Ke.add(Fe);let Ve=!1;for(const Ne of Ke)if(!V.horizontal[Ne])if(Ve)V.horizontal[Ne]=V.horizontal[0];else{const ht=sg(U,a.glyphMap,a.glyphPositions,a.imagePositions,I,Ze,y,"center",Ne,me,ee,f.az.horizontal,!1,N,D);ht&&(V.horizontal[Ne]=ht,Ve=ht.positionedLines.length===1)}rt()}else{Fe==="auto"&&(Fe=Zv(Ae));const Ke=sg(U,a.glyphMap,a.glyphPositions,a.imagePositions,I,Ze,y,Ae,Fe,me,ee,f.az.horizontal,!1,N,D);Ke&&(V.horizontal[Fe]=Ke),rt(),Vo(ie)&&_&&b&&(V.vertical=sg(U,a.glyphMap,a.glyphPositions,a.imagePositions,I,Ze,y,Ae,Fe,me,ee,f.az.vertical,!1,N,D))}}let ue=!1;if(k.icon&&k.icon.name){const ie=a.imageMap[k.icon.name];ie&&(q=OD(a.imagePositions[k.icon.name],s.get("icon-offset").evaluate(k,{},a.canonical),s.get("icon-anchor").evaluate(k,{},a.canonical)),ue=!!ie.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ue:a.bucket.sdfIcons!==ue&&ir("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ie.pixelRatio!==a.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const ne=TT(V.horizontal)||V.vertical;a.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||q)&&Cj(a.bucket,k,V,q,a.imageMap,p,N,z,ee,ue,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},f.cR=mv,f.cS=yv,f.cT=_v,f.cU=function(a){const n=new ig;return function(s,u){for(const p in s.layers)u.writeMessage(3,pj,s.layers[p])}(a,n),n.finish()},f.cV=function(a,n,s,u,p,y){let _=dT(a,n,s,p,0);return _=dT(_,n,u,y,1),_},f.cW=class{constructor(a){this.maxEntries=a,this.map=new Map}get(a){const n=this.map.get(a);return n!==void 0&&(this.map.delete(a),this.map.set(a,n)),n}set(a,n){if(this.map.has(a))this.map.delete(a);else if(this.map.size>=this.maxEntries){const s=this.map.keys().next().value;this.map.delete(s)}this.map.set(a,n)}clear(){this.map.clear()}},f.cX=H1,f.cY=ig,f.cZ=oT,f.c_=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},f.ca=class extends $a{},f.cb=gD,f.cc=class extends hc{},f.cd=uv,f.ce=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},f.cf=D1,f.cg=function(a,n,s){var u=n[0],p=n[1],y=n[2],_=s[3]*u+s[7]*p+s[11]*y+s[15];return a[0]=(s[0]*u+s[4]*p+s[8]*y+s[12])/(_=_||1),a[1]=(s[1]*u+s[5]*p+s[9]*y+s[13])/_,a[2]=(s[2]*u+s[6]*p+s[10]*y+s[14])/_,a},f.ch=class extends Xd{},f.ci=class extends r{},f.cj=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]&&a[4]===n[4]&&a[5]===n[5]&&a[6]===n[6]&&a[7]===n[7]&&a[8]===n[8]&&a[9]===n[9]&&a[10]===n[10]&&a[11]===n[11]&&a[12]===n[12]&&a[13]===n[13]&&a[14]===n[14]&&a[15]===n[15]},f.ck=function(a,n){var s=a[0],u=a[1],p=a[2],y=a[3],_=a[4],b=a[5],T=a[6],k=a[7],I=a[8],D=a[9],N=a[10],z=a[11],V=a[12],U=a[13],q=a[14],ee=a[15],ue=n[0],ne=n[1],ie=n[2],de=n[3],me=n[4],Ae=n[5],$e=n[6],Fe=n[7],Ze=n[8],rt=n[9],Ke=n[10],Ve=n[11],Ne=n[12],ht=n[13],ct=n[14],pt=n[15];return Math.abs(s-ue)<=H*Math.max(1,Math.abs(s),Math.abs(ue))&&Math.abs(u-ne)<=H*Math.max(1,Math.abs(u),Math.abs(ne))&&Math.abs(p-ie)<=H*Math.max(1,Math.abs(p),Math.abs(ie))&&Math.abs(y-de)<=H*Math.max(1,Math.abs(y),Math.abs(de))&&Math.abs(_-me)<=H*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(b-Ae)<=H*Math.max(1,Math.abs(b),Math.abs(Ae))&&Math.abs(T-$e)<=H*Math.max(1,Math.abs(T),Math.abs($e))&&Math.abs(k-Fe)<=H*Math.max(1,Math.abs(k),Math.abs(Fe))&&Math.abs(I-Ze)<=H*Math.max(1,Math.abs(I),Math.abs(Ze))&&Math.abs(D-rt)<=H*Math.max(1,Math.abs(D),Math.abs(rt))&&Math.abs(N-Ke)<=H*Math.max(1,Math.abs(N),Math.abs(Ke))&&Math.abs(z-Ve)<=H*Math.max(1,Math.abs(z),Math.abs(Ve))&&Math.abs(V-Ne)<=H*Math.max(1,Math.abs(V),Math.abs(Ne))&&Math.abs(U-ht)<=H*Math.max(1,Math.abs(U),Math.abs(ht))&&Math.abs(q-ct)<=H*Math.max(1,Math.abs(q),Math.abs(ct))&&Math.abs(ee-pt)<=H*Math.max(1,Math.abs(ee),Math.abs(pt))},f.cl=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},f.cm=a=>a.type==="symbol",f.cn=a=>a.type==="circle",f.co=a=>a.type==="heatmap",f.cp=a=>a.type==="line",f.cq=a=>a.type==="fill",f.cr=a=>a.type==="fill-extrusion",f.cs=a=>a.type==="hillshade",f.ct=a=>a.type==="color-relief",f.cu=a=>a.type==="background",f.cv=a=>a.type==="custom",f.cw=an,f.cx=function(a,n,s){const u=Ye(n.x-s.x,n.y-s.y),p=Ye(a.x-s.x,a.y-s.y),y=Math.atan2(u[0]*p[1]-u[1]*p[0],function(_,b){return _[0]*b[0]+_[1]*b[1]}(u,p));return Mn(y)},f.cy=tn,f.cz=function(a,n){return K[n]&&(a instanceof MouseEvent||a instanceof WheelEvent)},f.d=qe,f.d0=L1,f.d1=C,f.d2=class{constructor(a,n){this.layers={[vp]:this},this.name=vp,this.version=n?n.version:1,this.extent=n?n.extent:4096,this.length=a.length,this.features=a}feature(a){return new dj(this.features[a],this.extent)}},f.d3=Gl,f.d4=pa,f.e=vr,f.f=a=>c(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(n)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.g=Ie,f.h=a=>new Promise((n,s)=>{const u=new Image;u.onload=()=>{n(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=Ut})},u.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(a)],{type:"image/png"});u.src=a.byteLength?URL.createObjectURL(p):Ut}),f.i=Fi,f.j=(a,n)=>Xe(vr(a,{type:"json"}),n),f.k=dn,f.l=It,f.m=Xe,f.n=(a,n)=>Xe(vr(a,{type:"arrayBuffer"}),n),f.o=function(a){return new ig(a).readFields(ID,[])},f.p=hS,f.q=function(a){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(a))},f.r=sp,f.s=Lr,f.t=oi,f.u=Re,f.v=Jl,f.w=ir,f.x=Hd,f.y=Ql,f.z=rc}),h("worker",["./shared"],function(f){class c{constructor(K,Z){this.keyCache={},K&&this.replace(K,Z)}replace(K,Z){this._layerConfigs={},this._layers={},this.update(K,[],Z)}update(K,Z,re){for(const be of K){this._layerConfigs[be.id]=be;const Ie=this._layers[be.id]=f.bT(be,re);Ie._featureFilter=f.aj(Ie.filter,re),this.keyCache[be.id]&&delete this.keyCache[be.id]}for(const be of Z)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const ye=f.cL(Object.values(this._layerConfigs),this.keyCache);for(const be of ye){const Ie=be.map(ut=>this._layers[ut.id]),ke=Ie[0];if(ke.isHidden())continue;const Se=ke.source||"";let Le=this.familiesBySource[Se];Le||(Le=this.familiesBySource[Se]={});const Xe=ke.sourceLayer||f.ai;let qe=Le[Xe];qe||(qe=Le[Xe]=[]),qe.push(Ie)}}}class E{constructor(K){const Z={},re=[];for(const ke in K){const Se=K[ke],Le=Z[ke]={};for(const Xe in Se){const qe=Se[+Xe];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const ut={x:0,y:0,w:qe.bitmap.width+2,h:qe.bitmap.height+2};re.push(ut),Le[Xe]={rect:ut,metrics:qe.metrics}}}const{w:ye,h:be}=f.p(re),Ie=new f.r({width:ye||1,height:be||1});for(const ke in K){const Se=K[ke];for(const Le in Se){const Xe=Se[+Le];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const qe=Z[ke][Le].rect;f.r.copy(Xe.bitmap,Ie,{x:0,y:0},{x:qe.x+1,y:qe.y+1},Xe.bitmap)}}this.image=Ie,this.positions=Z}}f.cM("GlyphAtlas",E);class C{constructor(K){this.tileID=new f.a2(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[]}parse(K,Z,re,ye,be){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new f.ag;const Ie=new f.cN(Object.keys(K.layers).sort()),ke=new f.cO(this.tileID,this.promoteId);ke.bucketLayerIDs=[];const Se={},Le={featureIndex:ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:re,subdivisionGranularity:be},Xe=Z.familiesBySource[this.source];for(const gn in Xe){const dr=K.layers[gn];if(!dr)continue;dr.version===1&&f.w(`Vector tile source "${this.source}" layer "${gn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const El=Ie.encode(gn),Pl=[];for(let Qe=0;Qe<dr.length;Qe++){const ti=dr.feature(Qe),ni=ke.getId(ti,gn);Pl.push({feature:ti,id:ni,index:Qe,sourceLayerIndex:El})}for(const Qe of Xe[gn]){const ti=Qe[0];ti.source!==this.source&&f.w(`layer.source = ${ti.source} does not equal this.source = ${this.source}`),ti.isHidden(this.zoom,!0)||(R(Qe,this.zoom,re),(Se[ti.id]=ti.createBucket({index:ke.bucketLayerIDs.length,layers:Qe,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:El,sourceID:this.source})).populate(Pl,Le,this.tileID.canonical),ke.bucketLayerIDs.push(Qe.map(ni=>ni.id)))}}const qe=f.bY(Le.glyphDependencies,gn=>Object.keys(gn).map(Number));this.inFlightDependencies.forEach(gn=>gn==null?void 0:gn.abort()),this.inFlightDependencies=[];let ut=Promise.resolve({});if(Object.keys(qe).length){const gn=new AbortController;this.inFlightDependencies.push(gn),ut=ye.sendAsync({type:"GG",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},gn)}const yt=Object.keys(Le.iconDependencies);let It=Promise.resolve({});if(yt.length){const gn=new AbortController;this.inFlightDependencies.push(gn),It=ye.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"icons"}},gn)}const dn=Object.keys(Le.patternDependencies);let nn=Promise.resolve({});if(dn.length){const gn=new AbortController;this.inFlightDependencies.push(gn),nn=ye.sendAsync({type:"GI",data:{icons:dn,source:this.source,tileID:this.tileID,type:"patterns"}},gn)}const Re=Le.dashDependencies;let mn=Promise.resolve({});if(Object.keys(Re).length){const gn=new AbortController;this.inFlightDependencies.push(gn),mn=ye.sendAsync({type:"GDA",data:{dashes:Re}},gn)}const[zr,Mt,un,Or]=yield Promise.all([ut,It,nn,mn]),Cn=new E(zr),Un=new f.cP(Mt,un);for(const gn in Se){const dr=Se[gn];dr instanceof f.ah?(R(dr.layers,this.zoom,re),f.cQ({bucket:dr,glyphMap:zr,glyphPositions:Cn.positions,imageMap:Mt,imagePositions:Un.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Le.subdivisionGranularity})):dr.hasDependencies&&(dr instanceof f.cR||dr instanceof f.cS||dr instanceof f.cT)&&(R(dr.layers,this.zoom,re),dr.addFeatures(Le,this.tileID.canonical,Un.patternPositions,Or))}return this.status="done",{buckets:Object.values(Se).filter(gn=>!gn.isEmpty()),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cn.image,imageAtlas:Un,dashPositions:Or,glyphMap:this.returnDependencies?zr:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?Cn.positions:null}})}}function R(Ce,K,Z){const re=new f.H(K);for(const ye of Ce)ye.recalculate(re,Z)}class L{constructor(K,Z,re,ye,be){this.type=K,this.properties=re||{},this.extent=be,this.pointsArray=Z,this.id=ye}loadGeometry(){return this.pointsArray.map(K=>K.map(Z=>new f.P(Z.x,Z.y)))}}class B{constructor(K,Z,re){this.version=2,this._myFeatures=K,this.name=Z,this.length=K.length,this.extent=re}feature(K){return this._myFeatures[K]}}class X{constructor(){this.layers={}}addLayer(K){this.layers[K.name]=K}}function W(Ce){let K=f.cU(Ce);return K.byteOffset===0&&K.byteLength===K.buffer.byteLength||(K=new Uint8Array(K)),{vectorTile:Ce,rawData:K.buffer}}function te(Ce,K,Z){const{extent:re}=Ce,ye=Math.pow(2,Z.z-K.z),be=(Z.x-K.x*ye)*re,Ie=(Z.y-K.y*ye)*re,ke=[];for(let Se=0;Se<Ce.length;Se++){const Le=Ce.feature(Se);let Xe=Le.loadGeometry();for(const ut of Xe)for(const yt of ut)yt.x=yt.x*ye-be,yt.y=yt.y*ye-Ie;const qe=128;Xe=f.cV(Xe,Le.type,-qe,-qe,re+qe,re+qe),Xe.length!==0&&ke.push(new L(Le.type,Xe,Le.properties,Le.id,re))}return new B(ke,Ce.name,re)}class G{constructor(K,Z,re){this.actor=K,this.layerIndex=Z,this.availableImages=re,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new f.cW(1e3)}loadVectorTile(K,Z){return f._(this,void 0,void 0,function*(){const re=yield f.n(K.request,Z);try{return{vectorTile:K.encoding!=="mlt"?new f.cX(new f.cY(re.data)):new f.cZ(re.data),rawData:re.data,cacheControl:re.cacheControl,expires:re.expires}}catch(ye){const be=new Uint8Array(re.data);let Ie=`Unable to parse the tile at ${K.request.url}, `;throw Ie+=be[0]===31&&be[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ye.message}`,new Error(Ie)}})}loadTile(K){return f._(this,void 0,void 0,function*(){const{uid:Z,overzoomParameters:re}=K;re&&(K.request=re.overzoomRequest);const ye=!!(K&&K.request&&K.request.collectResourceTiming)&&new f.c_(K.request),be=new C(K);this.loading[Z]=be;const Ie=new AbortController;be.abort=Ie;try{const ke=yield this.loadVectorTile(K,Ie);if(delete this.loading[Z],!ke)return null;if(re){const ut=this._getOverzoomTile(K,ke.vectorTile);ke.rawData=ut.rawData,ke.vectorTile=ut.vectorTile}const Se=ke.rawData,Le={};ke.expires&&(Le.expires=ke.expires),ke.cacheControl&&(Le.cacheControl=ke.cacheControl);const Xe={};if(ye){const ut=ye.finish();ut&&(Xe.resourceTiming=JSON.parse(JSON.stringify(ut)))}be.vectorTile=ke.vectorTile;const qe=be.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);this.loaded[Z]=be,this.fetching[Z]={rawTileData:Se,cacheControl:Le,resourceTiming:Xe};try{const ut=yield qe;return f.e({rawTileData:Se.slice(0),encoding:K.encoding},ut,Le,Xe)}finally{delete this.fetching[Z]}}catch(ke){throw delete this.loading[Z],be.status="done",this.loaded[Z]=be,ke}})}_getOverzoomTile(K,Z){const{tileID:re,source:ye,overzoomParameters:be}=K,{maxZoomTileID:Ie}=be,ke=`${Ie.key}_${re.key}`,Se=this.overzoomedTileResultCache.get(ke);if(Se)return Se;const Le=new X,Xe=this.layerIndex.familiesBySource[ye];for(const ut in Xe){const yt=Z.layers[ut];if(!yt)continue;const It=te(yt,Ie,re.canonical);It.length>0&&Le.addLayer(It)}const qe=W(Le);return this.overzoomedTileResultCache.set(ke,qe),qe}reloadTile(K){return f._(this,void 0,void 0,function*(){const Z=K.uid;if(!this.loaded||!this.loaded[Z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const re=this.loaded[Z];if(re.showCollisionBoxes=K.showCollisionBoxes,re.status==="parsing"){const ye=yield re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);let be;if(this.fetching[Z]){const{rawTileData:Ie,cacheControl:ke,resourceTiming:Se}=this.fetching[Z];delete this.fetching[Z],be=f.e({rawTileData:Ie.slice(0),encoding:K.encoding},ye,ke,Se)}else be=ye;return be}if(re.status==="done"&&re.vectorTile)return re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity)})}abortTile(K){return f._(this,void 0,void 0,function*(){const Z=this.loading,re=K.uid;Z&&Z[re]&&Z[re].abort&&(Z[re].abort.abort(),delete Z[re])})}removeTile(K){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]})}}class J{constructor(){this.loaded={}}loadTile(K){return f._(this,void 0,void 0,function*(){const{uid:Z,encoding:re,rawImageData:ye,redFactor:be,greenFactor:Ie,blueFactor:ke,baseShift:Se}=K,Le=ye.width+2,Xe=ye.height+2,qe=f.b(ye)?new f.R({width:Le,height:Xe},yield f.c$(ye,-1,-1,Le,Xe)):ye,ut=new f.d0(Z,qe,re,be,Ie,ke,Se);return this.loaded=this.loaded||{},this.loaded[Z]=ut,ut})}removeTile(K){const Z=this.loaded,re=K.uid;Z&&Z[re]&&delete Z[re]}}var H,Q,le=function(){if(Q)return H;function Ce(Z,re){if(Z.length!==0){K(Z[0],re);for(var ye=1;ye<Z.length;ye++)K(Z[ye],!re)}}function K(Z,re){for(var ye=0,be=0,Ie=0,ke=Z.length,Se=ke-1;Ie<ke;Se=Ie++){var Le=(Z[Ie][0]-Z[Se][0])*(Z[Se][1]+Z[Ie][1]),Xe=ye+Le;be+=Math.abs(ye)>=Math.abs(Le)?ye-Xe+Le:Le-Xe+ye,ye=Xe}ye+be>=0!=!!re&&Z.reverse()}return Q=1,H=function Z(re,ye){var be,Ie=re&&re.type;if(Ie==="FeatureCollection")for(be=0;be<re.features.length;be++)Z(re.features[be],ye);else if(Ie==="GeometryCollection")for(be=0;be<re.geometries.length;be++)Z(re.geometries[be],ye);else if(Ie==="Feature")Z(re.geometry,ye);else if(Ie==="Polygon")Ce(re.coordinates,ye);else if(Ie==="MultiPolygon")for(be=0;be<re.coordinates.length;be++)Ce(re.coordinates[be],ye);return re}}(),ve=f.d1(le);const Ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},_e=Math.fround||(we=new Float32Array(1),Ce=>(we[0]=+Ce,we[0]));var we;class Ge{constructor(K){this.options=Object.assign(Object.create(Ee),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:Z,minZoom:re,maxZoom:ye}=this.options;Z&&console.time("total time");const be=`prepare ${K.length} points`;Z&&console.time(be),this.points=K;const Ie=[];for(let Se=0;Se<K.length;Se++){const Le=K[Se];if(!Le.geometry)continue;const[Xe,qe]=Le.geometry.coordinates,ut=_e(At(Xe)),yt=_e(kt(qe));Ie.push(ut,yt,1/0,Se,-1,1),this.options.reduce&&Ie.push(0)}let ke=this.trees[ye+1]=this._createTree(Ie);Z&&console.timeEnd(be);for(let Se=ye;Se>=re;Se--){const Le=+Date.now();ke=this.trees[Se]=this._createTree(this._cluster(ke,Se)),Z&&console.log("z%d: %d clusters in %dms",Se,ke.numItems,+Date.now()-Le)}return Z&&console.timeEnd("total time"),this}getClusters(K,Z){let re=((K[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,K[1]));let be=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)re=-180,be=180;else if(re>be){const qe=this.getClusters([re,ye,180,Ie],Z),ut=this.getClusters([-180,ye,be,Ie],Z);return qe.concat(ut)}const ke=this.trees[this._limitZoom(Z)],Se=ke.range(At(re),kt(Ie),At(be),kt(ye)),Le=ke.data,Xe=[];for(const qe of Se){const ut=this.stride*qe;Xe.push(Le[ut+5]>1?Je(Le,ut,this.clusterProps):this.points[Le[ut+3]])}return Xe}getChildren(K){const Z=this._getOriginId(K),re=this._getOriginZoom(K),ye="No cluster with the specified id.",be=this.trees[re];if(!be)throw new Error(ye);const Ie=be.data;if(Z*this.stride>=Ie.length)throw new Error(ye);const ke=this.options.radius/(this.options.extent*Math.pow(2,re-1)),Se=be.within(Ie[Z*this.stride],Ie[Z*this.stride+1],ke),Le=[];for(const Xe of Se){const qe=Xe*this.stride;Ie[qe+4]===K&&Le.push(Ie[qe+5]>1?Je(Ie,qe,this.clusterProps):this.points[Ie[qe+3]])}if(Le.length===0)throw new Error(ye);return Le}getLeaves(K,Z,re){const ye=[];return this._appendLeaves(ye,K,Z=Z||10,re=re||0,0),ye}getTile(K,Z,re){const ye=this.trees[this._limitZoom(K)],be=Math.pow(2,K),{extent:Ie,radius:ke}=this.options,Se=ke/Ie,Le=(re-Se)/be,Xe=(re+1+Se)/be,qe={features:[]};return this._addTileFeatures(ye.range((Z-Se)/be,Le,(Z+1+Se)/be,Xe),ye.data,Z,re,be,qe),Z===0&&this._addTileFeatures(ye.range(1-Se/be,Le,1,Xe),ye.data,be,re,be,qe),Z===be-1&&this._addTileFeatures(ye.range(0,Le,Se/be,Xe),ye.data,-1,re,be,qe),qe.features.length?qe:null}getClusterExpansionZoom(K){let Z=this._getOriginZoom(K)-1;for(;Z<=this.options.maxZoom;){const re=this.getChildren(K);if(Z++,re.length!==1)break;K=re[0].properties.cluster_id}return Z}_appendLeaves(K,Z,re,ye,be){const Ie=this.getChildren(Z);for(const ke of Ie){const Se=ke.properties;if(Se&&Se.cluster?be+Se.point_count<=ye?be+=Se.point_count:be=this._appendLeaves(K,Se.cluster_id,re,ye,be):be<ye?be++:K.push(ke),K.length===re)break}return be}_createTree(K){const Z=new f.aT(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<K.length;re+=this.stride)Z.add(K[re],K[re+1]);return Z.finish(),Z.data=K,Z}_addTileFeatures(K,Z,re,ye,be,Ie){for(const ke of K){const Se=ke*this.stride,Le=Z[Se+5]>1;let Xe,qe,ut;if(Le)Xe=ft(Z,Se,this.clusterProps),qe=Z[Se],ut=Z[Se+1];else{const dn=this.points[Z[Se+3]];Xe=dn.properties;const[nn,Re]=dn.geometry.coordinates;qe=At(nn),ut=kt(Re)}const yt={type:1,geometry:[[Math.round(this.options.extent*(qe*be-re)),Math.round(this.options.extent*(ut*be-ye))]],tags:Xe};let It;It=Le||this.options.generateId?Z[Se+3]:this.points[Z[Se+3]].id,It!==void 0&&(yt.id=It),Ie.features.push(yt)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,Z){const{radius:re,extent:ye,reduce:be,minPoints:Ie}=this.options,ke=re/(ye*Math.pow(2,Z)),Se=K.data,Le=[],Xe=this.stride;for(let qe=0;qe<Se.length;qe+=Xe){if(Se[qe+2]<=Z)continue;Se[qe+2]=Z;const ut=Se[qe],yt=Se[qe+1],It=K.within(Se[qe],Se[qe+1],ke),dn=Se[qe+5];let nn=dn;for(const Re of It){const mn=Re*Xe;Se[mn+2]>Z&&(nn+=Se[mn+5])}if(nn>dn&&nn>=Ie){let Re,mn=ut*dn,zr=yt*dn,Mt=-1;const un=(qe/Xe<<5)+(Z+1)+this.points.length;for(const Or of It){const Cn=Or*Xe;if(Se[Cn+2]<=Z)continue;Se[Cn+2]=Z;const Un=Se[Cn+5];mn+=Se[Cn]*Un,zr+=Se[Cn+1]*Un,Se[Cn+4]=un,be&&(Re||(Re=this._map(Se,qe,!0),Mt=this.clusterProps.length,this.clusterProps.push(Re)),be(Re,this._map(Se,Cn)))}Se[qe+4]=un,Le.push(mn/nn,zr/nn,1/0,un,-1,nn),be&&Le.push(Mt)}else{for(let Re=0;Re<Xe;Re++)Le.push(Se[qe+Re]);if(nn>1)for(const Re of It){const mn=Re*Xe;if(!(Se[mn+2]<=Z)){Se[mn+2]=Z;for(let zr=0;zr<Xe;zr++)Le.push(Se[mn+zr])}}}}return Le}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,Z,re){if(K[Z+5]>1){const Ie=this.clusterProps[K[Z+6]];return re?Object.assign({},Ie):Ie}const ye=this.points[K[Z+3]].properties,be=this.options.map(ye);return re&&be===ye?Object.assign({},be):be}}function Je(Ce,K,Z){return{type:"Feature",id:Ce[K+3],properties:ft(Ce,K,Z),geometry:{type:"Point",coordinates:[(re=Ce[K],360*(re-.5)),gt(Ce[K+1])]}};var re}function ft(Ce,K,Z){const re=Ce[K+5],ye=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,be=Ce[K+6],Ie=be===-1?{}:Object.assign({},Z[be]);return Object.assign(Ie,{cluster:!0,cluster_id:Ce[K+3],point_count:re,point_count_abbreviated:ye})}function At(Ce){return Ce/360+.5}function kt(Ce){const K=Math.sin(Ce*Math.PI/180),Z=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Z<0?0:Z>1?1:Z}function gt(Ce){const K=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function We(Ce,K,Z,re){let ye=re;const be=K+(Z-K>>1);let Ie,ke=Z-K;const Se=Ce[K],Le=Ce[K+1],Xe=Ce[Z],qe=Ce[Z+1];for(let ut=K+3;ut<Z;ut+=3){const yt=wt(Ce[ut],Ce[ut+1],Se,Le,Xe,qe);if(yt>ye)Ie=ut,ye=yt;else if(yt===ye){const It=Math.abs(ut-be);It<ke&&(Ie=ut,ke=It)}}ye>re&&(Ie-K>3&&We(Ce,K,Ie,re),Ce[Ie+2]=ye,Z-Ie>3&&We(Ce,Ie,Z,re))}function wt(Ce,K,Z,re,ye,be){let Ie=ye-Z,ke=be-re;if(Ie!==0||ke!==0){const Se=((Ce-Z)*Ie+(K-re)*ke)/(Ie*Ie+ke*ke);Se>1?(Z=ye,re=be):Se>0&&(Z+=Ie*Se,re+=ke*Se)}return Ie=Ce-Z,ke=K-re,Ie*Ie+ke*ke}function bt(Ce,K,Z,re){const ye={id:Ce??null,type:K,geometry:Z,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")Ye(ye,Z);else if(K==="Polygon")Ye(ye,Z[0]);else if(K==="MultiLineString")for(const be of Z)Ye(ye,be);else if(K==="MultiPolygon")for(const be of Z)Ye(ye,be[0]);return ye}function Ye(Ce,K){for(let Z=0;Z<K.length;Z+=3)Ce.minX=Math.min(Ce.minX,K[Z]),Ce.minY=Math.min(Ce.minY,K[Z+1]),Ce.maxX=Math.max(Ce.maxX,K[Z]),Ce.maxY=Math.max(Ce.maxY,K[Z+1])}function Pe(Ce,K,Z,re){if(!K.geometry)return;const ye=K.geometry.coordinates;if(ye&&ye.length===0)return;const be=K.geometry.type,Ie=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2);let ke=[],Se=K.id;if(Z.promoteId?Se=K.properties[Z.promoteId]:Z.generateId&&(Se=re||0),be==="Point")at(ye,ke);else if(be==="MultiPoint")for(const Le of ye)at(Le,ke);else if(be==="LineString")mt(ye,ke,Ie,!1);else if(be==="MultiLineString"){if(Z.lineMetrics){for(const Le of ye)ke=[],mt(Le,ke,Ie,!1),Ce.push(bt(Se,"LineString",ke,K.properties));return}Pt(ye,ke,Ie,!1)}else if(be==="Polygon")Pt(ye,ke,Ie,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const Le of K.geometry.geometries)Pe(Ce,{id:Se,geometry:Le,properties:K.properties},Z,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Le of ye){const Xe=[];Pt(Le,Xe,Ie,!0),ke.push(Xe)}}Ce.push(bt(Se,be,ke,K.properties))}function at(Ce,K){K.push(sn(Ce[0]),an(Ce[1]),0)}function mt(Ce,K,Z,re){let ye,be,Ie=0;for(let Se=0;Se<Ce.length;Se++){const Le=sn(Ce[Se][0]),Xe=an(Ce[Se][1]);K.push(Le,Xe,0),Se>0&&(Ie+=re?(ye*Xe-Le*be)/2:Math.sqrt(Math.pow(Le-ye,2)+Math.pow(Xe-be,2))),ye=Le,be=Xe}const ke=K.length-3;K[2]=1,We(K,0,ke,Z),K[ke+2]=1,K.size=Math.abs(Ie),K.start=0,K.end=K.size}function Pt(Ce,K,Z,re){for(let ye=0;ye<Ce.length;ye++){const be=[];mt(Ce[ye],be,Z,re),K.push(be)}}function sn(Ce){return Ce/360+.5}function an(Ce){const K=Math.sin(Ce*Math.PI/180),Z=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Z<0?0:Z>1?1:Z}function tn(Ce,K,Z,re,ye,be,Ie,ke){if(re/=K,be>=(Z/=K)&&Ie<re)return Ce;if(Ie<Z||be>=re)return null;const Se=[];for(const Le of Ce){const Xe=Le.geometry;let qe=Le.type;const ut=ye===0?Le.minX:Le.minY,yt=ye===0?Le.maxX:Le.maxY;if(ut>=Z&&yt<re){Se.push(Le);continue}if(yt<Z||ut>=re)continue;let It=[];if(qe==="Point"||qe==="MultiPoint")fn(Xe,It,Z,re,ye);else if(qe==="LineString")Yn(Xe,It,Z,re,ye,!1,ke.lineMetrics);else if(qe==="MultiLineString")wn(Xe,It,Z,re,ye,!1);else if(qe==="Polygon")wn(Xe,It,Z,re,ye,!0);else if(qe==="MultiPolygon")for(const dn of Xe){const nn=[];wn(dn,nn,Z,re,ye,!0),nn.length&&It.push(nn)}if(It.length){if(ke.lineMetrics&&qe==="LineString"){for(const dn of It)Se.push(bt(Le.id,qe,dn,Le.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(It.length===1?(qe="LineString",It=It[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=It.length===3?"Point":"MultiPoint"),Se.push(bt(Le.id,qe,It,Le.tags))}}return Se.length?Se:null}function fn(Ce,K,Z,re,ye){for(let be=0;be<Ce.length;be+=3){const Ie=Ce[be+ye];Ie>=Z&&Ie<=re&&Nr(K,Ce[be],Ce[be+1],Ce[be+2])}}function Yn(Ce,K,Z,re,ye,be,Ie){let ke=vr(Ce);const Se=ye===0?Ca:ki;let Le,Xe,qe=Ce.start;for(let nn=0;nn<Ce.length-3;nn+=3){const Re=Ce[nn],mn=Ce[nn+1],zr=Ce[nn+2],Mt=Ce[nn+3],un=Ce[nn+4],Or=ye===0?Re:mn,Cn=ye===0?Mt:un;let Un=!1;Ie&&(Le=Math.sqrt(Math.pow(Re-Mt,2)+Math.pow(mn-un,2))),Or<Z?Cn>Z&&(Xe=Se(ke,Re,mn,Mt,un,Z),Ie&&(ke.start=qe+Le*Xe)):Or>re?Cn<re&&(Xe=Se(ke,Re,mn,Mt,un,re),Ie&&(ke.start=qe+Le*Xe)):Nr(ke,Re,mn,zr),Cn<Z&&Or>=Z&&(Xe=Se(ke,Re,mn,Mt,un,Z),Un=!0),Cn>re&&Or<=re&&(Xe=Se(ke,Re,mn,Mt,un,re),Un=!0),!be&&Un&&(Ie&&(ke.end=qe+Le*Xe),K.push(ke),ke=vr(Ce)),Ie&&(qe+=Le)}let ut=Ce.length-3;const yt=Ce[ut],It=Ce[ut+1],dn=ye===0?yt:It;dn>=Z&&dn<=re&&Nr(ke,yt,It,Ce[ut+2]),ut=ke.length-3,be&&ut>=3&&(ke[ut]!==ke[0]||ke[ut+1]!==ke[1])&&Nr(ke,ke[0],ke[1],ke[2]),ke.length&&K.push(ke)}function vr(Ce){const K=[];return K.size=Ce.size,K.start=Ce.start,K.end=Ce.end,K}function wn(Ce,K,Z,re,ye,be){for(const Ie of Ce)Yn(Ie,K,Z,re,ye,be,!1)}function Nr(Ce,K,Z,re){Ce.push(K,Z,re)}function Ca(Ce,K,Z,re,ye,be){const Ie=(be-K)/(re-K);return Nr(Ce,be,Z+(ye-Z)*Ie,1),Ie}function ki(Ce,K,Z,re,ye,be){const Ie=(be-Z)/(ye-Z);return Nr(Ce,K+(re-K)*Ie,be,1),Ie}function zs(Ce,K){const Z=[];for(let re=0;re<Ce.length;re++){const ye=Ce[re],be=ye.type;let Ie;if(be==="Point"||be==="MultiPoint"||be==="LineString")Ie=ir(ye.geometry,K);else if(be==="MultiLineString"||be==="Polygon"){Ie=[];for(const ke of ye.geometry)Ie.push(ir(ke,K))}else if(be==="MultiPolygon"){Ie=[];for(const ke of ye.geometry){const Se=[];for(const Le of ke)Se.push(ir(Le,K));Ie.push(Se)}}Z.push(bt(ye.id,be,Ie,ye.tags))}return Z}function ir(Ce,K){const Z=[];Z.size=Ce.size,Ce.start!==void 0&&(Z.start=Ce.start,Z.end=Ce.end);for(let re=0;re<Ce.length;re+=3)Z.push(Ce[re]+K,Ce[re+1],Ce[re+2]);return Z}function mi(Ce,K){if(Ce.transformed)return Ce;const Z=1<<Ce.z,re=Ce.x,ye=Ce.y;for(const be of Ce.features){const Ie=be.geometry,ke=be.type;if(be.geometry=[],ke===1)for(let Se=0;Se<Ie.length;Se+=2)be.geometry.push(Fi(Ie[Se],Ie[Se+1],K,Z,re,ye));else for(let Se=0;Se<Ie.length;Se++){const Le=[];for(let Xe=0;Xe<Ie[Se].length;Xe+=2)Le.push(Fi(Ie[Se][Xe],Ie[Se][Xe+1],K,Z,re,ye));be.geometry.push(Le)}}return Ce.transformed=!0,Ce}function Fi(Ce,K,Z,re,ye,be){return[Math.round(Z*(Ce*re-ye)),Math.round(Z*(K*re-be))]}function In(Ce,K,Z,re,ye){const be=K===ye.maxZoom?0:ye.tolerance/((1<<K)*ye.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:Z,y:re,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ke of Ce)tt(Ie,ke,be,ye);return Ie}function tt(Ce,K,Z,re){const ye=K.geometry,be=K.type,Ie=[];if(Ce.minX=Math.min(Ce.minX,K.minX),Ce.minY=Math.min(Ce.minY,K.minY),Ce.maxX=Math.max(Ce.maxX,K.maxX),Ce.maxY=Math.max(Ce.maxY,K.maxY),be==="Point"||be==="MultiPoint")for(let ke=0;ke<ye.length;ke+=3)Ie.push(ye[ke],ye[ke+1]),Ce.numPoints++,Ce.numSimplified++;else if(be==="LineString")Ut(Ie,ye,Ce,Z,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let ke=0;ke<ye.length;ke++)Ut(Ie,ye[ke],Ce,Z,be==="Polygon",ke===0);else if(be==="MultiPolygon")for(let ke=0;ke<ye.length;ke++){const Se=ye[ke];for(let Le=0;Le<Se.length;Le++)Ut(Ie,Se[Le],Ce,Z,!0,Le===0)}if(Ie.length){let ke=K.tags||null;if(be==="LineString"&&re.lineMetrics){ke={};for(const Le in K.tags)ke[Le]=K.tags[Le];ke.mapbox_clip_start=ye.start/ye.size,ke.mapbox_clip_end=ye.end/ye.size}const Se={geometry:Ie,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:ke};K.id!==null&&(Se.id=K.id),Ce.features.push(Se)}}function Ut(Ce,K,Z,re,ye,be){const Ie=re*re;if(re>0&&K.size<(ye?Ie:re))return void(Z.numPoints+=K.length/3);const ke=[];for(let Se=0;Se<K.length;Se+=3)(re===0||K[Se+2]>Ie)&&(Z.numSimplified++,ke.push(K[Se],K[Se+1])),Z.numPoints++;ye&&function(Se,Le){let Xe=0;for(let qe=0,ut=Se.length,yt=ut-2;qe<ut;yt=qe,qe+=2)Xe+=(Se[qe]-Se[yt])*(Se[qe+1]+Se[yt+1]);if(Xe>0===Le)for(let qe=0,ut=Se.length;qe<ut/2;qe+=2){const yt=Se[qe],It=Se[qe+1];Se[qe]=Se[ut-2-qe],Se[qe+1]=Se[ut-1-qe],Se[ut-2-qe]=yt,Se[ut-1-qe]=It}}(ke,be),Ce.push(ke)}const Dt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Wt{constructor(K,Z){const re=(Z=this.options=function(be,Ie){for(const ke in Ie)be[ke]=Ie[ke];return be}(Object.create(Dt),Z)).debug;if(re&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(be,Ie){const ke=[];if(be.type==="FeatureCollection")for(let Se=0;Se<be.features.length;Se++)Pe(ke,be.features[Se],Ie,Se);else Pe(ke,be.type==="Feature"?be:{geometry:be},Ie);return ke}(K,Z);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(be,Ie){const ke=Ie.buffer/Ie.extent;let Se=be;const Le=tn(be,1,-1-ke,ke,0,-1,2,Ie),Xe=tn(be,1,1-ke,2+ke,0,-1,2,Ie);return(Le||Xe)&&(Se=tn(be,1,-ke,1+ke,0,-1,2,Ie)||[],Le&&(Se=zs(Le,1).concat(Se)),Xe&&(Se=Se.concat(zs(Xe,-1)))),Se}(ye,Z),ye.length&&this.splitTile(ye,0,0,0),re&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,Z,re,ye,be,Ie,ke){const Se=[K,Z,re,ye],Le=this.options,Xe=Le.debug;for(;Se.length;){ye=Se.pop(),re=Se.pop(),Z=Se.pop(),K=Se.pop();const qe=1<<Z,ut=Ct(Z,re,ye);let yt=this.tiles[ut];if(!yt&&(Xe>1&&console.time("creation"),yt=this.tiles[ut]=In(K,Z,re,ye,Le),this.tileCoords.push({z:Z,x:re,y:ye}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,re,ye,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));const Un=`z${Z}`;this.stats[Un]=(this.stats[Un]||0)+1,this.total++}if(yt.source=K,be==null){if(Z===Le.indexMaxZoom||yt.numPoints<=Le.indexMaxPoints)continue}else{if(Z===Le.maxZoom||Z===be)continue;if(be!=null){const Un=be-Z;if(re!==Ie>>Un||ye!==ke>>Un)continue}}if(yt.source=null,K.length===0)continue;Xe>1&&console.time("clipping");const It=.5*Le.buffer/Le.extent,dn=.5-It,nn=.5+It,Re=1+It;let mn=null,zr=null,Mt=null,un=null,Or=tn(K,qe,re-It,re+nn,0,yt.minX,yt.maxX,Le),Cn=tn(K,qe,re+dn,re+Re,0,yt.minX,yt.maxX,Le);K=null,Or&&(mn=tn(Or,qe,ye-It,ye+nn,1,yt.minY,yt.maxY,Le),zr=tn(Or,qe,ye+dn,ye+Re,1,yt.minY,yt.maxY,Le),Or=null),Cn&&(Mt=tn(Cn,qe,ye-It,ye+nn,1,yt.minY,yt.maxY,Le),un=tn(Cn,qe,ye+dn,ye+Re,1,yt.minY,yt.maxY,Le),Cn=null),Xe>1&&console.timeEnd("clipping"),Se.push(mn||[],Z+1,2*re,2*ye),Se.push(zr||[],Z+1,2*re,2*ye+1),Se.push(Mt||[],Z+1,2*re+1,2*ye),Se.push(un||[],Z+1,2*re+1,2*ye+1)}}getTile(K,Z,re){K=+K,Z=+Z,re=+re;const ye=this.options,{extent:be,debug:Ie}=ye;if(K<0||K>24)return null;const ke=1<<K,Se=Ct(K,Z=Z+ke&ke-1,re);if(this.tiles[Se])return mi(this.tiles[Se],be);Ie>1&&console.log("drilling down to z%d-%d-%d",K,Z,re);let Le,Xe=K,qe=Z,ut=re;for(;!Le&&Xe>0;)Xe--,qe>>=1,ut>>=1,Le=this.tiles[Ct(Xe,qe,ut)];return Le&&Le.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",Xe,qe,ut),console.time("drilling down")),this.splitTile(Le.source,Xe,qe,ut,K,Z,re),Ie>1&&console.timeEnd("drilling down"),this.tiles[Se]?mi(this.tiles[Se],be):null):null}}function Ct(Ce,K,Z){return 32*((1<<Ce)*Z+K)+Ce}class Lr extends G{constructor(K,Z,re,ye=ei){super(K,Z,re),this._dataUpdateable=new Map,this._createGeoJSONIndex=ye}loadVectorTile(K,Z){return f._(this,void 0,void 0,function*(){const re=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ye=this._geoJSONIndex.getTile(re.z,re.x,re.y);return ye?W(new f.d2(ye.features,{version:2,extent:f.a5})):null})}loadData(K){return f._(this,void 0,void 0,function*(){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.abort();const re=this._startPerformance(K);this._pendingRequest=new AbortController;try{(!this._pendingData||K.request||K.data||K.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(K,this._pendingRequest));const ye=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ye,K),this.loaded={};const be={};return K.request&&(be.data=ye),this._finishPerformance(re,K,be),be}catch(ye){if(delete this._pendingRequest,f.Z(ye))return{abandoned:!0};throw ye}})}_startPerformance(K){var Z;if(!((Z=K==null?void 0:K.request)===null||Z===void 0)&&Z.collectResourceTiming)return new f.c_(K.request)}_finishPerformance(K,Z,re){if(!K)return;const ye=K.finish();ye&&(re.resourceTiming={},re.resourceTiming[Z.source]=JSON.parse(JSON.stringify(ye)))}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(K){const Z=this.loaded;return Z&&Z[K.uid]?super.reloadTile(K):this.loadTile(K)}loadAndProcessGeoJSON(K,Z){return f._(this,void 0,void 0,function*(){let re;if(K.request?re=yield this.loadGeoJSONFromUrl(K.request,K.promoteId,Z):K.data?re=this._loadGeoJSONFromObject(K.data,K.promoteId):K.dataDiff&&(re=this._loadGeoJSONFromDiff(K.dataDiff,K.promoteId,K.source)),delete this._pendingRequest,typeof re!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);return ve(re,!0),K.filter&&(re=this._filterGeoJSON(re,K.filter)),re})}loadGeoJSONFromUrl(K,Z,re){return f._(this,void 0,void 0,function*(){const ye=yield f.j(K,re);return this._dataUpdateable=f.a7(ye.data,Z),ye.data})}_loadGeoJSONFromObject(K,Z){return this._dataUpdateable=f.a7(K,Z),K}_loadGeoJSONFromDiff(K,Z,re){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${re}`);f.a8(this._dataUpdateable,K,Z);const ye=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ye)}_filterGeoJSON(K,Z){const re=f.d3(Z,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(be=>`${be.key}: ${be.message}`).join(", "));const ye=K.features.filter(be=>re.value.evaluate({zoom:0},be));return this._toFeatureCollection(ye)}_toFeatureCollection(K){return{type:"FeatureCollection",features:K}}removeSource(K){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}function ei(Ce,K){return K.cluster?new Ge(function({superclusterOptions:Z,clusterProperties:re}){if(!re||!Z)return Z;const ye={},be={},Ie={accumulated:null,zoom:0},ke={properties:null},Se=Object.keys(re);for(const Le of Se){const[Xe,qe]=re[Le],ut=f.d3(qe),yt=f.d3(typeof Xe=="string"?[Xe,["accumulated"],["get",Le]]:Xe);ye[Le]=ut.value,be[Le]=yt.value}return Z.map=Le=>{ke.properties=Le;const Xe={};for(const qe of Se)Xe[qe]=ye[qe].evaluate(Ie,ke);return Xe},Z.reduce=(Le,Xe)=>{ke.properties=Xe;for(const qe of Se)Ie.accumulated=Le[qe],Le[qe]=be[qe].evaluate(Ie,ke)},Z}(K)).load(Ce.features):function(Z,re){return new Wt(Z,re)}(Ce,K.geojsonVtOptions)}class Mn{constructor(K){this.self=K,this.actor=new f.L(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Z,re)=>{if(this.externalWorkerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.externalWorkerSourceTypes[Z]=re},this.self.addProtocol=f.cJ,this.self.removeProtocol=f.cK,this.self.registerRTLTextPlugin=Z=>{f.d4.setMethods(Z)},this.actor.registerMessageHandler("LDT",(Z,re)=>this._getDEMWorkerSource(Z,re.source).loadTile(re)),this.actor.registerMessageHandler("RDT",(Z,re)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Z,re.source).removeTile(re)})),this.actor.registerMessageHandler("GCEZ",(Z,re)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,re.type,re.source).getClusterExpansionZoom(re)})),this.actor.registerMessageHandler("GCC",(Z,re)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,re.type,re.source).getClusterChildren(re)})),this.actor.registerMessageHandler("GCL",(Z,re)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,re.type,re.source).getClusterLeaves(re)})),this.actor.registerMessageHandler("LD",(Z,re)=>this._getWorkerSource(Z,re.type,re.source).loadData(re)),this.actor.registerMessageHandler("GD",(Z,re)=>this._getWorkerSource(Z,re.type,re.source).getData()),this.actor.registerMessageHandler("LT",(Z,re)=>this._getWorkerSource(Z,re.type,re.source).loadTile(re)),this.actor.registerMessageHandler("RT",(Z,re)=>this._getWorkerSource(Z,re.type,re.source).reloadTile(re)),this.actor.registerMessageHandler("AT",(Z,re)=>this._getWorkerSource(Z,re.type,re.source).abortTile(re)),this.actor.registerMessageHandler("RMT",(Z,re)=>this._getWorkerSource(Z,re.type,re.source).removeTile(re)),this.actor.registerMessageHandler("RS",(Z,re)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[Z]||!this.workerSources[Z][re.type]||!this.workerSources[Z][re.type][re.source])return;const ye=this.workerSources[Z][re.type][re.source];delete this.workerSources[Z][re.type][re.source],ye.removeSource!==void 0&&ye.removeSource(re)})),this.actor.registerMessageHandler("RM",Z=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],this.globalStates.delete(Z)})),this.actor.registerMessageHandler("SR",(Z,re)=>f._(this,void 0,void 0,function*(){this.referrer=re})),this.actor.registerMessageHandler("SRPS",(Z,re)=>this._syncRTLPluginState(Z,re)),this.actor.registerMessageHandler("IS",(Z,re)=>f._(this,void 0,void 0,function*(){this.self.importScripts(re)})),this.actor.registerMessageHandler("SI",(Z,re)=>this._setImages(Z,re)),this.actor.registerMessageHandler("UL",(Z,re)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(Z).update(re.layers,re.removedIds,this._getGlobalState(Z))})),this.actor.registerMessageHandler("UGS",(Z,re)=>f._(this,void 0,void 0,function*(){const ye=this._getGlobalState(Z);for(const be in re)ye[be]=re[be]})),this.actor.registerMessageHandler("SL",(Z,re)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(Z).replace(re,this._getGlobalState(Z))}))}_getGlobalState(K){let Z=this.globalStates.get(K);return Z||(Z={},this.globalStates.set(K,Z)),Z}_setImages(K,Z){return f._(this,void 0,void 0,function*(){this.availableImages[K]=Z;for(const re in this.workerSources[K]){const ye=this.workerSources[K][re];for(const be in ye)ye[be].availableImages=Z}})}_syncRTLPluginState(K,Z){return f._(this,void 0,void 0,function*(){return yield f.d4.syncState(Z,this.self.importScripts)})}_getAvailableImages(K){let Z=this.availableImages[K];return Z||(Z=[]),Z}_getLayerIndex(K){let Z=this.layerIndexes[K];return Z||(Z=this.layerIndexes[K]=new c),Z}_getWorkerSource(K,Z,re){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][Z]||(this.workerSources[K][Z]={}),!this.workerSources[K][Z][re]){const ye={sendAsync:(be,Ie)=>(be.targetMapId=K,this.actor.sendAsync(be,Ie))};switch(Z){case"vector":this.workerSources[K][Z][re]=new G(ye,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][Z][re]=new Lr(ye,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][Z][re]=new this.externalWorkerSourceTypes[Z](ye,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][Z][re]}_getDEMWorkerSource(K,Z){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][Z]||(this.demWorkerSources[K][Z]=new J),this.demWorkerSources[K][Z]}}return f.i(self)&&(self.worker=new Mn(self)),Mn}),h("index",["exports","./shared"],function(f,c){var E="5.16.0";function C(){var v=new c.A(4);return c.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let R,L,B;const X={frame(v,r,l){const d=requestAnimationFrame(x=>{g(),r(x)}),{unsubscribe:g}=c.s(v.signal,"abort",()=>{g(),cancelAnimationFrame(d),l(new c.a(v.signal.reason))},!1)},frameAsync(v){return new Promise((r,l)=>{this.frame(v,r,l)})},getImageData(v,r=0){return this.getImageCanvasContext(v).getImageData(-r,-r,v.width+2*r,v.height+2*r)},getImageCanvasContext(v){const r=window.document.createElement("canvas"),l=r.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return r.width=v.width,r.height=v.height,l.drawImage(v,0,0,v.width,v.height),l},resolveURL:v=>(R||(R=document.createElement("a")),R.href=v,R.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return B!==void 0?B:!!matchMedia&&(L==null&&(L=matchMedia("(prefers-reduced-motion: reduce)")),L.matches)},set prefersReducedMotion(v){B=v}},W=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(v){this._frozenAt=v}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function te(){return W.getCurrentTime()}class G{static testProp(r){if(!G.docStyle)return r[0];for(let l=0;l<r.length;l++)if(r[l]in G.docStyle)return r[l];return r[0]}static create(r,l,d){const g=window.document.createElement(r);return l!==void 0&&(g.className=l),d&&d.appendChild(g),g}static createNS(r,l){return window.document.createElementNS(r,l)}static disableDrag(){G.docStyle&&G.selectProp&&(G.userSelect=G.docStyle[G.selectProp],G.docStyle[G.selectProp]="none")}static enableDrag(){G.docStyle&&G.selectProp&&(G.docStyle[G.selectProp]=G.userSelect)}static setTransform(r,l){r.style[G.transformProp]=l}static addEventListener(r,l,d,g={}){r.addEventListener(l,d,"passive"in g?g:g.capture)}static removeEventListener(r,l,d,g={}){r.removeEventListener(l,d,"passive"in g?g:g.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",G.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",G.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",G.suppressClickInternal,!0)},0)}static getScale(r){const l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}static getPoint(r,l,d){const g=l.boundingClientRect;return new c.P((d.clientX-g.left)/l.x-r.clientLeft,(d.clientY-g.top)/l.y-r.clientTop)}static mousePos(r,l){const d=G.getScale(r);return G.getPoint(r,d,l)}static touchPos(r,l){const d=[],g=G.getScale(r);for(let x=0;x<l.length;x++)d.push(G.getPoint(r,g,l[x]));return d}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}static sanitize(r){const l=new DOMParser().parseFromString(r,"text/html").body||document.createElement("body"),d=l.querySelectorAll("script");for(const g of d)g.remove();return G.clean(l),l.innerHTML}static isPossiblyDangerous(r,l){const d=l.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(r)||!d.includes("javascript:")&&!d.includes("data:"))||!!r.startsWith("on")||void 0}static clean(r){const l=r.children;for(const d of l)G.removeAttributes(d),G.clean(d)}static removeAttributes(r){for(const{name:l,value:d}of r.attributes)G.isPossiblyDangerous(l,d)&&r.removeAttribute(l)}}G.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,G.selectProp=G.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),G.transformProp=G.testProp(["transform","WebkitTransform"]);const J={supported:!1,testSupport:function(v){!le&&Q&&(ve?Ee(v):H=v)}};let H,Q,le=!1,ve=!1;function Ee(v){const r=v.createTexture();v.bindTexture(v.TEXTURE_2D,r);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Q),v.isContextLost())return;J.supported=!0}catch{}v.deleteTexture(r),le=!0}var _e;typeof document<"u"&&(Q=document.createElement("img"),Q.onload=()=>{H&&Ee(H),H=null,ve=!0},Q.onerror=()=>{le=!0,H=null},Q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let r,l,d,g;v.resetRequestQueue=()=>{r=[],l=0,d=0,g={}},v.addThrottleControl=A=>{const M=d++;return g[M]=A,M},v.removeThrottleControl=A=>{delete g[A],w()},v.getImage=(A,M,j=!0)=>new Promise((F,O)=>{J.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),c.e(A,{type:"image"}),r.push({abortController:M,requestParameters:A,supportImageRefresh:j,state:"queued",onError:$=>{O($)},onSuccess:$=>{F($)}}),w()});const x=A=>c._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:M,supportImageRefresh:j,onError:F,onSuccess:O,abortController:$}=A,Y=j===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((ae,he)=>ae&&he==="accept",!0));l++;const se=Y?P(M,$):c.m(M,$);try{const ae=yield se;delete A.abortController,A.state="completed",ae.data instanceof HTMLImageElement||c.b(ae.data)?O(ae):ae.data&&O({data:yield(oe=ae.data,typeof createImageBitmap=="function"?c.f(oe):c.h(oe)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete A.abortController,F(ae)}finally{l--,w()}var oe}),w=()=>{const A=(()=>{for(const M of Object.keys(g))if(g[M]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=l;M<A&&r.length>0;M++){const j=r.shift();j.abortController.signal.aborted?M--:x(j)}},P=(A,M)=>new Promise((j,F)=>{const O=new Image,$=A.url,Y=A.credentials;Y&&Y==="include"?O.crossOrigin="use-credentials":(Y&&Y==="same-origin"||!c.d($))&&(O.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{O.src="",F(new c.a(M.signal.reason))}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,j({data:O})},O.onerror=()=>{O.onerror=O.onload=null,M.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=$})}(_e||(_e={})),_e.resetRequestQueue();class we{constructor(r){this._transformRequestFn=r??null}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}setTransformRequest(r){this._transformRequestFn=r}}function Ge(v){const r=[];if(typeof v=="string")r.push({id:"default",url:v});else if(v&&v.length>0){const l=[];for(const{id:d,url:g}of v){const x=`${d}${g}`;l.indexOf(x)===-1&&(l.push(x),r.push({id:d,url:g}))}}return r}function Je(v,r,l){try{const d=new URL(v);return d.pathname+=`${r}${l}`,d.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ft(v){const{userImage:r}=v;return!!(r&&r.render&&r.render())&&(v.data.replace(new Uint8Array(r.data.buffer)),!0)}class At extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const r of Object.keys(this.images))this.removeImage(r);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,promiseResolve:d}of this.requestors)d(this._getImagesForIds(l));this.requestors=[]}}getImage(r){const l=this.images[r];if(l&&!l.data&&l.spriteData){const d=l.spriteData;l.data=new c.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),l.spriteData=null}return l}addImage(r,l){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let d=!0;const g=l.data||l.spriteData;return this._validateStretch(l.stretchX,g&&g.width)||(this.fire(new c.k(new Error(`Image "${r}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,g&&g.height)||(this.fire(new c.k(new Error(`Image "${r}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new c.k(new Error(`Image "${r}" has invalid "content" value`))),d=!1),d}_validateStretch(r,l){if(!r)return!0;let d=0;for(const g of r){if(g[0]<d||g[1]<g[0]||l<g[1])return!1;d=g[1]}return!0}_validateContent(r,l){if(!r)return!0;if(r.length!==4)return!1;const d=l.spriteData,g=d&&d.width||l.data.width,x=d&&d.height||l.data.height;return!(r[0]<0||g<r[0]||r[1]<0||x<r[1]||r[2]<0||g<r[2]||r[3]<0||x<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,l,d=!0){const g=this.getImage(r);if(d&&(g.data.width!==l.data.width||g.data.height!==l.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=g.version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((l,d)=>{let g=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(g=!1);this.isLoaded()||g?l(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:l})})}_getImagesForIds(r){const l={};for(const d of r){let g=this.getImage(d);g||(this.fire(new c.l("styleimagemissing",{id:d})),g=this.getImage(d)),g?l[d]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:c.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return l}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],d=this.getImage(r);if(!d)return null;if(l&&l.position.version===d.version)return l.position;if(l)l.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},x=new c.I(g,d);this.patterns[r]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const x in this.patterns)r.push(this.patterns[x].bin);const{w:l,h:d}=c.p(r),g=this.atlasImage;g.resize({width:l||1,height:d||1});for(const x in this.patterns){const{bin:w}=this.patterns[x],P=w.x+1,A=w.y+1,M=this.getImage(x).data,j=M.width,F=M.height;c.R.copy(M,g,{x:0,y:0},{x:P,y:A},{width:j,height:F}),c.R.copy(M,g,{x:0,y:F-1},{x:P,y:A-1},{width:j,height:1}),c.R.copy(M,g,{x:0,y:0},{x:P,y:A+F},{width:j,height:1}),c.R.copy(M,g,{x:j-1,y:0},{x:P-1,y:A},{width:1,height:F}),c.R.copy(M,g,{x:0,y:0},{x:P+j,y:A},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const d=this.getImage(l);d||c.w(`Image with ID: "${l}" was not found`),ft(d)&&this.updateImage(l,d)}}cloneImages(){const r={};for(const l in this.images){const d=this.images[l];r[l]=Object.assign(Object.assign({},d),{data:d.data?d.data.clone():null})}return r}}const kt=1e20;function gt(v,r,l,d,g,x,w,P,A){for(let M=r;M<r+d;M++)We(v,l*x+M,x,g,w,P,A);for(let M=l;M<l+g;M++)We(v,M*x+r,1,d,w,P,A)}function We(v,r,l,d,g,x,w){x[0]=0,w[0]=-kt,w[1]=kt,g[0]=v[r];for(let P=1,A=0,M=0;P<d;P++){g[P]=v[r+P*l];const j=P*P;do{const F=x[A];M=(g[P]-g[F]+j-F*F)/(P-F)/2}while(M<=w[A]&&--A>-1);A++,x[A]=P,w[A]=M,w[A+1]=kt}for(let P=0,A=0;P<d;P++){for(;w[A+1]<P;)A++;const M=x[A],j=P-M;v[r+P*l]=g[M]+j*j}}const wt=c.v.layout_symbol["text-font"].default.join(",");class bt{constructor(r,l,d){this.requestManager=r,this.localIdeographFontFamily=l,this.entries={},this.lang=d}setURL(r){this.url=r}getGlyphs(r){return c._(this,void 0,void 0,function*(){const l=[];for(const x in r)for(const w of r[x])l.push(this._getAndCacheGlyphsPromise(x,w));const d=yield Promise.all(l),g={};for(const{stack:x,id:w,glyph:P}of d)g[x]||(g[x]={}),g[x][w]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return g})}_getAndCacheGlyphsPromise(r,l){return c._(this,void 0,void 0,function*(){let d=this.entries[r];d||(d=this.entries[r]={glyphs:{},requests:{},ranges:{}});let g=d.glyphs[l];return g!==void 0?{stack:r,id:l,glyph:g}:!this.url||this._charUsesLocalIdeographFontFamily(l)?(g=d.glyphs[l]=this._drawGlyph(d,r,l),{stack:r,id:l,glyph:g}):yield this._downloadAndCacheRangePromise(r,l)})}_downloadAndCacheRangePromise(r,l){return c._(this,void 0,void 0,function*(){const d=this.entries[r],g=Math.floor(l/256);if(d.ranges[g])return{stack:r,id:l,glyph:null};if(!d.requests[g]){const x=bt.loadGlyphRange(r,g,this.url,this.requestManager);d.requests[g]=x}try{const x=yield d.requests[g];for(const w in x)d.glyphs[+w]=x[+w];return d.ranges[g]=!0,{stack:r,id:l,glyph:x[l]||null}}catch(x){const w=d.glyphs[l]=this._drawGlyph(d,r,l);return this._warnOnMissingGlyphRange(w,g,l,x),{stack:r,id:l,glyph:w}}})}_warnOnMissingGlyphRange(r,l,d,g){const x=256*l,w=x+255,P=d.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${l}, ${x}-${w}. Rendering codepoint U+${P} locally instead. ${g}`)}_charUsesLocalIdeographFontFamily(r){return!!this.localIdeographFontFamily&&c.q(r)}_drawGlyph(r,l,d){const g=l===wt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(d),x=g?"ideographTinySDF":"tinySDF";r[x]||(r[x]=this._createTinySDF(g?this.localIdeographFontFamily:l));const w=r[x].draw(String.fromCodePoint(d)),P=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(d));return{id:d,bitmap:new c.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:P?0:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:P?0:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(r){const l=r?r.split(","):[];l.push("sans-serif");const d=l.map(g=>/[-\w]+/.test(g)?g:`'${CSS.escape(g)}'`).join(",");return new bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:this._fontWeight(l[0]),fontStyle:this._fontStyle(l[0]),lang:this.lang})}_fontStyle(r){return/italic/i.test(r)?"italic":/oblique/i.test(r)?"oblique":"normal"}_fontWeight(r){const l={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let d;for(const[g,x]of Object.entries(l))new RegExp(`\\b${g}\\b`,"i").test(r)&&(d=`${x}`);return d}destroy(){for(const r in this.entries){const l=this.entries[r];l.tinySDF&&(l.tinySDF=null),l.ideographTinySDF&&(l.ideographTinySDF=null),l.glyphs={},l.requests={},l.ranges={}}this.entries={}}}bt.loadGlyphRange=function(v,r,l,d){return c._(this,void 0,void 0,function*(){const g=256*r,x=g+255,w=d.transformRequest(l.replace("{fontstack}",v).replace("{range}",`${g}-${x}`),"Glyphs"),P=yield c.n(w,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${r}, ${g}-${x}`);const A={};for(const M of c.o(P.data))A[M.id]=M;return A})},bt.TinySDF=class{constructor({fontSize:v=24,buffer:r=3,radius:l=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:w="normal",lang:P=null}={}){this.buffer=r,this.cutoff=d,this.radius=l,this.lang=P;const A=this.size=v+4*r,M=this._createCanvas(A),j=this.ctx=M.getContext("2d",{willReadFrequently:!0});j.font=`${w} ${x} ${v}px ${g}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(v){const r=document.createElement("canvas");return r.width=r.height=v,r}draw(v){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(v),w=Math.ceil(l),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),A=Math.min(this.size-this.buffer,w+Math.ceil(d)),M=P+2*this.buffer,j=A+2*this.buffer,F=Math.max(M*j,0),O=new Uint8ClampedArray(F),$={data:O,width:M,height:j,glyphWidth:P,glyphHeight:A,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(P===0||A===0)return $;const{ctx:Y,buffer:se,gridInner:oe,gridOuter:ae}=this;this.lang&&(Y.lang=this.lang),Y.clearRect(se,se,P,A),Y.fillText(v,se,se+w);const he=Y.getImageData(se,se,P,A);ae.fill(kt,0,F),oe.fill(0,0,F);for(let ge=0;ge<A;ge++)for(let ce=0;ce<P;ce++){const fe=he.data[4*(ge*P+ce)+3]/255;if(fe===0)continue;const xe=(ge+se)*M+ce+se;if(fe===1)ae[xe]=0,oe[xe]=kt;else{const pe=.5-fe;ae[xe]=pe>0?pe*pe:0,oe[xe]=pe<0?pe*pe:0}}gt(ae,0,0,M,j,M,this.f,this.v,this.z),gt(oe,se,se,P,A,M,this.f,this.v,this.z);for(let ge=0;ge<F;ge++){const ce=Math.sqrt(ae[ge])-Math.sqrt(oe[ge]);O[ge]=Math.round(255-255*(ce/this.radius+this.cutoff))}return $}};class Ye{constructor(){this.specification=c.u.light.position}possiblyEvaluate(r,l){return c.F(r.expression.evaluate(l))}interpolate(r,l,d){return{x:c.G.number(r.x,l.x,d),y:c.G.number(r.y,l.y,d),z:c.G.number(r.z,l.z,d)}}}let Pe;class at extends c.E{constructor(r){super(),Pe=Pe||new c.t({anchor:new c.D(c.u.light.anchor),position:new Ye,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(Pe,void 0),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(c.y,r,l))for(const d in r){const g=r[d];d.endsWith(c.z)?this._transitionable.setTransition(d.slice(0,-c.z.length),g):this._transitionable.setValue(d,g)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,d){return(!d||d.validate!==!1)&&c.B(this,r.call(c.C,{value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const mt=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class Pt extends c.E{constructor(r){super(),this._transitionable=new c.x(mt,void 0),this.setSky(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(r,l={}){if(!this._validate(c.J,r,l)){r||(r={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in r){const g=r[d];d.endsWith(c.z)?this._transitionable.setTransition(d.slice(0,-c.z.length),g):this._transitionable.setValue(d,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,d={}){return(d==null?void 0:d.validate)!==!1&&c.B(this,r.call(c.C,c.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(r){return r<60?0:r<70?(r-60)/10:1}}class sn{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,l){const d=r.join(",")+String(l);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(r,l)),this.dashEntry[d]}getDashRanges(r,l,d){const g=[];let x=r.length%2==1?-r[r.length-1]*d:0,w=r[0]*d,P=!0;g.push({left:x,right:w,isDash:P,zeroLength:r[0]===0});let A=r[0];for(let M=1;M<r.length;M++){P=!P;const j=r[M];x=A*d,A+=j,w=A*d,g.push({left:x,right:w,isDash:P,zeroLength:j===0})}return g}addRoundDash(r,l,d){const g=l/2;for(let x=-d;x<=d;x++){const w=this.width*(this.nextRow+d+x);let P=0,A=r[P];for(let M=0;M<this.width;M++){M/A.right>1&&(A=r[++P]);const j=Math.abs(M-A.left),F=Math.abs(M-A.right),O=Math.min(j,F);let $;const Y=x/d*(g+1);if(A.isDash){const se=g-Math.abs(Y);$=Math.sqrt(O*O+se*se)}else $=g-Math.sqrt(O*O+Y*Y);this.data[w+M]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(r){for(let P=r.length-1;P>=0;--P){const A=r[P],M=r[P+1];A.zeroLength?r.splice(P,1):M&&M.isDash===A.isDash&&(M.left=A.left,r.splice(P,1))}const l=r[0],d=r[r.length-1];l.isDash===d.isDash&&(l.left=d.left-this.width,d.right=l.right+this.width);const g=this.width*this.nextRow;let x=0,w=r[x];for(let P=0;P<this.width;P++){P/w.right>1&&(w=r[++x]);const A=Math.abs(P-w.left),M=Math.abs(P-w.right),j=Math.min(A,M);this.data[g+P]=Math.max(0,Math.min(255,(w.isDash?j:-j)+128))}}addDash(r,l){const d=l?7:0,g=2*d+1;if(this.nextRow+g>this.height)return c.w("LineAtlas out of space"),null;let x=0;for(let P=0;P<r.length;P++)x+=r[P];if(x!==0){const P=this.width/x,A=this.getDashRanges(r,this.width,P);l?this.addRoundDash(A,P,d):this.addRegularDash(A)}const w={y:this.nextRow+d,height:2*d,width:x};return this.nextRow+=g,this.dirty=!0,w}bind(r){const l=r.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}const an="maplibre_preloaded_worker_pool";class tn{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<tn.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[an]}numActive(){return Object.keys(this.active).length}}const fn=Math.floor(X.hardwareConcurrency/2);let Yn,vr;function wn(){return Yn||(Yn=new tn),Yn}tn.workerCount=c.K(globalThis)?Math.max(Math.min(fn,3),1):1;class Nr{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=l;const d=this.workerPool.acquire(l);for(let g=0;g<d.length;g++){const x=new c.L(d[g],l);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,l){const d=[];for(const g of this.actors)d.push(g.sendAsync({type:r,data:l}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,l){for(const d of this.actors)d.registerMessageHandler(r,l)}unregisterMessageHandler(r){for(const l of this.actors)l.unregisterMessageHandler(r)}}function Ca(){return vr||(vr=new Nr(wn(),c.M),vr.registerMessageHandler("GR",(v,r,l)=>c.m(r,l))),vr}function ki(v,r){const l=c.N();return c.O(l,l,[1,1,0]),c.Q(l,l,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?c.S(l,l,v.calculatePosMatrix(r.toUnwrapped())):l}function zs(v,r,l,d,g,x,w){var P;const A=function(O,$,Y){if(O)for(const se of O){const oe=$[se];if(oe&&oe.source===Y&&oe.type==="fill-extrusion")return!0}else for(const se in $){const oe=$[se];if(oe.source===Y&&oe.type==="fill-extrusion")return!0}return!1}((P=g==null?void 0:g.layers)!==null&&P!==void 0?P:null,r,v.id),M=x.maxPitchScaleFactor(),j=v.tilesIn(d,M,A);j.sort(ir);const F=[];for(const O of j)F.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(r,l,v.getState(),O.queryGeometry,O.cameraQueryGeometry,O.scale,g,x,M,ki(x,O.tileID),w?($,Y)=>w(O.tileID,$,Y):void 0)});return function(O,$){for(const Y in O)for(const se of O[Y])mi(se,$);return O}(function(O){const $={},Y={};for(const se of O){const oe=se.queryResults,ae=se.wrappedTileID,he=Y[ae]=Y[ae]||{};for(const ge in oe){const ce=oe[ge],fe=he[ge]=he[ge]||{},xe=$[ge]=$[ge]||[];for(const pe of ce)fe[pe.featureIndex]||(fe[pe.featureIndex]=!0,xe.push(pe))}}return $}(F),v)}function ir(v,r){const l=v.tileID,d=r.tileID;return l.overscaledZ-d.overscaledZ||l.canonical.y-d.canonical.y||l.wrap-d.wrap||l.canonical.x-d.canonical.x}function mi(v,r){const l=v.feature,d=r.getFeatureState(l.layer["source-layer"],l.id);l.source=l.layer.source,l.layer["source-layer"]&&(l.sourceLayer=l.layer["source-layer"]),l.state=d}function Fi(v,r,l){return c._(this,void 0,void 0,function*(){let d=v;if(v.url?d=(yield c.j(r.transformRequest(v.url,"Source"),l)).data:yield X.frameAsync(l),!d)return null;const g=c.U(c.e(d,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(g.vectorLayerIds=d.vector_layers.map(x=>x.id)),g})}class In{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof c.V?new c.V(r.lng,r.lat):c.V.convert(r),this}setSouthWest(r){return this._sw=r instanceof c.V?new c.V(r.lng,r.lat):c.V.convert(r),this}extend(r){const l=this._sw,d=this._ne;let g,x;if(r instanceof c.V)g=r,x=r;else{if(!(r instanceof In))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(In.convert(r)):this.extend(c.V.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(c.V.convert(r)):this;if(g=r._sw,x=r._ne,!g||!x)return this}return l||d?(l.lng=Math.min(g.lng,l.lng),l.lat=Math.min(g.lat,l.lat),d.lng=Math.max(x.lng,d.lng),d.lat=Math.max(x.lat,d.lat)):(this._sw=new c.V(g.lng,g.lat),this._ne=new c.V(x.lng,x.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:d}=c.V.convert(r);let g=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}intersects(r){if(!((r=In.convert(r)).getNorth()>=this.getSouth()&&r.getSouth()<=this.getNorth()))return!1;const l=Math.abs(this.getEast()-this.getWest()),d=Math.abs(r.getEast()-r.getWest());if(l>=360||d>=360)return!0;const g=c.W(this.getWest(),-180,180),x=c.W(this.getEast(),-180,180),w=c.W(r.getWest(),-180,180),P=c.W(r.getEast(),-180,180),A=g>=x,M=w>=P;return!(!A||!M)||(A?P>=g||w<=x:M?x>=w||g<=P:w<=x&&P>=g)}static convert(r){return r instanceof In?r:r&&new In(r)}static fromLngLat(r,l=0){const d=360*l/40075017,g=d/Math.cos(Math.PI/180*r.lat);return new In(new c.V(r.lng-g,r.lat-d),new c.V(r.lng+g,r.lat+d))}adjustAntiMeridian(){const r=new c.V(this._sw.lng,this._sw.lat),l=new c.V(this._ne.lng,this._ne.lat);return new In(r,r.lng>l.lng?new c.V(l.lng+360,l.lat):l)}}class tt{constructor(r,l,d){this.bounds=In.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=d||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),d=Math.floor(c.Y(this.bounds.getWest())*l),g=Math.floor(c.X(this.bounds.getNorth())*l),x=Math.ceil(c.Y(this.bounds.getEast())*l),w=Math.ceil(c.X(this.bounds.getSouth())*l);return r.x>=d&&r.x<x&&r.y>=g&&r.y<w}}class Ut extends c.E{constructor(r,l,d,g){if(super(),this.id=r,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(l,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Fi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),r&&(c.e(this,r),r.bounds&&(this.tileBounds=new tt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,c.Z(r)||this.fire(new c.k(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(r){return c._(this,void 0,void 0,function*(){const l=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(l,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(r)};d.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((x,w)=>{r.reloadPromise={resolve:x,reject:w}})}else r.actor=this.dispatcher.getActor(),g="LT";r.abortController=new AbortController;try{const x=yield r.actor.sendAsync({type:g,data:d},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,x)}catch(x){if(delete r.abortController,r.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(r,null)}})}_getOverzoomParameters(r){if(r.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const l=r.tileID.scaledTo(this.maxzoom).canonical,d=l.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:l,overzoomRequest:this.map._requestManager.transformRequest(d,"Tile")}}_afterTileLoadWorkerResponse(r,l){if(l&&l.resourceTiming&&(r.resourceTiming=l.resourceTiming),l&&this.map._refreshExpiredTiles&&r.setExpiryData(l),r.loadVectorData(l,this.map.painter),r.reloadPromise){const d=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(d.resolve).catch(d.reject)}}abortTile(r){return c._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return c._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Dt extends c.E{constructor(r,l,d,g){super(),this.id=r,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},l),c.e(this,c.U(l,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(r=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Fi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(c.e(this,l),l.bounds&&(this.tileBounds=new tt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:r})))}catch(l){this._tileJSONRequest=null,this._loaded=!0,c.Z(l)||this.fire(new c.k(l))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load(!0)}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return c.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return c._(this,void 0,void 0,function*(){const l=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const d=yield _e.getImage(this.map._requestManager.transformRequest(l,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&r.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const g=this.map.painter.context,x=g.gl,w=d.data;r.texture=this.map.painter.getTileTexture(w.width),r.texture?r.texture.update(w,{useMipmap:!0}):(r.texture=new c.T(g,w,x.RGBA,{useMipmap:!0}),r.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),r.state="loaded"}}catch(d){if(delete r.abortController,r.aborted)r.state="unloaded";else if(d)throw r.state="errored",d}})}abortTile(r){return c._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return c._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class Wt extends Dt{constructor(r,l,d,g){super(r,l,d,g),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(r){return c._(this,void 0,void 0,function*(){const l=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(l,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const g=yield _e.getImage(d,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(g&&g.data){const x=g.data;this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&r.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const w=c.b(x)&&c.$()?x:yield this.readImageNow(x),P={type:this.type,uid:r.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const A=yield r.actor.sendAsync({type:"LDT",data:P});r.dem=A,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(g){if(delete r.abortController,r.aborted)r.state="unloaded";else if(g)throw r.state="errored",g}})}readImageNow(r){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.a0()){const l=r.width+2,d=r.height+2;try{return new c.R({width:l,height:d},yield c.a1(r,-1,-1,l,d))}catch{}}return X.getImageData(r,1)})}_getNeighboringTiles(r){const l=r.canonical,d=Math.pow(2,l.z),g=(l.x-1+d)%d,x=l.x===0?r.wrap-1:r.wrap,w=(l.x+1+d)%d,P=l.x+1===d?r.wrap+1:r.wrap,A={};return A[new c.a2(r.overscaledZ,x,l.z,g,l.y).key]={backfilled:!1},A[new c.a2(r.overscaledZ,P,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(A[new c.a2(r.overscaledZ,x,l.z,g,l.y-1).key]={backfilled:!1},A[new c.a2(r.overscaledZ,r.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new c.a2(r.overscaledZ,P,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<d&&(A[new c.a2(r.overscaledZ,x,l.z,g,l.y+1).key]={backfilled:!1},A[new c.a2(r.overscaledZ,r.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new c.a2(r.overscaledZ,P,l.z,w,l.y+1).key]={backfilled:!1}),A}unloadTile(r){return c._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}function Ct(v){return v.type==="GeometryCollection"?v.geometries.map(r=>r.coordinates).flat(1/0):v.coordinates.flat(1/0)}function Lr(v){const r=new In;let l;switch(v.type){case"FeatureCollection":l=v.features.map(d=>Ct(d.geometry)).flat(1/0);break;case"Feature":l=Ct(v.geometry);break;default:l=Ct(v)}if(l.length==0)return r;for(let d=0;d<l.length-1;d+=2)r.extend([l[d],l[d+1]]);return r}class ei extends c.E{constructor(r,l,d,g){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:l.data},this.actor=d.getActor(),this.setEventedParent(g),this._data=typeof l.data=="string"?{url:l.data}:{geojson:l.data},this._options=c.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId,l.clusterMaxZoom!==void 0&&this.maxzoom<=l.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${l.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(l.buffer!==void 0?l.buffer:128),tolerance:this._pixelsToTileUnits(l.tolerance!==void 0?l.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(l.clusterMaxZoom),minPoints:Math.max(2,l.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(l.clusterRadius||50),log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(r){return r*(c.a5/this.tileSize)}_getClusterMaxZoom(r){const l=r?Math.round(r):this.maxzoom-1;return Number.isInteger(r)||r===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${r}" rounded to "${l}"`),l}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r,l){this._data=typeof r=="string"?{url:r}:{geojson:r},this._pendingWorkerUpdate={data:r};const d=this._updateWorkerData();return l?d:this}updateData(r,l){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,r);const d=this._updateWorkerData();return l?d:this}getData(){return c._(this,void 0,void 0,function*(){const r=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:r})})}getBounds(){return c._(this,void 0,void 0,function*(){return Lr(yield this.getData())})}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(r.clusterRadius)),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(r.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,l,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:l,offset:d}})}_updateWorkerData(){return c._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:r,diff:l}=this._pendingWorkerUpdate,d=c.e({type:this.type},this.workerOptions);r!==void 0?(typeof r=="string"?(d.request=this.map._requestManager.transformRequest(X.resolveURL(r),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=r,this._pendingWorkerUpdate.data=void 0):l&&(d.dataDiff=l,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:d});if(this._isUpdatingWorker=!1,this._removed||g.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));g.data&&(this._data={geojson:g.data});const x=this._applyDiffToSource(l),w=this._getShouldReloadTileOptions(x);let P=null;g.resourceTiming&&g.resourceTiming[this.id]&&(P=g.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&P&&P.length>0&&c.e(A,{resourceTiming:P}),this.fire(new c.l("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},A),{sourceDataType:"content",shouldReloadTileOptions:w})))}catch(g){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(g))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyDiffToSource(r){if(!r)return;const l=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const g=c.a7(this._data.geojson,l);if(!g)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:g}}if(!this._data.updateable)return;const d=c.a8(this._data.updateable,r,l);return r.removeAll||this._options.cluster?void 0:d}_getShouldReloadTileOptions(r){if(r)return{affectedBounds:r.filter(Boolean).map(l=>Lr(l))}}shouldReloadTile(r,{affectedBounds:l}){if(r.state==="loading")return!0;if(r.state==="unloaded")return!1;const{buffer:d,extent:g}=this.workerOptions.geojsonVtOptions,x=function({x:w,y:P,z:A},M=0){const j=c.a3((w-M)/Math.pow(2,A)),F=c.a4((P+1+M)/Math.pow(2,A)),O=c.a3((w+1+M)/Math.pow(2,A)),$=c.a4((P-M)/Math.pow(2,A));return new In([j,F],[O,$])}(r.tileID.canonical,d/g);for(const w of l)if(x.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(r){return c._(this,void 0,void 0,function*(){const l=r.actor?"RT":"LT";r.actor=this.actor;const d={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};r.abortController=new AbortController;const g=yield this.actor.sendAsync({type:l,data:d},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(g,this.map.painter,l==="RT")})}abortTile(r){return c._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return c._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Mn extends c.E{constructor(r,l,d,g){super(),this.flippedWindingOrder=!1,this.id=r,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=l}load(r){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const l=yield _e.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,l&&l.data&&(this.image=l.data,r&&(this.coordinates=r),this._finishLoading())}catch(l){this._request=null,this._loaded=!0,c.Z(l)||this.fire(new c.k(l))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const l=r.map(c.a9.fromLngLat);var d;return this.tileID=function(g){const x=c.aa.fromPoints(g),w=x.width(),P=x.height(),A=Math.max(w,P),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),j=Math.pow(2,M);return new c.ac(M,Math.floor((x.minX+x.maxX)/2*j),Math.floor((x.minY+x.maxY)/2*j))}(l),this.terrainTileRanges=this._getOverlappingTileRanges(l),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=l.map(g=>this.tileID.getTilePoint(g)._round()),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this.texture||(this.texture=new c.T(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,d=!0)}d&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(r){const{minX:l,minY:d,maxX:g,maxY:x}=c.aa.fromPoints(r),w={};for(let P=0;P<=c.ab;P++){const A=Math.pow(2,P),M=Math.floor(l*A),j=Math.floor(d*A),F=Math.floor(g*A),O=Math.floor(x*A),$=(M%A+A)%A,Y=F%A,se=Math.floor(M/A),oe=Math.floor(F/A);w[P]={minWrap:se,maxWrap:oe,minTileXWrapped:$,maxTileXWrapped:Y,minTileY:j,maxTileY:O}}return w}}class Ce extends Mn{constructor(r,l,d,g){super(r,l,d,g),this.roundZoom=!0,this.type="video",this.options=l}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const l of r.urls)this.urls.push(this.map._requestManager.transformRequest(l,"Source").url);try{const l=yield c.ad(this.urls);if(this._loaded=!0,!l)return;this.video=l,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(l){this.fire(new c.k(l))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const l=this.video.seekable;r<l.start(0)||r>l.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,l=r.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(r,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,d=!0)}d&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class K extends Mn{constructor(r,l,d,g){super(r,l,d,g),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new c.k(new c.ae(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${r}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${r}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,d=l.gl;this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(l,this.canvas,d.RGBA,{premultiply:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let g=!1;for(const x in this.tiles){const w=this.tiles[x];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Z={},re=v=>{switch(v){case"geojson":return ei;case"image":return Mn;case"raster":return Dt;case"raster-dem":return Wt;case"vector":return Ut;case"video":return Ce;case"canvas":return K}return Z[v]},ye="RTLPluginLoaded";class be extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ca()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(l=>{throw this.status="error",l})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return c._(this,arguments,void 0,function*(l,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=X.resolveURL(l),!this.url)throw new Error(`requested url ${l} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(ye))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ie=null;function ke(){return Ie||(Ie=new be),Ie}var Se,Le;(function(v){v[v.Base=0]="Base",v[v.Parent=1]="Parent"})(Se||(Se={})),function(v){v[v.Departing=0]="Departing",v[v.Incoming=1]="Incoming"}(Le||(Le={}));class Xe{constructor(r,l){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=r,this.uid=c.af(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(r){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(r||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:r,fadingDirection:l,fadingParentID:d,fadeEndTime:g}){this.resetFadeLogic(),this.fadingRole=r,this.fadingDirection=l,this.fadingParentID=d,this.fadeEndTime=g}setSelfFadeLogic(r){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=r}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=te(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,l,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData,this.latestFeatureIndex.encoding=r.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(g,x){const w={};if(!x)return w;for(const P of g){const A=P.layerIds.map(M=>x.getLayer(M)).filter(Boolean);if(A.length!==0){P.layers=A,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(M=>A.filter(j=>j.id===M)[0]));for(const M of A)w[M.id]=P}}return w}(r.buckets,l==null?void 0:l.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof c.ah){if(this.hasSymbolBuckets=!0,!d)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof c.ah&&x.hasRTLText){this.hasRTLText=!0,ke().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(g).queryRadius(x))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),this.dashPositions=r.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,d,g,x,w,P,A,M,j,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:w,tileSize:this.tileSize,pixelPosMatrix:j,transform:A,params:P,queryPadding:this.queryPadding*M,getElevation:F},r,l,d):{}}querySourceFeatures(r,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),x=l&&l.sourceLayer?l.sourceLayer:"",w=g[c.ai]||g[x];if(!w)return;const P=c.aj(l==null?void 0:l.filter,l==null?void 0:l.globalState),{z:A,x:M,y:j}=this.tileID.canonical,F={z:A,x:M,y:j};for(let O=0;O<w.length;O++){const $=w.feature(O);if(P.needGeometry){const oe=c.ak($,!0);if(!P.filter(new c.H(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!P.filter(new c.H(this.tileID.overscaledZ),$))continue;const Y=d.getId($,x),se=new c.al($,A,M,j,Y);se.tile=F,r.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const d=c.am(r.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(l)if(this.expirationTime<l)g=!0;else{const x=this.expirationTime-l;x?this.expirationTime=d+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const x=this.buckets[g],w=x.layers[0].sourceLayer||c.ai,P=d[w],A=r[w];if(!P||!A||Object.keys(A).length===0)continue;x.update(A,P,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const M=l&&l.style&&l.style.getLayer(g);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(x)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<te()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(r){this.symbolFadeHoldUntil=te()+r}setDependencies(r,l){const d={};for(const g of l)d[g]=!0;this.dependencies[r]=d}hasDependency(r,l){for(const d of r){const g=this.dependencies[d];if(g){for(const x of l)if(g[x])return!0}}return!1}}class qe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,d){const g=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},c.e(this.stateChanges[r][g],d),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==g&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(const x in this.state[r][g])d[x]||(this.deletedStates[r][g][x]=null)}else for(const x in d)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][x]===null&&delete this.deletedStates[r][g][x]}removeFeatureState(r,l,d){if(this.deletedStates[r]===null)return;const g=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},d&&l!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][d]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(d in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][d]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,l){const d=String(l),g=c.e({},(this.state[r]||{})[d],(this.stateChanges[r]||{})[d]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const x=this.deletedStates[r][l];if(x===null)return{};for(const w in x)delete g[w]}return g}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const w in this.stateChanges[g])this.state[g][w]||(this.state[g][w]={}),c.e(this.state[g][w],this.stateChanges[g][w]),x[w]=this.state[g][w];d[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const w in this.state[g])x[w]={},this.state[g][w]={};else for(const w in this.deletedStates[g]){if(this.deletedStates[g][w]===null)this.state[g][w]={};else for(const P of Object.keys(this.deletedStates[g][w]))delete this.state[g][w][P];x[w]=this.state[g][w]}d[g]=d[g]||{},c.e(d[g],x)}this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0&&r.setFeatureState(d,l)}}const ut=89.25;function yt(v,r){const l=c.an(r.lat,-c.ao,c.ao);return new c.P(c.Y(r.lng)*v,c.X(l)*v)}function It(v,r){return new c.a9(r.x/v,r.y/v).toLngLat()}function dn(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-v.pitch)),Math.tan(c.ap(ut-v.pitch)))}function nn(v,r){const l=v.canonical,d=r/c.aq(l.z),g=l.x+Math.pow(2,l.z)*v.wrap,x=c.ar(new Float64Array(16));return c.O(x,x,[g*d,l.y*d,0]),c.Q(x,x,[d/c.a5,d/c.a5,1]),x}function Re(v,r,l,d,g){const x=c.a9.fromLngLat(v,r),w=g*c.as(1,v.lat),{x:P,y:A,z:M}=mn(l,d);return new c.a9(x.x+w*-P,x.y+w*-A,x.z+w*-M)}function mn(v,r){const l=c.ap(v),d=c.ap(r),g=Math.cos(-l),x=Math.sin(l);return{x:x*Math.sin(d),y:-x*Math.cos(d),z:g}}function zr(v,r,l){const d=r.intersectsFrustum(v);if(!l||d===0)return d;const g=r.intersectsPlane(l);return g===0?0:d===2&&g===2?2:1}function Mt(v,r,l){let d=0;const g=(l-r)/10;for(let x=0;x<10;x++)d+=g*Math.pow(Math.cos(r+(x+.5)/10*(l-r)),v);return d}function un(v,r){return function(l,d,g,x,w){const P=2*((v-1)/c.at(Math.cos(c.ap(ut-w))/Math.cos(c.ap(ut)))-1),A=Math.acos(g/x),M=2*Mt(P-1,0,c.ap(w/2)),j=Math.min(c.ap(ut),A+c.ap(w/2)),F=Mt(P-1,Math.min(j,A-c.ap(w/2)),j),O=Math.atan(d/g),$=Math.hypot(d,g);let Y=l;return Y+=c.at(x/$/Math.max(.5,Math.cos(c.ap(w/2)))),Y+=P*c.at(Math.cos(O))/2,Y-=c.at(Math.max(1,F/M/r))/2,Y}}const Or=un(9.314,3);function Cn(v,r){const l=(r.roundZoom?Math.round:Math.floor)(v.zoom+c.at(v.tileSize/r.tileSize));return Math.max(0,l)}function Un(v,r){const l=v.getCameraFrustum(),d=v.getClippingPlane(),g=v.screenPointToMercatorCoordinate(v.getCameraPoint()),x=c.a9.fromLngLat(v.center,v.elevation);g.z=x.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const w=v.getCoveringTilesDetailsProvider(),P=w.allowVariableZoom(v,r),A=Cn(v,r),M=r.minzoom||0,j=r.maxzoom!==void 0?r.maxzoom:v.maxZoom,F=Math.min(Math.max(0,A),j),O=Math.pow(2,F),$=[O*g.x,O*g.y,0],Y=[O*x.x,O*x.y,0],se=Math.hypot(x.x-g.x,x.y-g.y),oe=Math.abs(x.z-g.z),ae=Math.hypot(se,oe),he=fe=>({zoom:0,x:0,y:0,wrap:fe,fullyVisible:!1}),ge=[],ce=[];if(v.renderWorldCopies&&w.allowWorldCopies())for(let fe=1;fe<=3;fe++)ge.push(he(-fe)),ge.push(he(fe));for(ge.push(he(0));ge.length>0;){const fe=ge.pop(),xe=fe.x,pe=fe.y;let Te=fe.fullyVisible;const Oe={x:xe,y:pe,z:fe.zoom},Me=w.getTileBoundingVolume(Oe,fe.wrap,v.elevation,r);if(!Te){const nt=zr(l,Me,d);if(nt===0)continue;Te=nt===2}const De=w.distanceToTile2d(g.x,g.y,Oe,Me);let je=A;P&&(je=(r.calculateTileZoom||Or)(v.zoom+c.at(v.tileSize/r.tileSize),De,oe,ae,v.fov)),je=(r.roundZoom?Math.round:Math.floor)(je),je=Math.max(0,je);const et=Math.min(je,j);if(fe.wrap=w.getWrap(x,Oe,fe.wrap),fe.zoom>=et){if(fe.zoom<M)continue;const nt=F-fe.zoom,He=$[0]-.5-(xe<<nt),it=$[1]-.5-(pe<<nt),Rt=r.reparseOverscaled?Math.max(fe.zoom,je):fe.zoom;ce.push({tileID:new c.a2(fe.zoom===j?Rt:fe.zoom,fe.wrap,fe.zoom,xe,pe),distanceSq:c.au([Y[0]-.5-xe,Y[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(He*He+it*it)})}else for(let nt=0;nt<4;nt++)ge.push({zoom:fe.zoom+1,x:(xe<<1)+nt%2,y:(pe<<1)+(nt>>1),wrap:fe.wrap,fullyVisible:Te})}return ce.sort((fe,xe)=>fe.distanceSq-xe.distanceSq).map(fe=>fe.tileID)}const gn=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function dr(v){return v==="raster"||v==="image"||v==="video"}function El(v,r,l,d,g,x,w){if(!r.hasData())return!1;const{tileID:P,fadingRole:A,fadingDirection:M,fadingParentID:j}=r;if(A===Se.Base&&M===Le.Incoming&&j)return l[j.key]=j,!0;const F=Math.max(P.overscaledZ-g,x);for(let O=P.overscaledZ-1;O>=F;O--){const $=P.scaledTo(O),Y=v.getLoadedTile($);if(Y)return r.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:Le.Incoming,fadingParentID:Y.tileID,fadeEndTime:d+w}),Y.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:Le.Departing,fadeEndTime:d+w}),l[$.key]=$,!0}return!1}function Pl(v,r,l,d,g,x){if(!r.hasData())return!1;const w=r.tileID.children(g);let P=Qe(v,r,w,l,d,g,x);if(P)return!0;for(const A of w)Qe(v,r,A.children(g),l,d,g,x)&&(P=!0);return P}function Qe(v,r,l,d,g,x,w){if(l[0].overscaledZ>=x)return!1;let P=!1;for(const A of l){const M=v.getLoadedTile(A);if(!M)continue;const{fadingRole:j,fadingDirection:F,fadingParentID:O}=M;j===Se.Base&&F===Le.Departing&&O||(M.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:Le.Departing,fadingParentID:r.tileID,fadeEndTime:g+w}),r.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:Le.Incoming,fadeEndTime:g+w})),d[A.key]=A,P=!0}return P}function ti(v,r,l,d){const g=v.tileID;return!!v.selfFading||!v.hasData()&&!!r.has(g)&&(v.setSelfFadeLogic(l+d),!0)}function ni(v,r){var l;v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let d=r.tileID.canonical.x-v.tileID.canonical.x;const g=r.tileID.canonical.y-v.tileID.canonical.y,x=Math.pow(2,v.tileID.canonical.z),w=r.tileID.key;d===0&&g===0||Math.abs(g)>1||(Math.abs(d)>1&&(Math.abs(d+x)===1?d+=x:Math.abs(d-x)===1&&(d-=x)),r.dem&&v.dem&&(v.dem.backfillBorder(r.dem,d,g),!((l=v.neighboringTiles)===null||l===void 0)&&l[w]&&(v.neighboringTiles[w].backfilled=!0)))}class Jc{constructor(){this._tiles={}}handleWrapJump(r){const l={};for(const d in this._tiles){const g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),l[g.tileID.key]=g}this._tiles=l}setFeatureState(r,l){for(const d in this._tiles)this._tiles[d].setFeatureState(r,l)}getAllTiles(){return Object.values(this._tiles)}getAllIds(r=!1){return r?Object.values(this._tiles).map(l=>l.tileID).sort(c.aw).map(l=>l.key):Object.keys(this._tiles)}getTileById(r){return this._tiles[r]}setTile(r,l){this._tiles[r]=l}deleteTileById(r){delete this._tiles[r]}getLoadedTile(r){const l=this.getTileById(r.key);return l!=null&&l.hasData()?l:null}isIdRenderable(r,l=!1){var d;return(d=this.getTileById(r))===null||d===void 0?void 0:d.isRenderable(l)}getRenderableIds(r=0,l){const d=[];for(const g of this.getAllIds())this.isIdRenderable(g,l)&&d.push(this.getTileById(g));return l?d.sort((g,x)=>{const w=g.tileID,P=x.tileID,A=new c.P(w.canonical.x,w.canonical.y)._rotate(-r),M=new c.P(P.canonical.x,P.canonical.y)._rotate(-r);return w.overscaledZ-P.overscaledZ||M.y-A.y||M.x-A.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(c.aw).map(g=>g.key)}}class Bi extends c.E{constructor(r,l,d){super(),this.id=r,this.dispatcher=d,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,x,w,P)=>{const A=new(re(x.type))(g,x,w,P);if(A.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${A.id}`);return A})(r,l,d,this),this._inViewTiles=new Jc,this._outOfViewCache=new c.ax(0,g=>this._unloadTile(g)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new qe,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){for(const l of this._inViewTiles.getAllTiles())l.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r),this._inViewTiles=new Jc}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r of this._inViewTiles.getAllTiles())if(r.state!=="loaded"&&r.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,l,d){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,l,d)}catch(g){r.state="errored",g.status!==404?this._source.fire(new c.k(g,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new c.l("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const l of this._inViewTiles.getAllTiles())l.upload(r),l.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(r){var l;return this._inViewTiles.getRenderableIds((l=this.transform)===null||l===void 0?void 0:l.bearingInRadians,r)}hasRenderableParent(r){const l=r.overscaledZ-1;if(l>=this._source.minzoom){const d=this.getLoadedTile(r.scaledTo(l));if(d)return this._inViewTiles.isIdRenderable(d.tileID.key)}return!1}reload(r,l=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const d of this._inViewTiles.getAllIds()){const g=this._inViewTiles.getTileById(d);l&&!this._source.shouldReloadTile(g,l)||(r?this._reloadTile(d,"expired"):g.state!=="errored"&&this._reloadTile(d,"reloading"))}}}_reloadTile(r,l){return c._(this,void 0,void 0,function*(){const d=this._inViewTiles.getTileById(r);d&&(d.state!=="loading"&&(d.state=l),yield this._loadTile(d,r,l))})}_tileLoaded(r,l,d){r.timeAdded=te(),r.selfFading&&(r.fadeEndTime=r.timeAdded+this._rasterFadeDuration),d==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this.getSource().type==="raster-dem"&&r.dem&&function(g,x){var w,P;const A=x.getRenderableIds();for(const M of A){if(!g.neighboringTiles||!g.neighboringTiles[M])continue;const j=x.getTileById(M);g.neighboringTiles[M].backfilled||ni(g,j),!((P=(w=j.neighboringTiles)===null||w===void 0?void 0:w[g.tileID.key])===null||P===void 0)&&P.backfilled||ni(j,g)}}(r,this._inViewTiles),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:r,coord:r.tileID}))}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._inViewTiles.getTileById(r)}_retainLoadedChildren(r,l){const d=this._getLoadedDescendents(l),g=new Set;for(const x of l){const w=d[x.key];if(!(w!=null&&w.length)){g.add(x);continue}const P=x.overscaledZ+Bi.maxOverzooming,A=w.filter(F=>F.tileID.overscaledZ<=P);if(!A.length){g.add(x);continue}const M=Math.min(...A.map(F=>F.tileID.overscaledZ)),j=A.filter(F=>F.tileID.overscaledZ===M).map(F=>F.tileID);for(const F of j)r[F.key]=F;this._areDescendentsComplete(j,M,x.overscaledZ)||g.add(x)}return g}_getLoadedDescendents(r){var l;const d={};for(const g of this._inViewTiles.getAllTiles().filter(x=>x.hasData()))for(const x of r)g.tileID.isChildOf(x)&&(d[l=x.key]||(d[l]=[])).push(g);return d}_areDescendentsComplete(r,l,d){return r.length===1&&r[0].isOverscaled()?r[0].overscaledZ===l:Math.pow(4,l-d)===r.length}getLoadedTile(r){return this._inViewTiles.getLoadedTile(r)}updateCacheSize(r){const l=Math.ceil(r.width/this._source.tileSize)+1,d=Math.ceil(r.height/this._source.tileSize)+1,g=Math.floor(l*d*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._outOfViewCache.setMaxSize(x)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);this._prevLng=r,l&&(this._inViewTiles.handleWrapJump(l),this._resetTileReloadTimers())}update(r,l){if(!this._sourceLoaded||this._paused)return;let d;this.transform=r,this.terrain=l,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?d=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new c.a2(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(d=Un(r,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?r.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter(A=>this._source.hasTile(A)))):d=[],this.usedForTerrain&&(d=this._addTerrainIdealTiles(d));const g=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=Cn(r,this._source),w=this._updateRetainedTiles(d,x),P=dr(this._source.type);P&&this._rasterFadeDuration>0&&!l&&function(A,M,j,F,O,$,Y){const se=te(),oe=c.av(M);for(const ae of M){const he=A.getTileById(ae.key);he.fadingDirection!==Le.Departing&&he.fadeOpacity!==0||he.resetFadeLogic(),El(A,he,j,se,F,O,Y)||Pl(A,he,j,se,$,Y)||ti(he,oe,se,Y)||he.resetFadeLogic()}}(this._inViewTiles,d,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),P?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(r){for(const l of this._inViewTiles.getAllIds())r[l]||this._removeTile(l)}_cleanUpVectorTiles(r){for(const l of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(l);r[l]?d.clearSymbolFadeHold():d.hasSymbolBuckets?d.holdingForSymbolFade()?d.symbolFadeFinished()&&this._removeTile(l):d.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(l)}}_addTerrainIdealTiles(r){const l=[];for(const d of r)if(d.canonical.z>this._source.minzoom){const g=d.scaledTo(d.canonical.z-1);l.push(g);const x=d.scaledTo(Math.max(this._source.minzoom,Math.min(d.canonical.z,5)));l.push(x)}return r.concat(l)}releaseSymbolFadeTiles(){for(const r of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(r).holdingForSymbolFade()&&this._removeTile(r)}_updateRetainedTiles(r,l){var d;const g=new Set;for(const M of r)this._addTile(M).hasData()||g.add(M);const x=r.reduce((M,j)=>(M[j.key]=j,M),{}),w=this._retainLoadedChildren(x,g),P={},A=Math.max(l-Bi.maxUnderzooming,this._source.minzoom);for(const M of w){let j=this._inViewTiles.getTileById(M.key),F=j==null?void 0:j.wasRequested();for(let O=M.overscaledZ-1;O>=A;--O){const $=M.scaledTo(O);if(P[$.key])break;if(P[$.key]=!0,j=this.getTile($),!j&&F&&(j=this._addTile($)),j){const Y=j.hasData();if((Y||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||F)&&(x[$.key]=$),F=j.wasRequested(),Y)break}}}return x}_addTile(r){let l=this._inViewTiles.getTileById(r.key);if(l)return l;l=this._outOfViewCache.getAndRemove(r),l&&(l.resetFadeLogic(),this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null));const d=l;return l||(l=new Xe(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(l,r.key,l.state)),l.uses++,this._inViewTiles.setTile(r.key,l),d||this._source.fire(new c.l("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(r,l){this._clearTileReloadTimer(r);const d=l.getExpiryTimeout();d&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},d))}_clearTileReloadTimer(r){const l=this._timers[r];l&&(clearTimeout(l),delete this._timers[r])}_resetTileReloadTimers(){for(const r in this._timers)clearTimeout(this._timers[r]),delete this._timers[r];for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);this._setTileReloadTimer(r,l)}}refreshTiles(r){for(const l of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(l);(this._inViewTiles.isIdRenderable(l)||d.state=="errored")&&r.some(g=>g.equals(d.tileID.canonical))&&this._reloadTile(l,"expired")}}_removeTile(r){const l=this._inViewTiles.getTileById(r);l&&(l.uses--,this._inViewTiles.deleteTileById(r),this._clearTileReloadTimer(r),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._outOfViewCache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}_dataHandler(r){r.dataType==="source"&&(r.sourceDataType!=="metadata"?r.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(r.sourceDataChanged,r.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r of this._inViewTiles.getAllIds())this._removeTile(r);this._outOfViewCache.reset()}tilesIn(r,l,d){const g=[],x=this.transform;if(!x)return g;const w=x.getCoveringTilesDetailsProvider().allowWorldCopies(),P=d?x.getCameraQueryGeometry(r):r,A=$=>x.screenPointToMercatorCoordinate($,this.terrain),M=this.transformBbox(r,A,!w),j=this.transformBbox(P,A,!w),F=this.getIds(),O=c.aa.fromPoints(j);for(let $=0;$<F.length;$++){const Y=this._inViewTiles.getTileById(F[$]);if(Y.holdingForSymbolFade())continue;const se=w?[Y.tileID]:[Y.tileID.unwrapTo(-1),Y.tileID.unwrapTo(0)],oe=Math.pow(2,x.zoom-Y.tileID.overscaledZ),ae=l*Y.queryPadding*c.a5/Y.tileSize/oe;for(const he of se){const ge=O.map(ce=>he.getTilePoint(new c.a9(ce.x,ce.y)));if(ge.expandBy(ae),ge.intersects(gn)){const ce=M.map(xe=>he.getTilePoint(xe)),fe=j.map(xe=>he.getTilePoint(xe));g.push({tile:Y,tileID:w?he:he.unwrapTo(0),queryGeometry:ce,cameraQueryGeometry:fe,scale:oe})}}}return g}transformBbox(r,l,d){let g=r.map(l);if(d){const x=c.aa.fromPoints(r);x.shrinkBy(.001*Math.min(x.width(),x.height()));const w=x.map(l);c.aa.fromPoints(g).covers(w)||(g=g.map(P=>P.x>.5?new c.a9(P.x-1,P.y,P.z):P))}return g}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(d=>this._inViewTiles.getTileById(d).tileID);return this.transform&&this.transform.populateCache(l),l}hasTransition(){return!!this._source.hasTransition()||!(!dr(this._source.type)||!function(r,l){if(l<=0)return!1;const d=te();for(const g of r.getAllTiles())if(g.fadeEndTime>=d)return!0;return!1}(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(r){this._rasterFadeDuration=r}setFeatureState(r,l,d){this._state.updateState(r=r||c.ai,l,d)}removeFeatureState(r,l,d){this._state.removeFeatureState(r=r||c.ai,l,d)}getFeatureState(r,l){return this._state.getState(r=r||c.ai,l)}setDependencies(r,l,d){const g=this._inViewTiles.getTileById(r);g&&g.setDependencies(l,d)}reloadTilesForDependencies(r,l){for(const d of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(d).hasDependency(r,l)&&this._reloadTile(d,"reloading");this._outOfViewCache.filter(d=>!d.hasDependency(r,l))}areTilesLoaded(){for(const r of this._inViewTiles.getAllTiles())if(r.state!=="loaded"&&r.state!=="errored")return!1;return!0}}Bi.maxUnderzooming=10,Bi.maxOverzooming=3;class lt{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=c.an(r,0,1);let l=1,d=this._distances[l];const g=r*this.paddedLength+this.padding;for(;d<g&&l<this._distances.length;)d=this._distances[++l];const x=l-1,w=this._distances[x],P=d-w,A=P>0?(g-w)/P:0;return this.points[x].mult(1-A).add(this.points[l].mult(A))}}function $t(v,r){let l=!0;return v==="always"||v!=="never"&&r!=="never"||(l=!1),l}class Gt{constructor(r,l,d){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/d),this.yCellCount=Math.ceil(l/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,d,g,x){this._forEachCell(l,d,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(r,l,d,g){this._forEachCell(l-g,d-g,l+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(d),this.circles.push(g)}_insertBoxCell(r,l,d,g,x,w){this.boxCells[x].push(w)}_insertCircleCell(r,l,d,g,x,w){this.circleCells[x].push(w)}_query(r,l,d,g,x,w,P){if(d<0||r>this.width||g<0||l>this.height)return[];const A=[];if(r<=0&&l<=0&&this.width<=d&&this.height<=g){if(x)return[{key:null,x1:r,y1:l,x2:d,y2:g}];for(let M=0;M<this.boxKeys.length;M++)A.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const j=this.circles[3*M],F=this.circles[3*M+1],O=this.circles[3*M+2];A.push({key:this.circleKeys[M],x1:j-O,y1:F-O,x2:j+O,y2:F+O})}}else this._forEachCell(r,l,d,g,this._queryCell,A,{hitTest:x,overlapMode:w,seenUids:{box:{},circle:{}}},P);return A}query(r,l,d,g){return this._query(r,l,d,g,!1,null)}hitTest(r,l,d,g,x,w){return this._query(r,l,d,g,!0,x,w).length>0}hitTestCircle(r,l,d,g,x){const w=r-d,P=r+d,A=l-d,M=l+d;if(P<0||w>this.width||M<0||A>this.height)return!1;const j=[];return this._forEachCell(w,A,P,M,this._queryCellCircle,j,{hitTest:!0,overlapMode:g,circle:{x:r,y:l,radius:d},seenUids:{box:{},circle:{}}},x),j.length>0}_queryCell(r,l,d,g,x,w,P,A){const{seenUids:M,hitTest:j,overlapMode:F}=P,O=this.boxCells[x];if(O!==null){const Y=this.bboxes;for(const se of O)if(!M.box[se]){M.box[se]=!0;const oe=4*se,ae=this.boxKeys[se];if(r<=Y[oe+2]&&l<=Y[oe+3]&&d>=Y[oe+0]&&g>=Y[oe+1]&&(!A||A(ae))&&(!j||!$t(F,ae.overlapMode))&&(w.push({key:ae,x1:Y[oe],y1:Y[oe+1],x2:Y[oe+2],y2:Y[oe+3]}),j))return!0}}const $=this.circleCells[x];if($!==null){const Y=this.circles;for(const se of $)if(!M.circle[se]){M.circle[se]=!0;const oe=3*se,ae=this.circleKeys[se];if(this._circleAndRectCollide(Y[oe],Y[oe+1],Y[oe+2],r,l,d,g)&&(!A||A(ae))&&(!j||!$t(F,ae.overlapMode))){const he=Y[oe],ge=Y[oe+1],ce=Y[oe+2];if(w.push({key:ae,x1:he-ce,y1:ge-ce,x2:he+ce,y2:ge+ce}),j)return!0}}}return!1}_queryCellCircle(r,l,d,g,x,w,P,A){const{circle:M,seenUids:j,overlapMode:F}=P,O=this.boxCells[x];if(O!==null){const Y=this.bboxes;for(const se of O)if(!j.box[se]){j.box[se]=!0;const oe=4*se,ae=this.boxKeys[se];if(this._circleAndRectCollide(M.x,M.y,M.radius,Y[oe+0],Y[oe+1],Y[oe+2],Y[oe+3])&&(!A||A(ae))&&!$t(F,ae.overlapMode))return w.push(!0),!0}}const $=this.circleCells[x];if($!==null){const Y=this.circles;for(const se of $)if(!j.circle[se]){j.circle[se]=!0;const oe=3*se,ae=this.circleKeys[se];if(this._circlesCollide(Y[oe],Y[oe+1],Y[oe+2],M.x,M.y,M.radius)&&(!A||A(ae))&&!$t(F,ae.overlapMode))return w.push(!0),!0}}}_forEachCell(r,l,d,g,x,w,P,A){const M=this._convertToXCellCoord(r),j=this._convertToYCellCoord(l),F=this._convertToXCellCoord(d),O=this._convertToYCellCoord(g);for(let $=M;$<=F;$++)for(let Y=j;Y<=O;Y++)if(x.call(this,r,l,d,g,this.xCellCount*Y+$,w,P,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,d,g,x,w){const P=g-r,A=x-l,M=d+w;return M*M>P*P+A*A}_circleAndRectCollide(r,l,d,g,x,w,P){const A=(w-g)/2,M=Math.abs(r-(g+A));if(M>A+d)return!1;const j=(P-x)/2,F=Math.abs(l-(x+j));if(F>j+d)return!1;if(M<=A||F<=j)return!0;const O=M-A,$=F-j;return O*O+$*$<=d*d}}function Ai(v,r,l){const d=c.N();if(!v){const{vecSouth:F,vecEast:O}=Os(r),$=C();$[0]=O[0],$[1]=O[1],$[2]=F[0],$[3]=F[1],g=$,(j=(w=(x=$)[0])*(M=x[3])-(A=x[2])*(P=x[1]))&&(g[0]=M*(j=1/j),g[1]=-P*j,g[2]=-A*j,g[3]=w*j),d[0]=$[0],d[1]=$[1],d[4]=$[2],d[5]=$[3]}var g,x,w,P,A,M,j;return c.Q(d,d,[1/l,1/l,1]),d}function Qc(v,r,l,d){if(v){const g=c.N();if(!r){const{vecSouth:x,vecEast:w}=Os(l);g[0]=w[0],g[1]=w[1],g[4]=x[0],g[5]=x[1]}return c.Q(g,g,[d,d,1]),g}return l.pixelsToClipSpaceMatrix}function Os(v){const r=Math.cos(v.rollInRadians),l=Math.sin(v.rollInRadians),d=Math.cos(v.pitchInRadians),g=Math.cos(v.bearingInRadians),x=Math.sin(v.bearingInRadians),w=c.aC();w[0]=-g*d*l-x*r,w[1]=-x*d*l+g*r;const P=c.aD(w);P<1e-9?c.aE(w):c.aF(w,w,1/P);const A=c.aC();A[0]=g*d*r-x*l,A[1]=x*d*r+g*l;const M=c.aD(A);return M<1e-9?c.aE(A):c.aF(A,A,1/M),{vecEast:A,vecSouth:w}}function Bt(v,r,l,d){let g;d?(g=[v,r,d(v,r),1],c.aH(g,g,l)):(g=[v,r,0,1],nu(g,g,l));const x=g[3];return{point:new c.P(g[0]/x,g[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function Cl(v,r){return .5+v/r*.5}function kl(v,r){return v.x>=-r[0]&&v.x<=r[0]&&v.y>=-r[1]&&v.y<=r[1]}function eu(v,r,l,d,g,x,w,P,A,M,j,F,O){const $=l?v.textSizeData:v.iconSizeData,Y=c.ay($,r.transform.zoom),se=[256/r.width*2+1,256/r.height*2+1],oe=l?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;oe.clear();const ae=v.lineVertexArray,he=l?v.text.placedSymbolArray:v.icon.placedSymbolArray,ge=r.transform.width/r.transform.height;let ce=!1;for(let fe=0;fe<he.length;fe++){const xe=he.get(fe);if(xe.hidden||xe.writingMode===c.az.vertical&&!ce){Aa(xe.numGlyphs,oe);continue}ce=!1;const pe=new c.P(xe.anchorX,xe.anchorY),Te={getElevation:O,pitchedLabelPlaneMatrix:d,lineVertexArray:ae,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:r.transform,tileAnchorPoint:pe,unwrappedTileID:A,width:M,height:j,translation:F},Oe=vo(xe.anchorX,xe.anchorY,Te);if(!kl(Oe.point,se)){Aa(xe.numGlyphs,oe);continue}const Me=Cl(r.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),De=c.aA($,Y,xe),je=x?De*r.transform.getPitchedTextCorrection(xe.anchorX,xe.anchorY,A)/Me:De*Me,et=_o({projectionContext:Te,pitchedLabelPlaneMatrixInverse:g,symbol:xe,fontSize:je,flip:!1,keepUpright:w,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ge,rotateToLine:P});ce=et.useVertical,(et.notEnoughRoom||ce||et.needsFlipping&&_o({projectionContext:Te,pitchedLabelPlaneMatrixInverse:g,symbol:xe,fontSize:je,flip:!0,keepUpright:w,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ge,rotateToLine:P}).notEnoughRoom)&&Aa(xe.numGlyphs,oe)}l?v.text.dynamicLayoutVertexBuffer.updateData(oe):v.icon.dynamicLayoutVertexBuffer.updateData(oe)}function yo(v,r,l,d,g,x,w,P){const A=x.glyphStartIndex+x.numGlyphs,M=x.lineStartIndex,j=x.lineStartIndex+x.lineLength,F=r.getoffsetX(x.glyphStartIndex),O=r.getoffsetX(A-1),$=es(v*F,l,d,g,x.segment,M,j,P,w);if(!$)return null;const Y=es(v*O,l,d,g,x.segment,M,j,P,w);return Y?P.projectionCache.anyProjectionOccluded?null:{first:$,last:Y}:null}function Al(v,r,l,d){return v===c.az.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*d?{useVertical:!0}:(v===c.az.vertical?r.y<l.y:r.x>l.x)?{needsFlipping:!0}:null}function _o(v){const{projectionContext:r,pitchedLabelPlaneMatrixInverse:l,symbol:d,fontSize:g,flip:x,keepUpright:w,glyphOffsetArray:P,dynamicLayoutVertexArray:A,aspectRatio:M,rotateToLine:j}=v,F=g/24,O=d.lineOffsetX*F,$=d.lineOffsetY*F;let Y;if(d.numGlyphs>1){const se=d.glyphStartIndex+d.numGlyphs,oe=d.lineStartIndex,ae=d.lineStartIndex+d.lineLength,he=yo(F,P,O,$,x,d,j,r);if(!he)return{notEnoughRoom:!0};const ge=tu(he.first.point.x,he.first.point.y,r,l),ce=tu(he.last.point.x,he.last.point.y,r,l);if(w&&!x){const fe=Al(d.writingMode,ge,ce,M);if(fe)return fe}Y=[he.first];for(let fe=d.glyphStartIndex+1;fe<se-1;fe++){const xe=es(F*P.getoffsetX(fe),O,$,x,d.segment,oe,ae,r,j);if(!xe)return{notEnoughRoom:!0};Y.push(xe)}Y.push(he.last)}else{if(w&&!x){const oe=hn(r.tileAnchorPoint.x,r.tileAnchorPoint.y,r).point,ae=d.lineStartIndex+d.segment+1,he=new c.P(r.lineVertexArray.getx(ae),r.lineVertexArray.gety(ae)),ge=hn(he.x,he.y,r),ce=ge.signedDistanceFromCamera>0?ge.point:Il(r.tileAnchorPoint,he,oe,1,r),fe=tu(oe.x,oe.y,r,l),xe=tu(ce.x,ce.y,r,l),pe=Al(d.writingMode,fe,xe,M);if(pe)return pe}const se=es(F*P.getoffsetX(d.glyphStartIndex),O,$,x,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,r,j);if(!se||r.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Y=[se]}for(const se of Y)c.aG(A,se.point,se.angle);return{}}function Il(v,r,l,d,g){const x=v.add(v.sub(r)._unit()),w=hn(x.x,x.y,g).point,P=l.sub(w);return l.add(P._mult(d/P.mag()))}function ri(v,r,l){const d=r.projectionCache;if(d.projections[v])return d.projections[v];const g=new c.P(r.lineVertexArray.getx(v),r.lineVertexArray.gety(v)),x=hn(g.x,g.y,r);if(x.signedDistanceFromCamera>0)return d.projections[v]=x.point,d.anyProjectionOccluded=d.anyProjectionOccluded||x.isOccluded,x.point;const w=v-l.direction;return Il(l.distanceFromAnchor===0?r.tileAnchorPoint:new c.P(r.lineVertexArray.getx(w),r.lineVertexArray.gety(w)),g,l.previousVertex,l.absOffsetX-l.distanceFromAnchor+1,r)}function hn(v,r,l){const d=v+l.translation[0],g=r+l.translation[1];let x;return l.pitchWithMap?(x=Bt(d,g,l.pitchedLabelPlaneMatrix,l.getElevation),x.isOccluded=!1):(x=l.transform.projectTileCoordinates(d,g,l.unwrappedTileID,l.getElevation),x.point.x=(.5*x.point.x+.5)*l.width,x.point.y=(.5*-x.point.y+.5)*l.height),x}function tu(v,r,l,d){if(l.pitchWithMap){const g=[v,r,0,1];return c.aH(g,g,d),l.transform.projectTileCoordinates(g[0]/g[3],g[1]/g[3],l.unwrappedTileID,l.getElevation).point}return{x:v/l.width*2-1,y:1-r/l.height*2}}function vo(v,r,l){return l.transform.projectTileCoordinates(v,r,l.unwrappedTileID,l.getElevation)}function Ml(v,r,l){return v._unit()._perp()._mult(r*l)}function ka(v,r,l,d,g,x,w,P,A){if(P.projectionCache.offsets[v])return P.projectionCache.offsets[v];const M=l.add(r);if(v+A.direction<d||v+A.direction>=g)return P.projectionCache.offsets[v]=M,M;const j=ri(v+A.direction,P,A),F=Ml(j.sub(l),w,A.direction),O=l.add(F),$=j.add(F);return P.projectionCache.offsets[v]=c.aI(x,M,O,$)||M,P.projectionCache.offsets[v]}function es(v,r,l,d,g,x,w,P,A){const M=d?v-r:v+r;let j=M>0?1:-1,F=0;d&&(j*=-1,F=Math.PI),j<0&&(F+=Math.PI);let O,$=j>0?x+g:x+g+1;P.projectionCache.cachedAnchorPoint?O=P.projectionCache.cachedAnchorPoint:(O=hn(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=O);let Y,se,oe=O,ae=O,he=0,ge=0;const ce=Math.abs(M),fe=[];let xe;for(;he+ge<=ce;){if($+=j,$<x||$>=w)return null;he+=ge,ae=oe,se=Y;const Oe={absOffsetX:ce,direction:j,distanceFromAnchor:he,previousVertex:ae};if(oe=ri($,P,Oe),l===0)fe.push(ae),xe=oe.sub(ae);else{let Me;const De=oe.sub(ae);Me=De.mag()===0?Ml(ri($+j,P,Oe).sub(oe),l,j):Ml(De,l,j),se||(se=ae.add(Me)),Y=ka($,Me,oe,x,w,se,l,P,Oe),fe.push(se),xe=Y.sub(se)}ge=xe.mag()}const pe=xe._mult((ce-he)/ge)._add(se||ae),Te=F+Math.atan2(oe.y-ae.y,oe.x-ae.x);return fe.push(pe),{point:pe,angle:A?Te:0,path:fe}}const Zf=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Aa(v,r){for(let l=0;l<v;l++){const d=r.length;r.resize(d+4),r.float32.set(Zf,3*d)}}function nu(v,r,l){const d=r[0],g=r[1];return v[0]=l[0]*d+l[4]*g+l[12],v[1]=l[1]*d+l[5]*g+l[13],v[3]=l[3]*d+l[7]*g+l[15],v}const $n=100;class Hf{constructor(r,l=new Gt(r.width+200,r.height+200,25),d=new Gt(r.width+200,r.height+200,25)){this.transform=r,this.grid=l,this.ignoredGrid=d,this.pitchFactor=Math.cos(r.pitch*Math.PI/180)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+$n,this.screenBottomBoundary=r.height+$n,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,l,d,g,x,w,P,A,M,j,F,O){const $=this.projectAndGetPerspectiveRatio(r.anchorPointX+A[0],r.anchorPointY+A[1],x,j,O),Y=d*$.perspectiveRatio;let se;if(w||P)se=this._projectCollisionBox(r,Y,g,x,w,P,A,$,j,F,O);else{const xe=$.x+(F?F.x*Y:0),pe=$.y+(F?F.y*Y:0);se={allPointsOccluded:!1,box:[xe+r.x1*Y,pe+r.y1*Y,xe+r.x2*Y,pe+r.y2*Y]}}const[oe,ae,he,ge]=se.box,ce=w?se.allPointsOccluded:$.isOccluded;let fe=ce;return fe||(fe=$.perspectiveRatio<this.perspectiveRatioCutoff),fe||(fe=!this.isInsideGrid(oe,ae,he,ge)),fe||l!=="always"&&this.grid.hitTest(oe,ae,he,ge,l,M)?{box:[oe,ae,he,ge],placeable:!1,offscreen:!1,occluded:ce}:{box:[oe,ae,he,ge],placeable:!0,offscreen:this.isOffscreen(oe,ae,he,ge),occluded:ce}}placeCollisionCircles(r,l,d,g,x,w,P,A,M,j,F,O,$,Y){const se=[],oe=new c.P(l.anchorX,l.anchorY),ae=this.getPerspectiveRatio(oe.x,oe.y,w,Y),he=(M?x*this.transform.getPitchedTextCorrection(l.anchorX,l.anchorY,w)/ae:x*ae)/c.aM,ge={getElevation:Y,pitchedLabelPlaneMatrix:P,lineVertexArray:d,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:$},ce=yo(he,g,l.lineOffsetX*he,l.lineOffsetY*he,!1,l,!1,ge);let fe=!1,xe=!1,pe=!0;if(ce){const Te=.5*F*ae+O,Oe=new c.P(-100,-100),Me=new c.P(this.screenRightBoundary,this.screenBottomBoundary),De=new lt,je=ce.first,et=ce.last;let nt=[];for(let Rt=je.path.length-1;Rt>=1;Rt--)nt.push(je.path[Rt]);for(let Rt=1;Rt<et.path.length;Rt++)nt.push(et.path[Rt]);const He=2.5*Te;if(M){const Rt=this.projectPathToScreenSpace(nt,ge);nt=Rt.some(ln=>ln.signedDistanceFromCamera<=0)?[]:Rt.map(ln=>ln.point)}let it=[];if(nt.length>0){const Rt=nt[0].clone(),ln=nt[0].clone();for(let kn=1;kn<nt.length;kn++)Rt.x=Math.min(Rt.x,nt[kn].x),Rt.y=Math.min(Rt.y,nt[kn].y),ln.x=Math.max(ln.x,nt[kn].x),ln.y=Math.max(ln.y,nt[kn].y);it=Rt.x>=Oe.x&&ln.x<=Me.x&&Rt.y>=Oe.y&&ln.y<=Me.y?[nt]:ln.x<Oe.x||Rt.x>Me.x||ln.y<Oe.y||Rt.y>Me.y?[]:c.aJ([nt],Oe.x,Oe.y,Me.x,Me.y)}for(const Rt of it){De.reset(Rt,.25*Te);let ln=0;ln=De.length<=.5*Te?1:Math.ceil(De.paddedLength/He)+1;for(let kn=0;kn<ln;kn++){const vn=kn/Math.max(ln-1,1),Dn=De.lerp(vn),xn=Dn.x+$n,qn=Dn.y+$n;se.push(xn,qn,Te,0);const jn=xn-Te,Cr=qn-Te,sr=xn+Te,tr=qn+Te;if(pe=pe&&this.isOffscreen(jn,Cr,sr,tr),xe=xe||this.isInsideGrid(jn,Cr,sr,tr),r!=="always"&&this.grid.hitTestCircle(xn,qn,Te,r,j)&&(fe=!0,!A))return{circles:[],offscreen:!1,collisionDetected:fe}}}}return{circles:!A&&fe||!xe||ae<this.perspectiveRatioCutoff?[]:se,offscreen:pe,collisionDetected:fe}}projectPathToScreenSpace(r,l){const d=function(g,x){const w=c.N();return c.aB(w,x.pitchedLabelPlaneMatrix),g.map(P=>{const A=Bt(P.x,P.y,w,x.getElevation),M=x.transform.projectTileCoordinates(A.point.x,A.point.y,x.unwrappedTileID,x.getElevation);return M.point.x=(.5*M.point.x+.5)*x.width,M.point.y=(.5*-M.point.y+.5)*x.height,M})}(r,l);return function(g){let x=0,w=0,P=0,A=0;for(let M=0;M<g.length;M++)g[M].isOccluded?(P=M+1,A=0):(A++,A>w&&(w=A,x=P));return g.slice(x,x+w)}(d)}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[],d=new c.aa;for(const F of r){const O=new c.P(F.x+$n,F.y+$n);d.extend(O),l.push(O)}const{minX:g,minY:x,maxX:w,maxY:P}=d,A=this.grid.query(g,x,w,P).concat(this.ignoredGrid.query(g,x,w,P)),M={},j={};for(const F of A){const O=F.key;if(M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]={}),M[O.bucketInstanceId][O.featureIndex])continue;const $=[new c.P(F.x1,F.y1),new c.P(F.x2,F.y1),new c.P(F.x2,F.y2),new c.P(F.x1,F.y2)];c.aK(l,$)&&(M[O.bucketInstanceId][O.featureIndex]=!0,j[O.bucketInstanceId]===void 0&&(j[O.bucketInstanceId]=[]),j[O.bucketInstanceId].push(O.featureIndex))}return j}insertCollisionBox(r,l,d,g,x,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:w,overlapMode:l},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,d,g,x,w){const P=d?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:x,collisionGroupID:w,overlapMode:l};for(let M=0;M<r.length;M+=4)P.insertCircle(A,r[M],r[M+1],r[M+2])}projectAndGetPerspectiveRatio(r,l,d,g,x){if(x){let w;g?(w=[r,l,g(r,l),1],c.aH(w,w,x)):(w=[r,l,0,1],nu(w,w,x));const P=w[3];return{x:(w[0]/P+1)/2*this.transform.width+$n,y:(-w[1]/P+1)/2*this.transform.height+$n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}{const w=this.transform.projectTileCoordinates(r,l,d,g);return{x:(w.point.x+1)/2*this.transform.width+$n,y:(1-w.point.y)/2*this.transform.height+$n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(r,l,d,g){const x=this.transform.projectTileCoordinates(r,l,d,g);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(r,l,d,g){return d<$n||r>=this.screenRightBoundary||g<$n||l>this.screenBottomBoundary}isInsideGrid(r,l,d,g){return d>=0&&r<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=c.ar([]);return c.O(r,r,[-100,-100,0]),r}_projectCollisionBox(r,l,d,g,x,w,P,A,M,j,F){let O=1,$=0,Y=0,se=1;const oe=r.anchorPointX+P[0],ae=r.anchorPointY+P[1];if(w&&!x){const nt=this.projectAndGetPerspectiveRatio(oe+1,ae,g,M,F),He=nt.x-A.x,it=Math.atan((nt.y-A.y)/He)+(He<0?Math.PI:0),Rt=Math.sin(it),ln=Math.cos(it);O=ln,$=Rt,Y=-Rt,se=ln}else if(!w&&x){const nt=Os(this.transform);O=nt.vecEast[0],$=nt.vecEast[1],Y=nt.vecSouth[0],se=nt.vecSouth[1]}let he=A.x,ge=A.y,ce=l;x&&(he=oe,ge=ae,ce=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),ce*=this.transform.getPitchedTextCorrection(oe,ae,g),j||(ce*=c.an(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),j&&(he+=O*j.x*ce+Y*j.y*ce,ge+=$*j.x*ce+se*j.y*ce);const fe=r.x1*ce,xe=r.x2*ce,pe=(fe+xe)/2,Te=r.y1*ce,Oe=r.y2*ce,Me=(Te+Oe)/2,De=[{offsetX:fe,offsetY:Te},{offsetX:pe,offsetY:Te},{offsetX:xe,offsetY:Te},{offsetX:xe,offsetY:Me},{offsetX:xe,offsetY:Oe},{offsetX:pe,offsetY:Oe},{offsetX:fe,offsetY:Oe},{offsetX:fe,offsetY:Me}];let je=[];for(const{offsetX:nt,offsetY:He}of De)je.push(new c.P(he+O*nt+Y*He,ge+$*nt+se*He));let et=!1;if(x){const nt=je.map(He=>this.projectAndGetPerspectiveRatio(He.x,He.y,g,M,F));et=nt.some(He=>!He.isOccluded),je=nt.map(He=>new c.P(He.x,He.y))}else et=!0;return{box:c.aL(je),allPointsOccluded:!et}}}class Kf{constructor(r,l,d,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Rl{constructor(r,l,d,g,x){this.text=new Kf(r?r.text:null,l,d,x),this.icon=new Kf(r?r.icon:null,l,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xf{constructor(r,l,d){this.text=r,this.icon=l,this.skipFade=d}}class Yf{constructor(r,l,d,g,x){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=x}}class Jf{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:d=>d.collisionGroupID===l}}return this.collisionGroups[r]}}function ru(v,r,l,d,g){const{horizontalAlign:x,verticalAlign:w}=c.aS(v);return new c.P(-(x-.5)*r+d[0]*g,-(w-.5)*l+d[1]*g)}class ld{constructor(r,l,d,g,x){this.transform=r.clone(),this.terrain=l,this.collisionIndex=new Hf(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Jf(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(r){const l=this.terrain;return l?(d,g)=>l.getElevation(r,d,g):null}getBucketParts(r,l,d,g){const x=d.getBucket(l),w=d.latestFeatureIndex;if(!x||!w||l.id!==x.layerIds[0])return;const P=d.collisionBoxArray,A=x.layers[0].layout,M=x.layers[0].paint,j=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),F=d.tileSize/c.a5,O=d.tileID.toUnwrapped(),$=A.get("text-rotation-alignment")==="map",Y=c.aN(d,1,this.transform.zoom),se=c.aO(this.collisionIndex.transform,d,M.get("text-translate"),M.get("text-translate-anchor")),oe=c.aO(this.collisionIndex.transform,d,M.get("icon-translate"),M.get("icon-translate-anchor")),ae=Ai($,this.transform,Y);this.retainedQueryData[x.bucketInstanceId]=new Yf(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,d.tileID);const he={bucket:x,layout:A,translationText:se,translationIcon:oe,unwrappedTileID:O,pitchedLabelPlaneMatrix:ae,scale:j,textPixelRatio:F,holdingForFade:d.holdingForSymbolFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:c.ay(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const ge of x.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:fe,symbolInstanceEnd:xe}=ge;r.push({sortKey:ce,symbolInstanceStart:fe,symbolInstanceEnd:xe,parameters:he})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:he})}attemptAnchorPlacement(r,l,d,g,x,w,P,A,M,j,F,O,$,Y,se,oe,ae,he,ge,ce){const fe=c.aP[r.textAnchor],xe=[r.textOffset0,r.textOffset1],pe=ru(fe,d,g,xe,x),Te=this.collisionIndex.placeCollisionBox(l,O,A,M,j,P,w,oe,F.predicate,ge,pe,ce);if((!he||this.collisionIndex.placeCollisionBox(he,O,A,M,j,P,w,ae,F.predicate,ge,pe,ce).placeable)&&Te.placeable){let Oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:xe,width:d,height:g,anchor:fe,textBoxScale:x,prevAnchor:Oe},this.markUsedJustification(Y,fe,$,se),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,se,$),this.placedOrientations[$.crossTileID]=se),{shift:pe,placedGlyphBoxes:Te}}}placeLayerBucketPart(r,l,d){const{bucket:g,layout:x,translationText:w,translationIcon:P,unwrappedTileID:A,pitchedLabelPlaneMatrix:M,textPixelRatio:j,holdingForFade:F,collisionBoxArray:O,partiallyEvaluatedTextSize:$,collisionGroup:Y}=r.parameters,se=x.get("text-optional"),oe=x.get("icon-optional"),ae=c.aQ(x,"text-overlap","text-allow-overlap"),he=ae==="always",ge=c.aQ(x,"icon-overlap","icon-allow-overlap"),ce=ge==="always",fe=x.get("text-rotation-alignment")==="map",xe=x.get("text-pitch-alignment")==="map",pe=x.get("icon-text-fit")!=="none",Te=x.get("symbol-z-order")==="viewport-y",Oe=he&&(ce||!g.hasIconData()||oe),Me=ce&&(he||!g.hasTextData()||se);!g.collisionArrays&&O&&g.deserializeCollisionBoxes(O);const De=this.retainedQueryData[g.bucketInstanceId].tileID,je=this._getTerrainElevationFunc(De),et=this.transform.getFastPathSimpleProjectionMatrix(De),nt=(He,it,Rt)=>{var ln,kn;if(l[He.crossTileID])return;if(F)return void(this.placements[He.crossTileID]=new Xf(!1,!1,!1));let vn=!1,Dn=!1,xn=!0,qn=null,jn={box:null,placeable:!1,offscreen:null,occluded:!1},Cr={placeable:!1},sr=null,tr=null,Fr=null,fa=0,Vs=0,Es=0;it.textFeatureIndex?fa=it.textFeatureIndex:He.useRuntimeCollisionCircles&&(fa=He.featureIndex),it.verticalTextFeatureIndex&&(Vs=it.verticalTextFeatureIndex);const _i=it.textBox;if(_i){const qi=Sn=>{let bn=c.az.horizontal;if(g.allowVerticalPlacement&&!Sn&&this.prevPlacement){const xr=this.prevPlacement.placedOrientations[He.crossTileID];xr&&(this.placedOrientations[He.crossTileID]=xr,bn=xr,this.markUsedOrientation(g,bn,He))}return bn},Ps=(Sn,bn)=>{if(g.allowVerticalPlacement&&He.numVerticalGlyphVertices>0&&it.verticalTextBox){for(const xr of g.writingModes)if(xr===c.az.vertical?(jn=bn(),Cr=jn):jn=Sn(),jn&&jn.placeable)break}else jn=Sn()},as=He.textAnchorOffsetStartIndex,os=He.textAnchorOffsetEndIndex;if(os===as){const Sn=(bn,xr)=>{const br=this.collisionIndex.placeCollisionBox(bn,ae,j,De,A,xe,fe,w,Y.predicate,je,void 0,et);return br&&br.placeable&&(this.markUsedOrientation(g,xr,He),this.placedOrientations[He.crossTileID]=xr),br};Ps(()=>Sn(_i,c.az.horizontal),()=>{const bn=it.verticalTextBox;return g.allowVerticalPlacement&&He.numVerticalGlyphVertices>0&&bn?Sn(bn,c.az.vertical):{box:null,offscreen:null}}),qi(jn&&jn.placeable)}else{let Sn=c.aP[(kn=(ln=this.prevPlacement)===null||ln===void 0?void 0:ln.variableOffsets[He.crossTileID])===null||kn===void 0?void 0:kn.anchor];const bn=(br,Zm,Hm)=>{const Za=br.x2-br.x1,iv=br.y2-br.y1,Km=He.textBoxScale,np=pe&&ge==="never"?Zm:null;let ma=null,ga=ae==="never"?1:2,ya="never";Sn&&ga++;for(let rp=0;rp<ga;rp++){for(let ip=as;ip<os;ip++){const Bu=g.textAnchorOffsets.get(ip);if(Sn&&Bu.textAnchor!==Sn)continue;const Vu=this.attemptAnchorPlacement(Bu,br,Za,iv,Km,fe,xe,j,De,A,Y,ya,He,g,Hm,w,P,np,je);if(Vu&&(ma=Vu.placedGlyphBoxes,ma&&ma.placeable))return vn=!0,qn=Vu.shift,ma}Sn?Sn=null:ya=ae}return d&&!ma&&(ma={box:this.collisionIndex.placeCollisionBox(_i,"always",j,De,A,xe,fe,w,Y.predicate,je,void 0,et).box,offscreen:!1,placeable:!1,occluded:!1}),ma};Ps(()=>bn(_i,it.iconBox,c.az.horizontal),()=>{const br=it.verticalTextBox;return g.allowVerticalPlacement&&(!jn||!jn.placeable)&&He.numVerticalGlyphVertices>0&&br?bn(br,it.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}}),jn&&(vn=jn.placeable,xn=jn.offscreen);const xr=qi(jn&&jn.placeable);if(!vn&&this.prevPlacement){const br=this.prevPlacement.variableOffsets[He.crossTileID];br&&(this.variableOffsets[He.crossTileID]=br,this.markUsedJustification(g,br.anchor,He,xr))}}}if(sr=jn,vn=sr&&sr.placeable,xn=sr&&sr.offscreen,He.useRuntimeCollisionCircles&&He.centerJustifiedTextSymbolIndex>=0){const qi=g.text.placedSymbolArray.get(He.centerJustifiedTextSymbolIndex),Ps=c.aA(g.textSizeData,$,qi),as=x.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(ae,qi,g.lineVertexArray,g.glyphOffsetArray,Ps,A,M,d,xe,Y.predicate,He.collisionCircleDiameter,as,w,je),tr.circles.length&&tr.collisionDetected&&!d&&c.w("Collisions detected, but collision boxes are not shown"),vn=he||tr.circles.length>0&&!tr.collisionDetected,xn=xn&&tr.offscreen}if(it.iconFeatureIndex&&(Es=it.iconFeatureIndex),it.iconBox){const qi=Ps=>this.collisionIndex.placeCollisionBox(Ps,ge,j,De,A,xe,fe,P,Y.predicate,je,pe&&qn?qn:void 0,et);Cr&&Cr.placeable&&it.verticalIconBox?(Fr=qi(it.verticalIconBox),Dn=Fr.placeable):(Fr=qi(it.iconBox),Dn=Fr.placeable),xn=xn&&Fr.offscreen}const qa=se||He.numHorizontalGlyphVertices===0&&He.numVerticalGlyphVertices===0,dc=oe||He.numIconVertices===0;qa||dc?dc?qa||(Dn=Dn&&vn):vn=Dn&&vn:Dn=vn=Dn&&vn;const Wa=Dn&&Fr.placeable;if(vn&&sr.placeable&&this.collisionIndex.insertCollisionBox(sr.box,ae,x.get("text-ignore-placement"),g.bucketInstanceId,Cr&&Cr.placeable&&Vs?Vs:fa,Y.ID),Wa&&this.collisionIndex.insertCollisionBox(Fr.box,ge,x.get("icon-ignore-placement"),g.bucketInstanceId,Es,Y.ID),tr&&vn&&this.collisionIndex.insertCollisionCircles(tr.circles,ae,x.get("text-ignore-placement"),g.bucketInstanceId,fa,Y.ID),d&&this.storeCollisionData(g.bucketInstanceId,Rt,it,sr,Fr,tr),He.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[He.crossTileID]=new Xf((vn||Oe)&&!(sr!=null&&sr.occluded),(Dn||Me)&&!(Fr!=null&&Fr.occluded),xn||g.justReloaded),l[He.crossTileID]=!0};if(Te){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const He=g.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let it=He.length-1;it>=0;--it){const Rt=He[it];nt(g.symbolInstances.get(Rt),g.collisionArrays[Rt],Rt)}}else for(let He=r.symbolInstanceStart;He<r.symbolInstanceEnd;He++)nt(g.symbolInstances.get(He),g.collisionArrays[He],He);g.justReloaded=!1}storeCollisionData(r,l,d,g,x,w){if(d.textBox||d.iconBox){let P,A;this.collisionBoxArrays.has(r)?P=this.collisionBoxArrays.get(r):(P=new Map,this.collisionBoxArrays.set(r,P)),P.has(l)?A=P.get(l):(A={text:null,icon:null},P.set(l,A)),d.textBox&&(A.text=g.box),d.iconBox&&(A.icon=x.box)}if(w){let P=this.collisionCircleArrays[r];P===void 0&&(P=this.collisionCircleArrays[r]=[]);for(let A=0;A<w.circles.length;A+=4)P.push(w.circles[A+0]-$n),P.push(w.circles[A+1]-$n),P.push(w.circles[A+2]),P.push(w.collisionDetected?1:0)}}markUsedJustification(r,l,d,g){let x;x=g===c.az.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[c.aR(l)];const w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const P of w)P>=0&&(r.text.placedSymbolArray.get(P).crossTileID=x>=0&&P!==x?0:d.crossTileID)}markUsedOrientation(r,l,d){const g=l===c.az.horizontal||l===c.az.horizontalOnly?l:0,x=l===c.az.vertical?l:0,w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const P of w)r.text.placedSymbolArray.get(P).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let d=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(r):1,x=l?l.opacities:{},w=l?l.variableOffsets:{},P=l?l.placedOrientations:{};for(const A in this.placements){const M=this.placements[A],j=x[A];j?(this.opacities[A]=new Rl(j,g,M.text,M.icon),d=d||M.text!==j.text.placed||M.icon!==j.icon.placed):(this.opacities[A]=new Rl(null,g,M.text,M.icon,M.skipFade),d=d||M.text||M.icon)}for(const A in x){const M=x[A];if(!this.opacities[A]){const j=new Rl(M,g,!1,!1);j.isHidden()||(this.opacities[A]=j,d=d||M.text.placed||M.icon.placed)}}for(const A in w)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=w[A]);for(const A in P)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=P[A]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const d={};for(const g of l){const x=g.getBucket(r);x&&g.latestFeatureIndex&&r.id===x.layerIds[0]&&this.updateBucketOpacities(x,g.tileID,d,g.collisionBoxArray)}}updateBucketOpacities(r,l,d,g){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const x=r.layers[0],w=x.layout,P=new Rl(null,0,!1,!1,!0),A=w.get("text-allow-overlap"),M=w.get("icon-allow-overlap"),j=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=w.get("text-rotation-alignment")==="map",O=w.get("text-pitch-alignment")==="map",$=w.get("icon-text-fit")!=="none",Y=new Rl(null,0,A&&(M||!r.hasIconData()||w.get("icon-optional")),M&&(A||!r.hasTextData()||w.get("text-optional")),!0);!r.collisionArrays&&g&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(g);const se=(ae,he,ge)=>{for(let ce=0;ce<he/4;ce++)ae.opacityVertexArray.emplaceBack(ge);ae.hasVisibleVertices=ae.hasVisibleVertices||ge!==jl},oe=this.collisionBoxArrays.get(r.bucketInstanceId);for(let ae=0;ae<r.symbolInstances.length;ae++){const he=r.symbolInstances.get(ae),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:ce,crossTileID:fe}=he;let xe=this.opacities[fe];d[fe]?xe=P:xe||(xe=Y,this.opacities[fe]=xe),d[fe]=!0;const pe=he.numIconVertices>0,Te=this.placedOrientations[he.crossTileID],Oe=Te===c.az.vertical,Me=Te===c.az.horizontal||Te===c.az.horizontalOnly;if(ge>0||ce>0){const je=dd(xe.text);se(r.text,ge,Oe?jl:je),se(r.text,ce,Me?jl:je);const et=xe.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(r.text.placedSymbolArray.get(it).hidden=et||Oe?1:0)}),he.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=et||Me?1:0);const nt=this.variableOffsets[he.crossTileID];nt&&this.markUsedJustification(r,nt.anchor,he,Te);const He=this.placedOrientations[he.crossTileID];He&&(this.markUsedJustification(r,"left",he,He),this.markUsedOrientation(r,He,he))}if(pe){const je=dd(xe.icon),et=!($&&he.verticalPlacedIconSymbolIndex&&Oe);he.placedIconSymbolIndex>=0&&(se(r.icon,he.numIconVertices,et?je:jl),r.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=xe.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(se(r.icon,he.numVerticalIconVertices,et?jl:je),r.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=xe.icon.isHidden())}const De=oe&&oe.has(ae)?oe.get(ae):{text:null,icon:null};if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const je=r.collisionArrays[ae];if(je){let et=new c.P(0,0);if(je.textBox||je.verticalTextBox){let nt=!0;if(j){const He=this.variableOffsets[fe];He?(et=ru(He.anchor,He.width,He.height,He.textOffset,He.textBoxScale),F&&et._rotate(O?-this.transform.bearingInRadians:this.transform.bearingInRadians)):nt=!1}if(je.textBox||je.verticalTextBox){let He;je.textBox&&(He=Oe),je.verticalTextBox&&(He=Me),cd(r.textCollisionBox.collisionVertexArray,xe.text.placed,!nt||He,De.text,et.x,et.y)}}if(je.iconBox||je.verticalIconBox){const nt=!!(!Me&&je.verticalIconBox);let He;je.iconBox&&(He=nt),je.verticalIconBox&&(He=!nt),cd(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,He,De.icon,$?et.x:0,$?et.y:0)}}}}if(r.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);r.bucketInstanceId in this.collisionCircleArrays&&(r.collisionCircleArray=this.collisionCircleArrays[r.bucketInstanceId],delete this.collisionCircleArrays[r.bucketInstanceId])}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const d=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*d>r}setStale(){this.stale=!0}}function cd(v,r,l,d,g,x){d&&d.length!==0||(d=[0,0,0,0]);const w=d[0]-$n,P=d[1]-$n,A=d[2]-$n,M=d[3]-$n;v.emplaceBack(r?1:0,l?1:0,g||0,x||0,w,P),v.emplaceBack(r?1:0,l?1:0,g||0,x||0,A,P),v.emplaceBack(r?1:0,l?1:0,g||0,x||0,A,M),v.emplaceBack(r?1:0,l?1:0,g||0,x||0,w,M)}const ud=Math.pow(2,25),hd=Math.pow(2,24),D_=Math.pow(2,17),Dl=Math.pow(2,16),iu=Math.pow(2,9),Qf=Math.pow(2,8),xo=Math.pow(2,1);function dd(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const r=v.placed?1:0,l=Math.floor(127*v.opacity);return l*ud+r*hd+l*D_+r*Dl+l*iu+r*Qf+l*xo+r}const jl=0;class sa{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,d,g,x){const w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(w,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((P,A)=>P.sortKey-A.sortKey));this._currentPartIndex<w.length;)if(l.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,x())return!0;return!1}}class bo{constructor(r,l,d,g,x,w,P,A){this.placement=new ld(r,l,w,P,A),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,l,d){const g=te(),x=()=>!this._forceFullPlacement&&te()-g>2;for(;this._currentPlacementIndex>=0;){const w=l[r[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=P)&&(!w.maxzoom||w.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new sa(w)),this._inProgressLayer.continuePlacement(d[w.source],this.placement,this._showCollisionBoxes,w,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const qt=512/c.a5/2;class pd{constructor(r,l,d){this.tileID=r,this.bucketInstanceId=d,this._symbolsByKey={};const g=new Map;for(let x=0;x<l.length;x++){const w=l.get(x),P=w.key,A=g.get(P);A?A.push(w):g.set(P,[w])}for(const[x,w]of g){const P={positions:w.map(A=>({x:Math.floor(A.anchorX*qt),y:Math.floor(A.anchorY*qt)})),crossTileIDs:w.map(A=>A.crossTileID)};if(P.positions.length>128){const A=new c.aT(P.positions.length,16,Uint16Array);for(const{x:M,y:j}of P.positions)A.add(M,j);A.finish(),delete P.positions,P.index=A}this._symbolsByKey[x]=P}}getScaledCoordinates(r,l){const{x:d,y:g,z:x}=this.tileID.canonical,{x:w,y:P,z:A}=l.canonical,M=qt/Math.pow(2,A-x),j=(P*c.a5+r.anchorY)*M,F=g*c.a5*qt;return{x:Math.floor((w*c.a5+r.anchorX)*M-d*c.a5*qt),y:Math.floor(j-F)}}findMatches(r,l,d){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let x=0;x<r.length;x++){const w=r.get(x);if(w.crossTileID)continue;const P=this._symbolsByKey[w.key];if(!P)continue;const A=this.getScaledCoordinates(w,l);if(P.index){const M=P.index.range(A.x-g,A.y-g,A.x+g,A.y+g).sort();for(const j of M){const F=P.crossTileIDs[j];if(!d[F]){d[F]=!0,w.crossTileID=F;break}}}else if(P.positions)for(let M=0;M<P.positions.length;M++){const j=P.positions[M],F=P.crossTileIDs[M];if(Math.abs(j.x-A.x)<=g&&Math.abs(j.y-A.y)<=g&&!d[F]){d[F]=!0,w.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class j_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const d in this.indexes){const g=this.indexes[d],x={};for(const w in g){const P=g[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+l),x[P.tileID.key]=P}this.indexes[d]=x}this.lng=r}addBucket(r,l,d){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const g=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>r.overscaledZ)for(const P in w){const A=w[P];A.tileID.isChildOf(r)&&A.findMatches(l.symbolInstances,r,g)}else{const P=w[r.scaledTo(Number(x)).key];P&&P.findMatches(l.symbolInstances,r,g)}}for(let x=0;x<l.symbolInstances.length;x++){const w=l.symbolInstances.get(x);w.crossTileID||(w.crossTileID=d.generate(),g[w.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new pd(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const d of l.getCrossTileIDsLists())for(const g of d)delete this.usedCrossTileIDs[r][g]}removeStaleBuckets(r){let l=!1;for(const d in this.indexes){const g=this.indexes[d];for(const x in g)r[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[x]),delete g[x],l=!0)}return l}}class gi{constructor(){this.layerIndexes={},this.crossTileIDs=new j_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,d){let g=this.layerIndexes[r.id];g===void 0&&(g=this.layerIndexes[r.id]=new fd);let x=!1;const w={};g.handleWrapJump(d);for(const P of l){const A=P.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,A,this.crossTileIDs)&&(x=!0),w[A.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(r){const l={};r.forEach(d=>{l[d]=!0});for(const d in this.layerIndexes)l[d]||delete this.layerIndexes[d]}}var Wr="void main() {fragColor=vec4(1.0);}";const zn={prelude:Et(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Et("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Et("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Et(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Et(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Et(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Et(Wr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Et(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Et(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Et("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Et("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Et("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Et(Wr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Et(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Et(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Et(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Et(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Et(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Et(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Et(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Et(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Et(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Et(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Et(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Et(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Et(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Et(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Et("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Et("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Et("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Et("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Et(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Et("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Et(v,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=r.match(/in ([\w]+) ([\w]+)/g),g=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=x?x.concat(g):g,P={};return{fragmentSource:v=v.replace(l,(A,M,j,F,O)=>(P[O]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${j} ${F} ${O};
#else
uniform ${j} ${F} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${j} ${F} ${O} = u_${O};
#endif
`)),vertexSource:r=r.replace(l,(A,M,j,F,O)=>{const $=F==="float"?"vec2":"vec4",Y=O.match(/color/)?"color":$;return P[O]?M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${j} ${$} a_${O};
out ${j} ${F} ${O};
#else
uniform ${j} ${F} u_${O};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${j} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${Y}(a_${O}, u_${O}_t);
#else
    ${j} ${F} ${O} = u_${O};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${j} ${$} a_${O};
#else
uniform ${j} ${F} u_${O};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${j} ${F} ${O} = a_${O};
#else
    ${j} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${j} ${F} ${O} = unpack_mix_${Y}(a_${O}, u_${O}_t);
#else
    ${j} ${F} ${O} = u_${O};
#endif
`}),staticAttributes:d,staticUniforms:w}}class yn{constructor(r,l,d){this.vertexBuffer=r,this.indexBuffer=l,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var aa=c.aU([{name:"a_pos",type:"Int16",components:2}]);const ii="#define PROJECTION_MERCATOR",Ii="mercator";class si{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ii}get shaderDefine(){return ii}get shaderPreludeCode(){return zn.projectionMercator}get vertexShaderPreludeCode(){return zn.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(r){}getMeshFromTileID(r,l,d,g,x){if(this._cachedMesh)return this._cachedMesh;const w=new c.aW;w.emplaceBack(0,0),w.emplaceBack(c.a5,0),w.emplaceBack(0,c.a5),w.emplaceBack(c.a5,c.a5);const P=r.createVertexBuffer(w,aa.members),A=c.aX.simpleSegment(0,0,4,2),M=new c.aY;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3);const j=r.createIndexBuffer(M);return this._cachedMesh=new yn(P,j,A),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(r){}}class wo{constructor(r=0,l=0,d=0,g=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=d,this.right=g}interpolate(r,l,d){return l.top!=null&&r.top!=null&&(this.top=c.G.number(r.top,l.top,d)),l.bottom!=null&&r.bottom!=null&&(this.bottom=c.G.number(r.bottom,l.bottom,d)),l.left!=null&&r.left!=null&&(this.left=c.G.number(r.left,l.left,d)),l.right!=null&&r.right!=null&&(this.right=c.G.number(r.right,l.right,d)),this}getCenter(r,l){const d=c.an((this.left+r-this.right)/2,0,r),g=c.an((this.top+l-this.bottom)/2,0,l);return new c.P(d,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new wo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oa(v,r){if(!v.renderWorldCopies||v.lngRange)return;const l=r.lng-v.center.lng;r.lng+=l>180?-360:l<-180?360:0}function Jn(v){return Math.max(0,Math.floor(v))}class Ia{constructor(r,l){var d;this.applyConstrain=(g,x)=>this._constrainOverride!==null?this._constrainOverride(g,x):this._callbacks.defaultConstrain(g,x),this._callbacks=r,this._tileSize=512,this._renderWorldCopies=(l==null?void 0:l.renderWorldCopies)===void 0||!!(l!=null&&l.renderWorldCopies),this._minZoom=(l==null?void 0:l.minZoom)||0,this._maxZoom=(l==null?void 0:l.maxZoom)||22,this._minPitch=(l==null?void 0:l.minPitch)==null?0:l==null?void 0:l.minPitch,this._maxPitch=(l==null?void 0:l.maxPitch)==null?60:l==null?void 0:l.maxPitch,this._constrainOverride=(d=l==null?void 0:l.constrainOverride)!==null&&d!==void 0?d:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Jn(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new wo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(r,l,d){this._constrainOverride=r.constrainOverride,this._latRange=r.latRange,this._lngRange=r.lngRange,this._width=r.width,this._height=r.height,this._center=r.center,this._elevation=r.elevation,this._minElevationForCurrentTile=r.minElevationForCurrentTile,this._zoom=r.zoom,this._tileZoom=Jn(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=r.bearingInRadians,this._fovInRadians=r.fovInRadians,this._pitchInRadians=r.pitchInRadians,this._rollInRadians=r.rollInRadians,this._unmodified=r.unmodified,this._edgeInsets=new wo(r.padding.top,r.padding.bottom,r.padding.left,r.padding.right),this._minZoom=r.minZoom,this._maxZoom=r.maxZoom,this._minPitch=r.minPitch,this._maxPitch=r.maxPitch,this._renderWorldCopies=r.renderWorldCopies,this._cameraToCenterDistance=r.cameraToCenterDistance,this._nearZ=r.nearZ,this._farZ=r.farZ,this._autoCalculateNearFarZ=!d&&r.autoCalculateNearFarZ,l&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(r){this._minElevationForCurrentTile=r}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(r){this._minZoom!==r&&(this._minZoom=r,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(r){this._minPitch!==r&&(this._minPitch=r,this.setPitch(Math.max(this.pitch,r)))}get maxPitch(){return this._maxPitch}setMaxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.setPitch(Math.min(this.pitch,r)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get constrainOverride(){return this._constrainOverride}setConstrainOverride(r){r===void 0&&(r=null),this._constrainOverride!==r&&(this._constrainOverride=r,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(r){const l=c.W(r,-180,180)*Math.PI/180;var d,g,x,w,P,A,M,j,F;this._bearingInRadians!==l&&(this._unmodified=!1,this._bearingInRadians=l,this._calcMatrices(),this._rotationMatrix=C(),d=this._rotationMatrix,x=-this._bearingInRadians,w=(g=this._rotationMatrix)[0],P=g[1],A=g[2],M=g[3],j=Math.sin(x),F=Math.cos(x),d[0]=w*F+A*j,d[1]=P*F+M*j,d[2]=w*-j+A*F,d[3]=P*-j+M*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(r){const l=c.an(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==l&&(this._unmodified=!1,this._pitchInRadians=l,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(r){const l=r/180*Math.PI;this._rollInRadians!==l&&(this._unmodified=!1,this._rollInRadians=l,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(r){r=c.an(r,.1,150),this.fov!==r&&(this._unmodified=!1,this._fovInRadians=c.ap(r),this._calcMatrices())}get zoom(){return this._zoom}setZoom(r){const l=this.applyConstrain(this._center,r).zoom;this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this._tileZoom=Math.max(0,Math.floor(l)),this._scale=c.aq(l),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(r){r!==this._elevation&&(this._elevation=r,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(r,l){this._autoCalculateNearFarZ=!1,this._nearZ=r,this._farZ=l,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,d){this._unmodified=!1,this._edgeInsets.interpolate(r,l,d),this.constrainInternal(),this._calcMatrices()}resize(r,l,d=!0){this._width=r,this._height=l,d&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new In([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(r){r?(this._lngRange=[r.getWest(),r.getEast()],this._latRange=[r.getSouth(),r.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(r,l){if(l.length===1)return[l[0],r];{const{minX:d,minY:g,maxX:x,maxY:w}=c.aa.fromPoints(l).extend(r);return[new c.P(d,g),new c.P(x,g),new c.P(x,w),new c.P(d,w),new c.P(d,g)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:l,zoom:d}=this.applyConstrain(this.center,this.zoom);this.setCenter(l),this.setZoom(d),this._unmodified=r,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let r=c.ar(new Float64Array(16));c.Q(r,r,[this._width/2,-this._height/2,1]),c.O(r,r,[1,-1,0]),this._clipSpaceToPixelsMatrix=r,r=c.ar(new Float64Array(16)),c.Q(r,r,[1,-1,1]),c.O(r,r,[-1,-1,0]),c.Q(r,r,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=r,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(r,l,d,g){const x=d!==void 0?d:this.bearing,w=g=g!==void 0?g:this.pitch,{distanceToCenter:P,clampedElevation:A}=this._distanceToCenterFromAltElevationPitch(l,this.elevation,w),{x:M,y:j}=mn(w,x),F=c.a9.fromLngLat(r,l);let O,$,Y=c.a_(1,F.y),se=0;do{if(se+=1,se>10)break;$=P/Y,O=new c.a9(F.x+M*$,F.y+j*$),Y=1/O.meterInMercatorCoordinateUnits()}while(Math.abs(P-$*Y)>1e-12);return{center:O.toLngLat(),elevation:A,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(r){if(this.elevation-r==0)return;const l=1/this.worldSize,d=c.as(1,this.center.lat)*this.worldSize,g=c.a9.fromLngLat(this.center,this.elevation),x=g.x/l,w=g.y/l,P=g.z/l,A=this.pitch,M=this.bearing,{x:j,y:F,z:O}=mn(A,M),$=this.cameraToCenterDistance,Y=x+$*-j,se=w+$*-F,oe=P+$*O,{distanceToCenter:ae,clampedElevation:he}=this._distanceToCenterFromAltElevationPitch(oe/d,r,A),ge=ae*d,ce=new c.a9((Y+j*ge)*l,(se+F*ge)*l,0).toLngLat(),fe=c.as(1,ce.lat),xe=c.at(this.height/2/Math.tan(this.fovInRadians/2)/ae/fe/this.tileSize);this._elevation=he,this._center=ce,this.setZoom(xe)}_distanceToCenterFromAltElevationPitch(r,l,d){const g=-Math.cos(c.ap(d)),x=r-l;let w,P=l;return g*x>=0||Math.abs(g)<.1?(w=1e4,P=r+w*g):w=-x/g,{distanceToCenter:w,clampedElevation:P}}getCameraPoint(){const r=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(r*Math.sin(this.rollInRadians),r*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const r=c.as(1,this.center.lat)*this.worldSize;return Re(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/r).toLngLat()}getMercatorTileCoordinates(r){if(!r)return[0,0,1,1];const l=r.canonical.z>=0?1<<r.canonical.z:Math.pow(2,r.canonical.z);return[r.canonical.x/l,r.canonical.y/l,1/l/c.a5,1/l/c.a5]}}class Ss{constructor(r,l){this.min=r,this.max=l,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],d=c.b1(this.min),g=c.b1(this.max);for(let x=0;x<l.length;x++)d[x]=l[x]?this.min[x]:this.center[x],g[x]=l[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new Ss(d,g)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersectsFrustum(r){let l=!0;for(let d=0;d<r.planes.length;d++){const g=this.intersectsPlane(r.planes[d]);if(g===0)return 0;g===1&&(l=!1)}return l?2:r.aabb.min[0]>this.max[0]||r.aabb.min[1]>this.max[1]||r.aabb.min[2]>this.max[2]||r.aabb.max[0]<this.min[0]||r.aabb.max[1]<this.min[1]||r.aabb.max[2]<this.min[2]?0:1}intersectsPlane(r){let l=r[3],d=r[3];for(let g=0;g<3;g++)r[g]>0?(l+=r[g]*this.min[g],d+=r[g]*this.max[g]):(d+=r[g]*this.min[g],l+=r[g]*this.max[g]);return l>=0?2:d<0?0:1}}class su{distanceToTile2d(r,l,d,g){const x=g.distanceX([r,l]),w=g.distanceY([r,l]);return Math.hypot(x,w)}getWrap(r,l,d){return d}getTileBoundingVolume(r,l,d,g){var x,w;let P=0,A=0;if(g!=null&&g.terrain){const j=new c.a2(r.z,l,r.z,r.x,r.y),F=g.terrain.getMinMaxElevation(j);P=(x=F.minElevation)!==null&&x!==void 0?x:Math.min(0,d),A=(w=F.maxElevation)!==null&&w!==void 0?w:Math.max(0,d)}const M=1<<r.z;return new Ss([l+r.x/M,r.y/M,P],[l+(r.x+1)/M,(r.y+1)/M,A])}allowVariableZoom(r,l){const d=r.fov*(Math.abs(Math.cos(r.rollInRadians))*r.height+Math.abs(Math.sin(r.rollInRadians))*r.width)/r.height,g=c.an(78.5-d/2,0,60);return!!l.terrain||r.pitch>g}allowWorldCopies(){return!0}prepareNextFrame(){}}class yi{constructor(r,l,d){this.points=r,this.planes=l,this.aabb=d}static fromInvProjectionMatrix(r,l=1,d=0,g,x){const w=x?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],P=Math.pow(2,d),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>function($,Y,se,oe){const ae=c.aH([],$,Y),he=1/ae[3]/se*oe;return c.b6(ae,ae,[he,he,1/ae[3],he])}(O,r,l,P));g&&function(O,$,Y,se){const oe=se?4:0,ae=se?0:4;let he=0;const ge=[],ce=[];for(let pe=0;pe<4;pe++){const Te=c.b2([],O[pe+ae],O[pe+oe]),Oe=c.b7(Te);c.a$(Te,Te,1/Oe),ge.push(Oe),ce.push(Te)}for(let pe=0;pe<4;pe++){const Te=c.b8(O[pe+oe],ce[pe],Y);he=Te!==null&&Te>=0?Math.max(he,Te):Math.max(he,ge[pe])}const fe=function(pe,Te){const Oe=c.b2([],pe[Te[0]],pe[Te[1]]),Me=c.b2([],pe[Te[2]],pe[Te[1]]),De=[0,0,0,0];return c.b3(De,c.b4([],Oe,Me)),De[3]=-c.b5(De,pe[Te[0]]),De}(O,$),xe=function(pe,Te){const Oe=c.b9(pe),Me=c.ba([],pe,1/Oe),De=c.b2([],Te,c.a$([],Me,c.b5(Te,Me))),je=c.b9(De);if(je>0){const et=Math.sqrt(1-Me[3]*Me[3]),nt=c.a$([],Me,-Me[3]),He=c.b0([],nt,c.a$([],De,et/je));return c.bb(Te,He)}return null}(Y,fe);if(xe!==null){const pe=xe/c.b5(ce[0],fe);he=Math.min(he,pe)}for(let pe=0;pe<4;pe++){const Te=Math.min(he,ge[pe]);O[pe+ae]=[O[pe+oe][0]+ce[pe][0]*Te,O[pe+oe][1]+ce[pe][1]*Te,O[pe+oe][2]+ce[pe][2]*Te,1]}}(A,w[0],g,x);const M=w.map(O=>{const $=c.b2([],A[O[0]],A[O[1]]),Y=c.b2([],A[O[2]],A[O[1]]),se=c.b3([],c.b4([],$,Y)),oe=-c.b5(se,A[O[1]]);return se.concat(oe)}),j=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],F=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const O of A)for(let $=0;$<3;$++)j[$]=Math.min(j[$],O[$]),F[$]=Math.max(F[$],O[$]);return new yi(A,M,new Ss(j,F))}}class Ma{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,l,d){return this._helper.interpolatePadding(r,l,d)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,l,d=!0){this._helper.resize(r,l,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,l){this._helper.overrideNearFarZ(r,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r,l){}constructor(r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(l,d)=>{d=c.an(+d,this.minZoom,this.maxZoom);const g={center:new c.V(l.lng,l.lat),zoom:d};let x=this._helper._lngRange;if(!this._helper._renderWorldCopies&&x===null){const ce=179.9999999999;x=[-ce,ce]}const w=this.tileSize*c.aq(g.zoom);let P=0,A=w,M=0,j=w,F=0,O=0;const{x:$,y:Y}=this.size;if(this._helper._latRange){const ce=this._helper._latRange;P=c.X(ce[1])*w,A=c.X(ce[0])*w,A-P<Y&&(F=Y/(A-P))}x&&(M=c.W(c.Y(x[0])*w,0,w),j=c.W(c.Y(x[1])*w,0,w),j<M&&(j+=w),j-M<$&&(O=$/(j-M)));const{x:se,y:oe}=yt(w,l);let ae,he;const ge=Math.max(O||0,F||0);if(ge){const ce=new c.P(O?(j+M)/2:se,F?(A+P)/2:oe);return g.center=It(w,ce).wrap(),g.zoom+=c.at(ge),g}if(this._helper._latRange){const ce=Y/2;oe-ce<P&&(he=P+ce),oe+ce>A&&(he=A-ce)}if(x){const ce=(M+j)/2;let fe=se;this._helper._renderWorldCopies&&(fe=c.W(se,ce-w/2,ce+w/2));const xe=$/2;fe-xe<M&&(ae=M+xe),fe+xe>j&&(ae=j-xe)}if(ae!==void 0||he!==void 0){const ce=new c.P(ae??se,he??oe);g.center=It(w,ce).wrap()}return g},this.applyConstrain=(l,d)=>this._helper.applyConstrain(l,d),this._helper=new Ia({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(l,d)=>this.defaultConstrain(l,d)},r),this._coveringTilesDetailsProvider=new su}clone(){const r=new Ma;return r.apply(this,!1),r}apply(r,l,d){this._helper.apply(r,l,d)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(r){const l=[new c.bc(0,r)];if(this._helper._renderWorldCopies){const d=this.screenPointToMercatorCoordinate(new c.P(0,0)),g=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),P=Math.floor(Math.min(d.x,g.x,x.x,w.x)),A=Math.floor(Math.max(d.x,g.x,x.x,w.x)),M=1;for(let j=P-M;j<=A+M;j++)j!==0&&l.push(new c.bc(j,r))}return l}getCameraFrustum(){return yi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){const l=this.screenPointToLocation(this.centerPoint,r),d=r?r.getElevationForLngLatZoom(l,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(d)}setLocationAtPoint(r,l){const d=c.as(this.elevation,this.center.lat),g=this.screenPointToMercatorCoordinateAtZ(l,d),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),w=c.a9.fromLngLat(r),P=new c.a9(w.x-(g.x-x.x),w.y-(g.y-x.y));this.setCenter(P==null?void 0:P.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(r,l){return l?this.coordinatePoint(c.a9.fromLngLat(r),l.getElevationForLngLat(r,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(r))}screenPointToLocation(r,l){var d;return(d=this.screenPointToMercatorCoordinate(r,l))===null||d===void 0?void 0:d.toLngLat()}screenPointToMercatorCoordinate(r,l){if(l){const d=l.pointCoordinate(r);if(d!=null)return d}return this.screenPointToMercatorCoordinateAtZ(r)}screenPointToMercatorCoordinateAtZ(r,l){const d=l||0,g=[r.x,r.y,0,1],x=[r.x,r.y,1,1];c.aH(g,g,this._pixelMatrixInverse),c.aH(x,x,this._pixelMatrixInverse);const w=g[3],P=x[3],A=g[1]/w,M=x[1]/P,j=g[2]/w,F=x[2]/P,O=j===F?0:(d-j)/(F-j);return new c.a9(c.G.number(g[0]/w,x[0]/P,O)/this.worldSize,c.G.number(A,M,O)/this.worldSize,d)}coordinatePoint(r,l=0,d=this._pixelMatrix){const g=[r.x*this.worldSize,r.y*this.worldSize,l,1];return c.aH(g,g,d),new c.P(g[0]/g[3],g[1]/g[3])}getBounds(){const r=Math.max(0,this._helper._height/2-dn(this));return new In().extend(this.screenPointToLocation(new c.P(0,r))).extend(this.screenPointToLocation(new c.P(this._helper._width,r))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(r,l){return l?l.pointCoordinate(r)!=null:r.y>this.height/2-dn(this)}calculatePosMatrix(r,l=!1,d){var g;const x=(g=r.key)!==null&&g!==void 0?g:c.bd(r.wrap,r.canonical.z,r.canonical.z,r.canonical.x,r.canonical.y),w=l?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(x)){const M=w.get(x);return d?M.f32:M.f64}const P=nn(r,this.worldSize);c.S(P,l?this._alignedProjMatrix:this._viewProjMatrix,P);const A={f64:P,f32:new Float32Array(P)};return w.set(x,A),d?A.f32:A.f64}calculateFogMatrix(r){const l=r.key,d=this._fogMatrixCacheF32;if(d.has(l))return d.get(l);const g=nn(r,this.worldSize);return c.S(g,this._fogMatrix,g),d.set(l,new Float32Array(g)),d.get(l)}calculateCenterFromCameraLngLatAlt(r,l,d,g){return this._helper.calculateCenterFromCameraLngLatAlt(r,l,d,g)}_calculateNearFarZIfNeeded(r,l,d){if(!this._helper.autoCalculateNearFarZ)return;const g=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=r-g*this._helper._pixelPerMeter/Math.cos(l),w=g<0?x:r,P=Math.PI/2+this.pitchInRadians,A=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+d.y/this.height),M=Math.sin(A)*w/Math.sin(c.an(Math.PI-P-A,.01,Math.PI-.01)),j=dn(this),F=Math.atan(j/this._helper.cameraToCenterDistance),O=c.ap(.75),$=F>O?2*F*(.5+d.y/(2*j)):O,Y=Math.sin($)*w/Math.sin(c.an(Math.PI-P-$,.01,Math.PI-.01)),se=Math.min(M,Y);this._helper._farZ=1.01*(Math.cos(Math.PI/2-l)*se+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const r=this.centerOffset,l=yt(this.worldSize,this.center),d=l.x,g=l.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const x=c.ap(Math.min(this.pitch,ut)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let P;this._calculateNearFarZIfNeeded(w,x,r),P=new Float64Array(16),c.be(P,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,P),P[8]=2*-r.x/this._helper._width,P[9]=2*r.y/this._helper._height,this._projectionMatrix=c.bf(P),c.Q(P,P,[1,-1,1]),c.O(P,P,[0,0,-this._helper.cameraToCenterDistance]),c.bg(P,P,-this.rollInRadians),c.bh(P,P,this.pitchInRadians),c.bg(P,P,-this.bearingInRadians),c.O(P,P,[-d,-g,0]),this._mercatorMatrix=c.Q([],P,[this.worldSize,this.worldSize,this.worldSize]),c.Q(P,P,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,P),c.O(P,P,[0,0,-this.elevation]),this._viewProjMatrix=P,this._invViewProjMatrix=c.aB([],P);const A=[0,0,-1,1];c.aH(A,A,this._invViewProjMatrix),this._cameraPosition=[A[0]/A[3],A[1]/A[3],A[2]/A[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-r.x/this.width,this._fogMatrix[9]=2*r.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-d,-g,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,P);const M=this._helper._width%2/2,j=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),O=Math.sin(-this.bearingInRadians),$=d-Math.round(d)+F*M+O*j,Y=g-Math.round(g)+F*j+O*M,se=new Float64Array(P);if(c.O(se,se,[$>.5?$-1:$,Y>.5?Y-1:Y,0]),this._alignedProjMatrix=se,P=c.aB(new Float64Array(16),this._pixelMatrix),!P)throw new Error("failed to invert matrix");this._pixelMatrixInverse=P,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const r=this.screenPointToMercatorCoordinate(new c.P(0,0)),l=[r.x*this.worldSize,r.y*this.worldSize,0,1];return c.aH(l,l,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const r=c.as(1,this.center.lat)*this.worldSize;return Re(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/r).toLngLat()}lngLatToCameraDepth(r,l){const d=c.a9.fromLngLat(r),g=[d.x*this.worldSize,d.y*this.worldSize,l,1];return c.aH(g,g,this._viewProjMatrix),g[2]/g[3]}getProjectionData(r){const{overscaledTileID:l,aligned:d,applyTerrainMatrix:g}=r,x=this._helper.getMercatorTileCoordinates(l),w=l?this.calculatePosMatrix(l,d,!0):null;let P;return P=l&&l.terrainRttPosMatrix32f&&g?l.terrainRttPosMatrix32f:w||c.bi(),{mainMatrix:P,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:P}}isLocationOccluded(r){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(r,l,d){return 1}transformLightDirection(r){return c.b1(r)}getRayDirectionFromPixel(r){throw new Error("Not implemented.")}projectTileCoordinates(r,l,d,g){const x=this.calculatePosMatrix(d);let w;g?(w=[r,l,g(r,l),1],c.aH(w,w,x)):(w=[r,l,0,1],nu(w,w,x));const P=w[3];return{point:new c.P(w[0]/P,w[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}populateCache(r){for(const l of r)this.calculatePosMatrix(l)}getMatrixForModel(r,l){const d=c.a9.fromLngLat(r,l),g=d.meterInMercatorCoordinateUnits(),x=c.bj();return c.O(x,x,[d.x,d.y,d.z]),c.bg(x,x,Math.PI),c.bh(x,x,Math.PI/2),c.Q(x,x,[-g,g,g]),x}getProjectionDataForCustomLayer(r=!0){const l=new c.a2(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:l,applyGlobeMatrix:r}),g=nn(l,this.worldSize);c.S(g,this._viewProjMatrix,g),d.tileMercatorCoords=[0,0,1,1];const x=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],w=c.bk();return c.Q(w,g,x),d.fallbackMatrix=w,d.mainMatrix=w,d}getFastPathSimpleProjectionMatrix(r){return this.calculatePosMatrix(r)}}function Fs(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function em(v){if(v.useSlerp)if(v.k<1){const r=c.bl(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),l=c.bl(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),d=new Float64Array(4);c.bm(d,r,l,v.k);const g=c.bn(d);v.tr.setRoll(g.roll),v.tr.setPitch(g.pitch),v.tr.setBearing(g.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(c.G.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(c.G.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(c.G.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function md(v,r,l,d,g){const x=g.padding,w=yt(g.worldSize,l.getNorthWest()),P=yt(g.worldSize,l.getNorthEast()),A=yt(g.worldSize,l.getSouthEast()),M=yt(g.worldSize,l.getSouthWest()),j=c.ap(-d),F=w.rotate(j),O=P.rotate(j),$=A.rotate(j),Y=M.rotate(j),se=new c.P(Math.max(F.x,O.x,Y.x,$.x),Math.max(F.y,O.y,Y.y,$.y)),oe=new c.P(Math.min(F.x,O.x,Y.x,$.x),Math.min(F.y,O.y,Y.y,$.y)),ae=se.sub(oe),he=(g.width-(x.left+x.right+r.left+r.right))/ae.x,ge=(g.height-(x.top+x.bottom+r.top+r.bottom))/ae.y;if(ge<0||he<0)return void Fs();const ce=Math.min(c.at(g.scale*Math.min(he,ge)),v.maxZoom),fe=c.P.convert(v.offset),xe=new c.P((r.left-r.right)/2,(r.top-r.bottom)/2).rotate(c.ap(d)),pe=fe.add(xe).mult(g.scale/c.aq(ce));return{center:It(g.worldSize,w.add(A).div(2).sub(pe)),zoom:ce,bearing:d}}class Ra{get useGlobeControls(){return!1}handlePanInertia(r,l){const d=r.mag(),g=Math.abs(dn(l));return{easingOffset:r.mult(Math.min(.75*g/d,1)),easingCenter:l.center}}handleMapControlsRollPitchBearingZoom(r,l){r.bearingDelta&&l.setBearing(l.bearing+r.bearingDelta),r.pitchDelta&&l.setPitch(l.pitch+r.pitchDelta),r.rollDelta&&l.setRoll(l.roll+r.rollDelta),r.zoomDelta&&l.setZoom(l.zoom+r.zoomDelta)}handleMapControlsPan(r,l,d){r.around.distSqr(l.centerPoint)<.01||l.setLocationAtPoint(d,r.around)}cameraForBoxAndBearing(r,l,d,g,x){return md(r,l,d,g,x)}handleJumpToCenterZoom(r,l){r.zoom!==(l.zoom!==void 0?+l.zoom:r.zoom)&&r.setZoom(+l.zoom),l.center!==void 0&&r.setCenter(c.V.convert(l.center))}handleEaseTo(r,l){const d=r.zoom,g=r.padding,x={roll:r.roll,pitch:r.pitch,bearing:r.bearing},w={roll:l.roll===void 0?r.roll:l.roll,pitch:l.pitch===void 0?r.pitch:l.pitch,bearing:l.bearing===void 0?r.bearing:l.bearing},P=l.zoom!==void 0,A=!r.isPaddingEqual(l.padding);let M=!1;const j=P?+l.zoom:r.zoom;let F=r.centerPoint.add(l.offsetAsPoint);const O=r.screenPointToLocation(F),{center:$,zoom:Y}=r.applyConstrain(c.V.convert(l.center||O),j??d);oa(r,$);const se=yt(r.worldSize,O),oe=yt(r.worldSize,$).sub(se),ae=c.aq(Y-d);return M=Y!==d,{easeFunc:he=>{if(M&&r.setZoom(c.G.number(d,Y,he)),c.bo(x,w)||em({startEulerAngles:x,endEulerAngles:w,tr:r,k:he,useSlerp:x.roll!=w.roll}),A&&(r.interpolatePadding(g,l.padding,he),F=r.centerPoint.add(l.offsetAsPoint)),l.around)r.setLocationAtPoint(l.around,l.aroundPoint);else{const ge=c.aq(r.zoom-d),ce=Y>d?Math.min(2,ae):Math.max(.5,ae),fe=Math.pow(ce,1-he),xe=It(r.worldSize,se.add(oe.mult(he*fe)).mult(ge));r.setLocationAtPoint(r.renderWorldCopies?xe.wrap():xe,F)}},isZooming:M,elevationCenter:$}}handleFlyTo(r,l){const d=l.zoom!==void 0,g=r.zoom,x=r.applyConstrain(c.V.convert(l.center||l.locationAtOffset),d?+l.zoom:g),w=x.center,P=x.zoom;oa(r,w);const A=yt(r.worldSize,l.locationAtOffset),M=yt(r.worldSize,w).sub(A),j=M.mag(),F=c.aq(P-g);let O;if(l.minZoom!==void 0){const $=Math.min(+l.minZoom,g,P),Y=r.applyConstrain(w,$).zoom;O=c.aq(Y-g)}return{easeFunc:($,Y,se,oe)=>{r.setZoom($===1?P:g+c.at(Y));const ae=$===1?w:It(r.worldSize,A.add(M.mult(se)).mult(Y));r.setLocationAtPoint(r.renderWorldCopies?ae.wrap():ae,oe)},scaleOfZoom:F,targetCenter:w,scaleOfMinZoom:O,pixelPathLength:j}}}class _n{constructor(r,l,d){this.blendFunction=r,this.blendColor=l,this.mask=d}}_n.Replace=[1,0],_n.disabled=new _n(_n.Replace,c.bp.transparent,[!1,!1,!1,!1]),_n.unblended=new _n(_n.Replace,c.bp.transparent,[!0,!0,!0,!0]),_n.alphaBlended=new _n([1,771],c.bp.transparent,[!0,!0,!0,!0]);const So=2305;class Yt{constructor(r,l,d){this.enable=r,this.mode=l,this.frontFace=d}}Yt.disabled=new Yt(!1,1029,So),Yt.backCCW=new Yt(!0,1029,So),Yt.frontCCW=new Yt(!0,1028,So);class Vt{constructor(r,l,d){this.func=r,this.mask=l,this.range=d}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const To=7680;class Jt{constructor(r,l,d,g,x,w){this.test=r,this.ref=l,this.mask=d,this.fail=g,this.depthFail=x,this.pass=w}}Jt.disabled=new Jt({func:519,mask:0},0,0,To,To,To);const Nl=new WeakMap;function Vi(v){var r;if(Nl.has(v))return Nl.get(v);{const l=(r=v.getParameter(v.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return Nl.set(v,l),l}}class Eo{get awaitingQuery(){return!!this._readbackQueue}constructor(r){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=r;const l=r.context,d=l.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;const g=new c.aW;g.emplaceBack(-1,-1),g.emplaceBack(2,-1),g.emplaceBack(-1,2);const x=new c.aY;x.emplaceBack(0,1,2),this._fullscreenTriangle=new yn(l.createVertexBuffer(g,aa.members),l.createIndexBuffer(x),c.aX.simpleSegment(0,0,g.length,x.length)),this._resultBuffer=new Uint8Array(4),l.activeTexture.set(d.TEXTURE1);const w=d.createTexture();d.bindTexture(d.TEXTURE_2D,w),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=l.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Vi(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){const r=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),r.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(r,l){const d=this._updateCount;return this._readbackQueue?d>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():d>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(r,l),this._updateCount++,this._measuredError}_bindFramebuffer(){const r=this._cachedRenderContext.context,l=r.gl;r.activeTexture.set(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this._fbo.colorAttachment.get()),r.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(r,l){const d=this._cachedRenderContext.context,g=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,g.TRIANGLES,Vt.disabled,Jt.disabled,_n.unblended,Yt.disabled,((x,w)=>({u_input:x,u_output_expected:w}))(r,l),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Vi(g)){g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.readBuffer(g.COLOR_ATTACHMENT0),g.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null);const x=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);g.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const r=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Vi(r)){const l=r.clientWaitSync(this._readbackQueue.sync,0,0);if(l===r.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(l===r.TIMEOUT_EXPIRED)return;r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Eo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(r){let l=0;return l+=r[0]/256,l+=r[1]/65536,l+=r[2]/16777216,r[3]<127&&(l=-l),l/128}}const la=c.a5/128;function tm(v,r){const l=v.granularity!==void 0?Math.max(v.granularity,1):1,d=l+(v.generateBorders?2:0),g=l+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),x=d+1,w=g+1,P=v.generateBorders?-1:0,A=v.generateBorders||v.extendToNorthPole?-1:0,M=l+(v.generateBorders?1:0),j=l+(v.generateBorders||v.extendToSouthPole?1:0),F=x*w,O=d*g*6,$=x*w>65536;if($&&r==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Y=$||r==="32bit",se=new Int16Array(2*F);let oe=0;for(let ge=A;ge<=j;ge++)for(let ce=P;ce<=M;ce++){let fe=ce/l*c.a5;ce===-1&&(fe=-la),ce===l+1&&(fe=c.a5+la);let xe=ge/l*c.a5;ge===-1&&(xe=v.extendToNorthPole?c.br:-la),ge===l+1&&(xe=v.extendToSouthPole?c.bs:c.a5+la),se[oe++]=fe,se[oe++]=xe}const ae=Y?new Uint32Array(O):new Uint16Array(O);let he=0;for(let ge=0;ge<g;ge++)for(let ce=0;ce<d;ce++){const fe=ce+1+ge*x,xe=ce+(ge+1)*x,pe=ce+1+(ge+1)*x;ae[he++]=ce+ge*x,ae[he++]=xe,ae[he++]=fe,ae[he++]=fe,ae[he++]=xe,ae[he++]=pe}return{vertices:se.buffer.slice(0),indices:ae.buffer.slice(0),uses32bitIndices:Y}}const Ll=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class gd{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zn.projectionGlobe}get vertexShaderPreludeCode(){return zn.projectionMercator.vertexSource}get subdivisionGranularity(){return Ll}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(r){this._errorMeasurement||(this._errorMeasurement=new Eo(r));const l=c.X(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-l*Math.PI*2))-.5*Math.PI,g=this._errorMeasurement.updateErrorLoop(l,d),x=te();g!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=g,this._errorMeasurementLastChangeTime=x);const w=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(w))}_getMeshKey(r){return`${r.granularity.toString(36)}_${r.generateBorders?"b":""}${r.extendToNorthPole?"n":""}${r.extendToSouthPole?"s":""}`}getMeshFromTileID(r,l,d,g,x){const w=(x==="stencil"?Ll.stencil:Ll.tile).getGranularityForZoomLevel(l.z);return this._getMesh(r,{granularity:w,generateBorders:d,extendToNorthPole:l.y===0&&g,extendToSouthPole:l.y===(1<<l.z)-1&&g})}_getMesh(r,l){const d=this._getMeshKey(l);if(d in this._tileMeshCache)return this._tileMeshCache[d];const g=function(x,w){const P=tm(w,"16bit"),A=c.aW.deserialize({arrayBuffer:P.vertices,length:P.vertices.byteLength/2/2}),M=c.aY.deserialize({arrayBuffer:P.indices,length:P.indices.byteLength/2/3});return new yn(x.createVertexBuffer(A,aa.members),x.createIndexBuffer(M),c.aX.simpleSegment(0,0,A.length,M.length))}(r,l);return this._tileMeshCache[d]=g,g}recalculate(r){}hasTransition(){const r=te();let l=!1;return l=l||(r-this._errorMeasurementLastChangeTime)/1e3<.7,l=l||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,l}setErrorQueryLatitudeDegrees(r){this._errorQueryLatitudeDegrees=r}}const N_=new c.t({type:new c.D(c.u.projection.type)});class nm extends c.E{constructor(r){super(),this._transitionable=new c.x(N_,void 0),this.setProjection(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new si,this._verticalPerspectiveProjection=new gd}get transitionState(){const r=this.properties.get("type");if(typeof r=="string"&&r==="mercator")return 0;if(typeof r=="string"&&r==="vertical-perspective")return 1;if(r instanceof c.bw){if(r.from==="vertical-perspective"&&r.to==="mercator")return 1-r.transition;if(r.from==="mercator"&&r.to==="vertical-perspective")return r.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(r){this._mercatorProjection.updateGPUdependent(r),this._verticalPerspectiveProjection.updateGPUdependent(r)}getMeshFromTileID(r,l,d,g,x){return this.currentProjection.getMeshFromTileID(r,l,d,g,x)}setProjection(r){this._transitionable.setValue("type",(r==null?void 0:r.type)||"mercator")}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}setErrorQueryLatitudeDegrees(r){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(r),this._mercatorProjection.setErrorQueryLatitudeDegrees(r)}}function ai(v){const r=Da(v.worldSize,v.center.lat);return 2*Math.PI*r}function Ts(v,r,l,d,g){const x=1/(1<<g),w=r/c.a5*x+d*x,P=c.by((v/c.a5*x+l*x)*Math.PI*2+Math.PI,2*Math.PI),A=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,M=Math.cos(A),j=new Float64Array(3);return j[0]=Math.sin(P)*M,j[1]=Math.sin(A),j[2]=Math.cos(P)*M,j}function Rn(v){return function(r,l){const d=Math.cos(l),g=new Float64Array(3);return g[0]=Math.sin(r)*d,g[1]=Math.sin(l),g[2]=Math.cos(r)*d,g}(v.lng*Math.PI/180,v.lat*Math.PI/180)}function Da(v,r){return v/(2*Math.PI)/Math.cos(r*Math.PI/180)}function yd(v){const r=Math.asin(v[1])/Math.PI*180,l=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(l>1e-6){const d=v[0]/l,g=Math.acos(v[2]/l),x=(d>0?g:-g)/Math.PI*180;return new c.V(c.W(x,-180,180),r)}return new c.V(0,r)}function zl(v){return Math.cos(v*Math.PI/180)}function Gn(v,r){const l=zl(v),d=zl(r);return c.at(d/l)}function rm(v,r){const l=v.rotate(r.bearingInRadians),d=r.zoom+Gn(r.center.lat,0),g=c.bu(1/zl(r.center.lat),1/zl(Math.min(Math.abs(r.center.lat),60)),c.bx(d,7,3,0,1)),x=360/ai({worldSize:r.worldSize,center:{lat:r.center.lat}});return new c.V(r.center.lng-l.x*x*g,c.an(r.center.lat+l.y*x,-c.ao,c.ao))}function _d(v){const r=.5*v,l=Math.sin(r),d=Math.cos(r);return Math.log(l+d)-Math.log(d-l)}function im(v,r,l,d){const g=v.lat+l*d;if(Math.abs(l)>1){const x=(Math.sign(v.lat+l)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,w=Math.abs(v.lat+l)*Math.PI/180,P=_d(x+d*(w-x)),A=_d(x),M=_d(w);return new c.V(v.lng+r*((P-A)/(M-A)),g)}return new c.V(v.lng+r*d,g)}class L_{constructor(r){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=r}swapBuffers(){if(!this._hadAnyChanges)return;const r=this._cachePrevious;this._cachePrevious=this._cache,this._cache=r,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(r,l,d,g){const x=`${r.z}_${r.x}_${r.y}_${g!=null&&g.terrain?"t":""}`,w=this._cache.get(x);if(w)return w;const P=this._cachePrevious.get(x);if(P)return this._cache.set(x,P),P;const A=this._boundingVolumeFactory(r,l,d,g);return this._cache.set(x,A),this._hadAnyChanges=!0,A}}class Po{constructor(r,l,d,g){this.min=d,this.max=g,this.points=r,this.planes=l}static fromAabb(r,l){const d=[];for(let g=0;g<8;g++)d.push([1&~g?r[0]:l[0],(g>>1&1)==1?l[1]:r[1],(g>>2&1)==1?l[2]:r[2]]);return new Po(d,[[-1,0,0,l[0]],[1,0,0,-r[0]],[0,-1,0,l[1]],[0,1,0,-r[1]],[0,0,-1,l[2]],[0,0,1,-r[2]]],r,l)}static fromCenterSizeAngles(r,l,d){const g=c.bB([],d[0],d[1],d[2]),x=c.bC([],[l[0],0,0],g),w=c.bC([],[0,l[1],0],g),P=c.bC([],[0,0,l[2]],g),A=[...r],M=[...r];for(let F=0;F<8;F++)for(let O=0;O<3;O++){const $=r[O]+x[O]*(1&~F?-1:1)+w[O]*((F>>1&1)==1?1:-1)+P[O]*((F>>2&1)==1?1:-1);A[O]=Math.min(A[O],$),M[O]=Math.max(M[O],$)}const j=[];for(let F=0;F<8;F++){const O=[...r];c.b0(O,O,c.a$([],x,1&~F?-1:1)),c.b0(O,O,c.a$([],w,(F>>1&1)==1?1:-1)),c.b0(O,O,c.a$([],P,(F>>2&1)==1?1:-1)),j.push(O)}return new Po(j,[[...x,-c.b5(x,j[0])],[...w,-c.b5(w,j[0])],[...P,-c.b5(P,j[0])],[-x[0],-x[1],-x[2],-c.b5(x,j[7])],[-w[0],-w[1],-w[2],-c.b5(w,j[7])],[-P[0],-P[1],-P[2],-c.b5(P,j[7])]],A,M)}intersectsFrustum(r){let l=!0;const d=this.points.length,g=this.planes.length,x=r.planes.length,w=r.points.length;for(let P=0;P<x;P++){const A=r.planes[P];let M=0;for(let j=0;j<d;j++){const F=this.points[j];A[0]*F[0]+A[1]*F[1]+A[2]*F[2]+A[3]>=0&&M++}if(M===0)return 0;M<d&&(l=!1)}if(l)return 2;for(let P=0;P<g;P++){const A=this.planes[P];let M=0;for(let j=0;j<w;j++){const F=r.points[j];A[0]*F[0]+A[1]*F[1]+A[2]*F[2]+A[3]>=0&&M++}if(M===0)return 0}return 1}intersectsPlane(r){const l=this.points.length;let d=0;for(let g=0;g<l;g++){const x=this.points[g];r[0]*x[0]+r[1]*x[1]+r[2]*x[2]+r[3]>=0&&d++}return d===l?2:d===0?0:1}}function au(v,r,l){const d=v-r;return d<0?-d:Math.max(0,d-l)}function Co(v,r,l,d,g){const x=v-l;let w;return w=x<0?Math.min(-x,1+x-g):x>1?Math.min(Math.max(x-g,0),1-x):0,Math.max(w,au(r,d,g))}class vd{constructor(){this._boundingVolumeCache=new L_(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(r,l,d,g){const x=1<<d.z,w=1/x,P=d.x/x,A=d.y/x;let M=2;return M=Math.min(M,Co(r,l,P,A,w)),M=Math.min(M,Co(r,l,P+.5,-A-w,w)),M=Math.min(M,Co(r,l,P+.5,2-A-w,w)),M}getWrap(r,l,d){const g=1<<l.z,x=1/g,w=l.x/g,P=au(r.x,w,x),A=au(r.x,w-1,x),M=au(r.x,w+1,x),j=Math.min(P,A,M);return j===M?1:j===A?-1:0}allowVariableZoom(r,l){return Cn(r,l)>4}allowWorldCopies(){return!1}getTileBoundingVolume(r,l,d,g){return this._boundingVolumeCache.getTileBoundingVolume(r,l,d,g)}_computeTileBoundingVolume(r,l,d,g){var x,w;let P=0,A=0;if(g!=null&&g.terrain){const M=new c.a2(r.z,l,r.z,r.x,r.y),j=g.terrain.getMinMaxElevation(M);P=(x=j.minElevation)!==null&&x!==void 0?x:Math.min(0,d),A=(w=j.maxElevation)!==null&&w!==void 0?w:Math.max(0,d)}if(P/=c.bE,A/=c.bE,P+=1,A+=1,r.z<=0)return Po.fromAabb([-A,-A,-A],[A,A,A]);if(r.z===1)return Po.fromAabb([r.x===0?-A:0,r.y===0?0:-A,-A],[r.x===0?0:A,r.y===0?A:0,A]);{const M=[Ts(0,0,r.x,r.y,r.z),Ts(c.a5,0,r.x,r.y,r.z),Ts(c.a5,c.a5,r.x,r.y,r.z),Ts(0,c.a5,r.x,r.y,r.z)],j=[];for(const De of M)j.push(c.a$([],De,A));if(A!==P)for(const De of M)j.push(c.a$([],De,P));r.y===0&&j.push([0,1,0]),r.y===(1<<r.z)-1&&j.push([0,-1,0]);const F=[1,1,1],O=[-1,-1,-1];for(const De of j)for(let je=0;je<3;je++)F[je]=Math.min(F[je],De[je]),O[je]=Math.max(O[je],De[je]);const $=Ts(c.a5/2,c.a5/2,r.x,r.y,r.z),Y=c.b4([],[0,1,0],$);c.b3(Y,Y);const se=c.b4([],$,Y);c.b3(se,se);const oe=c.b4([],M[2],M[1]);c.b3(oe,oe);const ae=c.b4([],M[0],M[3]);c.b3(ae,ae),j.push(c.a$([],$,A)),r.y>=(1<<r.z)/2&&j.push(c.a$([],Ts(c.a5/2,0,r.x,r.y,r.z),A)),r.y<(1<<r.z)/2&&j.push(c.a$([],Ts(c.a5/2,c.a5,r.x,r.y,r.z),A));const he=Ol($,j),ge=Ol(se,j),ce=[-$[0],-$[1],-$[2],he.max],fe=[$[0],$[1],$[2],-he.min],xe=[-se[0],-se[1],-se[2],ge.max],pe=[se[0],se[1],se[2],-ge.min],Te=[...oe,0],Oe=[...ae,0],Me=[];return r.y===0?Me.push(c.bD(Oe,Te,ce),c.bD(Oe,Te,fe)):Me.push(c.bD(xe,Te,ce),c.bD(xe,Te,fe),c.bD(xe,Oe,ce),c.bD(xe,Oe,fe)),r.y===(1<<r.z)-1?Me.push(c.bD(Oe,Te,ce),c.bD(Oe,Te,fe)):Me.push(c.bD(pe,Te,ce),c.bD(pe,Te,fe),c.bD(pe,Oe,ce),c.bD(pe,Oe,fe)),new Po(Me,[ce,fe,xe,pe,Te,Oe],F,O)}}}function Ol(v,r){let l=1/0,d=-1/0;for(const g of r){const x=c.b5(v,g);l=Math.min(l,x),d=Math.max(d,x)}return{min:l,max:d}}class ko{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,l,d){return this._helper.interpolatePadding(r,l,d)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,l){this._helper.resize(r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,l){this._helper.overrideNearFarZ(r,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r){}constructor(r){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(l,d)=>{const g=c.an(l.lat,-c.ao,c.ao),x=c.an(+d,this.minZoom+Gn(0,g),this.maxZoom);return{center:new c.V(l.lng,g),zoom:x}},this.applyConstrain=(l,d)=>this._helper.applyConstrain(l,d),this._helper=new Ia({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(l,d)=>this.defaultConstrain(l,d)},r),this._coveringTilesDetailsProvider=new vd}clone(){const r=new ko;return r.apply(this,!1),r}apply(r,l,d){this._globeLatitudeErrorCorrectionRadians=d||0,this._helper.apply(r,l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const r=c.bz();return r[0]=this._cameraPosition[0],r[1]=this._cameraPosition[1],r[2]=this._cameraPosition[2],r}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(r){const{overscaledTileID:l,applyGlobeMatrix:d}=r,g=this._helper.getMercatorTileCoordinates(l);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:g,clippingPlane:this._cachedClippingPlane,projectionTransition:d?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(r){const l=this.pitchInRadians,d=this.cameraToCenterDistance/r,g=Math.sin(l)*d,x=Math.cos(l)*d+1,w=1/Math.sqrt(g*g+x*x)*1;let P=-g,A=x;const M=Math.sqrt(P*P+A*A);P/=M,A/=M;const j=[0,P,A];c.bG(j,j,[0,0,0],-this.bearingInRadians),c.bH(j,j,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(j,j,[0,0,0],this.center.lng*Math.PI/180);const F=1/c.b7(j);return c.a$(j,j,F),[...j,-w*F]}isLocationOccluded(r){return!this.isSurfacePointVisible(Rn(r))}transformLightDirection(r){const l=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,g=Math.cos(d),x=[Math.sin(l)*g,Math.sin(d),Math.cos(l)*g],w=[x[2],0,-x[0]],P=[0,0,0];c.b4(P,w,x),c.b3(w,w),c.b3(P,P);const A=[0,0,0];return c.b3(A,[w[0]*r[0]+P[0]*r[1]+x[0]*r[2],w[1]*r[0]+P[1]*r[1]+x[1]*r[2],w[2]*r[0]+P[2]*r[1]+x[2]*r[2]]),A}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(r,l,d){const g=function(P,A,M){const j=1/(1<<M.z);return new c.a9(P/c.a5*j+M.x*j,A/c.a5*j+M.y*j)}(r,l,d.canonical),x=(w=g.y,[c.by(g.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(r,l,d,g){const x=d.canonical,w=Ts(r,l,x.x,x.y,x.z),P=1+(g?g(r,l):0)/c.bE,A=[w[0]*P,w[1]*P,w[2]*P,1];c.aH(A,A,this._globeViewProjMatrixNoCorrection);const M=this._cachedClippingPlane,j=M[0]*w[0]+M[1]*w[1]+M[2]*w[2]+M[3]<0;return{point:new c.P(A[0]/A[3],A[1]/A[3]),signedDistanceFromCamera:A[3],isOccluded:j}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const r=Da(this.worldSize,this.center.lat),l=c.bk(),d=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*r),c.be(l,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const g=this.centerOffset;l[8]=2*-g.x/this._helper._width,l[9]=2*g.y/this._helper._height,this._projectionMatrix=c.bf(l),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,l),c.O(l,l,[0,0,-this.cameraToCenterDistance]),c.bg(l,l,this.rollInRadians),c.bh(l,l,-this.pitchInRadians),c.bg(l,l,this.bearingInRadians),c.O(l,l,[0,0,-r]);const x=c.bz();x[0]=r,x[1]=r,x[2]=r,c.bh(d,l,this.center.lat*Math.PI/180),c.bJ(d,d,-this.center.lng*Math.PI/180),c.Q(d,d,x),this._globeViewProjMatrixNoCorrection=d,c.bh(l,l,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(l,l,-this.center.lng*Math.PI/180),c.Q(l,l,x),this._globeViewProjMatrix32f=new Float32Array(l),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,d);const w=c.bz();this._cameraPosition=c.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/r,c.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(r);const P=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(P,P,[1,1,-1]),this._cachedFrustum=yi.fromInvProjectionMatrix(P,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(r){c.w("calculateFogMatrix is not supported on globe projection.");const l=c.bk();return c.ar(l),l}getVisibleUnwrappedCoordinates(r){return[new c.bc(0,r)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){r&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,l){if(!this._globeViewProjMatrixNoCorrection)return 1;const d=Rn(r);c.a$(d,d,1+l/c.bE);const g=c.bF();return c.aH(g,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),g[2]/g[3]}populateCache(r){}getBounds(){const r=.5*this.width,l=.5*this.height,d=[new c.P(0,0),new c.P(r,0),new c.P(this.width,0),new c.P(this.width,l),new c.P(this.width,this.height),new c.P(r,this.height),new c.P(0,this.height),new c.P(0,l)],g=[];for(const F of d)g.push(this.unprojectScreenPoint(F));let x=0,w=0,P=0,A=0;const M=this.center;for(const F of g){const O=c.bK(M.lng,F.lng),$=c.bK(M.lat,F.lat);O<w&&(w=O),O>x&&(x=O),$<A&&(A=$),$>P&&(P=$)}const j=[M.lng+w,M.lat+A,M.lng+x,M.lat+P];return this.isSurfacePointOnScreen([0,1,0])&&(j[3]=90,j[0]=-180,j[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(j[1]=-90,j[0]=-180,j[2]=180),new In(j)}calculateCenterFromCameraLngLatAlt(r,l,d,g){return this._helper.calculateCenterFromCameraLngLatAlt(r,l,d,g)}setLocationAtPoint(r,l){const d=Rn(this.unprojectScreenPoint(l)),g=Rn(r),x=c.bz();c.bL(x);const w=c.bz();c.bI(w,d,x,-this.center.lng*Math.PI/180),c.bH(w,w,x,this.center.lat*Math.PI/180);const P=g[0]*g[0]+g[2]*g[2],A=w[0]*w[0];if(P<A)return;const M=Math.sqrt(P-A),j=-M,F=c.bM(g[0],g[2],w[0],M),O=c.bM(g[0],g[2],w[0],j),$=c.bz();c.bI($,g,x,-F);const Y=c.bM($[1],$[2],w[1],w[2]),se=c.bz();c.bI(se,g,x,-O);const oe=c.bM(se[1],se[2],w[1],w[2]),ae=.5*Math.PI,he=Y>=-ae&&Y<=ae,ge=oe>=-ae&&oe<=ae;let ce,fe;if(he&&ge){const Oe=this.center.lng*Math.PI/180,Me=this.center.lat*Math.PI/180;c.bN(F,Oe)+c.bN(Y,Me)<c.bN(O,Oe)+c.bN(oe,Me)?(ce=F,fe=Y):(ce=O,fe=oe)}else if(he)ce=F,fe=Y;else{if(!ge)return;ce=O,fe=oe}const xe=ce/Math.PI*180,pe=fe/Math.PI*180,Te=this.center.lat;this.setCenter(new c.V(xe,c.an(pe,-90,90))),this.setZoom(this.zoom+Gn(Te,this.center.lat))}locationToScreenPoint(r,l){const d=Rn(r);if(l){const g=l.getElevationForLngLatZoom(r,this._helper._tileZoom);c.a$(d,d,1+g/c.bE)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(r){const l=c.bF();return c.aH(l,[...r,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],new c.P((.5*l[0]+.5)*this.width,(.5*-l[1]+.5)*this.height)}screenPointToMercatorCoordinate(r,l){if(l){const d=l.pointCoordinate(r);if(d)return d}return c.a9.fromLngLat(this.unprojectScreenPoint(r))}screenPointToLocation(r,l){var d;return(d=this.screenPointToMercatorCoordinate(r,l))===null||d===void 0?void 0:d.toLngLat()}isPointOnMapSurface(r,l){const d=this._cameraPosition,g=this.getRayDirectionFromPixel(r);return!!this.rayPlanetIntersection(d,g)}getRayDirectionFromPixel(r){const l=c.bF();l[0]=r.x/this.width*2-1,l[1]=-1*(r.y/this.height*2-1),l[2]=1,l[3]=1,c.aH(l,l,this._globeViewProjMatrixNoCorrectionInverted),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3];const d=c.bz();d[0]=l[0]-this._cameraPosition[0],d[1]=l[1]-this._cameraPosition[1],d[2]=l[2]-this._cameraPosition[2];const g=c.bz();return c.b3(g,d),g}isSurfacePointVisible(r){const l=this._cachedClippingPlane;return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3]>=0}isSurfacePointOnScreen(r){if(!this.isSurfacePointVisible(r))return!1;const l=c.bF();return c.aH(l,[...r,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3],l[0]>-1&&l[0]<1&&l[1]>-1&&l[1]<1&&l[2]>-1&&l[2]<1}rayPlanetIntersection(r,l){const d=c.b5(r,l),g=c.bz(),x=c.bz();c.a$(x,l,d),c.b2(g,r,x);const w=1-c.b5(g,g);if(w<0)return null;const P=c.b5(r,r)-1,A=-d+(d<0?1:-1)*Math.sqrt(w),M=P/A,j=A;return{tMin:Math.min(M,j),tMax:Math.max(M,j)}}unprojectScreenPoint(r){const l=this._cameraPosition,d=this.getRayDirectionFromPixel(r),g=this.rayPlanetIntersection(l,d);if(g){const j=c.bz();c.b0(j,l,[d[0]*g.tMin,d[1]*g.tMin,d[2]*g.tMin]);const F=c.bz();return c.b3(F,j),yd(F)}const x=this._cachedClippingPlane,w=x[0]*d[0]+x[1]*d[1]+x[2]*d[2],P=-c.bb(x,l)/w,A=c.bz();if(P>0)c.b0(A,l,[d[0]*P,d[1]*P,d[2]*P]);else{const j=c.bz();c.b0(j,l,[2*d[0],2*d[1],2*d[2]]);const F=c.bb(this._cachedClippingPlane,j);c.b2(A,j,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const M=function(j){const F=c.bz();return F[0]=j[0]*-j[3],F[1]=j[1]*-j[3],F[2]=j[2]*-j[3],{center:F,radius:Math.sqrt(1-j[3]*j[3])}}(x);return yd(function(j,F,O){const $=c.bz();c.b2($,O,j);const Y=c.bz();return c.bA(Y,j,$,F/c.b9($)),Y}(M.center,M.radius,A))}getMatrixForModel(r,l){const d=c.V.convert(r),g=1/c.bE,x=c.bj();return c.bJ(x,x,d.lng/180*Math.PI),c.bh(x,x,-d.lat/180*Math.PI),c.O(x,x,[0,0,1+l/c.bE]),c.bh(x,x,.5*Math.PI),c.Q(x,x,[g,g,g]),x}getProjectionDataForCustomLayer(r=!0){const l=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:r});return l.tileMercatorCoords=[0,0,1,1],l}getFastPathSimpleProjectionMatrix(r){}}class Ao{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,l,d){return this._helper.interpolatePadding(r,l,d)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,l,d=!0){this._helper.resize(r,l,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,l){this._helper.overrideNearFarZ(r,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(r,l){this._globeness=r,this._globeLatitudeErrorCorrectionRadians=l,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(r){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(l,d)=>this.currentTransform.defaultConstrain(l,d),this.applyConstrain=(l,d)=>this._helper.applyConstrain(l,d),this._helper=new Ia({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(l,d)=>this.defaultConstrain(l,d)},r),this._globeness=1,this._mercatorTransform=new Ma,this._verticalPerspectiveTransform=new ko}clone(){const r=new Ao;return r._globeness=this._globeness,r._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,r.apply(this,!1),r}apply(r,l){this._helper.apply(r,l),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(r){const l=this._mercatorTransform.getProjectionData(r),d=this._verticalPerspectiveTransform.getProjectionData(r);return{mainMatrix:this.isGlobeRendering?d.mainMatrix:l.mainMatrix,clippingPlane:d.clippingPlane,tileMercatorCoords:d.tileMercatorCoords,projectionTransition:r.applyGlobeMatrix?this._globeness:0,fallbackMatrix:l.fallbackMatrix}}isLocationOccluded(r){return this.currentTransform.isLocationOccluded(r)}transformLightDirection(r){return this.currentTransform.transformLightDirection(r)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(r,l,d){const g=this._mercatorTransform.getPitchedTextCorrection(r,l,d),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(r,l,d);return c.bu(g,x,this._globeness)}projectTileCoordinates(r,l,d,g){return this.currentTransform.projectTileCoordinates(r,l,d,g)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(r){return this.currentTransform.calculateFogMatrix(r)}getVisibleUnwrappedCoordinates(r){return this.currentTransform.getVisibleUnwrappedCoordinates(r)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(r){this._mercatorTransform.recalculateZoomAndCenter(r),this._verticalPerspectiveTransform.recalculateZoomAndCenter(r)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,l){return this.currentTransform.lngLatToCameraDepth(r,l)}populateCache(r){this._mercatorTransform.populateCache(r),this._verticalPerspectiveTransform.populateCache(r)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(r,l,d,g){return this._helper.calculateCenterFromCameraLngLatAlt(r,l,d,g)}setLocationAtPoint(r,l){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(r,l),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(r,l),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(r,l){return this.currentTransform.locationToScreenPoint(r,l)}screenPointToMercatorCoordinate(r,l){return this.currentTransform.screenPointToMercatorCoordinate(r,l)}screenPointToLocation(r,l){return this.currentTransform.screenPointToLocation(r,l)}isPointOnMapSurface(r,l){return this.currentTransform.isPointOnMapSurface(r,l)}getRayDirectionFromPixel(r){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(r)}getMatrixForModel(r,l){return this.currentTransform.getMatrixForModel(r,l)}getProjectionDataForCustomLayer(r=!0){const l=this._mercatorTransform.getProjectionDataForCustomLayer(r);if(!this.isGlobeRendering)return l;const d=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(r);return d.fallbackMatrix=l.mainMatrix,d}getFastPathSimpleProjectionMatrix(r){return this.currentTransform.getFastPathSimpleProjectionMatrix(r)}}class pr{get useGlobeControls(){return!0}handlePanInertia(r,l){const d=rm(r,l);return Math.abs(d.lng-l.center.lng)>180&&(d.lng=l.center.lng+179.5*Math.sign(d.lng-l.center.lng)),{easingCenter:d,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(r,l){const d=r.around,g=l.screenPointToLocation(d);r.bearingDelta&&l.setBearing(l.bearing+r.bearingDelta),r.pitchDelta&&l.setPitch(l.pitch+r.pitchDelta),r.rollDelta&&l.setRoll(l.roll+r.rollDelta);const x=l.zoom;r.zoomDelta&&l.setZoom(l.zoom+r.zoomDelta);const w=l.zoom-x;if(w===0)return;const P=c.bK(l.center.lng,g.lng),A=P/(Math.abs(P/180)+1),M=c.bK(l.center.lat,g.lat),j=l.getRayDirectionFromPixel(d),F=l.cameraPosition,O=-1*c.b5(F,j),$=c.bz();c.b0($,F,[j[0]*O,j[1]*O,j[2]*O]);const Y=c.b7($)-1,se=Math.exp(.5*-Math.max(Y-.3,0)),oe=Da(l.worldSize,l.center.lat)/Math.min(l.width,l.height),ae=c.bx(oe,.9,.5,1,.25),he=(1-c.aq(-w))*Math.min(se,ae),ge=l.center.lat,ce=l.zoom,fe=new c.V(l.center.lng+A*he,c.an(l.center.lat+M*he,-c.ao,c.ao));l.setLocationAtPoint(g,d);const xe=l.center,pe=c.bx(Math.abs(P),45,85,0,1),Te=c.bx(oe,.75,.35,0,1),Oe=Math.pow(Math.max(pe,Te),.25),Me=c.bK(xe.lng,fe.lng),De=c.bK(xe.lat,fe.lat);l.setCenter(new c.V(xe.lng+Me*Oe,xe.lat+De*Oe).wrap()),l.setZoom(ce+Gn(ge,l.center.lat))}handleMapControlsPan(r,l,d){if(!r.panDelta)return;const g=l.center.lat,x=l.zoom;l.setCenter(rm(r.panDelta,l).wrap()),l.setZoom(x+Gn(g,l.center.lat))}cameraForBoxAndBearing(r,l,d,g,x){const w=md(r,l,d,g,x),P=l.left/x.width*2-1,A=(x.width-l.right)/x.width*2-1,M=l.top/x.height*-2+1,j=(x.height-l.bottom)/x.height*-2+1,F=c.bK(d.getWest(),d.getEast())<0,O=F?d.getEast():d.getWest(),$=F?d.getWest():d.getEast(),Y=Math.max(d.getNorth(),d.getSouth()),se=Math.min(d.getNorth(),d.getSouth()),oe=O+.5*c.bK(O,$),ae=Y+.5*c.bK(Y,se),he=x.clone();he.setCenter(w.center),he.setBearing(w.bearing),he.setPitch(0),he.setRoll(0),he.setZoom(w.zoom);const ge=he.modelViewProjectionMatrix,ce=[Rn(d.getNorthWest()),Rn(d.getNorthEast()),Rn(d.getSouthWest()),Rn(d.getSouthEast()),Rn(new c.V($,ae)),Rn(new c.V(O,ae)),Rn(new c.V(oe,Y)),Rn(new c.V(oe,se))],fe=Rn(w.center);let xe=Number.POSITIVE_INFINITY;for(const pe of ce)P<0&&(xe=pr.getLesserNonNegativeNonNull(xe,pr.solveVectorScale(pe,fe,ge,"x",P))),A>0&&(xe=pr.getLesserNonNegativeNonNull(xe,pr.solveVectorScale(pe,fe,ge,"x",A))),M>0&&(xe=pr.getLesserNonNegativeNonNull(xe,pr.solveVectorScale(pe,fe,ge,"y",M))),j<0&&(xe=pr.getLesserNonNegativeNonNull(xe,pr.solveVectorScale(pe,fe,ge,"y",j)));if(Number.isFinite(xe)&&xe!==0)return w.zoom=he.zoom+c.at(xe),w;Fs()}handleJumpToCenterZoom(r,l){const d=r.center.lat,g=r.applyConstrain(l.center?c.V.convert(l.center):r.center,r.zoom).center;r.setCenter(g.wrap());const x=l.zoom!==void 0?+l.zoom:r.zoom+Gn(d,g.lat);r.zoom!==x&&r.setZoom(x)}handleEaseTo(r,l){const d=r.zoom,g=r.center,x=r.padding,w={roll:r.roll,pitch:r.pitch,bearing:r.bearing},P={roll:l.roll===void 0?r.roll:l.roll,pitch:l.pitch===void 0?r.pitch:l.pitch,bearing:l.bearing===void 0?r.bearing:l.bearing},A=l.zoom!==void 0,M=!r.isPaddingEqual(l.padding);let j=!1;const F=l.center?c.V.convert(l.center):g,O=r.applyConstrain(F,d).center;oa(r,O);const $=r.clone();$.setCenter(O),$.setZoom(A?+l.zoom:d+Gn(g.lat,F.lat)),$.setBearing(l.bearing);const Y=new c.P(c.an(r.centerPoint.x+l.offsetAsPoint.x,0,r.width),c.an(r.centerPoint.y+l.offsetAsPoint.y,0,r.height));$.setLocationAtPoint(O,Y);const se=(l.offset&&l.offsetAsPoint.mag())>0?$.center:O,oe=A?+l.zoom:d+Gn(g.lat,se.lat),ae=d+Gn(g.lat,0),he=oe+Gn(se.lat,0),ge=c.bK(g.lng,se.lng),ce=c.bK(g.lat,se.lat),fe=c.aq(he-ae);return j=oe!==d,{easeFunc:xe=>{if(c.bo(w,P)||em({startEulerAngles:w,endEulerAngles:P,tr:r,k:xe,useSlerp:w.roll!=P.roll}),M&&r.interpolatePadding(x,l.padding,xe),l.around)c.w("Easing around a point is not supported under globe projection."),r.setLocationAtPoint(l.around,l.aroundPoint);else{const pe=he>ae?Math.min(2,fe):Math.max(.5,fe),Te=Math.pow(pe,1-xe),Oe=im(g,ge,ce,xe*Te);r.setCenter(Oe.wrap())}if(j){const pe=c.G.number(ae,he,xe)+Gn(0,r.center.lat);r.setZoom(pe)}},isZooming:j,elevationCenter:se}}handleFlyTo(r,l){const d=l.zoom!==void 0,g=r.center,x=r.zoom,w=r.padding,P=!r.isPaddingEqual(l.padding),A=r.applyConstrain(c.V.convert(l.center||l.locationAtOffset),x).center,M=d?+l.zoom:r.zoom+Gn(r.center.lat,A.lat),j=r.clone();j.setCenter(A),j.setZoom(M),j.setBearing(l.bearing);const F=new c.P(c.an(r.centerPoint.x+l.offsetAsPoint.x,0,r.width),c.an(r.centerPoint.y+l.offsetAsPoint.y,0,r.height));j.setLocationAtPoint(A,F);const O=j.center;oa(r,O);const $=function(ce,fe,xe){const pe=Rn(fe),Te=Rn(xe),Oe=c.b5(pe,Te),Me=Math.acos(Oe),De=ai(ce);return Me/(2*Math.PI)*De}(r,g,O),Y=x+Gn(g.lat,0),se=M+Gn(O.lat,0),oe=c.aq(se-Y);let ae;if(typeof l.minZoom=="number"){const ce=+l.minZoom+Gn(O.lat,0),fe=Math.min(ce,Y,se)+Gn(0,O.lat),xe=r.applyConstrain(O,fe).zoom+Gn(O.lat,0);ae=c.aq(xe-Y)}const he=c.bK(g.lng,O.lng),ge=c.bK(g.lat,O.lat);return{easeFunc:(ce,fe,xe,pe)=>{const Te=im(g,he,ge,xe);P&&r.interpolatePadding(w,l.padding,ce);const Oe=ce===1?O:Te;r.setCenter(Oe.wrap());const Me=Y+c.at(fe);r.setZoom(ce===1?M:Me+Gn(0,Oe.lat))},scaleOfZoom:oe,targetCenter:O,scaleOfMinZoom:ae,pixelPathLength:$}}static solveVectorScale(r,l,d,g,x){const w=g==="x"?[d[0],d[4],d[8],d[12]]:[d[1],d[5],d[9],d[13]],P=[d[3],d[7],d[11],d[15]],A=r[0]*w[0]+r[1]*w[1]+r[2]*w[2],M=r[0]*P[0]+r[1]*P[1]+r[2]*P[2],j=l[0]*w[0]+l[1]*w[1]+l[2]*w[2],F=l[0]*P[0]+l[1]*P[1]+l[2]*P[2];return j+x*M===A+x*F||P[3]*(A-j)+w[3]*(F-M)+A*F==j*M?null:(j+w[3]-x*F-x*P[3])/(j-A-x*F+x*M)}static getLesserNonNegativeNonNull(r,l){return l!==null&&l>=0&&l<r?l:r}}class sm{constructor(r){this._globe=r,this._mercatorCameraHelper=new Ra,this._verticalPerspectiveCameraHelper=new pr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(r,l){return this.currentHelper.handlePanInertia(r,l)}handleMapControlsRollPitchBearingZoom(r,l){return this.currentHelper.handleMapControlsRollPitchBearingZoom(r,l)}handleMapControlsPan(r,l,d){this.currentHelper.handleMapControlsPan(r,l,d)}cameraForBoxAndBearing(r,l,d,g,x){return this.currentHelper.cameraForBoxAndBearing(r,l,d,g,x)}handleJumpToCenterZoom(r,l){this.currentHelper.handleJumpToCenterZoom(r,l)}handleEaseTo(r,l){return this.currentHelper.handleEaseTo(r,l)}handleFlyTo(r,l){return this.currentHelper.handleFlyTo(r,l)}}const Io=(v,r)=>c.B(v,r&&r.filter(l=>l.identifier!=="source.canvas")),Fl=c.bO();class ja extends c.E{constructor(r,l={}){var d,g;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const P=this.tileManagers[w].getSource().type;P!=="vector"&&P!=="geojson"||this.tileManagers[w].reload()}},this.map=r,this.dispatcher=new Nr(wn(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(w,P)=>this.getGlyphs(w,P)),this.dispatcher.registerMessageHandler("GI",(w,P)=>this.getImages(w,P)),this.dispatcher.registerMessageHandler("GDA",(w,P)=>this.getDashes(w,P)),this.imageManager=new At,this.imageManager.setEventedParent(this);const x=((d=r._container)===null||d===void 0?void 0:d.lang)||typeof document<"u"&&((g=document.documentElement)===null||g===void 0?void 0:g.lang)||void 0;this.glyphManager=new bt(r._requestManager,l.localIdeographFontFamily,x),this.lineAtlas=new sn(256,512),this.crossTileSymbolIndex=new gi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),ke().on(ye,this._rtlPluginLoaded),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const P=this.tileManagers[w.sourceId];if(!P)return;const A=P.getSource();if(A&&A.vectorLayerIds)for(const M in this._layers){const j=this._layers[M];j.source===A.id&&this._validateLayer(j)}})}_setInitialValues(){var r;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((r=this.crossTileSymbolIndex)===null||r===void 0?void 0:r.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(r,l){var d,g,x;this._checkLoaded();const w=l===null?(x=(g=(d=this.stylesheet.state)===null||d===void 0?void 0:d[r])===null||g===void 0?void 0:g.default)!==null&&x!==void 0?x:null:l;if(c.bR(w,this._globalState[r]))return this;this._globalState[r]=w,this._applyGlobalStateChanges([r])}getGlobalState(){return this._globalState}setGlobalState(r){this._checkLoaded();const l=[];for(const d in r)!c.bR(this._globalState[d],r[d].default)&&(l.push(d),this._globalState[d]=r[d].default);this._applyGlobalStateChanges(l)}_applyGlobalStateChanges(r){if(r.length===0)return;const l=new Set,d={};for(const g of r){d[g]=this._globalState[g];for(const x in this._layers){const w=this._layers[x],P=w.getLayoutAffectingGlobalStateRefs(),A=w.getPaintAffectingGlobalStateRefs(),M=w.getVisibilityAffectingGlobalStateRefs();if(P.has(g)&&l.add(w.source),A.has(g))for(const{name:j,value:F}of A.get(g))this._updatePaintProperty(w,j,F);M!=null&&M.has(g)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",d);for(const g in this.tileManagers)l.has(g)&&(this._reloadSource(g),this._changed=!0)}loadURL(r,l={},d){this.fire(new c.l("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const g=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;c.j(g,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,l,d)}).catch(w=>{this._loadStyleRequest=null,w&&!x.signal.aborted&&this.fire(new c.k(w))})}loadJSON(r,l={},d){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,l.validate=l.validate!==!1,this._load(r,l,d)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Fl,{validate:!1})}_load(r,l,d){var g,x;let w=l.transformStyle?l.transformStyle(d,r):r;if(!l.validate||!Io(this,c.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const P in w.sources)this.addSource(P,w.sources[P],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new at(this.stylesheet.light),this._setProjectionInternal(((g=this.stylesheet.projection)===null||g===void 0?void 0:g.type)||"mercator"),this.sky=new Pt(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var r,l,d;const g=c.bS(this.stylesheet.layers);this.setGlobalState((r=this.stylesheet.state)!==null&&r!==void 0?r:null),this.dispatcher.broadcast("SL",g),this._order=g.map(x=>x.id),this._layers={},this._serializedLayers=null;for(const x of g){const w=c.bT(x,this._globalState);if(w.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=w,c.bU(w)&&this.tileManagers[w.source]){const P=(d=(l=x.paint)===null||l===void 0?void 0:l["raster-fade-duration"])!==null&&d!==void 0?d:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(P)}}}_loadSprite(r,l=!1,d=void 0){this.imageManager.setLoaded(!1);const g=new AbortController;let x;this._spriteRequest=g,function(w,P,A,M){return c._(this,void 0,void 0,function*(){const j=Ge(w),F=A>1?"@2x":"",O={},$={};for(const{id:Y,url:se}of j){const oe=P.transformRequest(Je(se,F,".json"),"SpriteJSON");O[Y]=c.j(oe,M);const ae=P.transformRequest(Je(se,F,".png"),"SpriteImage");$[Y]=_e.getImage(ae,M)}return yield Promise.all([...Object.values(O),...Object.values($)]),function(Y,se){return c._(this,void 0,void 0,function*(){const oe={};for(const ae in Y){oe[ae]={};const he=X.getImageCanvasContext((yield se[ae]).data),ge=(yield Y[ae]).data;for(const ce in ge){const{width:fe,height:xe,x:pe,y:Te,sdf:Oe,pixelRatio:Me,stretchX:De,stretchY:je,content:et,textFitWidth:nt,textFitHeight:He}=ge[ce];oe[ae][ce]={data:null,pixelRatio:Me,sdf:Oe,stretchX:De,stretchY:je,content:et,textFitWidth:nt,textFitHeight:He,spriteData:{width:fe,height:xe,x:pe,y:Te,context:he}}}}return oe})}(O,$)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const P in w){this._spritesImagesIds[P]=[];const A=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(M=>!(M in w)):[];for(const M of A)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in w[P]){const j=P==="default"?M:`${P}:${M}`;this._spritesImagesIds[P].push(j),j in this.imageManager.images?this.imageManager.updateImage(j,w[P][M],!1):this.imageManager.addImage(j,w[P][M]),l&&(this._changedImages[j]=!0)}}}).catch(w=>{this._spriteRequest=null,x=w,g.signal.aborted||this.fire(new c.k(x))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),d&&d(x)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(r){const l=this.tileManagers[r.source];if(!l)return;const d=r.sourceLayer;if(!d)return;const g=l.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(d)===-1)&&this.fire(new c.k(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.tileManagers)if(!this.tileManagers[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r,l=!1){const d=this._serializedAllLayers();if(!r||r.length===0)return Object.values(l?c.bV(d):d);const g=[];for(const x of r)if(d[x]){const w=l?c.bV(d[x]):d[x];g.push(w)}return g}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const l=Object.keys(this._layers);for(const d of l){const g=this._layers[d];g.type!=="custom"&&(r[d]=g.serialize())}return r}hasTransitions(){var r,l,d;if(!((r=this.light)===null||r===void 0)&&r.hasTransition()||!((l=this.sky)===null||l===void 0)&&l.hasTransition()||!((d=this.projection)===null||d===void 0)&&d.hasTransition())return!0;for(const g in this.tileManagers)if(this.tileManagers[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const l=this._changed;if(l){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const w in this._updatedSources){const P=this._updatedSources[w];if(P==="reload")this._reloadSource(w);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(r);this.light.updateTransitions(r),this.sky.updateTransitions(r),this._resetUpdates()}const d={};for(const g in this.tileManagers){const x=this.tileManagers[g];d[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)&&x.source&&(this.tileManagers[x.source].used=!0)}for(const g in d){const x=this.tileManagers[g];!!d[g]!=!!x.used&&x.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(r),this.sky.recalculate(r),this.projection.recalculate(r),this.z=r.zoom,l&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this.tileManagers)this.tileManagers[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r,!1),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,l={}){var d;this._checkLoaded();const g=this.serialize();if(r=l.transformStyle?l.transformStyle(g,r):r,((d=l.validate)===null||d===void 0||d)&&Io(this,c.C(r)))return!1;(r=c.bV(r)).layers=c.bS(r.layers);const x=c.bW(g,r),w=this._getOperationsToPerform(x);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const P of w.operations)P();return this.stylesheet=r,this._serializedLayers=null,this.fire(new c.l("style.load",{style:this})),!0}_getOperationsToPerform(r){const l=[],d=[];for(const g of r)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":l.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":l.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":l.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":l.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":l.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":l.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":l.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":l.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":l.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":l.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":l.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":l.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":l.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setSky":l.push(()=>this.setSky.apply(this,g.args));break;case"setProjection":this.setProjection.apply(this,g.args);break;case"setGlobalState":l.push(()=>this.setGlobalState.apply(this,g.args));break;case"setTransition":l.push(()=>{});break;default:d.push(g.command)}return{operations:l,unimplemented:d}}addImage(r,l){if(this.getImage(r))return this.fire(new c.k(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,l),this._afterImageUpdated(r)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new c.k(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,l,d={}){if(this._checkLoaded(),this.tileManagers[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.C.source,`sources.${r}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=this.tileManagers[r]=new Bi(r,l,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:r})),g.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.tileManagers[r]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===r)return this.fire(new c.k(new Error(`Source "${r}" cannot be removed while layer "${d}" is using it.`)));const l=this.tileManagers[r];delete this.tileManagers[r],delete this._updatedSources[r],l.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,l){if(this._checkLoaded(),this.tileManagers[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const d=this.tileManagers[r].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(l),this._changed=!0}getSource(r){return this.tileManagers[r]&&this.tileManagers[r].getSource()}addLayer(r,l,d={}){this._checkLoaded();const g=r.id;if(this.getLayer(g))return void this.fire(new c.k(new Error(`Layer "${g}" already exists on this map.`)));let x;if(r.type==="custom"){if(Io(this,c.bX(r)))return;x=c.bT(r,this._globalState)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(g,r.source),r=c.bV(r),r=c.e(r,{source:g})),this._validate(c.C.layer,`layers.${g}`,r,{arrayIndex:-1},d))return;x=c.bT(r,this._globalState),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}})}const w=l?this._order.indexOf(l):this._order.length;if(l&&w===-1)this.fire(new c.k(new Error(`Cannot add layer "${g}" before non-existing layer "${l}".`)));else{if(this._order.splice(w,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&x.type!=="custom"){const P=this._removedLayers[g];delete this._removedLayers[g],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.tileManagers[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.k(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const d=this._order.indexOf(r);this._order.splice(d,1);const g=l?this._order.indexOf(l):this._order.length;l&&g===-1?this.fire(new c.k(new Error(`Cannot move layer "${r}" before non-existing layer "${l}".`))):(this._order.splice(g,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${r}".`)));l.setEventedParent(null);const d=this._order.indexOf(r);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,l,d){this._checkLoaded();const g=this.getLayer(r);g?g.minzoom===l&&g.maxzoom===d||(l!=null&&(g.minzoom=l),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,l,d={}){this._checkLoaded();const g=this.getLayer(r);if(g){if(!c.bR(g.filter,l))return l==null?(g.setFilter(void 0),void this._updateLayer(g)):void(this._validate(c.C.filter,`layers.${g.id}.filter`,l,null,d)||(g.setFilter(c.bV(l)),this._updateLayer(g)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return c.bV(this.getLayer(r).filter)}setLayoutProperty(r,l,d,g={}){this._checkLoaded();const x=this.getLayer(r);x?c.bR(x.getLayoutProperty(l),d)||(x.setLayoutProperty(l,d,g),this._updateLayer(x)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,l){const d=this.getLayer(r);if(d)return d.getLayoutProperty(l);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,l,d,g={}){this._checkLoaded();const x=this.getLayer(r);x?c.bR(x.getPaintProperty(l),d)||this._updatePaintProperty(x,l,d,g):this.fire(new c.k(new Error(`Cannot style non-existing layer "${r}".`)))}_updatePaintProperty(r,l,d,g={}){r.setPaintProperty(l,d,g)&&this._updateLayer(r),c.bU(r)&&l==="raster-fade-duration"&&this.tileManagers[r.source].setRasterFadeDuration(d),this._changed=!0,this._updatedPaintProps[r.id]=!0,this._serializedLayers=null}getPaintProperty(r,l){return this.getLayer(r).getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const d=r.source,g=r.sourceLayer,x=this.tileManagers[d];if(x===void 0)return void this.fire(new c.k(new Error(`The source '${d}' does not exist in the map's style.`)));const w=x.getSource().type;w==="geojson"&&g?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||g?(r.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,r.id,l)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,l){this._checkLoaded();const d=r.source,g=this.tileManagers[d];if(g===void 0)return void this.fire(new c.k(new Error(`The source '${d}' does not exist in the map's style.`)));const x=g.getSource().type,w=x==="vector"?r.sourceLayer:void 0;x!=="vector"||w?l&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(w,r.id,l):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const l=r.source,d=r.sourceLayer,g=this.tileManagers[l];if(g!==void 0)return g.getSource().type!=="vector"||d?(r.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,r.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=c.bY(this.tileManagers,x=>x.serialize()),l=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,g=this.stylesheet;return c.bZ({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,projection:g.projection,sources:r,layers:l,terrain:d},x=>x!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.tileManagers[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.tileManagers[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const l=w=>this._layers[w].type==="fill-extrusion",d={},g=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(l(P)){d[P]=w;for(const A of r){const M=A[P];if(M)for(const j of M)g.push(j)}}}g.sort((w,P)=>P.intersectionZ-w.intersectionZ);const x=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(l(P))for(let A=g.length-1;A>=0;A--){const M=g[A].feature;if(d[M.layer.id]<w)break;x.push(M),g.pop()}else for(const A of r){const M=A[P];if(M)for(const j of M)x.push(j.feature)}}return x}queryRenderedFeatures(r,l,d){l&&l.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",l.filter,null,l);const g={};if(l&&l.layers){if(!(Array.isArray(l.layers)||l.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const M of l.layers){const j=this._layers[M];if(!j)return this.fire(new c.k(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];g[j.source]=!0}}const x=[];l.availableImages=this._availableImages;const w=this._serializedAllLayers(),P=l.layers instanceof Set?l.layers:Array.isArray(l.layers)?new Set(l.layers):null,A=Object.assign(Object.assign({},l),{layers:P,globalState:this._globalState});for(const M in this.tileManagers)l.layers&&!g[M]||x.push(zs(this.tileManagers[M],this._layers,w,r,A,d,this.map.terrain?(j,F,O)=>this.map.terrain.getElevation(j,F,O):void 0));return this.placement&&x.push(function(M,j,F,O,$,Y,se){const oe={},ae=Y.queryRenderedSymbols(O),he=[];for(const ge of Object.keys(ae).map(Number))he.push(se[ge]);he.sort(ir);for(const ge of he){const ce=ge.featureIndex.lookupSymbolFeatures(ae[ge.bucketInstanceId],j,ge.bucketIndex,ge.sourceLayerIndex,{filterSpec:$.filter,globalState:$.globalState},$.layers,$.availableImages,M);for(const fe in ce){const xe=oe[fe]=oe[fe]||[],pe=ce[fe];pe.sort((Te,Oe)=>{const Me=ge.featureSortOrder;if(Me){const De=Me.indexOf(Te.featureIndex);return Me.indexOf(Oe.featureIndex)-De}return Oe.featureIndex-Te.featureIndex});for(const Te of pe)xe.push(Te)}}return function(ge,ce,fe){for(const xe in ge)for(const pe of ge[xe])mi(pe,fe[ce[xe].source]);return ge}(oe,M,F)}(this._layers,w,this.tileManagers,r,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,l){l!=null&&l.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",l.filter,null,l);const d=this.tileManagers[r];return d?function(g,x){const w=g.getRenderableIds().map(M=>g.getTileByID(M)),P=[],A={};for(let M=0;M<w.length;M++){const j=w[M],F=j.tileID.canonical.key;A[F]||(A[F]=!0,j.querySourceFeatures(P,x))}return P}(d,l?Object.assign(Object.assign({},l),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const w in r)if(!c.bR(r[w],d[w])){g=!0;break}if(!g)return;const x={now:te(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,l),this.light.updateTransitions(x)}getProjection(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.projection}setProjection(r){if(this._checkLoaded(),this.projection){if(this.projection.name===r.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=r,this._setProjectionInternal(r.type)}getSky(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.sky}setSky(r,l={}){this._checkLoaded();const d=this.getSky();let g=!1;if(!r&&!d)return;if(r&&!d)g=!0;else if(!r&&d)g=!0;else for(const w in r)if(!c.bR(r[w],d[w])){g=!0;break}if(!g)return;const x={now:te(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=r,this.sky.setSky(r,l),this.sky.updateTransitions(x)}_setProjectionInternal(r){const l=function(d,g){const x={constrainOverride:g};if(Array.isArray(d)){const w=new nm({type:d});return{projection:w,transform:new Ao(x),cameraHelper:new sm(w)}}switch(d){case"mercator":return{projection:new si,transform:new Ma(x),cameraHelper:new Ra};case"globe":{const w=new nm({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new Ao(x),cameraHelper:new sm(w)}}case"vertical-perspective":return{projection:new gd,transform:new ko(x),cameraHelper:new pr};default:return c.w(`Unknown projection name: ${d}. Falling back to mercator projection.`),{projection:new si,transform:new Ma(x),cameraHelper:new Ra}}}(r,this.map.transformConstrain);this.projection=l.projection,this.map.migrateProjection(l.transform,l.cameraHelper);for(const d in this.tileManagers)this.tileManagers[d].reload()}_validate(r,l,d,g,x={}){return(!x||x.validate!==!1)&&Io(this,r.call(c.C,c.e({key:l,style:this.serialize(),value:d,styleSpec:c.u},g)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ke().off(ye,this._rtlPluginLoaded);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.tileManagers){const d=this.tileManagers[l];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.tileManagers[r].clearTiles()}_reloadSource(r){this.tileManagers[r].resume(),this.tileManagers[r].reload()}_updateSources(r){for(const l in this.tileManagers)this.tileManagers[l].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.tileManagers)this._reloadSource(r)}_updatePlacement(r,l,d,g,x=!1){let w=!1,P=!1;const A={};for(const M of this._order){const j=this._layers[M];if(j.type!=="symbol")continue;if(!A[j.source]){const O=this.tileManagers[j.source];A[j.source]=O.getRenderableIds(!0).map($=>O.getTileByID($)).sort(($,Y)=>Y.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Y.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(j,A[j.source],r.center.lng);w=w||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(te(),r.zoom))&&(this.pauseablePlacement=new bo(r,this.map.terrain,this._order,x,l,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(te()),P=!0),w&&this.pauseablePlacement.placement.setStale()),P||w)for(const M of this._order){const j=this._layers[M];j.type==="symbol"&&this.placement.updateLayerOpacities(j,A[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(te())}_releaseSymbolFadeTiles(){for(const r in this.tileManagers)this.tileManagers[r].releaseSymbolFadeTiles()}getImages(r,l){return c._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(l.icons);this._updateTilesForChangedImages();const g=this.tileManagers[l.source];return g&&g.setDependencies(l.tileID.key,l.type,l.icons),d})}getGlyphs(r,l){return c._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(l.stacks),g=this.tileManagers[l.source];return g&&g.setDependencies(l.tileID.key,l.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,l={}){this._checkLoaded(),r&&this._validate(c.C.glyphs,"glyphs",r,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}getDashes(r,l){return c._(this,void 0,void 0,function*(){const d={};for(const[g,x]of Object.entries(l.dashes))d[g]=this.lineAtlas.getDash(x.dasharray,x.round);return d})}addSprite(r,l,d={},g){this._checkLoaded();const x=[{id:r,url:l}],w=[...Ge(this.stylesheet.sprite),...x];this._validate(c.C.sprite,"sprite",w,null,d)||(this.stylesheet.sprite=w,this._loadSprite(x,!0,g))}removeSprite(r){this._checkLoaded();const l=Ge(this.stylesheet.sprite);if(l.find(d=>d.id===r)){if(this._spritesImagesIds[r])for(const d of this._spritesImagesIds[r])this.imageManager.removeImage(d),this._changedImages[d]=!0;l.splice(l.findIndex(d=>d.id===r),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Ge(this.stylesheet.sprite)}setSprite(r,l={},d){this._checkLoaded(),r&&this._validate(c.C.sprite,"sprite",r,null,l)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,d):(this._unloadSprite(),d&&d(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const r in this.tileManagers){const l=this.tileManagers[r];l.setEventedParent(null),l.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const r in this._layers){const l=this._layers[r];l.setEventedParent(null),l.onRemove&&l.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var z_=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ou{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,l,d,g,x,w,P,A,M){this.context=r;let j=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!j&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(j=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==d||j||this.boundIndexBuffer!==x||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==M?this.freshBind(l,d,g,x,w,P,A,M):(r.bindVertexArray.set(this.vao),P&&P.bind(),x&&x.dynamicDraw&&x.bind(),A&&A.bind(),M&&M.bind())}freshBind(r,l,d,g,x,w,P,A){const M=r.numAttributes,j=this.context,F=j.gl;this.vao&&this.destroy(),this.vao=j.createVertexArray(),j.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=A,l.enableAttributes(F,r);for(const O of d)O.enableAttributes(F,r);w&&w.enableAttributes(F,r),P&&P.enableAttributes(F,r),A&&A.enableAttributes(F,r),l.bind(),l.setVertexAttribPointers(F,r,x);for(const O of d)O.bind(),O.setVertexAttribPointers(F,r,x);w&&(w.bind(),w.setVertexAttribPointers(F,r,x)),g&&g.bind(),P&&(P.bind(),P.setVertexAttribPointers(F,r,x)),A&&(A.bind(),A.setVertexAttribPointers(F,r,x)),j.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const O_=(v,r,l,d,g)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:r,u_fog_color:l?l.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?0:l?l.calculateFogBlendOpacity(d):0,u_horizon_color:l?l.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1,u_is_globe_mode:g?1:0}),Mo={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function lu(v){const r=[];for(let l=0;l<v.length;l++){if(v[l]===null)continue;const d=v[l].split(" ");r.push(d.pop())}return r}class am{constructor(r,l,d,g,x,w,P,A,M=[]){const j=r.gl;this.program=j.createProgram();const F=lu(l.staticAttributes),O=d?d.getBinderAttributes():[],$=F.concat(O),Y=zn.prelude.staticUniforms?lu(zn.prelude.staticUniforms):[],se=P.staticUniforms?lu(P.staticUniforms):[],oe=l.staticUniforms?lu(l.staticUniforms):[],ae=d?d.getBinderUniforms():[],he=Y.concat(se).concat(oe).concat(ae),ge=[];for(const Me of he)ge.indexOf(Me)<0&&ge.push(Me);const ce=d?d.defines():[];Vi(j)&&ce.unshift("#version 300 es"),x&&ce.push("#define OVERDRAW_INSPECTOR;"),w&&ce.push("#define TERRAIN3D;"),A&&ce.push(A),M&&ce.push(...M);let fe=ce.concat(zn.prelude.fragmentSource,P.fragmentSource,l.fragmentSource).join(`
`),xe=ce.concat(zn.prelude.vertexSource,P.vertexSource,l.vertexSource).join(`
`);Vi(j)||(fe=function(Me){return Me.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(fe),xe=function(Me){return Me.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(xe));const pe=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(pe,fe),j.compileShader(pe),!j.getShaderParameter(pe,j.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${j.getShaderInfoLog(pe)}`);j.attachShader(this.program,pe);const Te=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(Te,xe),j.compileShader(Te),!j.getShaderParameter(Te,j.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${j.getShaderInfoLog(Te)}`);j.attachShader(this.program,Te),this.attributes={};const Oe={};this.numAttributes=$.length;for(let Me=0;Me<this.numAttributes;Me++)$[Me]&&(j.bindAttribLocation(this.program,Me,$[Me]),this.attributes[$[Me]]=Me);if(j.linkProgram(this.program),!j.getProgramParameter(this.program,j.LINK_STATUS))throw new Error(`Program failed to link: ${j.getProgramInfoLog(this.program)}`);j.deleteShader(Te),j.deleteShader(pe);for(let Me=0;Me<ge.length;Me++){const De=ge[Me];if(De&&!Oe[De]){const je=j.getUniformLocation(this.program,De);je&&(Oe[De]=je)}}this.fixedUniforms=g(r,Oe),this.terrainUniforms=((Me,De)=>({u_depth:new c.b_(Me,De.u_depth),u_terrain:new c.b_(Me,De.u_terrain),u_terrain_dim:new c.bq(Me,De.u_terrain_dim),u_terrain_matrix:new c.c0(Me,De.u_terrain_matrix),u_terrain_unpack:new c.c1(Me,De.u_terrain_unpack),u_terrain_exaggeration:new c.bq(Me,De.u_terrain_exaggeration)}))(r,Oe),this.projectionUniforms=((Me,De)=>({u_projection_matrix:new c.c0(Me,De.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(Me,De.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(Me,De.u_projection_clipping_plane),u_projection_transition:new c.bq(Me,De.u_projection_transition),u_projection_fallback_matrix:new c.c0(Me,De.u_projection_fallback_matrix)}))(r,Oe),this.binderUniforms=d?d.getUniforms(r,Oe):[]}draw(r,l,d,g,x,w,P,A,M,j,F,O,$,Y,se,oe,ae,he,ge){const ce=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(d),r.setStencilMode(g),r.setColorMode(x),r.setCullFace(w),A){r.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,A.depthTexture),r.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,A.texture);for(const xe in this.terrainUniforms)this.terrainUniforms[xe].set(A[xe])}if(M)for(const xe in M)this.projectionUniforms[Mo[xe]].set(M[xe]);if(P)for(const xe in this.fixedUniforms)this.fixedUniforms[xe].set(P[xe]);oe&&oe.setUniforms(r,this.binderUniforms,Y,{zoom:se});let fe=0;switch(l){case ce.LINES:fe=2;break;case ce.TRIANGLES:fe=3;break;case ce.LINE_STRIP:fe=1}for(const xe of $.get()){const pe=xe.vaos||(xe.vaos={});(pe[j]||(pe[j]=new ou)).bind(r,this,F,oe?oe.getPaintVertexBuffers():[],O,xe.vertexOffset,ae,he,ge),ce.drawElements(l,xe.primitiveLength*fe,ce.UNSIGNED_SHORT,xe.primitiveOffset*fe*2)}}}function om(v,r,l){const d=1/c.aN(l,1,r.transform.tileZoom),g=Math.pow(2,l.tileID.overscaledZ),x=l.tileSize*Math.pow(2,r.transform.tileZoom)/g,w=x*(l.tileID.canonical.x+l.tileID.wrap*g),P=x*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[d,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[w>>16,P>>16],u_pixel_coord_lower:[65535&w,65535&P]}}const xd=(v,r,l,d)=>{const g=v.style.light,x=g.properties.get("position"),w=[x.x,x.y,x.z],P=c.c4();g.properties.get("anchor")==="viewport"&&c.c5(P,v.transform.bearingInRadians),c.c6(w,w,P);const A=v.transform.transformLightDirection(w),M=g.properties.get("color");return{u_lightpos:w,u_lightpos_globe:A,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+r,u_opacity:l,u_fill_translate:d}},bd=(v,r,l,d,g,x,w)=>c.e(xd(v,r,l,d),om(x,v,w),{u_height_factor:-Math.pow(2,g.overscaledZ)/w.tileSize/8}),wd=(v,r,l,d)=>c.e(om(r,v,l),{u_fill_translate:d}),lm=(v,r)=>({u_world:v,u_fill_translate:r}),cm=(v,r,l,d,g)=>c.e(wd(v,r,l,g),{u_world:d}),um=(v,r,l,d,g)=>{const x=v.transform;let w,P,A=0;if(l.paint.get("circle-pitch-alignment")==="map"){const M=c.aN(r,1,x.zoom);w=!0,P=[M,M],A=M/(c.a5*Math.pow(2,r.tileID.overscaledZ))*2*Math.PI*g}else w=!1,P=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:P,u_globe_extrude_scale:A,u_translate:d}},Na=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),hm=v=>({u_viewport_size:[v.width,v.height]}),Sd=(v,r=1)=>({u_color:v,u_overlay:0,u_overlay_scale:r}),Ro=(v,r,l,d)=>{const g=c.aN(v,1,r)/(c.a5*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*d;return{u_extrude_scale:c.aN(v,1,r),u_intensity:l,u_globe_extrude_scale:g}},dm=(v,r,l,d)=>{const g=c.N();c.c7(g,0,v.width,v.height,0,0,1);const x=v.context.gl;return{u_matrix:g,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:l,u_color_ramp:d,u_opacity:r.paint.get("heatmap-opacity")}},cu=(v,r,l)=>{const d=l.paint.get("hillshade-accent-color");let g;switch(l.paint.get("hillshade-method")){case"basic":g=4;break;case"combined":g=1;break;case"igor":g=2;break;case"multidirectional":g=3;break;default:g=0}const x=l.getIlluminationProperties();for(let w=0;w<x.directionRadians.length;w++)l.paint.get("hillshade-illumination-anchor")==="viewport"&&(x.directionRadians[w]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:B_(0,r.tileID),u_exaggeration:l.paint.get("hillshade-exaggeration"),u_altitudes:x.altitudeRadians,u_azimuths:x.directionRadians,u_accent:d,u_method:g,u_highlights:x.highlightColor,u_shadows:x.shadowColor}},F_=(v,r)=>{const l=r.stride,d=c.N();return c.c7(d,0,c.a5,-c.a5,0,0,1),c.O(d,d,[0,-c.a5,0]),{u_matrix:d,u_image:1,u_dimension:[l,l],u_zoom:v.overscaledZ,u_unpack:r.getUnpackVector()}};function B_(v,r){const l=Math.pow(2,r.canonical.z),d=r.canonical.y;return[new c.a9(0,d/l).toLngLat().lat,new c.a9(0,(d+1)/l).toLngLat().lat]}const pm=(v,r,l=0)=>({u_image:0,u_unpack:r.getUnpackVector(),u_dimension:[r.stride,r.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:l,u_opacity:v.paint.get("color-relief-opacity")}),Bl=(v,r,l,d)=>{const g=v.transform;return{u_translation:hu(v,r,l),u_ratio:d/c.aN(r,1,g.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},fm=(v,r,l,d,g)=>c.e(Bl(v,r,l,d),{u_image:0,u_image_height:g}),Td=(v,r,l,d,g)=>{const x=v.transform,w=ts(r,x);return{u_translation:hu(v,r,l),u_texsize:r.imageAtlasTexture.size,u_ratio:d/c.aN(r,1,x.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[w,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},mm=(v,r,l,d,g)=>{const x=ts(r,v.transform);return c.e(Bl(v,r,l,d),{u_tileratio:x,u_crossfade_from:g.fromScale,u_crossfade_to:g.toScale,u_image:0,u_mix:g.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})},uu=(v,r,l,d,g,x)=>{const w=ts(r,v.transform);return c.e(Bl(v,r,l,d),{u_image:0,u_image_height:x,u_tileratio:w,u_crossfade_from:g.fromScale,u_crossfade_to:g.toScale,u_image_dash:1,u_mix:g.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})};function ts(v,r){return 1/c.aN(v,1,r.tileZoom)}function hu(v,r,l){return c.aO(v.transform,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Ed=(v,r,l,d,g)=>{return{u_tl_parent:v,u_scale_parent:r,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(w=d.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(x=d.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Pd(d.paint.get("raster-hue-rotate")),u_coords_top:[g[0].x,g[0].y,g[1].x,g[1].y],u_coords_bottom:[g[3].x,g[3].y,g[2].x,g[2].y]};var x,w};function Pd(v){v*=Math.PI/180;const r=Math.sin(v),l=Math.cos(v);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Cd=(v,r,l,d,g,x,w,P,A,M,j,F,O)=>{const $=w.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:$.width/$.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:P,u_coord_matrix:A,u_is_text:+j,u_pitch_with_map:+d,u_is_along_line:g,u_is_variable_anchor:x,u_texsize:F,u_texture:0,u_translation:M,u_pitched_scale:O}},du=(v,r,l,d,g,x,w,P,A,M,j,F,O,$)=>{const Y=w.transform;return c.e(Cd(v,r,l,d,g,x,w,P,A,M,j,F,$),{u_gamma_scale:d?Math.cos(Y.pitch*Math.PI/180)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},La=(v,r,l,d,g,x,w,P,A,M,j,F,O)=>c.e(du(v,r,l,d,g,x,w,P,A,M,!0,j,0,O),{u_texsize_icon:F,u_texture_icon:1}),kd=(v,r)=>({u_opacity:v,u_color:r}),V_=(v,r,l,d,g)=>c.e(function(x,w,P,A){const M=P.imageManager.getPattern(x.from.toString()),j=P.imageManager.getPattern(x.to.toString()),{width:F,height:O}=P.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),Y=A.tileSize*Math.pow(2,P.transform.tileZoom)/$,se=Y*(A.tileID.canonical.x+A.tileID.wrap*$),oe=Y*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[F,O],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/c.aN(A,1,P.transform.tileZoom),u_pixel_coord_upper:[se>>16,oe>>16],u_pixel_coord_lower:[65535&se,65535&oe]}}(l,g,r,d),{u_opacity:v}),gm=(v,r)=>{},U_={fillExtrusion:(v,r)=>({u_lightpos:new c.c2(v,r.u_lightpos),u_lightpos_globe:new c.c2(v,r.u_lightpos_globe),u_lightintensity:new c.bq(v,r.u_lightintensity),u_lightcolor:new c.c2(v,r.u_lightcolor),u_vertical_gradient:new c.bq(v,r.u_vertical_gradient),u_opacity:new c.bq(v,r.u_opacity),u_fill_translate:new c.c3(v,r.u_fill_translate)}),fillExtrusionPattern:(v,r)=>({u_lightpos:new c.c2(v,r.u_lightpos),u_lightpos_globe:new c.c2(v,r.u_lightpos_globe),u_lightintensity:new c.bq(v,r.u_lightintensity),u_lightcolor:new c.c2(v,r.u_lightcolor),u_vertical_gradient:new c.bq(v,r.u_vertical_gradient),u_height_factor:new c.bq(v,r.u_height_factor),u_opacity:new c.bq(v,r.u_opacity),u_fill_translate:new c.c3(v,r.u_fill_translate),u_image:new c.b_(v,r.u_image),u_texsize:new c.c3(v,r.u_texsize),u_pixel_coord_upper:new c.c3(v,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,r.u_pixel_coord_lower),u_scale:new c.c2(v,r.u_scale),u_fade:new c.bq(v,r.u_fade)}),fill:(v,r)=>({u_fill_translate:new c.c3(v,r.u_fill_translate)}),fillPattern:(v,r)=>({u_image:new c.b_(v,r.u_image),u_texsize:new c.c3(v,r.u_texsize),u_pixel_coord_upper:new c.c3(v,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,r.u_pixel_coord_lower),u_scale:new c.c2(v,r.u_scale),u_fade:new c.bq(v,r.u_fade),u_fill_translate:new c.c3(v,r.u_fill_translate)}),fillOutline:(v,r)=>({u_world:new c.c3(v,r.u_world),u_fill_translate:new c.c3(v,r.u_fill_translate)}),fillOutlinePattern:(v,r)=>({u_world:new c.c3(v,r.u_world),u_image:new c.b_(v,r.u_image),u_texsize:new c.c3(v,r.u_texsize),u_pixel_coord_upper:new c.c3(v,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,r.u_pixel_coord_lower),u_scale:new c.c2(v,r.u_scale),u_fade:new c.bq(v,r.u_fade),u_fill_translate:new c.c3(v,r.u_fill_translate)}),circle:(v,r)=>({u_camera_to_center_distance:new c.bq(v,r.u_camera_to_center_distance),u_scale_with_map:new c.b_(v,r.u_scale_with_map),u_pitch_with_map:new c.b_(v,r.u_pitch_with_map),u_extrude_scale:new c.c3(v,r.u_extrude_scale),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(v,r.u_globe_extrude_scale),u_translate:new c.c3(v,r.u_translate)}),collisionBox:(v,r)=>({u_pixel_extrude_scale:new c.c3(v,r.u_pixel_extrude_scale)}),collisionCircle:(v,r)=>({u_viewport_size:new c.c3(v,r.u_viewport_size)}),debug:(v,r)=>({u_color:new c.b$(v,r.u_color),u_overlay:new c.b_(v,r.u_overlay),u_overlay_scale:new c.bq(v,r.u_overlay_scale)}),depth:gm,clippingMask:gm,heatmap:(v,r)=>({u_extrude_scale:new c.bq(v,r.u_extrude_scale),u_intensity:new c.bq(v,r.u_intensity),u_globe_extrude_scale:new c.bq(v,r.u_globe_extrude_scale)}),heatmapTexture:(v,r)=>({u_matrix:new c.c0(v,r.u_matrix),u_world:new c.c3(v,r.u_world),u_image:new c.b_(v,r.u_image),u_color_ramp:new c.b_(v,r.u_color_ramp),u_opacity:new c.bq(v,r.u_opacity)}),hillshade:(v,r)=>({u_image:new c.b_(v,r.u_image),u_latrange:new c.c3(v,r.u_latrange),u_exaggeration:new c.bq(v,r.u_exaggeration),u_altitudes:new c.c9(v,r.u_altitudes),u_azimuths:new c.c9(v,r.u_azimuths),u_accent:new c.b$(v,r.u_accent),u_method:new c.b_(v,r.u_method),u_shadows:new c.c8(v,r.u_shadows),u_highlights:new c.c8(v,r.u_highlights)}),hillshadePrepare:(v,r)=>({u_matrix:new c.c0(v,r.u_matrix),u_image:new c.b_(v,r.u_image),u_dimension:new c.c3(v,r.u_dimension),u_zoom:new c.bq(v,r.u_zoom),u_unpack:new c.c1(v,r.u_unpack)}),colorRelief:(v,r)=>({u_image:new c.b_(v,r.u_image),u_unpack:new c.c1(v,r.u_unpack),u_dimension:new c.c3(v,r.u_dimension),u_elevation_stops:new c.b_(v,r.u_elevation_stops),u_color_stops:new c.b_(v,r.u_color_stops),u_color_ramp_size:new c.b_(v,r.u_color_ramp_size),u_opacity:new c.bq(v,r.u_opacity)}),line:(v,r)=>({u_translation:new c.c3(v,r.u_translation),u_ratio:new c.bq(v,r.u_ratio),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,r.u_units_to_pixels)}),lineGradient:(v,r)=>({u_translation:new c.c3(v,r.u_translation),u_ratio:new c.bq(v,r.u_ratio),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,r.u_units_to_pixels),u_image:new c.b_(v,r.u_image),u_image_height:new c.bq(v,r.u_image_height)}),linePattern:(v,r)=>({u_translation:new c.c3(v,r.u_translation),u_texsize:new c.c3(v,r.u_texsize),u_ratio:new c.bq(v,r.u_ratio),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_image:new c.b_(v,r.u_image),u_units_to_pixels:new c.c3(v,r.u_units_to_pixels),u_scale:new c.c2(v,r.u_scale),u_fade:new c.bq(v,r.u_fade)}),lineSDF:(v,r)=>({u_translation:new c.c3(v,r.u_translation),u_ratio:new c.bq(v,r.u_ratio),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,r.u_units_to_pixels),u_image:new c.b_(v,r.u_image),u_mix:new c.bq(v,r.u_mix),u_tileratio:new c.bq(v,r.u_tileratio),u_crossfade_from:new c.bq(v,r.u_crossfade_from),u_crossfade_to:new c.bq(v,r.u_crossfade_to),u_lineatlas_width:new c.bq(v,r.u_lineatlas_width),u_lineatlas_height:new c.bq(v,r.u_lineatlas_height)}),lineGradientSDF:(v,r)=>({u_translation:new c.c3(v,r.u_translation),u_ratio:new c.bq(v,r.u_ratio),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,r.u_units_to_pixels),u_image:new c.b_(v,r.u_image),u_image_height:new c.bq(v,r.u_image_height),u_tileratio:new c.bq(v,r.u_tileratio),u_crossfade_from:new c.bq(v,r.u_crossfade_from),u_crossfade_to:new c.bq(v,r.u_crossfade_to),u_image_dash:new c.b_(v,r.u_image_dash),u_mix:new c.bq(v,r.u_mix),u_lineatlas_width:new c.bq(v,r.u_lineatlas_width),u_lineatlas_height:new c.bq(v,r.u_lineatlas_height)}),raster:(v,r)=>({u_tl_parent:new c.c3(v,r.u_tl_parent),u_scale_parent:new c.bq(v,r.u_scale_parent),u_buffer_scale:new c.bq(v,r.u_buffer_scale),u_fade_t:new c.bq(v,r.u_fade_t),u_opacity:new c.bq(v,r.u_opacity),u_image0:new c.b_(v,r.u_image0),u_image1:new c.b_(v,r.u_image1),u_brightness_low:new c.bq(v,r.u_brightness_low),u_brightness_high:new c.bq(v,r.u_brightness_high),u_saturation_factor:new c.bq(v,r.u_saturation_factor),u_contrast_factor:new c.bq(v,r.u_contrast_factor),u_spin_weights:new c.c2(v,r.u_spin_weights),u_coords_top:new c.c1(v,r.u_coords_top),u_coords_bottom:new c.c1(v,r.u_coords_bottom)}),symbolIcon:(v,r)=>({u_is_size_zoom_constant:new c.b_(v,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(v,r.u_is_size_feature_constant),u_size_t:new c.bq(v,r.u_size_t),u_size:new c.bq(v,r.u_size),u_camera_to_center_distance:new c.bq(v,r.u_camera_to_center_distance),u_pitch:new c.bq(v,r.u_pitch),u_rotate_symbol:new c.b_(v,r.u_rotate_symbol),u_aspect_ratio:new c.bq(v,r.u_aspect_ratio),u_fade_change:new c.bq(v,r.u_fade_change),u_label_plane_matrix:new c.c0(v,r.u_label_plane_matrix),u_coord_matrix:new c.c0(v,r.u_coord_matrix),u_is_text:new c.b_(v,r.u_is_text),u_pitch_with_map:new c.b_(v,r.u_pitch_with_map),u_is_along_line:new c.b_(v,r.u_is_along_line),u_is_variable_anchor:new c.b_(v,r.u_is_variable_anchor),u_texsize:new c.c3(v,r.u_texsize),u_texture:new c.b_(v,r.u_texture),u_translation:new c.c3(v,r.u_translation),u_pitched_scale:new c.bq(v,r.u_pitched_scale)}),symbolSDF:(v,r)=>({u_is_size_zoom_constant:new c.b_(v,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(v,r.u_is_size_feature_constant),u_size_t:new c.bq(v,r.u_size_t),u_size:new c.bq(v,r.u_size),u_camera_to_center_distance:new c.bq(v,r.u_camera_to_center_distance),u_pitch:new c.bq(v,r.u_pitch),u_rotate_symbol:new c.b_(v,r.u_rotate_symbol),u_aspect_ratio:new c.bq(v,r.u_aspect_ratio),u_fade_change:new c.bq(v,r.u_fade_change),u_label_plane_matrix:new c.c0(v,r.u_label_plane_matrix),u_coord_matrix:new c.c0(v,r.u_coord_matrix),u_is_text:new c.b_(v,r.u_is_text),u_pitch_with_map:new c.b_(v,r.u_pitch_with_map),u_is_along_line:new c.b_(v,r.u_is_along_line),u_is_variable_anchor:new c.b_(v,r.u_is_variable_anchor),u_texsize:new c.c3(v,r.u_texsize),u_texture:new c.b_(v,r.u_texture),u_gamma_scale:new c.bq(v,r.u_gamma_scale),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_is_halo:new c.b_(v,r.u_is_halo),u_translation:new c.c3(v,r.u_translation),u_pitched_scale:new c.bq(v,r.u_pitched_scale)}),symbolTextAndIcon:(v,r)=>({u_is_size_zoom_constant:new c.b_(v,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(v,r.u_is_size_feature_constant),u_size_t:new c.bq(v,r.u_size_t),u_size:new c.bq(v,r.u_size),u_camera_to_center_distance:new c.bq(v,r.u_camera_to_center_distance),u_pitch:new c.bq(v,r.u_pitch),u_rotate_symbol:new c.b_(v,r.u_rotate_symbol),u_aspect_ratio:new c.bq(v,r.u_aspect_ratio),u_fade_change:new c.bq(v,r.u_fade_change),u_label_plane_matrix:new c.c0(v,r.u_label_plane_matrix),u_coord_matrix:new c.c0(v,r.u_coord_matrix),u_is_text:new c.b_(v,r.u_is_text),u_pitch_with_map:new c.b_(v,r.u_pitch_with_map),u_is_along_line:new c.b_(v,r.u_is_along_line),u_is_variable_anchor:new c.b_(v,r.u_is_variable_anchor),u_texsize:new c.c3(v,r.u_texsize),u_texsize_icon:new c.c3(v,r.u_texsize_icon),u_texture:new c.b_(v,r.u_texture),u_texture_icon:new c.b_(v,r.u_texture_icon),u_gamma_scale:new c.bq(v,r.u_gamma_scale),u_device_pixel_ratio:new c.bq(v,r.u_device_pixel_ratio),u_is_halo:new c.b_(v,r.u_is_halo),u_translation:new c.c3(v,r.u_translation),u_pitched_scale:new c.bq(v,r.u_pitched_scale)}),background:(v,r)=>({u_opacity:new c.bq(v,r.u_opacity),u_color:new c.b$(v,r.u_color)}),backgroundPattern:(v,r)=>({u_opacity:new c.bq(v,r.u_opacity),u_image:new c.b_(v,r.u_image),u_pattern_tl_a:new c.c3(v,r.u_pattern_tl_a),u_pattern_br_a:new c.c3(v,r.u_pattern_br_a),u_pattern_tl_b:new c.c3(v,r.u_pattern_tl_b),u_pattern_br_b:new c.c3(v,r.u_pattern_br_b),u_texsize:new c.c3(v,r.u_texsize),u_mix:new c.bq(v,r.u_mix),u_pattern_size_a:new c.c3(v,r.u_pattern_size_a),u_pattern_size_b:new c.c3(v,r.u_pattern_size_b),u_scale_a:new c.bq(v,r.u_scale_a),u_scale_b:new c.bq(v,r.u_scale_b),u_pixel_coord_upper:new c.c3(v,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,r.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(v,r.u_tile_units_to_pixels)}),terrain:(v,r)=>({u_texture:new c.b_(v,r.u_texture),u_ele_delta:new c.bq(v,r.u_ele_delta),u_fog_matrix:new c.c0(v,r.u_fog_matrix),u_fog_color:new c.b$(v,r.u_fog_color),u_fog_ground_blend:new c.bq(v,r.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(v,r.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(v,r.u_horizon_color),u_horizon_fog_blend:new c.bq(v,r.u_horizon_fog_blend),u_is_globe_mode:new c.bq(v,r.u_is_globe_mode)}),terrainDepth:(v,r)=>({u_ele_delta:new c.bq(v,r.u_ele_delta)}),terrainCoords:(v,r)=>({u_texture:new c.b_(v,r.u_texture),u_terrain_coords_id:new c.bq(v,r.u_terrain_coords_id),u_ele_delta:new c.bq(v,r.u_ele_delta)}),projectionErrorMeasurement:(v,r)=>({u_input:new c.bq(v,r.u_input),u_output_expected:new c.bq(v,r.u_output_expected)}),atmosphere:(v,r)=>({u_sun_pos:new c.c2(v,r.u_sun_pos),u_atmosphere_blend:new c.bq(v,r.u_atmosphere_blend),u_globe_position:new c.c2(v,r.u_globe_position),u_globe_radius:new c.bq(v,r.u_globe_radius),u_inv_proj_matrix:new c.c0(v,r.u_inv_proj_matrix)}),sky:(v,r)=>({u_sky_color:new c.b$(v,r.u_sky_color),u_horizon_color:new c.b$(v,r.u_horizon_color),u_horizon:new c.c3(v,r.u_horizon),u_horizon_normal:new c.c3(v,r.u_horizon_normal),u_sky_horizon_blend:new c.bq(v,r.u_sky_horizon_blend),u_sky_blend:new c.bq(v,r.u_sky_blend)})};class $_{constructor(r,l,d){this.context=r;const g=r.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ym={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class G_{constructor(r,l,d,g){this.length=l.length,this.attributes=d,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),r.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let d=0;d<this.attributes.length;d++){const g=l.attributes[this.attributes[d].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,l,d){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],w=l.attributes[x.name];w!==void 0&&r.vertexAttribPointer(w,x.components,r[ym[x.type]],!1,this.itemSize,x.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pu extends rn{getDefault(){return c.bp.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class fu extends rn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class mu extends rn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Ad extends rn{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class za extends rn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Vl extends rn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Do extends rn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ui extends rn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class _m extends rn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class vm extends rn{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Id extends rn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Oa extends rn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class gu extends rn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class yu extends rn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ul extends rn{getDefault(){return c.bp.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class _u extends rn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class xm extends rn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class jo extends rn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class No extends rn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class bm extends rn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Md extends rn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Zt extends rn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class vu extends rn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class q_ extends rn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class wm extends rn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class $l extends rn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class W_ extends rn{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Z_ extends rn{getDefault(){return null}set(r){var l;if(r===this.current&&!this.dirty)return;const d=this.gl;Vi(d)?d.bindVertexArray(r):(l=d.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Sm extends rn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class H_ extends rn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Rd extends rn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Lo extends rn{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Gl extends Lo{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class xu extends Lo{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Dd extends Lo{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}const jd="Framebuffer is not complete";class bu{constructor(r,l,d,g,x){this.context=r,this.width=l,this.height=d;const w=r.gl,P=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Gl(r,P),g)this.depthAttachment=x?new Dd(r,P):new xu(r,P);else if(x)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(jd)}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const d=this.depthAttachment.get();d&&r.deleteRenderbuffer(d)}r.deleteFramebuffer(this.framebuffer)}}class wu{constructor(r){var l,d;if(this.gl=r,this.clearColor=new pu(this),this.clearDepth=new fu(this),this.clearStencil=new mu(this),this.colorMask=new Ad(this),this.depthMask=new za(this),this.stencilMask=new Vl(this),this.stencilFunc=new Do(this),this.stencilOp=new Ui(this),this.stencilTest=new _m(this),this.depthRange=new vm(this),this.depthTest=new Id(this),this.depthFunc=new Oa(this),this.blend=new gu(this),this.blendFunc=new yu(this),this.blendColor=new Ul(this),this.blendEquation=new _u(this),this.cullFace=new xm(this),this.cullFaceSide=new jo(this),this.frontFace=new No(this),this.program=new bm(this),this.activeTexture=new Md(this),this.viewport=new Zt(this),this.bindFramebuffer=new vu(this),this.bindRenderbuffer=new q_(this),this.bindTexture=new wm(this),this.bindVertexBuffer=new $l(this),this.bindElementBuffer=new W_(this),this.bindVertexArray=new Z_(this),this.pixelStoreUnpack=new Sm(this),this.pixelStoreUnpackPremultiplyAlpha=new H_(this),this.pixelStoreUnpackFlipY=new Rd(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),Vi(r)){this.HALF_FLOAT=r.HALF_FLOAT;const g=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=r.RGBA16F)!==null&&l!==void 0?l:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(d=r.RGB16F)!==null&&d!==void 0?d:g==null?void 0:g.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const g=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new $_(this,r,l)}createVertexBuffer(r,l,d){return new G_(this,r,l,d)}createRenderbuffer(r,l,d){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,r,l,d),this.bindRenderbuffer.set(null),x}createFramebuffer(r,l,d,g){return new bu(this,r,l,d,g)}clear({color:r,depth:l,stencil:d}){const g=this.gl;let x=0;r&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),d!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){c.bR(r.blendFunction,_n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return Vi(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var l;return Vi(this.gl)?this.gl.deleteVertexArray(r):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}let ca;function Fa(v,r,l,d,g){const x=v.context,w=v.transform,P=x.gl,A=v.useProgram("collisionBox"),M=[];let j=0,F=0;for(let ae=0;ae<d.length;ae++){const he=d[ae],ge=r.getTile(he).getBucket(l);if(!ge)continue;const ce=g?ge.textCollisionBox:ge.iconCollisionBox,fe=ge.collisionCircleArray;fe.length>0&&(M.push({circleArray:fe,circleOffset:F,coord:he}),j+=fe.length/4,F=j),ce&&A.draw(x,P.LINES,Vt.disabled,Jt.disabled,v.colorModeForRenderPass(),Yt.disabled,Na(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(he),w.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),l.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,null,v.transform.zoom,null,null,ce.collisionVertexBuffer)}if(!g||!M.length)return;const O=v.useProgram("collisionCircle"),$=new c.ca;$.resize(4*j),$._trim();let Y=0;for(const ae of M)for(let he=0;he<ae.circleArray.length/4;he++){const ge=4*he,ce=ae.circleArray[ge+0],fe=ae.circleArray[ge+1],xe=ae.circleArray[ge+2],pe=ae.circleArray[ge+3];$.emplace(Y++,ce,fe,xe,pe,0),$.emplace(Y++,ce,fe,xe,pe,1),$.emplace(Y++,ce,fe,xe,pe,2),$.emplace(Y++,ce,fe,xe,pe,3)}(!ca||ca.length<2*j)&&(ca=function(ae){const he=2*ae,ge=new c.cc;ge.resize(he),ge._trim();for(let ce=0;ce<he;ce++){const fe=6*ce;ge.uint16[fe+0]=4*ce+0,ge.uint16[fe+1]=4*ce+1,ge.uint16[fe+2]=4*ce+2,ge.uint16[fe+3]=4*ce+2,ge.uint16[fe+4]=4*ce+3,ge.uint16[fe+5]=4*ce+0}return ge}(j));const se=x.createIndexBuffer(ca,!0),oe=x.createVertexBuffer($,c.cb.members,!0);for(const ae of M){const he=hm(v.transform);O.draw(x,P.TRIANGLES,Vt.disabled,Jt.disabled,v.colorModeForRenderPass(),Yt.disabled,he,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ae.coord),null,l.id,oe,se,c.aX.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,v.transform.zoom,null,null,null)}oe.destroy(),se.destroy()}const Nd=c.ar(new Float32Array(16));function K_(v,r,l,d,g,x){const{horizontalAlign:w,verticalAlign:P}=c.aS(v);return new c.P((-(w-.5)*r/g+d[0])*x,(-(P-.5)*l/g+d[1])*x)}function ql(v,r,l,d,g,x){const w=r.tileAnchorPoint.add(new c.P(r.translation[0],r.translation[1]));if(r.pitchWithMap){let P=d.mult(x);l||(P=P.rotate(-g));const A=w.add(P);return Bt(A.x,A.y,r.pitchedLabelPlaneMatrix,r.getElevation).point}if(l){const P=hn(r.tileAnchorPoint.x+1,r.tileAnchorPoint.y,r).point.sub(v),A=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return v.add(d.rotate(A))}return v.add(d)}function X_(v,r,l,d,g,x,w,P,A,M,j,F){const O=v.text.placedSymbolArray,$=v.text.dynamicLayoutVertexArray,Y=v.icon.dynamicLayoutVertexArray,se={};$.clear();for(let oe=0;oe<O.length;oe++){const ae=O.get(oe),he=ae.hidden||!ae.crossTileID||v.allowVerticalPlacement&&!ae.placedOrientation?null:d[ae.crossTileID];if(he){const ge=new c.P(ae.anchorX,ae.anchorY),ce={getElevation:F,width:g.width,height:g.height,pitchedLabelPlaneMatrix:x,pitchWithMap:l,transform:g,tileAnchorPoint:ge,translation:M,unwrappedTileID:j},fe=l?vo(ge.x,ge.y,ce):hn(ge.x,ge.y,ce),xe=Cl(g.cameraToCenterDistance,fe.signedDistanceFromCamera);let pe=c.aA(v.textSizeData,P,ae)*xe/c.aM;l&&(pe*=v.tilePixelRatio/w);const{width:Te,height:Oe,anchor:Me,textOffset:De,textBoxScale:je}=he,et=K_(Me,Te,Oe,De,je,pe),nt=g.getPitchedTextCorrection(ge.x+M[0],ge.y+M[1],j),He=ql(fe.point,ce,r,et,-g.bearingInRadians,nt),it=v.allowVerticalPlacement&&ae.placedOrientation===c.az.vertical?Math.PI/2:0;for(let Rt=0;Rt<ae.numGlyphs;Rt++)c.aG($,He,it);A&&ae.associatedIconIndex>=0&&(se[ae.associatedIconIndex]={shiftedAnchor:He,angle:it})}else Aa(ae.numGlyphs,$)}if(A){Y.clear();const oe=v.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){const he=oe.get(ae);if(he.hidden)Aa(he.numGlyphs,Y);else{const ge=se[ae];if(ge)for(let ce=0;ce<he.numGlyphs;ce++)c.aG(Y,ge.shiftedAnchor,ge.angle);else Aa(he.numGlyphs,Y)}}v.icon.dynamicLayoutVertexBuffer.updateData(Y)}v.text.dynamicLayoutVertexBuffer.updateData($)}function Tm(v,r,l){return l.iconsInText&&r?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Wl(v,r,l,d,g,x,w,P,A,M,j,F,O){const $=v.context,Y=$.gl,se=v.transform,oe=P==="map",ae=A==="map",he=P!=="viewport"&&l.layout.get("symbol-placement")!=="point",ge=oe&&!ae&&!he,ce=!l.layout.get("symbol-sort-key").isConstant();let fe=!1;const xe=v.getDepthModeForSublayer(0,Vt.ReadOnly),pe=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],Oe=se.getCircleRadiusCorrection();for(const Me of d){const De=r.getTile(Me),je=De.getBucket(l);if(!je)continue;const et=g?je.text:je.icon;if(!et||!et.segments.get().length||!et.hasVisibleVertices)continue;const nt=et.programConfigurations.get(l.id),He=g||je.sdfIcons,it=g?je.textSizeData:je.iconSizeData,Rt=ae||se.pitch!==0,ln=v.useProgram(Tm(He,g,je),nt),kn=c.ay(it,se.zoom),vn=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Me);let Dn,xn,qn,jn,Cr=[0,0],sr=null;if(g)xn=De.glyphAtlasTexture,qn=Y.LINEAR,Dn=De.glyphAtlasTexture.size,je.iconsInText&&(Cr=De.imageAtlasTexture.size,sr=De.imageAtlasTexture,jn=Rt||v.options.rotating||v.options.zooming||it.kind==="composite"||it.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const Sn=l.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;xn=De.imageAtlasTexture,qn=He||v.options.rotating||v.options.zooming||Sn||Rt?Y.LINEAR:Y.NEAREST,Dn=De.imageAtlasTexture.size}const tr=c.aN(De,1,v.transform.zoom),Fr=Ai(oe,v.transform,tr),fa=c.N();c.aB(fa,Fr);const Vs=Qc(ae,oe,v.transform,tr),Es=c.aO(se,De,x,w),_i=se.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),qa=pe&&je.hasTextData(),dc=l.layout.get("icon-text-fit")!=="none"&&qa&&je.hasIconData();if(he){const Sn=v.style.map.terrain?(xr,br)=>v.style.map.terrain.getElevation(Me,xr,br):null,bn=l.layout.get("text-rotation-alignment")==="map";eu(je,v,g,Fr,fa,ae,M,bn,Me.toUnwrapped(),se.width,se.height,Es,Sn)}const Wa=g&&pe||dc,qi=he||Wa?Nd:ae?Fr:v.transform.clipSpaceToPixelsMatrix,Ps=He&&l.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let as;as=He?je.iconsInText?La(it.kind,kn,ge,ae,he,Wa,v,qi,Vs,Es,Dn,Cr,Oe):du(it.kind,kn,ge,ae,he,Wa,v,qi,Vs,Es,g,Dn,0,Oe):Cd(it.kind,kn,ge,ae,he,Wa,v,qi,Vs,Es,g,Dn,Oe);const os={program:ln,buffers:et,uniformValues:as,projectionData:_i,atlasTexture:xn,atlasTextureIcon:sr,atlasInterpolation:qn,atlasInterpolationIcon:jn,isSDF:He,hasHalo:Ps};if(ce&&je.canOverlap){fe=!0;const Sn=et.segments.get();for(const bn of Sn)Te.push({segments:new c.aX([bn]),sortKey:bn.sortKey,state:os,terrainData:vn})}else Te.push({segments:et.segments,sortKey:0,state:os,terrainData:vn})}fe&&Te.sort((Me,De)=>Me.sortKey-De.sortKey);for(const Me of Te){const De=Me.state;if($.activeTexture.set(Y.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,Y.CLAMP_TO_EDGE),De.atlasTextureIcon&&($.activeTexture.set(Y.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),De.isSDF){const je=De.uniformValues;De.hasHalo&&(je.u_is_halo=1,Su(De.buffers,Me.segments,l,v,De.program,xe,j,F,je,De.projectionData,Me.terrainData)),je.u_is_halo=0}Su(De.buffers,Me.segments,l,v,De.program,xe,j,F,De.uniformValues,De.projectionData,Me.terrainData)}}function Su(v,r,l,d,g,x,w,P,A,M,j){const F=d.context;g.draw(F,F.gl.TRIANGLES,x,w,P,Yt.backCCW,A,j,M,l.id,v.layoutVertexBuffer,v.indexBuffer,r,l.paint,d.transform.zoom,v.programConfigurations.get(l.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Em(v,r,l,d,g){const x=v.context,w=x.gl,P=Jt.disabled,A=new _n([w.ONE,w.ONE],c.bp.transparent,[!0,!0,!0,!0]),M=r.getBucket(l);if(!M)return;const j=d.key;let F=l.heatmapFbos.get(j);F||(F=Zl(x,r.tileSize,r.tileSize),l.heatmapFbos.set(j,F)),x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,r.tileSize,r.tileSize]),x.clear({color:c.bp.transparent});const O=M.programConfigurations.get(l.id),$=v.useProgram("heatmap",O,!g),Y=v.transform.getProjectionData({overscaledTileID:r.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=v.style.map.terrain.getTerrainData(d);$.draw(x,w.TRIANGLES,Vt.disabled,P,A,Yt.disabled,Ro(r,v.transform.zoom,l.paint.get("heatmap-intensity"),1),se,Y,l.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,l.paint,v.transform.zoom,O)}function Pm(v,r,l,d,g){const x=v.context,w=x.gl,P=v.transform;x.setColorMode(v.colorModeForRenderPass());const A=Tu(x,r),M=l.key,j=r.heatmapFbos.get(M);if(!j)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,j.colorAttachment.get()),x.activeTexture.set(w.TEXTURE1),A.bind(w.LINEAR,w.CLAMP_TO_EDGE);const F=P.getProjectionData({overscaledTileID:l,applyTerrainMatrix:g,applyGlobeMatrix:!d});v.useProgram("heatmapTexture").draw(x,w.TRIANGLES,Vt.disabled,Jt.disabled,v.colorModeForRenderPass(),Yt.disabled,dm(v,r,0,1),null,F,r.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,r.paint,P.zoom),j.destroy(),r.heatmapFbos.delete(M)}function Zl(v,r,l){var d,g;const x=v.gl,w=x.createTexture();x.bindTexture(x.TEXTURE_2D,w),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const P=(d=v.HALF_FLOAT)!==null&&d!==void 0?d:x.UNSIGNED_BYTE,A=(g=v.RGBA16F)!==null&&g!==void 0?g:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,A,r,l,0,x.RGBA,P,null);const M=v.createFramebuffer(r,l,!1,!1);return M.colorAttachment.set(w),M}function Tu(v,r){return r.colorRampTexture||(r.colorRampTexture=new c.T(v,r.colorRamp,v.gl.RGBA)),r.colorRampTexture}function Cm(v,r,l,d,g,x,w,P){let A=256;if(g.stepInterpolant){const M=r.getSource().maxzoom,j=w.canonical.z===M?Math.ceil(1<<v.transform.maxZoom-w.canonical.z):1;A=c.an(c.ce(x.maxLineLength/c.a5*1024*j),256,l.maxTextureSize)}return P.gradient=c.cf({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:A,image:P.gradient||void 0,clips:x.lineClipsArray}),P.texture?P.texture.update(P.gradient):P.texture=new c.T(l,P.gradient,d.RGBA),P.version=g.gradientVersion,P.texture}function km(v,r,l,d,g){v.activeTexture.set(r.TEXTURE0),l.imageAtlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),d.updatePaintBuffers(g)}function Qn(v,r,l,d,g,x){(g||v.lineAtlas.dirty)&&(r.activeTexture.set(l.TEXTURE0),v.lineAtlas.bind(r)),d.updatePaintBuffers(x)}function Ba(v,r,l,d,g,x,w){const P=x.gradients[g.id];let A=P.texture;g.gradientVersion!==P.version&&(A=Cm(v,r,l,d,g,x,w,P)),l.activeTexture.set(d.TEXTURE0),A.bind(g.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE)}function Mi(v,r,l,d,g,x,w,P,A){const M=x.gradients[g.id];let j=M.texture;g.gradientVersion!==M.version&&(j=Cm(v,r,l,d,g,x,w,M)),l.activeTexture.set(d.TEXTURE0),j.bind(g.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE),l.activeTexture.set(d.TEXTURE1),v.lineAtlas.bind(l),P.updatePaintBuffers(A)}function Eu(v,r,l,d,g){if(!l||!d||!d.imageAtlas)return;const x=d.imageAtlas.patternPositions;let w=x[l.to.toString()],P=x[l.from.toString()];if(!w&&P&&(w=P),!P&&w&&(P=w),!w||!P){const A=g.getPaintProperty(r);w=x[A],P=x[A]}w&&P&&v.setConstantPatternPositions(w,P)}function Hl(v,r,l,d,g,x,w,P){const A=v.context.gl,M="fill-pattern",j=l.paint.get(M),F=j&&j.constantOr(1),O=l.getCrossfadeParameters();let $,Y,se,oe,ae;const he=v.transform,ge=l.paint.get("fill-translate"),ce=l.paint.get("fill-translate-anchor");w?(Y=F&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=A.LINES):(Y=F?"fillPattern":"fill",$=A.TRIANGLES);const fe=j.constantOr(null);for(const xe of d){const pe=r.getTile(xe);if(F&&!pe.patternsLoaded())continue;const Te=pe.getBucket(l);if(!Te)continue;const Oe=Te.programConfigurations.get(l.id),Me=v.useProgram(Y,Oe),De=v.style.map.terrain&&v.style.map.terrain.getTerrainData(xe);F&&(v.context.activeTexture.set(A.TEXTURE0),pe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Oe.updatePaintBuffers(O)),Eu(Oe,M,fe,pe,l);const je=he.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),et=c.aO(he,pe,ge,ce);if(w){oe=Te.indexBuffer2,ae=Te.segments2;const He=[A.drawingBufferWidth,A.drawingBufferHeight];se=Y==="fillOutlinePattern"&&F?cm(v,O,pe,He,et):lm(He,et)}else oe=Te.indexBuffer,ae=Te.segments,se=F?wd(v,O,pe,et):{u_fill_translate:et};const nt=v.stencilModeForClipping(xe);Me.draw(v.context,$,g,nt,x,Yt.backCCW,se,De,je,l.id,Te.layoutVertexBuffer,oe,ae,l.paint,v.transform.zoom,Oe)}}function Pu(v,r,l,d,g,x,w,P){const A=v.context,M=A.gl,j="fill-extrusion-pattern",F=l.paint.get(j),O=F.constantOr(1),$=l.getCrossfadeParameters(),Y=l.paint.get("fill-extrusion-opacity"),se=F.constantOr(null),oe=v.transform;for(const ae of d){const he=r.getTile(ae),ge=he.getBucket(l);if(!ge)continue;const ce=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ae),fe=ge.programConfigurations.get(l.id),xe=v.useProgram(O?"fillExtrusionPattern":"fillExtrusion",fe);O&&(v.context.activeTexture.set(M.TEXTURE0),he.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),fe.updatePaintBuffers($));const pe=oe.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!P,applyTerrainMatrix:!0});Eu(fe,j,se,he,l);const Te=c.aO(oe,he,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Oe=l.paint.get("fill-extrusion-vertical-gradient"),Me=O?bd(v,Oe,Y,Te,ae,$,he):xd(v,Oe,Y,Te);xe.draw(A,A.gl.TRIANGLES,g,x,w,Yt.backCCW,Me,ce,pe,l.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,l.paint,v.transform.zoom,fe,v.style.map.terrain&&ge.centroidVertexBuffer)}}function ua(v,r,l,d,g,x,w,P,A){var M;const j=v.style.projection,F=v.context,O=v.transform,$=F.gl,Y=[`#define NUM_ILLUMINATION_SOURCES ${l.paint.get("hillshade-highlight-color").values.length}`],se=v.useProgram("hillshade",null,!1,Y),oe=!v.options.moving;for(const ae of d){const he=r.getTile(ae),ge=he.fbo;if(!ge)continue;const ce=j.getMeshFromTileID(F,ae.canonical,P,!0,"raster"),fe=(M=v.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(ae);F.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,ge.colorAttachment.get());const xe=O.getProjectionData({overscaledTileID:ae,aligned:oe,applyGlobeMatrix:!A,applyTerrainMatrix:!0});se.draw(F,$.TRIANGLES,x,g[ae.overscaledZ],w,Yt.backCCW,cu(v,he,l),fe,xe,l.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}function Kl(v,r,l,d,g,x,w,P,A){var M;const j=v.style.projection,F=v.context,O=v.transform,$=F.gl,Y=v.useProgram("colorRelief"),se=!v.options.moving;let oe=!0,ae=0;for(const he of d){const ge=r.getTile(he),ce=ge.dem;if(oe){const Me=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:De,colorTexture:je}=l.getColorRampTextures(F,Me,ce.getUnpackVector());F.activeTexture.set($.TEXTURE1),De.bind($.NEAREST,$.CLAMP_TO_EDGE),F.activeTexture.set($.TEXTURE4),je.bind($.LINEAR,$.CLAMP_TO_EDGE),oe=!1,ae=De.size[0]}if(!ce||!ce.data)continue;const fe=ce.stride,xe=ce.getPixels();if(F.activeTexture.set($.TEXTURE0),F.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||v.getTileTexture(fe),ge.demTexture){const Me=ge.demTexture;Me.update(xe,{premultiply:!1}),Me.bind($.LINEAR,$.CLAMP_TO_EDGE)}else ge.demTexture=new c.T(F,xe,$.RGBA,{premultiply:!1}),ge.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const pe=j.getMeshFromTileID(F,he.canonical,P,!0,"raster"),Te=(M=v.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(he),Oe=O.getProjectionData({overscaledTileID:he,aligned:se,applyGlobeMatrix:!A,applyTerrainMatrix:!0});Y.draw(F,$.TRIANGLES,x,g[he.overscaledZ],w,Yt.backCCW,pm(l,ge.dem,ae),Te,Oe,l.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}const Va=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function zo(v,r,l,d,g,x,w,P,A=!1,M=!1){const j=d[d.length-1].overscaledZ,F=v.context,O=F.gl,$=v.useProgram("raster"),Y=v.transform,se=v.style.projection,oe=v.colorModeForRenderPass(),ae=!v.options.moving,he=l.paint.get("raster-opacity"),ge=l.paint.get("raster-resampling"),ce=l.paint.get("raster-fade-duration"),fe=!!v.style.map.terrain;for(const xe of d){const pe=v.getDepthModeForSublayer(xe.overscaledZ-j,he===1?Vt.ReadWrite:Vt.ReadOnly,O.LESS),Te=r.getTile(xe),Oe=ge==="nearest"?O.NEAREST:O.LINEAR;F.activeTexture.set(O.TEXTURE0),Te.texture.bind(Oe,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(O.TEXTURE1);const{parentTile:Me,parentScaleBy:De,parentTopLeft:je,fadeValues:et}=Am(Te,r,ce,fe);Te.fadeOpacity=et.tileOpacity,Me?(Me.fadeOpacity=et.parentTileOpacity,Me.texture.bind(Oe,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST)):Te.texture.bind(Oe,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Te.texture.useMipmap&&F.extTextureFilterAnisotropic&&v.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const nt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(xe),He=Y.getProjectionData({overscaledTileID:xe,aligned:ae,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),it=Ed(je,De,et.fadeMix,l,P),Rt=se.getMeshFromTileID(F,xe.canonical,x,w,"raster");$.draw(F,O.TRIANGLES,pe,g?g[xe.overscaledZ]:Jt.disabled,oe,A?Yt.frontCCW:Yt.backCCW,it,nt,He,l.id,Rt.vertexBuffer,Rt.indexBuffer,Rt.segments)}}function Am(v,r,l,d){const g={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(l===0||d)return g;if(v.fadingParentID){const x=r.getLoadedTile(v.fadingParentID);if(!x)return g;const w=Math.pow(2,x.tileID.overscaledZ-v.tileID.overscaledZ),P=[v.tileID.canonical.x*w%1,v.tileID.canonical.y*w%1],A=function(M,j,F){const O=te(),$=(O-j.timeAdded)/F,Y=M.fadingDirection===Le.Incoming,se=c.an((O-M.timeAdded)/F,0,1),oe=c.an(1-$,0,1),ae=Y?se:oe;return{tileOpacity:ae,parentTileOpacity:Y?oe:se,fadeMix:{opacity:1,mix:1-ae}}}(v,x,l);return{parentTile:x,parentScaleBy:w,parentTopLeft:P,fadeValues:A}}if(v.selfFading){const x=function(w,P){const A=(te()-w.timeAdded)/P,M=c.an(A,0,1);return{tileOpacity:M,fadeMix:{opacity:M,mix:0}}}(v,l);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:x}}return g}const Im=new c.bp(1,0,0,1),Mm=new c.bp(0,1,0,1),Rm=new c.bp(0,0,1,1),Dm=new c.bp(1,0,1,1),ha=new c.bp(0,1,1,1);function Ld(v,r,l,d){Xl(v,0,r+l/2,v.transform.width,l,d)}function zd(v,r,l,d){Xl(v,r-l/2,0,l,v.transform.height,d)}function Xl(v,r,l,d,g,x){const w=v.context,P=w.gl;P.enable(P.SCISSOR_TEST),P.scissor(r*v.pixelRatio,l*v.pixelRatio,d*v.pixelRatio,g*v.pixelRatio),w.clear({color:x}),P.disable(P.SCISSOR_TEST)}function jm(v,r,l){const d=v.context,g=d.gl,x=v.useProgram("debug"),w=Vt.disabled,P=Jt.disabled,A=v.colorModeForRenderPass(),M="$debug",j=v.style.map.terrain&&v.style.map.terrain.getTerrainData(l);d.activeTexture.set(g.TEXTURE0);const F=r.getTileByID(l.key).latestRawTileData,O=Math.floor((F&&F.byteLength||0)/1024),$=r.getTile(l).tileSize,Y=512/Math.min($,512)*(l.overscaledZ/v.transform.zoom)*.5;let se=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(se+=` => ${l.overscaledZ}`),function(ae,he){ae.initDebugOverlayCanvas();const ge=ae.debugOverlayCanvas,ce=ae.context.gl,fe=ae.debugOverlayCanvas.getContext("2d");fe.clearRect(0,0,ge.width,ge.height),fe.shadowColor="white",fe.shadowBlur=2,fe.lineWidth=1.5,fe.strokeStyle="white",fe.textBaseline="top",fe.font="bold 36px Open Sans, sans-serif",fe.fillText(he,5,5),fe.strokeText(he,5,5),ae.debugOverlayTexture.update(ge),ae.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(v,`${se} ${O}kB`);const oe=v.transform.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(d,g.TRIANGLES,w,P,_n.alphaBlended,Yt.disabled,Sd(c.bp.transparent,Y),null,oe,M,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),x.draw(d,g.LINE_STRIP,w,P,A,Yt.disabled,Sd(c.bp.red),j,oe,M,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function Od(v,r,l,d){const{isRenderingGlobe:g}=d,x=v.context,w=x.gl,P=v.transform,A=v.colorModeForRenderPass(),M=v.getDepthModeFor3D(),j=v.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,v.width,v.height]);for(const F of l){const O=r.getTerrainMesh(F.tileID),$=v.renderToTexture.getTexture(F),Y=r.getTerrainData(F.tileID);x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,$.texture);const se=r.getMeshFrameDelta(P.zoom),oe=P.calculateFogMatrix(F.tileID.toUnwrapped()),ae=O_(se,oe,v.style.sky,P.pitch,g),he=P.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});j.draw(x,w.TRIANGLES,M,Jt.disabled,A,Yt.backCCW,ae,Y,he,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}function Fd(v,r){if(!r.mesh){const l=new c.aW;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(1,1),l.emplaceBack(-1,1);const d=new c.aY;d.emplaceBack(0,1,2),d.emplaceBack(0,2,3),r.mesh=new yn(v.createVertexBuffer(l,aa.members),v.createIndexBuffer(d),c.aX.simpleSegment(0,0,l.length,d.length))}return r.mesh}class Nm{constructor(r,l){this.context=new wu(r),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Bi.maxOverzooming+Bi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gi}resize(r,l,d){if(this.width=Math.floor(r*d),this.height=Math.floor(l*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const r=this.context,l=new c.aW;l.emplaceBack(0,0),l.emplaceBack(c.a5,0),l.emplaceBack(0,c.a5),l.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=r.createVertexBuffer(l,aa.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const d=new c.aW;d.emplaceBack(0,0),d.emplaceBack(c.a5,0),d.emplaceBack(0,c.a5),d.emplaceBack(c.a5,c.a5),this.debugBuffer=r.createVertexBuffer(d,aa.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const g=new c.ch;g.emplaceBack(0,0,0,0),g.emplaceBack(c.a5,0,c.a5,0),g.emplaceBack(0,c.a5,0,c.a5),g.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=r.createVertexBuffer(g,z_.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const x=new c.aW;x.emplaceBack(0,0),x.emplaceBack(c.a5,0),x.emplaceBack(0,c.a5),x.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=r.createVertexBuffer(x,aa.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const w=new c.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(w,aa.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const P=new c.ci;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(P);const A=new c.aY;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(A);const M=this.context.gl;this.stencilClearMode=new Jt({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.tileExtentMesh=new yn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=c.N();c.c7(d,0,this.width,this.height,0,0,1),c.Q(d,d,[l.drawingBufferWidth,l.drawingBufferHeight,0]);const g={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(r,l.TRIANGLES,Vt.disabled,this.stencilClearMode,_n.disabled,Yt.disabled,null,null,g,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,l,d){if(this.currentStencilSource===r.source||!r.isTileClipped()||!l||!l.length)return;this.currentStencilSource=r.source,this.nextStencilID+l.length>256&&this.clearStencil();const g=this.context;g.setColorMode(_n.disabled),g.setDepthMode(Vt.disabled);const x={};for(const w of l)x[w.key]=this.nextStencilID++;this._renderTileMasks(x,l,d,!0),this._renderTileMasks(x,l,d,!1),this._tileClippingMaskIDs=x}_renderTileMasks(r,l,d,g){const x=this.context,w=x.gl,P=this.style.projection,A=this.transform,M=this.useProgram("clippingMask");for(const j of l){const F=r[j.key],O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),$=P.getMeshFromTileID(this.context,j.canonical,g,!0,"stencil"),Y=A.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!d,applyTerrainMatrix:!0});M.draw(x,w.TRIANGLES,Vt.disabled,new Jt({func:w.ALWAYS,mask:0},F,255,w.KEEP,w.KEEP,w.REPLACE),_n.disabled,d?Yt.disabled:Yt.backCCW,null,O,Y,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){const r=this.context,l=r.gl,d=this.style.projection,g=this.transform,x=this.useProgram("depth"),w=this.getDepthModeFor3D(),P=Un(g,{tileSize:g.tileSize});for(const A of P){const M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),j=d.getMeshFromTileID(this.context,A.canonical,!0,!0,"raster"),F=g.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(r,l.TRIANGLES,w,Jt.disabled,_n.disabled,Yt.backCCW,null,M,F,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new Jt({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){const l=this.context.gl;return new Jt({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(r){const l=this.context.gl,d=r.sort((w,P)=>P.overscaledZ-w.overscaledZ),g=d[d.length-1].overscaledZ,x=d[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let P=0;P<x;P++)w[P+g]=new Jt({func:l.GEQUAL,mask:255},P+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[w,d]}return[{[g]:Jt.disabled},d]}stencilConfigForOverlapTwoPass(r){const l=this.context.gl,d=r.sort((w,P)=>P.overscaledZ-w.overscaledZ),g=d[d.length-1].overscaledZ,x=d[0].overscaledZ-g+1;if(this.clearStencil(),x>1){const w={},P={};for(let A=0;A<x;A++)w[A+g]=new Jt({func:l.GREATER,mask:255},x+1+A,255,l.KEEP,l.KEEP,l.REPLACE),P[A+g]=new Jt({func:l.GREATER,mask:255},1+A,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID=2*x+1,[w,P,d]}return this.nextStencilID=3,[{[g]:new Jt({func:l.GREATER,mask:255},2,255,l.KEEP,l.KEEP,l.REPLACE)},{[g]:new Jt({func:l.GREATER,mask:255},1,255,l.KEEP,l.KEEP,l.REPLACE)},d]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new _n([r.CONSTANT_COLOR,r.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_n.unblended:_n.alphaBlended}getDepthModeForSublayer(r,l,d){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Vt(d||this.context.gl.LEQUAL,l,[g,g])}getDepthModeFor3D(){return new Vt(this.context.gl.LEQUAL,Vt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){var d,g;this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(te()),this.imageManager.beginFrame();const x=this.style._order,w=this.style.tileManagers,P={},A={},M={},j={isRenderingToTexture:!1,isRenderingGlobe:((d=r.projection)===null||d===void 0?void 0:d.transitionState)>0};for(const O in w){const $=w[O];$.used&&$.prepare(this.context),P[O]=$.getVisibleCoordinates(!1),A[O]=P[O].slice().reverse(),M[O]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<x.length;O++)if(this.style._layers[x[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of x){const $=this.style._layers[O];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const Y=A[$.source];($.type==="custom"||Y.length)&&this.renderLayer(this,w[$.source],$,Y,j)}if((g=this.style.projection)===null||g===void 0||g.updateGPUdependent({context:this.context,useProgram:O=>this.useProgram(O)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,$){const Y=O.context,se=Y.gl,oe=((xe,pe,Te)=>{const Oe=Math.cos(pe.rollInRadians),Me=Math.sin(pe.rollInRadians),De=dn(pe),je=pe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:xe.properties.get("sky-color"),u_horizon_color:xe.properties.get("horizon-color"),u_horizon:[(pe.width/2-De*Me)*Te,(pe.height/2+De*Oe)*Te],u_horizon_normal:[-Me,Oe],u_sky_horizon_blend:xe.properties.get("sky-horizon-blend")*pe.height/2*Te,u_sky_blend:je}})($,O.style.map.transform,O.pixelRatio),ae=new Vt(se.LEQUAL,Vt.ReadWrite,[0,1]),he=Jt.disabled,ge=O.colorModeForRenderPass(),ce=O.useProgram("sky"),fe=Fd(Y,$);ce.draw(Y,se.TRIANGLES,ae,he,ge,Yt.disabled,oe,null,void 0,"sky",fe.vertexBuffer,fe.indexBuffer,fe.segments)}(this,this.style.sky),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[x[this.currentLayer]],$=w[O.source],Y=P[O.source];this._renderTileClippingMasks(O,Y,!1),this.renderLayer(this,$,O,Y,j)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const O=this.style._layers[x[this.currentLayer]],$=w[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O,j))continue;this.opaquePassEnabledForLayer()||F||(F=!0,j.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Y=(O.type==="symbol"?M:A)[O.source];this._renderTileClippingMasks(O,P[O.source],!!this.renderToTexture),this.renderLayer(this,$,O,Y,j)}if(j.isRenderingGlobe&&function(O,$,Y){const se=O.context,oe=se.gl,ae=O.useProgram("atmosphere"),he=new Vt(oe.LEQUAL,Vt.ReadOnly,[0,1]),ge=O.transform,ce=function(je,et){const nt=je.properties.get("position"),He=[-nt.x,-nt.y,-nt.z],it=c.ar(new Float64Array(16));return je.properties.get("anchor")==="map"&&(c.bg(it,it,et.rollInRadians),c.bh(it,it,-et.pitchInRadians),c.bg(it,it,et.bearingInRadians),c.bh(it,it,et.center.lat*Math.PI/180),c.bJ(it,it,-et.center.lng*Math.PI/180)),c.cg(He,He,it),He}(Y,O.transform),fe=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),xe=$.properties.get("atmosphere-blend")*fe.projectionTransition;if(xe===0)return;const pe=Da(ge.worldSize,ge.center.lat),Te=ge.inverseProjectionMatrix,Oe=new Float64Array(4);Oe[3]=1,c.aH(Oe,Oe,ge.modelViewProjectionMatrix),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1,c.aH(Oe,Oe,Te),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1;const Me=((je,et,nt,He,it)=>({u_sun_pos:je,u_atmosphere_blend:et,u_globe_position:nt,u_globe_radius:He,u_inv_proj_matrix:it}))(ce,xe,[Oe[0],Oe[1],Oe[2]],pe,Te),De=Fd(se,$);ae.draw(se,oe.TRIANGLES,he,Jt.disabled,_n.alphaBlended,Yt.disabled,Me,null,null,"atmosphere",De.vertexBuffer,De.indexBuffer,De.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const O=function($,Y){let se=null;const oe=Object.values($._layers).flatMap(ce=>ce.source&&!ce.isHidden(Y)?[$.tileManagers[ce.source]]:[]),ae=oe.filter(ce=>ce.getSource().type==="vector"),he=oe.filter(ce=>ce.getSource().type!=="vector"),ge=ce=>{(!se||se.getSource().maxzoom<ce.getSource().maxzoom)&&(se=ce)};return ae.forEach(ce=>ge(ce)),se||he.forEach(ce=>ge(ce)),se}(this.style,this.transform.zoom);O&&function($,Y,se){for(let oe=0;oe<se.length;oe++)jm($,Y,se[oe])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const $=O.transform.padding;Ld(O,O.transform.height-($.top||0),3,Im),Ld(O,$.bottom||0,3,Mm),zd(O,$.left||0,3,Rm),zd(O,O.transform.width-($.right||0),3,Dm);const Y=O.transform.centerPoint;(function(se,oe,ae,he){Xl(se,oe-1,ae-10,2,20,he),Xl(se,oe-10,ae-1,20,2,he)})(O,Y.x,O.transform.height-Y.y,ha)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const l=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=r?!c.cj(l,d):!c.ck(l,d)),g||(g=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),g&&(c.cl(l,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,w){const P=x.context,A=P.gl,M=x.transform,j=_n.unblended,F=new Vt(A.LEQUAL,Vt.ReadWrite,[0,1]),O=w.tileManager.getRenderableTiles(),$=x.useProgram("terrainDepth");P.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),P.clear({color:c.bp.transparent,depth:1});for(const Y of O){const se=w.getTerrainMesh(Y.tileID),oe=w.getTerrainData(Y.tileID),ae=M.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),he={u_ele_delta:w.getMeshFrameDelta(M.zoom)};$.draw(P,A.TRIANGLES,F,Jt.disabled,j,Yt.backCCW,he,oe,ae,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,w){const P=x.context,A=P.gl,M=x.transform,j=_n.unblended,F=new Vt(A.LEQUAL,Vt.ReadWrite,[0,1]),O=w.getCoordsTexture(),$=w.tileManager.getRenderableTiles(),Y=x.useProgram("terrainCoords");P.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),P.clear({color:c.bp.transparent,depth:1}),w.coordsIndex=[];for(const se of $){const oe=w.getTerrainMesh(se.tileID),ae=w.getTerrainData(se.tileID);P.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.texture);const he={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(M.zoom)},ge=M.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Y.draw(P,A.TRIANGLES,F,Jt.disabled,j,Yt.backCCW,he,ae,ge,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),w.coordsIndex.push(se.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(r,l,d,g,x){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||(g||[]).length)&&(this.id=d.id,c.cm(d)?function(w,P,A,M,j,F){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:O}=F,$=Jt.disabled,Y=w.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(se,oe,ae,he,ge,ce,fe,xe,pe){const Te=oe.transform,Oe=oe.style.map.terrain,Me=ge==="map",De=ce==="map";for(const je of se){const et=he.getTile(je),nt=et.getBucket(ae);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const He=c.ay(nt.textSizeData,Te.zoom),it=c.aN(et,1,oe.transform.zoom),Rt=Ai(Me,oe.transform,it),ln=ae.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(He){const kn=Math.pow(2,Te.zoom-et.tileID.overscaledZ),vn=Oe?(Dn,xn)=>Oe.getElevation(je,Dn,xn):null;X_(nt,Me,De,pe,Te,Rt,kn,He,ln,c.aO(Te,et,fe,xe),je.toUnwrapped(),vn)}}}(M,w,A,P,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),j),A.paint.get("icon-opacity").constantOr(1)!==0&&Wl(w,P,A,M,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),$,Y,O),A.paint.get("text-opacity").constantOr(1)!==0&&Wl(w,P,A,M,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),$,Y,O),P.map.showCollisionBoxes&&(Fa(w,P,A,M,!0),Fa(w,P,A,M,!1))}(r,l,d,g,this.style.placement.variableOffsets,x):c.cn(d)?function(w,P,A,M,j){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:F}=j,O=A.paint.get("circle-opacity"),$=A.paint.get("circle-stroke-width"),Y=A.paint.get("circle-stroke-opacity"),se=!A.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&($.constantOr(1)===0||Y.constantOr(1)===0))return;const oe=w.context,ae=oe.gl,he=w.transform,ge=w.getDepthModeForSublayer(0,Vt.ReadOnly),ce=Jt.disabled,fe=w.colorModeForRenderPass(),xe=[],pe=he.getCircleRadiusCorrection();for(let Te=0;Te<M.length;Te++){const Oe=M[Te],Me=P.getTile(Oe),De=Me.getBucket(A);if(!De)continue;const je=A.paint.get("circle-translate"),et=A.paint.get("circle-translate-anchor"),nt=c.aO(he,Me,je,et),He=De.programConfigurations.get(A.id),it=w.useProgram("circle",He),Rt=De.layoutVertexBuffer,ln=De.indexBuffer,kn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Oe),vn={programConfiguration:He,program:it,layoutVertexBuffer:Rt,indexBuffer:ln,uniformValues:um(w,Me,A,nt,pe),terrainData:kn,projectionData:he.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(se){const Dn=De.segments.get();for(const xn of Dn)xe.push({segments:new c.aX([xn]),sortKey:xn.sortKey,state:vn})}else xe.push({segments:De.segments,sortKey:0,state:vn})}se&&xe.sort((Te,Oe)=>Te.sortKey-Oe.sortKey);for(const Te of xe){const{programConfiguration:Oe,program:Me,layoutVertexBuffer:De,indexBuffer:je,uniformValues:et,terrainData:nt,projectionData:He}=Te.state;Me.draw(oe,ae.TRIANGLES,ge,ce,fe,Yt.backCCW,et,nt,He,A.id,De,je,Te.segments,A.paint,w.transform.zoom,Oe)}}(r,l,d,g,x):c.co(d)?function(w,P,A,M,j){if(A.paint.get("heatmap-opacity")===0)return;const F=w.context,{isRenderingToTexture:O,isRenderingGlobe:$}=j;if(w.style.map.terrain){for(const Y of M){const se=P.getTile(Y);P.hasRenderableParent(Y)||(w.renderPass==="offscreen"?Em(w,se,A,Y,$):w.renderPass==="translucent"&&Pm(w,A,Y,O,$))}F.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(Y,se,oe,ae){const he=Y.context,ge=he.gl,ce=Y.transform,fe=Jt.disabled,xe=new _n([ge.ONE,ge.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(pe,Te,Oe){const Me=pe.gl;pe.activeTexture.set(Me.TEXTURE1),pe.viewport.set([0,0,Te.width/4,Te.height/4]);let De=Oe.heatmapFbos.get(c.cd);De?(Me.bindTexture(Me.TEXTURE_2D,De.colorAttachment.get()),pe.bindFramebuffer.set(De.framebuffer)):(De=Zl(pe,Te.width/4,Te.height/4),Oe.heatmapFbos.set(c.cd,De))})(he,Y,oe),he.clear({color:c.bp.transparent});for(let pe=0;pe<ae.length;pe++){const Te=ae[pe];if(se.hasRenderableParent(Te))continue;const Oe=se.getTile(Te),Me=Oe.getBucket(oe);if(!Me)continue;const De=Me.programConfigurations.get(oe.id),je=Y.useProgram("heatmap",De),et=ce.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),nt=ce.getCircleRadiusCorrection();je.draw(he,ge.TRIANGLES,Vt.disabled,fe,xe,Yt.backCCW,Ro(Oe,ce.zoom,oe.paint.get("heatmap-intensity"),nt),null,et,oe.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,oe.paint,ce.zoom,De)}he.viewport.set([0,0,Y.width,Y.height])}(w,P,A,M):w.renderPass==="translucent"&&function(Y,se){const oe=Y.context,ae=oe.gl;oe.setColorMode(Y.colorModeForRenderPass());const he=se.heatmapFbos.get(c.cd);he&&(oe.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_2D,he.colorAttachment.get()),oe.activeTexture.set(ae.TEXTURE1),Tu(oe,se).bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(oe,ae.TRIANGLES,Vt.disabled,Jt.disabled,Y.colorModeForRenderPass(),Yt.disabled,dm(Y,se,0,1),null,null,se.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,se.paint,Y.transform.zoom))}(w,A)}(r,l,d,g,x):c.cp(d)?function(w,P,A,M,j){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:F}=j,O=A.paint.get("line-opacity"),$=A.paint.get("line-width");if(O.constantOr(1)===0||$.constantOr(1)===0)return;const Y=w.getDepthModeForSublayer(0,Vt.ReadOnly),se=w.colorModeForRenderPass(),oe=A.paint.get("line-dasharray"),ae=oe.constantOr(1),he=A.paint.get("line-pattern"),ge=he.constantOr(1),ce=A.paint.get("line-gradient"),fe=A.getCrossfadeParameters();let xe;xe=ge?"linePattern":ae&&ce?"lineGradientSDF":ae?"lineSDF":ce?"lineGradient":"line";const pe=w.context,Te=pe.gl,Oe=w.transform;let Me=!0;for(const De of M){const je=P.getTile(De);if(ge&&!je.patternsLoaded())continue;const et=je.getBucket(A);if(!et)continue;const nt=et.programConfigurations.get(A.id),He=w.context.program.get(),it=w.useProgram(xe,nt),Rt=Me||it.program!==He,ln=w.style.map.terrain&&w.style.map.terrain.getTerrainData(De),kn=he.constantOr(null),vn=oe&&oe.constantOr(null);if(kn&&je.imageAtlas){const Cr=je.imageAtlas,sr=Cr.patternPositions[kn.to.toString()],tr=Cr.patternPositions[kn.from.toString()];sr&&tr&&nt.setConstantPatternPositions(sr,tr)}else if(vn){const Cr=A.layout.get("line-cap")==="round",sr=w.lineAtlas.getDash(vn.to,Cr),tr=w.lineAtlas.getDash(vn.from,Cr);nt.setConstantDashPositions(sr,tr)}const Dn=Oe.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),xn=Oe.getPixelScale();let qn;ge?(qn=Td(w,je,A,xn,fe),km(pe,Te,je,nt,fe)):ae&&ce?(qn=uu(w,je,A,xn,fe,et.lineClipsArray.length),Mi(w,P,pe,Te,A,et,De,nt,fe)):ae?(qn=mm(w,je,A,xn,fe),Qn(w,pe,Te,nt,Rt,fe)):ce?(qn=fm(w,je,A,xn,et.lineClipsArray.length),Ba(w,P,pe,Te,A,et,De)):qn=Bl(w,je,A,xn);const jn=w.stencilModeForClipping(De);it.draw(pe,Te.TRIANGLES,Y,jn,se,Yt.disabled,qn,ln,Dn,A.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,A.paint,w.transform.zoom,nt,et.layoutVertexBuffer2),Me=!1}}(r,l,d,g,x):c.cq(d)?function(w,P,A,M,j){const F=A.paint.get("fill-color"),O=A.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const{isRenderingToTexture:$}=j,Y=w.colorModeForRenderPass(),se=A.paint.get("fill-pattern"),oe=w.opaquePassEnabledForLayer()&&!se.constantOr(1)&&F.constantOr(c.bp.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===oe){const ae=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly);Hl(w,P,A,M,ae,Y,!1,$)}if(w.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ae=w.getDepthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);Hl(w,P,A,M,ae,Y,!0,$)}}(r,l,d,g,x):c.cr(d)?function(w,P,A,M,j){const F=A.paint.get("fill-extrusion-opacity");if(F===0)return;const{isRenderingToTexture:O}=j;if(w.renderPass==="translucent"){const $=new Vt(w.context.gl.LEQUAL,Vt.ReadWrite,w.depthRangeFor3D);if(F!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Pu(w,P,A,M,$,Jt.disabled,_n.disabled,O),Pu(w,P,A,M,$,w.stencilModeFor3D(),w.colorModeForRenderPass(),O);else{const Y=w.colorModeForRenderPass();Pu(w,P,A,M,$,Jt.disabled,Y,O)}}}(r,l,d,g,x):c.cs(d)?function(w,P,A,M,j){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:F}=j,O=w.context,$=w.style.projection.useSubdivision,Y=w.getDepthModeForSublayer(0,Vt.ReadOnly),se=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(oe,ae,he,ge,ce,fe,xe){const pe=oe.context,Te=pe.gl;for(const Oe of he){const Me=ae.getTile(Oe),De=Me.dem;if(!De||!De.data||!Me.needsHillshadePrepare)continue;const je=De.dim,et=De.stride,nt=De.getPixels();if(pe.activeTexture.set(Te.TEXTURE1),pe.pixelStoreUnpackPremultiplyAlpha.set(!1),Me.demTexture=Me.demTexture||oe.getTileTexture(et),Me.demTexture){const it=Me.demTexture;it.update(nt,{premultiply:!1}),it.bind(Te.NEAREST,Te.CLAMP_TO_EDGE)}else Me.demTexture=new c.T(pe,nt,Te.RGBA,{premultiply:!1}),Me.demTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);pe.activeTexture.set(Te.TEXTURE0);let He=Me.fbo;if(!He){const it=new c.T(pe,{width:je,height:je,data:null},Te.RGBA);it.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),He=Me.fbo=pe.createFramebuffer(je,je,!0,!1),He.colorAttachment.set(it.texture)}pe.bindFramebuffer.set(He.framebuffer),pe.viewport.set([0,0,je,je]),oe.useProgram("hillshadePrepare").draw(pe,Te.TRIANGLES,ce,fe,xe,Yt.disabled,F_(Me.tileID,De),null,null,ge.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),Me.needsHillshadePrepare=!1}})(w,P,M,A,Y,Jt.disabled,se),O.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if($){const[oe,ae,he]=w.stencilConfigForOverlapTwoPass(M);ua(w,P,A,he,oe,Y,se,!1,F),ua(w,P,A,he,ae,Y,se,!0,F)}else{const[oe,ae]=w.getStencilConfigForOverlapAndUpdateStencilID(M);ua(w,P,A,ae,oe,Y,se,!1,F)}}(r,l,d,g,x):c.ct(d)?function(w,P,A,M,j){if(w.renderPass!=="translucent"||!M.length)return;const{isRenderingToTexture:F}=j,O=w.style.projection.useSubdivision,$=w.getDepthModeForSublayer(0,Vt.ReadOnly),Y=w.colorModeForRenderPass();if(O){const[se,oe,ae]=w.stencilConfigForOverlapTwoPass(M);Kl(w,P,A,ae,se,$,Y,!1,F),Kl(w,P,A,ae,oe,$,Y,!0,F)}else{const[se,oe]=w.getStencilConfigForOverlapAndUpdateStencilID(M);Kl(w,P,A,oe,se,$,Y,!1,F)}}(r,l,d,g,x):c.bU(d)?function(w,P,A,M,j){if(w.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!M.length)return;const{isRenderingToTexture:F}=j,O=P.getSource(),$=w.style.projection.useSubdivision;if(O instanceof Mn)zo(w,P,A,M,null,!1,!1,O.tileCoords,O.flippedWindingOrder,F);else if($){const[Y,se,oe]=w.stencilConfigForOverlapTwoPass(M);zo(w,P,A,oe,Y,!1,!0,Va,!1,F),zo(w,P,A,oe,se,!0,!0,Va,!1,F)}else{const[Y,se]=w.getStencilConfigForOverlapAndUpdateStencilID(M);zo(w,P,A,se,Y,!1,!0,Va,!1,F)}}(r,l,d,g,x):c.cu(d)?function(w,P,A,M,j){const F=A.paint.get("background-color"),O=A.paint.get("background-opacity");if(O===0)return;const{isRenderingToTexture:$}=j,Y=w.context,se=Y.gl,oe=w.style.projection,ae=w.transform,he=ae.tileSize,ge=A.paint.get("background-pattern");if(w.isPatternMissing(ge))return;const ce=!ge&&F.a===1&&O===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ce)return;const fe=Jt.disabled,xe=w.getDepthModeForSublayer(0,ce==="opaque"?Vt.ReadWrite:Vt.ReadOnly),pe=w.colorModeForRenderPass(),Te=w.useProgram(ge?"backgroundPattern":"background"),Oe=M||Un(ae,{tileSize:he,terrain:w.style.map.terrain});ge&&(Y.activeTexture.set(se.TEXTURE0),w.imageManager.bind(w.context));const Me=A.getCrossfadeParameters();for(const De of Oe){const je=ae.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),et=ge?V_(O,w,ge,{tileID:De,tileSize:he},Me):kd(O,F),nt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(De),He=oe.getMeshFromTileID(Y,De.canonical,!1,!0,"raster");Te.draw(Y,se.TRIANGLES,xe,fe,pe,Yt.backCCW,et,nt,je,A.id,He.vertexBuffer,He.indexBuffer,He.segments)}}(r,0,d,g,x):c.cv(d)&&function(w,P,A,M){const{isRenderingGlobe:j}=M,F=w.context,O=A.implementation,$=w.style.projection,Y=w.transform,se=Y.getProjectionDataForCustomLayer(j),oe={farZ:Y.farZ,nearZ:Y.nearZ,fov:Y.fov*Math.PI/180,modelViewProjectionMatrix:Y.modelViewProjectionMatrix,projectionMatrix:Y.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:se},ae=O.renderingMode?O.renderingMode:"2d";if(w.renderPass==="offscreen"){const he=O.prerender;he&&(w.setCustomLayerDefaults(),F.setColorMode(w.colorModeForRenderPass()),he.call(O,F.gl,oe),F.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),F.setColorMode(w.colorModeForRenderPass()),F.setStencilMode(Jt.disabled);const he=ae==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,Vt.ReadOnly);F.setDepthMode(he),O.render(F.gl,oe),F.setDirty(),w.setBaseState(),F.bindFramebuffer.set(null)}}(r,0,d,x))}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),d=this.imageManager.getPattern(r.to.toString());return!l||!d}useProgram(r,l,d=!1,g=[]){this.cache=this.cache||{};const x=!!this.style.map.terrain,w=this.style.projection,P=d?zn.projectionMercator:w.shaderPreludeCode,A=d?ii:w.shaderDefine,M=r+(l?l.cacheKey:"")+`/${d?Ii:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(x?"/terrain":"")+(g?`/${g.join("/")}`:"");return this.cache[M]||(this.cache[M]=new am(this.context,zn[r],l,U_[r],this._showOverdrawInspector,x,P,A,g)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var r,l;if(this._tileTextures){for(const d in this._tileTextures){const g=this._tileTextures[d];if(g)for(const x of g)x.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((r=this.tileExtentMesh.vertexBuffer)===null||r===void 0||r.destroy()),this.tileExtentMesh&&((l=this.tileExtentMesh.indexBuffer)===null||l===void 0||l.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const d in this.cache){const g=this.cache[d];g&&g.program&&this.context.gl.deleteProgram(g.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:l}=this.context.gl;return this.width!==r||this.height!==l}}function Bd(v,r){let l,d=!1,g=null,x=null;const w=()=>{g=null,d&&(v.apply(x,l),g=setTimeout(w,r),d=!1)};return(...P)=>(d=!0,x=this,l=P,g||w(),g)}class Vd{constructor(r){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(!this._isValidHash(l))return!1;const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,l)},this._removeHash=()=>{const l=this._getCurrentHash();if(l.length===0)return;const d=l.join("/");let g=d;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${d}`);let x=window.location.hash.replace(g,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let w=window.location.href.replace(/(#.+)?$/,x);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=Bd(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(r){const l=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),w=Math.round(l.lng*x)/x,P=Math.round(l.lat*x)/x,A=this._map.getBearing(),M=this._map.getPitch();let j="";if(j+=r?`/${w}/${P}/${d}`:`${d}/${P}/${w}`,(A||M)&&(j+="/"+Math.round(10*A)/10),M&&(j+=`/${Math.round(M)}`),this._hashName){const F=this._hashName;let O=!1;const $=window.location.hash.slice(1).split("&").map(Y=>{const se=Y.split("=")[0];return se===F?(O=!0,`${se}=${j}`):Y}).filter(Y=>Y);return O||$.push(`${F}=${j}`),`#${$.join("&")}`}return`#${j}`}_isValidHash(r){if(r.length<3||r.some(isNaN))return!1;try{new c.V(+r[2],+r[1])}catch{return!1}const l=+r[0],d=+(r[3]||0),g=+(r[4]||0);return l>=this._map.getMinZoom()&&l<=this._map.getMaxZoom()&&d>=-180&&d<=180&&g>=this._map.getMinPitch()&&g<=this._map.getMaxPitch()}}const da={linearity:.3,easing:c.cw(0,0,.3,1)},Lm=c.e({deceleration:2500,maxSpeed:1400},da),$i=c.e({deceleration:20,maxSpeed:1400},da),ns=c.e({deceleration:1e3,maxSpeed:360},da),zm=c.e({deceleration:1e3,maxSpeed:90},da),rs=c.e({deceleration:1e3,maxSpeed:360},da);class Y_{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:te(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=te();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,l.roll+=x.rollDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const x=Jl(l.pan.mag(),d,c.e({},Lm,r||{})),w=l.pan.mult(x.amount/l.pan.mag()),P=this._map.cameraHelper.handlePanInertia(w,this._map.transform);g.center=P.easingCenter,g.offset=P.easingOffset,Yl(g,x)}if(l.zoom){const x=Jl(l.zoom,d,$i);g.zoom=this._map.transform.zoom+x.amount,Yl(g,x)}if(l.bearing){const x=Jl(l.bearing,d,ns);g.bearing=this._map.transform.bearing+c.an(x.amount,-179,179),Yl(g,x)}if(l.pitch){const x=Jl(l.pitch,d,zm);g.pitch=this._map.transform.pitch+x.amount,Yl(g,x)}if(l.roll){const x=Jl(l.roll,d,rs);g.roll=this._map.transform.roll+c.an(x.amount,-179,179),Yl(g,x)}if(g.zoom||g.bearing){const x=l.pinchAround===void 0?l.around:l.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),c.e(g,{noMoveStart:!0})}}function Yl(v,r){(!v.duration||v.duration<r.duration)&&(v.duration=r.duration,v.easing=r.easing)}function Jl(v,r,l){const{maxSpeed:d,linearity:g,deceleration:x}=l,w=c.an(v*g/(r/1e3),-d,d),P=Math.abs(w)/(x*g);return{easing:l.easing,duration:1e3*P,amount:w*(P/2)}}class Pr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,d,g={}){d=d instanceof MouseEvent?d:new MouseEvent(r,d);const x=G.mousePos(l.getCanvas(),d),w=l.unproject(x);super(r,c.e({point:x,lngLat:w,originalEvent:d},g)),this._defaultPrevented=!1,this.target=l}}class Ql extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,d){const g=r==="touchend"?d.changedTouches:d.touches,x=G.touchPos(l.getCanvasContainer(),g),w=x.map(A=>l.unproject(A)),P=x.reduce((A,M,j,F)=>A.add(M.div(F.length)),new c.P(0,0));super(r,{points:x,point:P,lngLats:w,lngLat:l.unproject(P),originalEvent:d}),this._defaultPrevented=!1}}class Om extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,d){super(r,{originalEvent:d}),this._defaultPrevented=!1}}class J_{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Om(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Pr(r.type,this._map,r))}mouseup(r){this._map.fire(new Pr(r.type,this._map,r))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new Pr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Pr(r.type,this._map,r))}mouseover(r){this._map.fire(new Pr(r.type,this._map,r))}mouseout(r){this._map.fire(new Pr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ql(r.type,this._map,r))}touchmove(r){this._map.fire(new Ql(r.type,this._map,r))}touchend(r){this._map.fire(new Ql(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ql(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Q_{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Pr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new Pr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oo{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.screenPointToLocation(c.P.convert(r),this._map.terrain)}}class Fo{constructor(r,l){this._map=r,this._tr=new Oo(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(G.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const d=l;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=G.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const x=Math.min(g.x,d.x),w=Math.max(g.x,d.x),P=Math.min(g.y,d.y),A=Math.max(g.y,d.y);G.setTransform(this._box,`translate(${x}px,${P}px)`),this._box.style.width=w-x+"px",this._box.style.height=A-P+"px"}mouseupWindow(r,l){if(!this._active||r.button!==0)return;const d=this._startPos,g=l;if(this.reset(),G.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(d,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new c.l(r,{originalEvent:l}))}}function is(v,r){if(v.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${r.length}`);const l={};for(let d=0;d<v.length;d++)l[v[d].identifier]=r[d];return l}class dt{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const x=new c.P(0,0);for(const w of g)x._add(w);return x.div(g.length)}(l),this.touches=is(d,l)))}touchmove(r,l,d){if(this.aborted||!this.centroid)return;const g=is(d,l);for(const x in this.touches){const w=g[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,l,d){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Cu{constructor(r){this.singleTap=new dt(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,l,d){this.singleTap.touchstart(r,l,d)}touchmove(r,l,d){this.singleTap.touchmove(r,l,d)}touchend(r,l,d){const g=this.singleTap.touchend(r,l,d);if(g){const x=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(x&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Ud{constructor(r){this._tr=new Oo(r),this._zoomIn=new Cu({numTouches:1,numTaps:2}),this._zoomOut=new Cu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,d){this._zoomIn.touchstart(r,l,d),this._zoomOut.touchstart(r,l,d)}touchmove(r,l,d){this._zoomIn.touchmove(r,l,d),this._zoomOut.touchmove(r,l,d)}touchend(r,l,d){const g=this._zoomIn.touchend(r,l,d),x=this._zoomOut.touchend(r,l,d),w=this._tr;return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(g)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bo{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const l=this._moveFunction(...r);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(r,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=Array.isArray(l)?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,l){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const g=Array.isArray(l)?l[0]:l;return!this._moved&&g.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(d,g))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&G.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ec=0,tc=2,$d={[ec]:1,[tc]:2};class nc{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const l=G.mouseButton(r);this._eventButton=l}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(l,d){const g=$d[d];return l.buttons===void 0||(l.buttons&g)!==g}(r,this._eventButton)}isValidEndEvent(r){return G.mouseButton(r)===this._eventButton}}class Gd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}class Fm{constructor(r=new nc({checkCorrectEvent:()=>!0}),l=new Gd){this.mouseMoveStateManager=r,this.oneFingerTouchMoveStateManager=l}_executeRelevantHandler(r,l,d){return r instanceof MouseEvent?l(r):typeof TouchEvent<"u"&&r instanceof TouchEvent?d(r):void 0}startMove(r){this._executeRelevantHandler(r,l=>this.mouseMoveStateManager.startMove(l),l=>this.oneFingerTouchMoveStateManager.startMove(l))}endMove(r){this._executeRelevantHandler(r,l=>this.mouseMoveStateManager.endMove(l),l=>this.oneFingerTouchMoveStateManager.endMove(l))}isValidStartEvent(r){return this._executeRelevantHandler(r,l=>this.mouseMoveStateManager.isValidStartEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidStartEvent(l))}isValidMoveEvent(r){return this._executeRelevantHandler(r,l=>this.mouseMoveStateManager.isValidMoveEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(l))}isValidEndEvent(r){return this._executeRelevantHandler(r,l=>this.mouseMoveStateManager.isValidEndEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidEndEvent(l))}}const Vo=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=r=>{r.preventDefault()}};class ev{constructor(r,l){this._clickTolerance=r.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(r){return r<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(r,l,d){return this._calculateTransform(r,l,d)}touchmove(r,l,d){if(this._active){if(!this._shouldBePrevented(d.length))return r.preventDefault(),this._calculateTransform(r,l,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",r)}}touchend(r,l,d){this._calculateTransform(r,l,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,d){d.length>0&&(this._active=!0);const g=is(d,l),x=new c.P(0,0),w=new c.P(0,0);let P=0;for(const M in g){const j=g[M],F=this._touches[M];F&&(x._add(j),w._add(j.sub(F)),P++,g[M]=j)}if(this._touches=g,this._shouldBePrevented(P)||!w.mag())return;const A=w.div(P);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(P),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,l,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,d){if(!this._firstTwoTouches)return;r.preventDefault();const[g,x]=this._firstTwoTouches,w=Au(d,l,g),P=Au(d,l,x);if(!w||!P)return;const A=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],A,r)}touchend(r,l,d){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,w=Au(d,l,g),P=Au(d,l,x);w&&P||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Au(v,r,l){for(let d=0;d<v.length;d++)if(v[d].identifier===l)return r[d]}function Bm(v,r){return Math.log(v/r)/Math.LN2}class qd extends ku{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const d=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Bm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bm(this._distance,d),pinchAround:l}}}function Vm(v,r){return 180*v.angleWith(r)/Math.PI}class Wd extends ku{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l,d){const g=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Vm(this._vector,g),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,d=Vm(r,this._startVector);return Math.abs(d)<l}}function Zd(v){return Math.abs(v.y)>Math.abs(v.x)}class Um extends ku{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,l,d){super.touchstart(r,l,d),this._currentTouchCount=d.length}_start(r){this._lastPoints=r,Zd(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=r[0].sub(this._lastPoints[0]),x=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,d.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(r,l,d){if(this._valid!==void 0)return this._valid;const g=r.mag()>=2,x=l.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=r.y>0==l.y>0;return Zd(r)&&Zd(l)&&w}}const pa={panStep:100,bearingStep:15,pitchStep:10};class pn{constructor(r){this._tr=new Oo(r);const l=pa;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,d=0,g=0,x=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?d=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?d=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:P=>{const A=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:tv,zoom:l?Math.round(A.zoom)+l*(r.shiftKey?2:1):A.zoom,bearing:A.bearing+d*this._bearingStep,pitch:A.pitch+g*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:A.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tv(v){return v*(2-v)}const rc=4.000244140625,Iu=1/450;class Mu{constructor(r,l){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=r,this._tr=new Oo(r),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Iu}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(r){return!!this._map.cooperativeGestures.isEnabled()&&!(r.ctrlKey||this._map.cooperativeGestures.isBypassed(r))}wheel(r){if(!this.isEnabled())return;if(this._shouldBePrevented(r))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",r);let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const d=te(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,l!==0&&l%rc==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=G.mousePos(this._map.getCanvas(),r),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(c.V.convert(d.center)):l,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const P=r.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=P),typeof this._targetZoom=="number"&&(this._targetZoom+=P)}if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>rc?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&A!==0&&(A=1/A);const M=typeof this._targetZoom!="number"?r.scale:c.aq(this._targetZoom);this._targetZoom=r.applyConstrain(r.getCameraLngLat(),c.at(M*A)).zoom,this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom!="number"?r.zoom:this._targetZoom,d=this._startZoom,g=this._easing;let x,w=!1;if(this._type==="wheel"&&d&&g){const P=te()-this._lastWheelEventTime,A=Math.min((P+5)/200,1),M=g(A);x=c.G.number(d,l,M),A<1?this._frameId||(this._frameId=!0):w=!0}else x=l,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!w,zoomDelta:x-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=c.cy;if(this._prevEase){const d=this._prevEase,g=(te()-d.start)/d.duration,x=d.easing(g+.01)-d.easing(g),w=.27/Math.sqrt(x*x+1e-4)*.01,P=Math.sqrt(.0729-w*w);l=c.cw(w,P,.25,1)}return this._prevEase={start:te(),duration:r,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Hd{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $m{constructor(r){this._tr=new Oo(r),this.reset()}reset(){this._active=!1}dblclick(r,l){return r.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gm{constructor(){this._tap=new Cu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,l,d){if(!this._swipePoint)if(this._tapTime){const g=l[0],x=r.timeStamp-this._tapTime<500,w=this._tapPoint.dist(g)<30;x&&w?d.length>0&&(this._swipePoint=g,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(r,l,d)}touchmove(r,l,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=l[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,l,d)}touchend(r,l,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const g=this._tap.touchend(r,l,d);g&&(this._tapTime=r.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qm{constructor(r,l,d){this._el=r,this._mousePan=l,this._touchPan=d}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ss{constructor(r,l,d,g){this._pitchWithRotate=r.pitchWithRotate,this._rollEnabled=r.rollEnabled,this._mouseRotate=l,this._mousePitch=d,this._mouseRoll=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ic{constructor(r,l,d,g){this._el=r,this._touchZoom=l,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class _t{constructor(r,l){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=l,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=G.create("div","maplibregl-cooperative-gesture-screen",r);let l=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(l=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=l,this._container.appendChild(g);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=d,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(G.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(r){return r[this._bypassKey]}notifyGestureBlocked(r,l){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:r,originalEvent:l})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const St=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class sc extends c.l{}function Ru(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class Du{constructor(r,l){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,x)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=g.type==="renderFrame"?void 0:g,P={needsRenderFrame:!1},A={},M={};for(const{handlerName:O,handler:$,allowed:Y}of this._handlers){if(!$.isEnabled())continue;let se;if(this._blockedByActive(M,Y,O))$.reset();else if($[x||g.type]){if(c.cz(g,x||g.type)){const oe=G.mousePos(this._map.getCanvas(),g);se=$[x||g.type](g,oe)}else if(c.cA(g,x||g.type)){const oe=this._getMapTouches(g.touches),ae=G.touchPos(this._map.getCanvas(),oe);se=$[x||g.type](g,ae,oe)}else c.cB(x||g.type)||(se=$[x||g.type](g));this.mergeHandlerResult(P,A,se,O,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||$.isActive())&&(M[O]=$)}const j={};for(const O in this._previousActiveHandlers)M[O]||(j[O]=w);this._previousActiveHandlers=M,(Object.keys(j).length||Ru(P))&&(this._changes.push([P,A,j]),this._triggerRenderFrame()),(Object.keys(M).length||Ru(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=P;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Y_(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,w]of this._listeners)G.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[r,l,d]of this._listeners)G.removeEventListener(r,l,r===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(r){const l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new J_(l,r));const g=l.boxZoom=new Fo(l,r);this._add("boxZoom",g),r.interactive&&r.boxZoom&&g.enable();const x=l.cooperativeGestures=new _t(l,r.cooperativeGestures);this._add("cooperativeGestures",x),r.cooperativeGestures&&x.enable();const w=new Ud(l),P=new $m(l);l.doubleClickZoom=new Hd(P,w),this._add("tapZoom",w),this._add("clickZoom",P),r.interactive&&r.doubleClickZoom&&l.doubleClickZoom.enable();const A=new Gm;this._add("tapDragZoom",A);const M=l.touchPitch=new Um(l);this._add("touchPitch",M),r.interactive&&r.touchPitch&&l.touchPitch.enable(r.touchPitch);const j=()=>l.project(l.getCenter()),F=function({enable:ce,clickTolerance:fe,aroundCenter:xe=!0,minPixelCenterThreshold:pe=100,rotateDegreesPerPixelMoved:Te=.8},Oe){const Me=new nc({checkCorrectEvent:De=>G.mouseButton(De)===0&&De.ctrlKey||G.mouseButton(De)===2&&!De.ctrlKey});return new Bo({clickTolerance:fe,move:(De,je)=>{const et=Oe();if(xe&&Math.abs(et.y-De.y)>pe)return{bearingDelta:c.cx(new c.P(De.x,je.y),je,et)};let nt=(je.x-De.x)*Te;return xe&&je.y<et.y&&(nt=-nt),{bearingDelta:nt}},moveStateManager:Me,enable:ce,assignEvents:Vo})}(r,j),O=function({enable:ce,clickTolerance:fe,pitchDegreesPerPixelMoved:xe=-.5}){const pe=new nc({checkCorrectEvent:Te=>G.mouseButton(Te)===0&&Te.ctrlKey||G.mouseButton(Te)===2});return new Bo({clickTolerance:fe,move:(Te,Oe)=>({pitchDelta:(Oe.y-Te.y)*xe}),moveStateManager:pe,enable:ce,assignEvents:Vo})}(r),$=function({enable:ce,clickTolerance:fe,rollDegreesPerPixelMoved:xe=.3},pe){const Te=new nc({checkCorrectEvent:Oe=>G.mouseButton(Oe)===2&&Oe.ctrlKey});return new Bo({clickTolerance:fe,move:(Oe,Me)=>{const De=pe();let je=(Me.x-Oe.x)*xe;return Me.y<De.y&&(je=-je),{rollDelta:je}},moveStateManager:Te,enable:ce,assignEvents:Vo})}(r,j);l.dragRotate=new ss(r,F,O,$),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",O,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),r.interactive&&r.dragRotate&&l.dragRotate.enable();const Y=function({enable:ce,clickTolerance:fe}){const xe=new nc({checkCorrectEvent:pe=>G.mouseButton(pe)===0&&!pe.ctrlKey});return new Bo({clickTolerance:fe,move:(pe,Te)=>({around:Te,panDelta:Te.sub(pe)}),activateOnStart:!0,moveStateManager:xe,enable:ce,assignEvents:Vo})}(r),se=new ev(r,l);l.dragPan=new qm(d,Y,se),this._add("mousePan",Y),this._add("touchPan",se,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&l.dragPan.enable(r.dragPan);const oe=new Wd,ae=new qd;l.touchZoomRotate=new ic(d,ae,oe,A),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&l.touchZoomRotate.enable(r.touchZoomRotate),this._add("blockableMapEvent",new Q_(l));const he=l.scrollZoom=new Mu(l,()=>this._triggerRenderFrame());this._add("scrollZoom",he,["mousePan"]),r.interactive&&r.scrollZoom&&l.scrollZoom.enable(r.scrollZoom);const ge=l.keyboard=new pn(l);this._add("keyboard",ge),r.interactive&&r.keyboard&&l.keyboard.enable()}_add(r,l,d){this._handlers.push({handlerName:r,handler:l,allowed:d}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!St(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,l,d){for(const g in r)if(g!==d&&(!l||l.indexOf(g)<0))return!0;return!1}_getMapTouches(r){const l=[];for(const d of r)this._el.contains(d.target)&&l.push(d);return l}mergeHandlerResult(r,l,d,g,x){if(!d)return;c.e(r,d);const w={handlerName:g,originalEvent:d.originalEvent||x};d.zoomDelta!==void 0&&(l.zoom=w),d.panDelta!==void 0&&(l.drag=w),d.rollDelta!==void 0&&(l.roll=w),d.pitchDelta!==void 0&&(l.pitch=w),d.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const r={},l={},d={};for(const[g,x,w]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new c.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.rollDelta&&(r.rollDelta=(r.rollDelta||0)+g.rollDelta),g.around!==void 0&&(r.around=g.around),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),c.e(l,x),c.e(d,w);this._updateMapTransform(r,l,d),this._changes=[]}_updateMapTransform(r,l,d){const g=this._map,x=g._getTransformForUpdate(),w=g.terrain;if(!(Ru(r)||w&&this._terrainMovement))return this._fireEvents(l,d,!0);g._stop(!0);let{panDelta:P,zoomDelta:A,bearingDelta:M,pitchDelta:j,rollDelta:F,around:O,pinchAround:$}=r;$!==void 0&&(O=$),O=O||g.transform.centerPoint,w&&!x.isPointOnMapSurface(O)&&(O=x.centerPoint);const Y={panDelta:P,zoomDelta:A,rollDelta:F,pitchDelta:j,bearingDelta:M,around:O};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(O)&&(O=x.centerPoint);const se=O.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(P?O.sub(P):O);this._handleMapControls({terrain:w,tr:x,deltasForHelper:Y,preZoomAroundLoc:se,combinedEventsInProgress:l,panDelta:P}),g._applyUpdatedTransform(x),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,d,!0)}_handleMapControls({terrain:r,tr:l,deltasForHelper:d,preZoomAroundLoc:g,combinedEventsInProgress:x,panDelta:w}){const P=this._map.cameraHelper;if(P.handleMapControlsRollPitchBearingZoom(d,l),r)return P.useGlobeControls?(this._terrainMovement||!x.drag&&!x.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void P.handleMapControlsPan(d,l,g)):this._terrainMovement||!x.drag&&!x.zoom?void(x.drag&&this._terrainMovement&&w?l.setCenter(l.screenPointToLocation(l.centerPoint.sub(w))):P.handleMapControlsPan(d,l,g)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void P.handleMapControlsPan(d,l,g));P.handleMapControlsPan(d,l,g)}_fireEvents(r,l,d){const g=St(this._eventsInProgress),x=St(r),w={};for(const F in r){const{originalEvent:O}=r[F];this._eventsInProgress[F]||(w[`${F}start`]=O),this._eventsInProgress[F]=r[F]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in w)this._fireEvent(F,w[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in r){const{originalEvent:O}=r[F];this._fireEvent(F,O)}const P={};let A;for(const F in this._eventsInProgress){const{handlerName:O,originalEvent:$}=this._eventsInProgress[F];this._handlersById[O].isActive()||(delete this._eventsInProgress[F],A=l[O]||$,P[`${F}end`]=A)}for(const F in P)this._fireEvent(F,P[F]);const M=St(this._eventsInProgress),j=(g||x)&&!M;if(j&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(d&&j){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!F||!F.essential&&X.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:A})),O(this._map.getBearing())&&this._map.resetNorth()):(O(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new c.l(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new sc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class oi extends c.E{constructor(r,l,d){super(),this._renderFrameCallback=()=>{const g=Math.min((te()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=d.bearingSnap,this.cameraHelper=l,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(r,l){r.apply(this.transform,!0),this.transform=r,this.cameraHelper=l}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}getCenterElevation(){return this.transform.elevation}setCenterElevation(r,l){return this.jumpTo({elevation:r},l),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(r){this._centerClampedToGround=r}panBy(r,l,d){return r=c.P.convert(r).mult(-1),this.panTo(this.transform.center,c.e({offset:r},l),d)}panTo(r,l,d){return this.easeTo(c.e({center:r},l),d)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,d){return this.easeTo(c.e({zoom:r},l),d)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(r,l){return r!=this.transform.fov&&(this.transform.setFov(r),this.fire(new c.l("movestart",l)).fire(new c.l("move",l)).fire(new c.l("moveend",l))),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,d){return this.easeTo(c.e({bearing:r},l),d)}resetNorth(r,l){return this.rotateTo(0,c.e({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}getRoll(){return this.transform.roll}setRoll(r,l){return this.jumpTo({roll:r},l),this}cameraForBounds(r,l){r=In.convert(r).adjustAntiMeridian();const d=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),d,l)}_cameraForBoxAndBearing(r,l,d,g){const x={top:0,bottom:0,right:0,left:0};if(typeof(g=c.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const M=g.padding;g.padding={top:M,bottom:M,right:M,left:M}}const w=c.e(x,g.padding);g.padding=w;const P=this.transform,A=new In(r,l);return this.cameraHelper.cameraForBoxAndBearing(g,w,A,d,P)}fitBounds(r,l,d){return this._fitInternal(this.cameraForBounds(r,l),l,d)}fitScreenCoordinates(r,l,d,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(r)),this.transform.screenPointToLocation(c.P.convert(l)),d,g),g,x)}_fitInternal(r,l,d){return r?(delete(l=c.e(r,l)).padding,l.linear?this.easeTo(l,d):this.flyTo(l,d)):this}jumpTo(r,l){this.stop();const d=this._getTransformForUpdate();let g=!1,x=!1,w=!1;const P=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,r);const A=d.zoom!==P;return"elevation"in r&&d.elevation!==+r.elevation&&d.setElevation(+r.elevation),"bearing"in r&&d.bearing!==+r.bearing&&(g=!0,d.setBearing(+r.bearing)),"pitch"in r&&d.pitch!==+r.pitch&&(x=!0,d.setPitch(+r.pitch)),"roll"in r&&d.roll!==+r.roll&&(w=!0,d.setRoll(+r.roll)),r.padding==null||d.isPaddingEqual(r.padding)||d.setPadding(r.padding),this._applyUpdatedTransform(d),this.fire(new c.l("movestart",l)).fire(new c.l("move",l)),A&&this.fire(new c.l("zoomstart",l)).fire(new c.l("zoom",l)).fire(new c.l("zoomend",l)),g&&this.fire(new c.l("rotatestart",l)).fire(new c.l("rotate",l)).fire(new c.l("rotateend",l)),x&&this.fire(new c.l("pitchstart",l)).fire(new c.l("pitch",l)).fire(new c.l("pitchend",l)),w&&this.fire(new c.l("rollstart",l)).fire(new c.l("roll",l)).fire(new c.l("rollend",l)),this.fire(new c.l("moveend",l))}calculateCameraOptionsFromTo(r,l,d,g=0){const x=c.a9.fromLngLat(r,l),w=c.a9.fromLngLat(d,g),P=w.x-x.x,A=w.y-x.y,M=w.z-x.z,j=Math.hypot(P,A,M);if(j===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(P,A),O=c.at(this.transform.cameraToCenterDistance/j/this.transform.tileSize),$=180*Math.atan2(P,-A)/Math.PI;let Y=180*Math.acos(F/j)/Math.PI;return Y=M<0?90-Y:90+Y,{center:w.toLngLat(),elevation:g,zoom:O,pitch:Y,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(r,l,d,g,x){const w=this.transform.calculateCenterFromCameraLngLatAlt(r,l,d,g);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:d,pitch:g,roll:x}}easeTo(r,l){this._stop(!1,r.easeId),((r=c.e({offset:[0,0],duration:500,easing:c.cy},r)).animate===!1||!r.essential&&X.prefersReducedMotion)&&(r.duration=0);const d=this._getTransformForUpdate(),g=this.getBearing(),x=d.pitch,w=d.roll,P="bearing"in r?this._normalizeBearing(r.bearing,g):g,A="pitch"in r?+r.pitch:x,M="roll"in r?this._normalizeBearing(r.roll,w):w,j="padding"in r?r.padding:d.padding,F=c.P.convert(r.offset);let O,$;r.around&&(O=c.V.convert(r.around),$=d.locationToScreenPoint(O));const Y={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(d,{bearing:P,pitch:A,roll:M,padding:j,around:O,aroundPoint:$,offsetAsPoint:F,offset:r.offset,zoom:r.zoom,center:r.center});return this._rotating=this._rotating||g!==P,this._pitching=this._pitching||A!==x,this._rolling=this._rolling||M!==w,this._padding=!d.isPaddingEqual(j),this._zooming=this._zooming||se.isZooming,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Y),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease(oe=>{se.easeFunc(oe),this.terrain&&!r.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(d),this._fireMoveEvents(l)},oe=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(l,oe)},r),this}_prepareEase(r,l,d={}){this._moving=!0,l||d.moving||this.fire(new c.l("movestart",r)),this._zooming&&!d.zooming&&this.fire(new c.l("zoomstart",r)),this._rotating&&!d.rotating&&this.fire(new c.l("rotatestart",r)),this._pitching&&!d.pitching&&this.fire(new c.l("pitchstart",r)),this._rolling&&!d.rolling&&this.fire(new c.l("rollstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&l!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(d-(l-(d*r+this._elevationStart))/(1-r)),this._elevationTarget=l}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,r))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(r){if(!this.terrain&&r.elevation>=0&&r.pitch<=90)return{};const l=r.getCameraLngLat(),d=r.getCameraAltitude(),g=this.terrain?this.terrain.getElevationForLngLatZoom(l,r.zoom):0;if(d<g){const x=this.calculateCameraOptionsFromTo(l,g,r.center,r.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(r){const l=[];if(l.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&l.push(g=>this.transformCameraUpdate(g)),!l.length)return;const d=r.clone();for(const g of l){const x=d.clone(),{center:w,zoom:P,roll:A,pitch:M,bearing:j,elevation:F}=g(x);w&&x.setCenter(w),F!==void 0&&x.setElevation(F),P!==void 0&&x.setZoom(P),A!==void 0&&x.setRoll(A),M!==void 0&&x.setPitch(M),j!==void 0&&x.setBearing(j),d.apply(x,!1)}this.transform.apply(d,!1)}_fireMoveEvents(r){this.fire(new c.l("move",r)),this._zooming&&this.fire(new c.l("zoom",r)),this._rotating&&this.fire(new c.l("rotate",r)),this._pitching&&this.fire(new c.l("pitch",r)),this._rolling&&this.fire(new c.l("roll",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const d=this._zooming,g=this._rotating,x=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new c.l("zoomend",r)),g&&this.fire(new c.l("rotateend",r)),x&&this.fire(new c.l("pitchend",r)),w&&this.fire(new c.l("rollend",r)),this.fire(new c.l("moveend",r))}flyTo(r,l){if(!r.essential&&X.prefersReducedMotion){const je=c.U(r,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(je,l)}this.stop(),r=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cy},r);const d=this._getTransformForUpdate(),g=d.bearing,x=d.pitch,w=d.roll,P=d.padding,A="bearing"in r?this._normalizeBearing(r.bearing,g):g,M="pitch"in r?+r.pitch:x,j="roll"in r?this._normalizeBearing(r.roll,w):w,F="padding"in r?r.padding:d.padding,O=c.P.convert(r.offset);let $=d.centerPoint.add(O);const Y=d.screenPointToLocation($),se=this.cameraHelper.handleFlyTo(d,{bearing:A,pitch:M,roll:j,padding:F,locationAtOffset:Y,offsetAsPoint:O,center:r.center,minZoom:r.minZoom,zoom:r.zoom});let oe=r.curve;const ae=Math.max(d.width,d.height),he=ae/se.scaleOfZoom,ge=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(oe=Math.sqrt(ae/se.scaleOfMinZoom/ge*2));const ce=oe*oe;function fe(je){const et=(he*he-ae*ae+(je?-1:1)*ce*ce*ge*ge)/(2*(je?he:ae)*ce*ge);return Math.log(Math.sqrt(et*et+1)-et)}function xe(je){return(Math.exp(je)-Math.exp(-je))/2}function pe(je){return(Math.exp(je)+Math.exp(-je))/2}const Te=fe(!1);let Oe=function(je){return pe(Te)/pe(Te+oe*je)},Me=function(je){return ae*((pe(Te)*(xe(et=Te+oe*je)/pe(et))-xe(Te))/ce)/ge;var et},De=(fe(!0)-Te)/oe;if(Math.abs(ge)<2e-6||!isFinite(De)){if(Math.abs(ae-he)<1e-6)return this.easeTo(r,l);const je=he<ae?-1:1;De=Math.abs(Math.log(he/ae))/oe,Me=()=>0,Oe=et=>Math.exp(je*oe*et)}return r.duration="duration"in r?+r.duration:1e3*De/("screenSpeed"in r?+r.screenSpeed/oe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=g!==A,this._pitching=M!==x,this._rolling=j!==w,this._padding=!d.isPaddingEqual(F),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease(je=>{const et=je*De,nt=1/Oe(et),He=Me(et);this._rotating&&d.setBearing(c.G.number(g,A,je)),this._pitching&&d.setPitch(c.G.number(x,M,je)),this._rolling&&d.setRoll(c.G.number(w,j,je)),this._padding&&(d.interpolatePadding(P,F,je),$=d.centerPoint.add(O)),se.easeFunc(je,nt,He,$),this.terrain&&!r.freezeElevation&&this._updateElevation(je),this._applyUpdatedTransform(d),this._fireMoveEvents(l)},()=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(l)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,l)}return r||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(r,l,d){d.animate===!1||d.duration===0?(r(1),l()):(this._easeStart=te(),this._easeOptions=d,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,l){r=c.W(r,-180,180);const d=Math.abs(r-l);return Math.abs(r-360-l)<d&&(r-=360),Math.abs(r+360-l)<d&&(r+=360),r}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(r),this.transform):null}}const Gi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Kd{constructor(r=Gi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=G.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=G.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const d=this._map._getUIString(`AttributionControl.${l}`);r.title=d,r.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style.tileManagers;for(const g in l){const x=l[g];if(x.used||x.usedForTerrain){const w=x.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r=r.filter(g=>String(g).trim()),r.sort((g,x)=>g.length-x.length),r=r.filter((g,x)=>{for(let w=x+1;w<r.length;w++)if(r[w].indexOf(g)>=0)return!1;return!0});const d=r.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,r.length?(this._innerContainer.innerHTML=G.sanitize(d),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Wm{constructor(r={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=G.create("div","maplibregl-ctrl");const l=G.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){G.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class nv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,d=l?this._queue.concat(l):this._queue;for(const g of d)if(g.id===r)return void(g.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const d of l)if(!d.cancelled&&(d.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var rv=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class ac extends c.E{constructor(r){super(),this._lastTilesetChange=te(),this.tileManager=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=r._source.tileSize*2**this.deltaZoom,r.usedForTerrain=!0,r.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(r,l){this.tileManager.update(r,l),this._renderableTilesKeys=[];const d={};for(const g of Un(r,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l,calculateTileZoom:this.tileManager._source.calculateTileZoom}))d[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.terrainRttPosMatrix32f=new Float64Array(16),c.c7(g.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[g.key]=new Xe(g,this.tileSize),this._lastTilesetChange=te());for(const g in this._tiles)d[g]||delete this._tiles[g]}freeRtt(r){for(const l in this._tiles){const d=this._tiles[l];(!r||d.tileID.equals(r)||d.tileID.isChildOf(r)||r.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r,l){return l?this._getTerrainCoordsForTileRanges(r,l):this._getTerrainCoordsForRegularTile(r)}_getTerrainCoordsForRegularTile(r){const l={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID,x=r.clone(),w=c.bk();if(g.canonical.equals(r.canonical))c.c7(w,0,c.a5,c.a5,0,0,1);else if(g.canonical.isChildOf(r.canonical)){const P=g.canonical.z-r.canonical.z,A=g.canonical.x-(g.canonical.x>>P<<P),M=g.canonical.y-(g.canonical.y>>P<<P),j=c.a5>>P;c.c7(w,0,j,j,0,0,1),c.O(w,w,[-A*j,-M*j,0])}else{if(!r.canonical.isChildOf(g.canonical))continue;{const P=r.canonical.z-g.canonical.z,A=r.canonical.x-(r.canonical.x>>P<<P),M=r.canonical.y-(r.canonical.y>>P<<P),j=c.a5>>P;c.c7(w,0,c.a5,c.a5,0,0,1),c.O(w,w,[A*j,M*j,0]),c.Q(w,w,[1/2**P,1/2**P,0])}}x.terrainRttPosMatrix32f=new Float32Array(w),l[d]=x}return l}_getTerrainCoordsForTileRanges(r,l){const d={};for(const g of this._renderableTilesKeys){const x=this._tiles[g].tileID;if(!this._isWithinTileRanges(x,l))continue;const w=r.clone(),P=c.bk();if(x.canonical.z===r.canonical.z){const A=r.canonical.x-x.canonical.x+r.wrap*(1<<r.canonical.z),M=r.canonical.y-x.canonical.y;c.c7(P,0,c.a5,c.a5,0,0,1),c.O(P,P,[A*c.a5,M*c.a5,0])}else if(x.canonical.z>r.canonical.z){const A=x.canonical.z-r.canonical.z,M=x.canonical.x-(x.canonical.x>>A<<A)+r.wrap*(1<<x.canonical.z),j=x.canonical.y-(x.canonical.y>>A<<A),F=r.canonical.x-(x.canonical.x>>A),O=r.canonical.y-(x.canonical.y>>A),$=c.a5>>A;c.c7(P,0,$,$,0,0,1),c.O(P,P,[-M*$+F*c.a5,-j*$+O*c.a5,0])}else{const A=r.canonical.z-x.canonical.z,M=r.canonical.x-(r.canonical.x>>A<<A)+r.wrap*(1<<r.canonical.z),j=r.canonical.y-(r.canonical.y>>A<<A),F=(r.canonical.x>>A)-x.canonical.x,O=(r.canonical.y>>A)-x.canonical.y,$=c.a5<<A;c.c7(P,0,$,$,0,0,1),c.O(P,P,[M*c.a5+F*$,j*c.a5+O*$,0])}w.terrainRttPosMatrix32f=new Float32Array(P),d[g]=w}return d}getSourceTile(r,l){const d=this.tileManager._source;let g=r.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(g).key);let x=this.findTileInCaches(this._sourceTileCache[r.key]);if(!(x!=null&&x.dem)&&l)for(;g>=d.minzoom&&!(x!=null&&x.dem);)x=this.findTileInCaches(r.scaledTo(g--).key);return x}findTileInCaches(r){let l=this.tileManager.getTileByID(r);return l||(l=this.tileManager._outOfViewCache.getByKey(r),l)}anyTilesAfterTime(r=Date.now()){return this._lastTilesetChange>=r}_isWithinTileRanges(r,l){const d=l[r.canonical.z];return!!d&&(r.wrap>d.minWrap||r.wrap<d.maxWrap||r.canonical.x>=d.minTileXWrapped&&r.canonical.x<=d.maxTileXWrapped&&r.canonical.y>=d.minTileY&&r.canonical.y<=d.maxTileY)}}class On{constructor(r,l,d){this._meshCache={},this.painter=r,this.tileManager=new ac(l),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,l,d,g=c.a5){var x;if(!(l>=0&&l<g&&d>=0&&d<g))return 0;const w=this.getTerrainData(r),P=(x=w.tile)===null||x===void 0?void 0:x.dem;if(!P)return 0;const A=c.cC([],[l/g*c.a5,d/g*c.a5],w.u_terrain_matrix),M=[A[0]*P.dim,A[1]*P.dim],j=Math.floor(M[0]),F=Math.floor(M[1]),O=M[0]-j,$=M[1]-F;return P.get(j,F)*(1-O)*(1-$)+P.get(j+1,F)*O*(1-$)+P.get(j,F+1)*(1-O)*$+P.get(j+1,F+1)*O*$}getElevationForLngLatZoom(r,l){if(!c.cD(l,r.wrap()))return 0;const{tileID:d,mercatorX:g,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(r,l);return this.getElevation(d,g%c.a5,x%c.a5,c.a5)}getElevationForLngLat(r,l){const d=Un(l,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let g=0;for(const x of d)x.canonical.z>g&&(g=Math.min(x.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(r,g)}getElevation(r,l,d,g=c.a5){return this.getDEMElevation(r,l,d,g)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const g=this.painter.context,x=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(g,new c.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const l=this.tileManager.getSourceTile(r,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const g=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new c.T(g,l.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),l.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const d=l&&l.toString()+l.tileID.key+r.key;if(d&&!this._demMatrixCache[d]){const g=this.tileManager.getSource().maxzoom;let x=r.canonical.z-l.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=g?x=r.canonical.z-g:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=r.canonical.x-(r.canonical.x>>x<<x),P=r.canonical.y-(r.canonical.y>>x<<x),A=c.cE(new Float64Array(16),[1/(c.a5<<x),1/(c.a5<<x),0]);c.O(A,A,[w*c.a5,P*c.a5,0]),this._demMatrixCache[r.key]={matrix:A,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(r){const l=this.painter,d=l.width/devicePixelRatio,g=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(l.context,{width:d,height:g,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(l.context,{width:d,height:g,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(d,g,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,w=0;x<this._coordsTextureSize;x++)for(let P=0;P<this._coordsTextureSize;P++,w+=4)l[w+0]=255&P,l[w+1]=255&x,l[w+2]=P>>8<<4|x>>8,l[w+3]=0;const d=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),g=new c.T(r,d,r.gl.RGBA,{premultiply:!1});return g.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const l=new Uint8Array(4),d=this.painter.context,g=d.gl,x=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(x,P-w-1,1,1,g.RGBA,g.UNSIGNED_BYTE,l),d.bindFramebuffer.set(null);const A=l[0]+(l[2]>>4<<8),M=l[1]+((15&l[2])<<8),j=this.coordsIndex[255-l[3]],F=j&&this.tileManager.getTileByID(j);if(!F)return null;const O=this._coordsTextureSize,$=(1<<F.tileID.canonical.z)*O;return new c.a9((F.tileID.canonical.x*O+A)/$+F.tileID.wrap,(F.tileID.canonical.y*O+M)/$,this.getElevation(F.tileID,A,M,O))}depthAtPoint(r){const l=new Uint8Array(4),d=this.painter.context,g=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,l),d.bindFramebuffer.set(null),(l[0]/16777216+l[1]/65536+l[2]/256+l[3])/256}getTerrainMesh(r){var l;const d=((l=this.painter.style.projection)===null||l===void 0?void 0:l.transitionState)>0,g=d&&r.canonical.y===0,x=d&&r.canonical.y===(1<<r.canonical.z)-1,w=`m_${g?"n":""}_${x?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const P=this.painter.context,A=new c.cF,M=new c.aY,j=this.meshSize,F=c.a5/j,O=j*j;for(let pe=0;pe<=j;pe++)for(let Te=0;Te<=j;Te++)A.emplaceBack(Te*F,pe*F,0);for(let pe=0;pe<O;pe+=j+1)for(let Te=0;Te<j;Te++)M.emplaceBack(Te+pe,j+Te+pe+1,j+Te+pe+2),M.emplaceBack(Te+pe,j+Te+pe+2,Te+pe+1);const $=A.length,Y=$+(j+1),se=(j+1)*j,oe=g?c.br:0,ae=g?0:1,he=x?c.bs:c.a5,ge=x?0:1;for(let pe=0;pe<=j;pe++)A.emplaceBack(pe*F,oe,ae);for(let pe=0;pe<=j;pe++)A.emplaceBack(pe*F,he,ge);for(let pe=0;pe<j;pe++)M.emplaceBack(se+pe,Y+pe,Y+pe+1),M.emplaceBack(se+pe,Y+pe+1,se+pe+1),M.emplaceBack(0+pe,$+pe+1,$+pe),M.emplaceBack(0+pe,0+pe+1,$+pe+1);const ce=A.length,fe=ce+2*(j+1);for(const pe of[0,1])for(let Te=0;Te<=j;Te++)for(const Oe of[0,1])A.emplaceBack(pe*c.a5,Te*F,Oe);for(let pe=0;pe<2*j;pe+=2)M.emplaceBack(ce+pe,ce+pe+1,ce+pe+3),M.emplaceBack(ce+pe,ce+pe+3,ce+pe+2),M.emplaceBack(fe+pe,fe+pe+3,fe+pe+1),M.emplaceBack(fe+pe,fe+pe+2,fe+pe+3);const xe=new yn(P.createVertexBuffer(A,rv.members),P.createIndexBuffer(M),c.aX.simpleSegment(0,0,A.length,M.length));return this._meshCache[w]=xe,xe}getMeshFrameDelta(r){return 2*Math.PI*c.bE/Math.pow(2,Math.max(r,0))/5}getMinTileElevationForLngLatZoom(r,l){var d;if(!c.cD(l,r.wrap()))return 0;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(r,l);return(d=this.getMinMaxElevation(g).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(r){const l=this.getTerrainData(r).tile,d={minElevation:null,maxElevation:null};return l&&l.dem&&(d.minElevation=l.dem.min*this.exaggeration,d.maxElevation=l.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(r,l){const d=c.a9.fromLngLat(r.wrap()),g=(1<<l)*c.a5,x=d.x*g,w=d.y*g,P=Math.floor(x/c.a5),A=Math.floor(w/c.a5);return{tileID:new c.a2(l,0,l,P,A),mercatorX:x,mercatorY:w}}}class er{constructor(r,l,d){this._context=r,this._size=l,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(d.texture),{id:r,fbo:l,texture:d,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>r.id!==l),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Ua={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class oc{constructor(r,l){this.painter=r,this.terrain=l,this.pool=new er(r.context,30,l.tileManager.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=r._order.filter(d=>!r._layers[d].isHidden(l)),this._coordsAscending={};for(const d in r.tileManagers){this._coordsAscending[d]={};const g=r.tileManagers[d].getVisibleCoordinates(),x=r.tileManagers[d].getSource(),w=x instanceof Mn?x.terrainTileRanges:null;for(const P of g){const A=this.terrain.tileManager.getTerrainCoords(P,w);for(const M in A)this._coordsAscending[d][M]||(this._coordsAscending[d][M]=[]),this._coordsAscending[d][M].push(A[M])}}this._coordsAscendingStr={};for(const d of r._order){const g=r._layers[d],x=g.source;if(Ua[g.type]&&!this._coordsAscendingStr[x]){this._coordsAscendingStr[x]={};for(const w in this._coordsAscending[x])this._coordsAscendingStr[x][w]=this._coordsAscending[x][w].map(P=>P.key).sort().join()}}for(const d of this._renderableTiles)for(const g in this._coordsAscendingStr){const x=this._coordsAscendingStr[g][d.tileID.key];x&&x!==d.rttCoords[g]&&(d.rtt=[])}}renderLayer(r,l){if(r.isHidden(this.painter.transform.zoom))return!1;const d=Object.assign(Object.assign({},l),{isRenderingToTexture:!0}),g=r.type,x=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Ua[g]&&(this._prevType&&Ua[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(r.id),!w))return!0;if(Ua[this._prevType]||Ua[g]&&w){this._prevType=g;const P=this._stacks.length-1,A=this._stacks[P]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(Od(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[P]){const F=this.pool.getObjectForId(M.rtt[P].id);if(F.stamp===M.rtt[P].stamp){this.pool.useObject(F);continue}}const j=this.pool.getOrCreateFreeObject();this.pool.useObject(j),this.pool.stampObject(j),M.rtt[P]={id:j.id,stamp:j.stamp},x.context.bindFramebuffer.set(j.fbo.framebuffer),x.context.clear({color:c.bp.transparent,stencil:0}),x.currentStencilSource=void 0;for(let F=0;F<A.length;F++){const O=x.style._layers[A[F]],$=O.source?this._coordsAscending[O.source][M.tileID.key]:[M.tileID];x.context.viewport.set([0,0,j.fbo.width,j.fbo.height]),x._renderTileClippingMasks(O,$,!0),x.renderLayer(x,x.style.tileManagers[O.source],O,$,d),O.source&&(M.rttCoords[O.source]=this._coordsAscendingStr[O.source][M.tileID.key])}}return Od(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),Ua[g]}return!1}}const ju={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Xd=E,Nu={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Yd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class lc{constructor(r,l,d=!1){this.mousedown=x=>{this.startMove(x,G.mousePos(this.element,x)),G.addEventListener(window,"mousemove",this.mousemove),G.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,G.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHandler.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),G.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=l;const g=new Fm;this._rotatePitchHandler=new Bo({clickTolerance:3,move:(x,w)=>{const P=l.getBoundingClientRect(),A=new c.P((P.bottom-P.top)/2,(P.right-P.left)/2);return{bearingDelta:c.cx(new c.P(x.x,w.y),w,A),pitchDelta:d?-.5*(w.y-x.y):void 0}},moveStateManager:g,enable:!0,assignEvents:()=>{}}),this.map=r,G.addEventListener(l,"mousedown",this.mousedown),G.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(l,"touchcancel",this.reset)}startMove(r,l){this._rotatePitchHandler.dragStart(r,l),G.disableDrag()}move(r,l){const d=this.map,{bearingDelta:g,pitchDelta:x}=this._rotatePitchHandler.dragMove(r,l)||{};g&&d.setBearing(d.getBearing()+g),x&&d.setPitch(d.getPitch()+x)}off(){const r=this.element;G.removeEventListener(r,"mousedown",this.mousedown),G.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend),G.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),G.removeEventListener(window,"mousemove",this.mousemove),G.removeEventListener(window,"mouseup",this.mouseup),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend)}}let Bs;function Lu(v,r,l,d=!1){if(d||!l.getCoveringTilesDetailsProvider().allowWorldCopies())return v==null?void 0:v.wrap();const g=new c.V(v.lng,v.lat);if(v=new c.V(v.lng,v.lat),r){const x=new c.V(v.lng-360,v.lat),w=new c.V(v.lng+360,v.lat),P=l.locationToScreenPoint(v).distSqr(r);l.locationToScreenPoint(x).distSqr(r)<P?v=x:l.locationToScreenPoint(w).distSqr(r)<P&&(v=w)}for(;Math.abs(v.lng-l.center.lng)>180;){const x=l.locationToScreenPoint(v);if(x.x>=0&&x.y>=0&&x.x<=l.width&&x.y<=l.height)break;v.lng>l.center.lng?v.lng-=360:v.lng+=360}return v.lng!==g.lng&&l.isPointOnMapSurface(l.locationToScreenPoint(v))?v:g}const cc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zu(v,r,l){const d=v.classList;for(const g in cc)d.remove(`maplibregl-${l}-anchor-${g}`);d.add(`maplibregl-${l}-anchor-${r}`)}class uc extends c.E{constructor(r){if(super(),this._onKeyPress=l=>{const d=l.code,g=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=l=>{const d=l.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()},this._update=l=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((l==null?void 0:l.type)==="terrain"||(l==null?void 0:l.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=Lu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||l&&l.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,`${cc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${g}`),X.frameAsync(new AbortController).then(()=>{this._updateOpacity(l&&l.type==="moveend")}).catch(()=>{})},this._onMove=l=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._subpixelPositioning=r&&r.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=c.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div");const l=G.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${d}px`),l.setAttributeNS(null,"width",`${g}px`),l.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const x=G.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const w=G.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const P=G.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of A){const he=G.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ae.rx),he.setAttributeNS(null,"ry",ae.ry),P.appendChild(he)}const M=G.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const j=G.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(j);const F=G.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const O=G.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(O);const $=G.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const Y=G.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=G.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const oe=G.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),Y.appendChild(se),Y.appendChild(oe),w.appendChild(P),w.appendChild(M),w.appendChild(F),w.appendChild($),w.appendChild(Y),l.appendChild(w),l.setAttributeNS(null,"height",d*this._scale+"px"),l.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(l),this._offset=c.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),zu(this._element,this._anchor,"marker"),r&&r.className)for(const l of r.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(r){return this.remove(),this._map=r,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",r._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),r.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.V.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const g=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(r){return this._subpixelPositioning=r,this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var l,d;const g=(l=this._map)===null||l===void 0?void 0:l.terrain,x=this._map.transform.isLocationOccluded(this._lngLat);if(!g||x){const $=x?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const w=this._map,P=w.terrain.depthAtPoint(this._pos),A=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,A)-P<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/w.transform.pixelsPerMeter,j=Math.sin(w.getPitch()*Math.PI/180)*M,F=w.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),O=w.transform.lngLatToCameraDepth(this._lngLat,A+j)-F>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=c.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,l){return(this._opacity===void 0||r===void 0&&l===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),l!==void 0&&(this._opacityWhenCovered=l),this._map&&this._updateOpacity(!0),this}}const Jd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Uo=0,$a=!1;const Qd={maxWidth:100,unit:"metric"};function hc(v,r,l){const d=l&&l.maxWidth||100,g=v._container.clientHeight/2,x=v._container.clientWidth/2,w=v.unproject([x-d/2,g]),P=v.unproject([x+d/2,g]),A=Math.round(v.project(P).x-v.project(w).x),M=Math.min(d,A,v._container.clientWidth),j=w.distanceTo(P);if(l&&l.unit==="imperial"){const F=3.2808*j;F>5280?Ga(r,M,F/5280,v._getUIString("ScaleControl.Miles")):Ga(r,M,F,v._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Ga(r,M,j/1852,v._getUIString("ScaleControl.NauticalMiles")):j>=1e3?Ga(r,M,j/1e3,v._getUIString("ScaleControl.Kilometers")):Ga(r,M,j,v._getUIString("ScaleControl.Meters"))}function Ga(v,r,l,d){const g=function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let P=x/w;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(A){const M=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*M)/M}(P),w*P}(l);v.style.width=r*(g/l)+"px",v.innerHTML=`${g}&nbsp;${d}`}const ep={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Ou=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fu(v){if(v){if(typeof v=="number"){const r=Math.round(Math.abs(v)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,v),"top-left":new c.P(r,r),"top-right":new c.P(-r,r),bottom:new c.P(0,-v),"bottom-left":new c.P(r,-r),"bottom-right":new c.P(-r,-r),left:new c.P(v,0),right:new c.P(-v,0)}}if(v instanceof c.P||Array.isArray(v)){const r=c.P.convert(v);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:c.P.convert(v.center||[0,0]),top:c.P.convert(v.top||[0,0]),"top-left":c.P.convert(v["top-left"]||[0,0]),"top-right":c.P.convert(v["top-right"]||[0,0]),bottom:c.P.convert(v.bottom||[0,0]),"bottom-left":c.P.convert(v["bottom-left"]||[0,0]),"bottom-right":c.P.convert(v["bottom-right"]||[0,0]),left:c.P.convert(v.left||[0,0]),right:c.P.convert(v.right||[0,0])}}return Fu(new c.P(0,0))}const tp=E;f.AJAXError=c.cI,f.Event=c.l,f.Evented=c.E,f.LngLat=c.V,f.MercatorCoordinate=c.a9,f.Point=c.P,f.addProtocol=c.cJ,f.config=c.c,f.removeProtocol=c.cK,f.AttributionControl=Kd,f.BoxZoomHandler=Fo,f.CanvasSource=K,f.CooperativeGesturesHandler=_t,f.DoubleClickZoomHandler=Hd,f.DragPanHandler=qm,f.DragRotateHandler=ss,f.EdgeInsets=wo,f.FullscreenControl=class extends c.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var r;let l=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=l==null?void 0:l.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){G.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=G.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);G.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=ei,f.GeolocateControl=class extends c.E{constructor(v){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",r)),this._finish()}},this._updateCamera=r=>{const l=new c.V(r.coords.longitude,r.coords.latitude),d=r.coords.accuracy,g=this._map.getBearing(),x=c.e({bearing:g},this.options.fitBoundsOptions),w=In.fromLngLat(l,d);this._map.fitBounds(w,x,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const l=new c.V(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=r.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=r=>{if(this._map){if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&$a)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=G.create("button","maplibregl-ctrl-geolocate",this._container),G.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=r=>{if(this._map){if(r===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new uc({element:this._dotElement}),this._circleElement=G.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new uc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{const d=(l==null?void 0:l[0])instanceof ResizeObserverEntry;l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},Jd,v)}onAdd(v){return this._map=v,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(r=!1){if(Bs!==void 0&&!r)return Bs;if(window.navigator.permissions===void 0)return Bs=!!window.navigator.geolocation,Bs;try{Bs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Bs=!!window.navigator.geolocation}return Bs})}().then(r=>this._finishSetupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Uo=0,$a=!1}_isOutOfMapMaxBounds(v){const r=this._map.getMaxBounds(),l=v.coords;return r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const v=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&v))return;const r=this._map.project(v),l=this._map.unproject([r.x+100,r.y]),d=v.distanceTo(l)/100,g=2*this._accuracy/d;this._circleElement.style.width=`${g.toFixed(2)}px`,this._circleElement.style.height=`${g.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Uo--,$a=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Uo++,Uo>1?(v={maximumAge:6e5,timeout:0},$a=!0):(v=this.options.positionOptions,$a=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const r=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(r!=="mercator"&&r?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=G.create("button","maplibregl-ctrl-globe",this._container),G.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=Vd,f.ImageSource=Mn,f.KeyboardHandler=pn,f.LngLatBounds=In,f.LogoControl=Wm,f.Map=class extends oi{constructor(v){var r,l;c.cG.mark(c.cH.create);const d=Object.assign(Object.assign(Object.assign({},Nu),v),{canvasContextAttributes:Object.assign(Object.assign({},Nu.canvasContextAttributes),v.canvasContextAttributes)});if(d.minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const g=new Ma,x=new Ra;if(d.minZoom!==void 0&&g.setMinZoom(d.minZoom),d.maxZoom!==void 0&&g.setMaxZoom(d.maxZoom),d.minPitch!==void 0&&g.setMinPitch(d.minPitch),d.maxPitch!==void 0&&g.setMaxPitch(d.maxPitch),d.renderWorldCopies!==void 0&&g.setRenderWorldCopies(d.renderWorldCopies),d.transformConstrain!==null&&g.setConstrainOverride(d.transformConstrain),super(g,x,{bearingSnap:d.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new nv,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=P=>{P.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const A of Object.values(this.style._layers))if(A.type==="custom"&&console.warn(`Custom layer with id '${A.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),A._listeners)for(const[M]of Object.entries(A._listeners))console.warn(`Custom layer with id '${A.id}' had event listeners for event '${M}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:P}))},this._contextRestored=P=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new c.l("webglcontextrestored",{originalEvent:P}))},this._onMapScroll=P=>{if(P.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},d.canvasContextAttributes),this._trackResize=d.trackResize===!0,this._bearingSnap=d.bearingSnap,this._centerClampedToGround=d.centerClampedToGround,this._refreshExpiredTiles=d.refreshExpiredTiles===!0,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions===!0,this._collectResourceTiming=d.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ju),d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this._zoomLevelsToOverscale=d.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=d.transformCameraUpdate,this.transformConstrain=d.transformConstrain,this.cancelPendingTileRequestsWhileZooming=d.cancelPendingTileRequestsWhileZooming===!0,d.reduceMotion!==void 0&&(X.prefersReducedMotion=d.reduceMotion),this._imageQueueHandle=_e.addThrottleControl(()=>this.isMoving()),this._requestManager=new we(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let P=!1;const A=Bd(M=>{this._trackResize&&!this._removed&&(this.resize(M),this.redraw())},50);this._resizeObserver=new ResizeObserver(M=>{P?A(M):P=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Du(this,d),this._hash=d.hash&&new Vd(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,elevation:d.elevation,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,roll:d.roll}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,c.e({},d.fitBoundsOptions,{duration:0}))));const w=typeof d.style=="string"||((l=(r=d.style)===null||r===void 0?void 0:r.projection)===null||l===void 0?void 0:l.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Kd(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new Wm,d.logoPosition),this.on("style.load",()=>{if(w||this._resizeTransform(),this.transform.unmodified){const P=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(P)}}),this.on("data",P=>{this._update(P.dataType==="style"),this.fire(new c.l(`${P.dataType}data`,P))}),this.on("dataloading",P=>{this.fire(new c.l(`${P.dataType}dataloading`,P))}),this.on("dataabort",P=>{this.fire(new c.l("sourcedataabort",P))})}_getMapId(){return this._mapId}setGlobalStateProperty(v,r){return this.style.setGlobalStateProperty(v,r),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,r){if(r===void 0&&(r=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=v.onAdd(this);this._controls.push(v);const d=this._controlPositions[r];return r.indexOf("bottom")!==-1?d.insertBefore(l,d.firstChild):d.appendChild(l),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(v);return r>-1&&this._controls.splice(r,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}coveringTiles(v){return Un(this.transform,v)}calculateCameraOptionsFromTo(v,r,l,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLat(l,this.transform)),super.calculateCameraOptionsFromTo(v,r,l,d)}resize(v,r=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(r);const l=!this._moving;return l&&(this.stop(),this.fire(new c.l("movestart",v)).fire(new c.l("move",v))),this.fire(new c.l("resize",v)),l&&this.fire(new c.l("moveend",v)),this}_resizeInternal(v=!0){const[r,l]=this._containerDimensions(),d=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,d),this.painter.resize(r,l,d),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const x=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,x),this.painter.resize(r,l,x)}this._resizeTransform(v)}_resizeTransform(v=!0){var r;const[l,d]=this._containerDimensions();this.transform.resize(l,d,v),(r=this._requestedCameraState)===null||r===void 0||r.resize(l,d,v)}_getClampedPixelRatio(v,r){const{0:l,1:d}=this._maxCanvasSize,g=this.getPixelRatio(),x=v*g,w=r*g;return Math.min(x>l?l/x:1,w>d?d/w:1)*g}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(In.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom){const r=this._getTransformForUpdate();return r.setMinZoom(v),this._applyUpdatedTransform(r),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom){const r=this._getTransformForUpdate();return r.setMaxZoom(v),this._applyUpdatedTransform(r),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}setTransformConstrain(v){return this.transform.setConstrainOverride(v),this._update()}project(v){return this.transform.locationToScreenPoint(c.V.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(c.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,r,l){if(v==="mouseenter"||v==="mouseover"){let d=!1;return{layers:r,listener:l,delegates:{mousemove:x=>{const w=r.filter(A=>this.getLayer(A)),P=w.length!==0?this.queryRenderedFeatures(x.point,{layers:w}):[];P.length?d||(d=!0,l.call(this,new Pr(v,this,x.originalEvent,{features:P}))):d=!1},mouseout:()=>{d=!1}}}}if(v==="mouseleave"||v==="mouseout"){let d=!1;return{layers:r,listener:l,delegates:{mousemove:w=>{const P=r.filter(A=>this.getLayer(A));(P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[]).length?d=!0:d&&(d=!1,l.call(this,new Pr(v,this,w.originalEvent)))},mouseout:w=>{d&&(d=!1,l.call(this,new Pr(v,this,w.originalEvent)))}}}}{const d=g=>{const x=r.filter(P=>this.getLayer(P)),w=x.length!==0?this.queryRenderedFeatures(g.point,{layers:x}):[];w.length&&(g.features=w,l.call(this,g),delete g.features)};return{layers:r,listener:l,delegates:{[v]:d}}}}_saveDelegatedListener(v,r){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(r)}_removeDelegatedListener(v,r,l){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const d=this._delegatedListeners[v];for(let g=0;g<d.length;g++){const x=d[g];if(x.listener===l&&x.layers.length===r.length&&x.layers.every(w=>r.includes(w))){for(const w in x.delegates)this.off(w,x.delegates[w]);return void d.splice(g,1)}}}on(v,r,l){if(l===void 0)return super.on(v,r);const d=typeof r=="string"?[r]:r,g=this._createDelegatedListener(v,d,l);this._saveDelegatedListener(v,g);for(const x in g.delegates)this.on(x,g.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(v,d,l)}}}once(v,r,l){if(l===void 0)return super.once(v,r);const d=typeof r=="string"?[r]:r,g=this._createDelegatedListener(v,d,l);for(const x in g.delegates){const w=g.delegates[x];g.delegates[x]=(...P)=>{this._removeDelegatedListener(v,d,l),w(...P)}}this._saveDelegatedListener(v,g);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(v,r,l){return l===void 0?super.off(v,r):(this._removeDelegatedListener(v,typeof r=="string"?[r]:r,l),this)}queryRenderedFeatures(v,r){if(!this.style)return[];let l;const d=v instanceof c.P||Array.isArray(v),g=d?v:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(d?{}:v)||{},g instanceof c.P||typeof g[0]=="number")l=[c.P.convert(g)];else{const x=c.P.convert(g[0]),w=c.P.convert(g[1]);l=[x,new c.P(w.x,x.y),w,new c.P(x.x,w.y),x]}return this.style.queryRenderedFeatures(l,r,this.transform)}querySourceFeatures(v,r){return this.style.querySourceFeatures(v,r)}setStyle(v,r){return(r=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(v,r))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const r=this._locale[v];if(r==null)throw new Error(`Missing UI string '${v}'`);return r}_updateStyle(v,r){var l,d;if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,r));const g=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ja(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,r,g):this.style.loadJSON(v,r,g),this):((d=(l=this.style)===null||l===void 0?void 0:l.projection)===null||d===void 0||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ja(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,r){if(typeof v=="string"){const l=this._requestManager.transformRequest(v,"Style");c.j(l,new AbortController).then(d=>{this._updateDiff(d.data,r)}).catch(d=>{d&&this.fire(new c.k(d))})}else typeof v=="object"&&this._updateDiff(v,r)}_updateDiff(v,r){try{this.style.setState(v,r)&&this._update(!0)}catch(l){c.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(v,r)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(v,r){return this._lazyInitEmptyStyle(),this.style.addSource(v,r),this._update(!0)}isSourceLoaded(v){const r=this.style&&this.style.tileManagers[v];if(r!==void 0)return r.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const r=this.style.tileManagers[v.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&r.reload();for(const l in this.style._layers){const d=this.style._layers[l];d.type==="hillshade"&&d.source===v.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),d.type==="color-relief"&&d.source===v.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new On(this.painter,r,v),this.painter.renderToTexture=new oc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=l=>{var d;l.dataType==="style"?this.terrain.tileManager.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((d=l.source)===null||d===void 0?void 0:d.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:v})),this}getTerrain(){var v,r;return(r=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const v=this.style&&this.style.tileManagers;for(const r of Object.values(v))if(!r.areTilesLoaded())return!1;return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,r,l){if(l){const d=this.getSource(l);if(!d)throw new Error(`There is no source with ID "${l}", cannot set LOD parameters`);d.calculateTileZoom=un(Math.max(1,v),Math.max(1,r))}else for(const d in this.style.tileManagers)this.style.tileManagers[d].getSource().calculateTileZoom=un(Math.max(1,v),Math.max(1,r));return this._update(!0),this}refreshTiles(v,r){const l=this.style.tileManagers[v];if(!l)throw new Error(`There is no tile manager with ID "${v}", cannot refresh tile`);r===void 0?l.reload(!0):l.refreshTiles(r.map(d=>new c.ac(d.z,d.x,d.y)))}addImage(v,r,l={}){const{pixelRatio:d=1,sdf:g=!1,stretchX:x,stretchY:w,content:P,textFitWidth:A,textFitHeight:M}=l;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||c.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:j,height:F,data:O}=r,$=r;return this.style.addImage(v,{data:new c.R({width:j,height:F},new Uint8Array(O)),pixelRatio:d,stretchX:x,stretchY:w,content:P,textFitWidth:A,textFitHeight:M,sdf:g,version:0,userImage:$}),$.onAdd&&$.onAdd(this,v),this}}{const{width:j,height:F,data:O}=X.getImageData(r);this.style.addImage(v,{data:new c.R({width:j,height:F},O),pixelRatio:d,stretchX:x,stretchY:w,content:P,textFitWidth:A,textFitHeight:M,sdf:g,version:0})}}updateImage(v,r){const l=this.style.getImage(v);if(!l)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=r instanceof HTMLImageElement||c.b(r)?X.getImageData(r):r,{width:g,height:x,data:w}=d;if(g===void 0||x===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==l.data.width||x!==l.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(r instanceof HTMLImageElement||c.b(r));return l.data.replace(w,P),this.style.updateImage(v,l),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return _e.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,r){return this._lazyInitEmptyStyle(),this.style.addLayer(v,r),this._update(!0)}moveLayer(v,r){return this.style.moveLayer(v,r),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,r,l){return this.style.setLayerZoomRange(v,r,l),this._update(!0)}setFilter(v,r,l={}){return this.style.setFilter(v,r,l),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,r,l,d={}){return this.style.setPaintProperty(v,r,l,d),this._update(!0)}getPaintProperty(v,r){return this.style.getPaintProperty(v,r)}setLayoutProperty(v,r,l,d={}){return this.style.setLayoutProperty(v,r,l,d),this._update(!0)}getLayoutProperty(v,r){return this.style.getLayoutProperty(v,r)}setGlyphs(v,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,r,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,r,l,d=>{d||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,r,l=>{l||this._update(!0)}),this}setLight(v,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,r),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,r={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,r),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,r){return this.style.setFeatureState(v,r),this._update()}removeFeatureState(v,r){return this.style.removeFeatureState(v,r),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,r=0;return this._container&&(v=this._container.clientWidth||400,r=this._container.clientHeight||300),[v,r]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const r=this._canvasContainer=G.create("div","maplibregl-canvas-container",v);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=G.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),d=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],d);const g=this._controlContainer=G.create("div","maplibregl-control-container",v),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{x[w]=G.create("div",`maplibregl-ctrl-${w} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,r,l){this._canvas.width=Math.floor(l*v),this._canvas.height=Math.floor(l*r),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let r=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{r={requestedAttributes:v},d&&(r.statusMessage=d.statusMessage,r.type=d.type)},{once:!0});let l=null;if(l=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!l){const d="Failed to initialize WebGL";throw r?(r.message=d,new Error(JSON.stringify(r))):new Error(d)}this.painter=new Nm(l,this.transform),J.testSupport(l)}migrateProjection(v,r){super.migrateProjection(v,r),this.painter.transform=v,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var r,l,d,g,x;const w=this._idleTriggered?this._fadeDuration:0,P=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,O=te();this.style.zoomHistory.update(F,O);const $=new c.H(F,{now:O,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=$.crossFadingFactor();Y===1&&Y===this._crossFadingFactor||(A=!0,this._crossFadingFactor=Y),this.style.update($)}const M=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0!==P;(d=this.style.projection)===null||d===void 0||d.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((g=this.style.projection)===null||g===void 0?void 0:g.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||M)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,M),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cG.mark(c.cH.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const j=this._sourcesDirty||this._styleDirty||this._placementDirty;return j||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,c.cG.mark(c.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),_e.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r!=null&&r.loseContext&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),G.remove(this._canvasContainer),G.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cG.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,X.frame(this._frameRequest,v=>{c.cG.frame(v),this._frameRequest=null;try{this._render(v)}catch(r){if(!c.Z(r)&&!function(l){return l.message===jd}(r))throw r}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Xd}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},f.MapMouseEvent=Pr,f.MapTouchEvent=Ql,f.MapWheelEvent=Om,f.Marker=uc,f.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const r=this._map.getZoom(),l=r===this._map.getMaxZoom(),d=r===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(r,l)=>{const d=this._map._getUIString(`NavigationControl.${l}`);r.title=d,r.setAttribute("aria-label",d)},this.options=c.e({},Yd,v),this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),G.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),G.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=G.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,r){const l=G.create("button",v,this._container);return l.type="button",l.addEventListener("click",r),l}},f.Popup=class extends c.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=G.create("div","maplibregl-popup",this._map.getContainer()),this._tip=G.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Lu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!r)return;const l=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor;const g=Fu(this.options.offset);if(!d){const w=this._container.offsetWidth,P=this._container.offsetHeight,A=function(j){var F,O,$,Y;return j?{top:(F=j.top)!==null&&F!==void 0?F:0,right:(O=j.right)!==null&&O!==void 0?O:0,bottom:($=j.bottom)!==null&&$!==void 0?$:0,left:(Y=j.left)!==null&&Y!==void 0?Y:0}:{top:0,right:0,bottom:0,left:0}}(this.options.padding);let M;M=l.y+g.bottom.y<P+A.top?["top"]:l.y>this._map.transform.height-P-A.bottom?["bottom"]:[],l.x<w/2+A.left?M.push("left"):l.x>this._map.transform.width-w/2-A.right&&M.push("right"),d=M.length===0?"bottom":M.join("-")}let x=l.add(g[d]);this.options.subpixelPositioning||(x=x.round()),G.setTransform(this._container,`${cc[d]} translate(${x.x}px,${x.y}px)`),zu(this._container,d,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(ep),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=c.V.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const r=document.createDocumentFragment(),l=document.createElement("body");let d;for(l.innerHTML=v;d=l.firstChild,d;)r.appendChild(d);return this.setDOMContent(r)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}setPadding(v){this.options.padding=v,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Ou);v&&v.focus()}},f.RasterDEMTileSource=Wt,f.RasterTileSource=Dt,f.ScaleControl=class{constructor(v){this._onMove=()=>{hc(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,hc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Qd),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=Mu,f.Style=ja,f.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=G.create("button","maplibregl-ctrl-terrain",this._container),G.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){G.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=Um,f.TwoFingersTouchRotateHandler=Wd,f.TwoFingersTouchZoomHandler=qd,f.TwoFingersTouchZoomRotateHandler=ic,f.VectorTileSource=Ut,f.VideoSource=Ce,f.addSourceType=(v,r)=>c._(void 0,void 0,void 0,function*(){if(re(v))throw new Error(`A source type called "${v}" already exists.`);((l,d)=>{Z[l]=d})(v,r)}),f.clearPrewarmedResources=function(){const v=Yn;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(an),Yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=tm,f.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return ke().getRTLTextPluginStatus()},f.getVersion=function(){return tp},f.getWorkerCount=function(){return tn.workerCount},f.getWorkerUrl=function(){return c.c.WORKER_URL},f.importScriptInWorkers=function(v){return Ca().broadcast("IS",v)},f.isTimeFrozen=function(){return W.isFrozen()},f.now=te,f.prewarm=function(){wn().acquire(an)},f.restoreNow=function(){W.restoreNow()},f.setMaxParallelImageRequests=function(v){c.c.MAX_PARALLEL_IMAGE_REQUESTS=v},f.setNow=function(v){W.setNow(v)},f.setRTLTextPlugin=function(v,r){return ke().setRTLTextPlugin(v,r)},f.setWorkerCount=function(v){tn.workerCount=v},f.setWorkerUrl=function(v){c.c.WORKER_URL=v}});var m=i;return m})})(fR);var v8=fR.exports;const rx=yC(v8),x8="https://demotiles.maplibre.org/style.json",fC=e=>({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:e.map(t=>[t.lng,t.lat])}}]});function gR({points:e,center:t}){const i=Ue.useRef(null),o=Ue.useRef(null),h=Ue.useRef(null);return Ue.useEffect(()=>{if(o.current||!i.current)return;const m=new rx.Map({container:i.current,style:x8,center:t||[-82.9988,39.9612],zoom:11});m.addControl(new rx.NavigationControl({showCompass:!1})),o.current=m,m.on("load",()=>{m.addSource("track",{type:"geojson",data:fC(e||[])}),m.addLayer({id:"track-line",type:"line",source:"track",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#22d3ee","line-width":4}})})},[t,e]),Ue.useEffect(()=>{const m=o.current;if(!m)return;const f=e==null?void 0:e[e.length-1];m.getSource("track")&&m.getSource("track").setData(fC(e||[])),f&&(h.current?h.current.setLngLat([f.lng,f.lat]):h.current=new rx.Marker({color:"#34d399"}).setLngLat([f.lng,f.lat]).addTo(m),m.easeTo({center:[f.lng,f.lat],zoom:13,duration:800}))},[e]),S.jsx("div",{ref:i,style:{width:"100%",height:"420px"}})}function b8(){const{token:e}=LA(),[t,i]=Ue.useState(null),[o,h]=Ue.useState([]),[m,f]=Ue.useState(!0),[c,E]=Ue.useState(""),C=Ue.useCallback(async()=>{var L,B,X,W;if(e)try{const[te,G]=await Promise.all([oR(e),lR(e)]);i(((L=te.data)==null?void 0:L.session)||null),h(((B=G.data)==null?void 0:B.points)||[]),E("")}catch(te){E(((W=(X=te.response)==null?void 0:X.data)==null?void 0:W.error)||te.message)}finally{f(!1)}},[e]);Ue.useEffect(()=>{C();const L=setInterval(C,5e3);return()=>clearInterval(L)},[C]);const R=o==null?void 0:o[o.length-1];return S.jsxs("div",{style:{minHeight:"100vh",position:"relative"},children:[S.jsx(T_,{}),S.jsxs("div",{style:{position:"relative",zIndex:1,maxWidth:"980px",margin:"0 auto",padding:"4rem 1.5rem"},children:[S.jsxs("div",{className:"glass",style:{padding:"2rem"},children:[S.jsx("div",{style:{letterSpacing:"0.2rem",color:"#22d3ee"},children:"LIVE TRACKING"}),S.jsx("h2",{style:{marginTop:"0.6rem",fontSize:"2rem"},children:"Your Technician Is En Route"}),c?S.jsx("div",{style:{color:"#f87171",marginTop:"1rem"},children:c}):null,m?S.jsx("div",{style:{color:"#9ca3af",marginTop:"1rem"},children:"Loading live location..."}):S.jsxs("div",{style:{color:"#9ca3af",marginTop:"0.6rem"},children:["Status: ",(t==null?void 0:t.status)||"active","  ETA"," ",(t==null?void 0:t.eta_minutes)||""," minutes"]})]}),S.jsx("div",{className:"glass",style:{padding:"1.5rem",marginTop:"1.5rem"},children:S.jsx(gR,{points:o,center:R?[R.lng,R.lat]:t!=null&&t.last_lng&&(t!=null&&t.last_lat)?[t.last_lng,t.last_lat]:void 0})})]})]})}function w8(){const{token:e}=LA(),[t]=Dw(),i=t.get("key"),[o,h]=Ue.useState("idle"),[m,f]=Ue.useState(""),[c,E]=Ue.useState([]),[C,R]=Ue.useState(null),L=Ue.useRef(null),B=Ue.useCallback(async()=>{var G,J,H,Q;if(e)try{const[le,ve]=await Promise.all([oR(e),lR(e)]);R(((G=le.data)==null?void 0:G.session)||null),E(((J=ve.data)==null?void 0:J.points)||[])}catch(le){f(((Q=(H=le.response)==null?void 0:H.data)==null?void 0:Q.error)||le.message)}},[e]);Ue.useEffect(()=>{B()},[B]);const X=async G=>{var Q,le;if(!e||!i)return;const J=G.coords.latitude,H=G.coords.longitude;try{await g$({token:e,key:i,lat:J,lng:H}),h("live"),B()}catch(ve){f(((le=(Q=ve.response)==null?void 0:Q.data)==null?void 0:le.error)||ve.message)}},W=()=>{if(f(""),!navigator.geolocation){f("Geolocation not supported on this device.");return}h("starting"),L.current=navigator.geolocation.watchPosition(X,G=>f(G.message),{enableHighAccuracy:!0,maximumAge:1e4,timeout:2e4})},te=()=>{L.current&&navigator.geolocation.clearWatch(L.current),h("stopped")};return S.jsxs("div",{style:{minHeight:"100vh",position:"relative"},children:[S.jsx(T_,{}),S.jsxs("div",{style:{position:"relative",zIndex:1,maxWidth:"980px",margin:"0 auto",padding:"4rem 1.5rem"},children:[S.jsxs("div",{className:"glass",style:{padding:"2rem"},children:[S.jsx("div",{style:{letterSpacing:"0.2rem",color:"#22d3ee"},children:"TECH TRACKING"}),S.jsx("h2",{style:{marginTop:"0.6rem",fontSize:"2rem"},children:"Live Location Uplink"}),S.jsxs("div",{style:{color:"#9ca3af",marginTop:"0.6rem"},children:["Status: ",o," ",C!=null&&C.eta_minutes?` ETA ${C.eta_minutes}m`:""]}),m?S.jsx("div",{style:{color:"#f87171",marginTop:"1rem"},children:m}):null,S.jsxs("div",{style:{display:"flex",gap:"0.8rem",marginTop:"1rem"},children:[S.jsx("button",{className:"button-primary",onClick:W,children:"Start Tracking"}),S.jsx("button",{className:"button-primary",onClick:te,children:"Stop"})]})]}),S.jsx("div",{className:"glass",style:{padding:"1.5rem",marginTop:"1.5rem"},children:S.jsx(gR,{points:c,center:c.length?[c[c.length-1].lng,c[c.length-1].lat]:void 0})})]})]})}const S8=[{id:"usr_001",business:"Apex Heating",email:"apex@heating.com",plan:"ELITE",status:"active",usage:78},{id:"usr_002",business:"Flow Plumbing Co",email:"info@flowplumbing.com",plan:"PRO",status:"active",usage:62},{id:"usr_003",business:"Northstar HVAC",email:"support@northstarhvac.com",plan:"CORE",status:"past_due",usage:44}],T8={active:"bg-neon-green",past_due:"bg-neon-pink"};function E8(){const e=qr();return S.jsxs("div",{className:"min-h-screen w-full bg-void-black text-white relative overflow-hidden font-sans",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsxs("div",{className:"relative z-10 flex w-full h-screen",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{className:"flex-1 px-6 py-8 space-y-6",children:[S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"glass-panel rounded-3xl border border-white/10 p-6",children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Fleet Registry"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold",children:"System Users"}),S.jsx("p",{className:"mt-1 text-white/60",children:"Live roster of every deployment across the Kryonex fleet."})]}),S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"glass-panel rounded-3xl border border-white/10 p-6 overflow-hidden",children:[S.jsxs("div",{className:"grid grid-cols-[1fr_1fr_1fr_0.7fr_0.8fr_0.8fr] gap-4 text-[0.65rem] uppercase tracking-widest text-white/40 border-b border-white/10 pb-3",children:[S.jsx("div",{children:"Client"}),S.jsx("div",{children:"Email"}),S.jsx("div",{children:"Plan"}),S.jsx("div",{children:"Status"}),S.jsx("div",{children:"Usage"}),S.jsx("div",{children:"Actions"})]}),S.jsx("div",{className:"mt-3 space-y-2",children:S8.map(t=>S.jsxs("div",{className:"grid grid-cols-[1fr_1fr_1fr_0.7fr_0.8fr_0.8fr] gap-4 items-center rounded-2xl border border-white/5 bg-black/40 px-4 py-3 hover:border-neon-cyan/40 transition",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold",children:t.business}),S.jsx("div",{className:"text-xs text-white/40",children:t.id})]}),S.jsx("div",{className:"text-xs text-slate-400",children:t.email}),S.jsx("div",{children:S.jsx("span",{className:"px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-widest border border-white/20 rounded-full bg-white/5",children:t.plan})}),S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${T8[t.status]||"bg-white/20"}`}),S.jsx("span",{className:"text-xs uppercase tracking-[0.3em]",children:t.status.replace("_"," ")})]}),S.jsxs("div",{children:[S.jsx("div",{className:"h-2 w-full rounded-full bg-white/10",children:S.jsx("div",{className:"h-2 rounded-full bg-neon-cyan",style:{width:`${t.usage}%`}})}),S.jsxs("div",{className:"text-[0.6rem] text-white/40 mt-1",children:[t.usage,"% usage"]})]}),S.jsxs("div",{className:"flex items-center justify-end gap-2",children:[S.jsx("button",{className:"p-2 rounded-full border border-white/10 hover:border-neon-cyan/60 transition",children:S.jsx(H$,{size:16})}),S.jsx("button",{className:"p-2 rounded-full border border-white/10 hover:border-neon-cyan/60 transition",children:S.jsx(e_,{size:16})}),S.jsx("button",{className:"p-2 rounded-full border border-white/10 hover:border-neon-cyan/60 transition",children:S.jsx(B$,{size:16})})]})]},t.id))})]})]})]})]})}const P8=[{timestamp:"2026-01-18 21:12",client:"Apex Heating",result:"Booked",sentiment:"positive",cost:.45,recording:"https://recordings.kryonex/rec_102"},{timestamp:"2026-01-18 21:09",client:"Flow Plumbing Co",result:"Transfer",sentiment:"neutral",cost:.18,recording:"https://recordings.kryonex/rec_101"},{timestamp:"2026-01-18 20:56",client:"Northstar HVAC",result:"Hangup",sentiment:"negative",cost:.06,recording:"https://recordings.kryonex/rec_100"}],C8={positive:"bg-neon-green",neutral:"bg-white/40",negative:"bg-neon-pink"};function k8(){const e=qr();return S.jsxs("div",{className:"min-h-screen w-full bg-void-black text-white relative overflow-hidden font-sans",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsxs("div",{className:"relative z-10 flex w-full h-screen",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{className:"flex-1 px-6 py-8 space-y-6",children:[S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"glass-panel rounded-3xl border border-white/10 p-6",children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Global Neural Logs"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold",children:"AI Call Stream"}),S.jsx("p",{className:"mt-1 text-white/60",children:"Matrix-style feed for every AI interaction."})]}),S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"glass-panel rounded-3xl border border-white/10 p-6 overflow-hidden",children:[S.jsxs("div",{className:"grid grid-cols-[1fr_1fr_0.9fr_0.7fr_0.9fr_0.8fr] gap-4 text-[0.65rem] uppercase tracking-[0.3em] text-white/40 border-b border-white/10 pb-3",children:[S.jsx("div",{children:"Timestamp"}),S.jsx("div",{children:"Client"}),S.jsx("div",{children:"Result"}),S.jsx("div",{children:"Sentiment"}),S.jsx("div",{children:"API Cost"}),S.jsx("div",{children:"Playback"})]}),S.jsx("div",{className:"mt-3 space-y-3 max-h-[620px] overflow-y-auto pr-2",children:P8.map((t,i)=>S.jsxs("div",{className:`grid grid-cols-[1fr_1fr_0.9fr_0.7fr_0.9fr_0.8fr] gap-4 items-center rounded-2xl border border-white/5 bg-black/40 px-4 py-3 transition ${i===0?"animate-pulse border-neon-cyan/40":""}`,children:[S.jsx("div",{className:"text-xs text-neon-cyan font-mono",children:t.timestamp}),S.jsx("div",{className:"text-sm font-semibold",children:t.client}),S.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-neon-green",children:t.result}),S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("span",{className:`h-3 w-3 rounded-full ${C8[t.sentiment]}`}),S.jsx("span",{className:"text-[0.7rem] uppercase tracking-[0.3em] text-white/60",children:t.sentiment})]}),S.jsxs("div",{className:"text-xs text-white/40",children:["$",t.cost.toFixed(2)]}),S.jsx("a",{href:t.recording,target:"_blank",rel:"noreferrer",className:"flex items-center justify-center text-neon-purple hover:text-white transition p-1 rounded hover:bg-white/10",title:"Play recording",children:S.jsx(O$,{size:16})})]},`${t.timestamp}-${t.client}`))})]})]})]})]})}const A8=[{label:"Total MRR",value:"$42,800",tone:"text-neon-green",trend:" 12% vs last week"},{label:"Active Clients",value:"128",tone:"text-neon-cyan",trend:" 3 new onboardings"},{label:"ARPU",value:"$334",tone:"text-neon-purple",trend:" $18 avg ticket"},{label:"Churn Rate",value:"2.4%",tone:"text-neon-pink",trend:" 0.2% MoM"}],I8=[{id:"txn_1093",client:"Apex Heating",amount:"$1,250",status:"Success",time:"Just now"},{id:"txn_1092",client:"Flow Plumbing Co",amount:"$980",status:"Success",time:"6m ago"},{id:"txn_1091",client:"Northstar HVAC",amount:"$197",status:"Pending",time:"12m ago"},{id:"txn_1090",client:"Zenith Cooling",amount:"$397",status:"Success",time:"20m ago"}],mC=[[0,50],[1,120],[2,95],[3,165],[4,145],[5,190],[6,210],[7,240]],gC=e=>{const t=Math.max(...e.map(o=>o[1])),i=200;return e.map(([o,h],m)=>`${m===0?"M":"L"}${o/(e.length-1)*100}%,${i-h/t*i}`).join(" ")};function M8(){const e=qr();return S.jsxs("div",{className:"min-h-screen w-full bg-void-black text-white relative overflow-hidden font-sans",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsxs("div",{className:"relative z-10 flex w-full h-screen",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{className:"flex-1 px-6 py-8 space-y-6",children:[S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"glass-panel rounded-3xl border border-white/10 p-6",children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Revenue Telemetry"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold",children:"Financial Command"}),S.jsx("p",{className:"mt-1 text-white/60",children:"KPI and trend surface for the Kryonex fleet."})]}),S.jsx(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"grid gap-4 lg:grid-cols-4",children:A8.map(t=>S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-5 flex flex-col gap-2",children:[S.jsx("div",{className:"text-[0.65rem] uppercase tracking-[0.3em] text-white/40",children:t.label}),S.jsx("div",{className:`text-3xl font-mono ${t.tone}`,children:t.value}),S.jsxs("div",{className:"flex items-center text-[0.7rem] text-white/60 gap-2",children:[S.jsx(W$,{size:16}),t.trend]})]},t.label))}),S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"grid gap-6 lg:grid-cols-[1.5fr_1fr]",children:[S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6",children:[S.jsxs("div",{className:"flex items-center justify-between mb-4",children:[S.jsx("div",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"MRR Growth"}),S.jsx("span",{className:"text-xs text-white/60",children:"Last 8 weeks"})]}),S.jsx("div",{className:"relative h-[250px]",children:S.jsxs("svg",{viewBox:"0 0 100 200",className:"w-full h-full overflow-visible",preserveAspectRatio:"none",children:[S.jsx("path",{d:gC(mC),fill:"none",stroke:"url(#gradient)",strokeWidth:"1.8",strokeLinecap:"round"}),S.jsx("defs",{children:S.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[S.jsx("stop",{offset:"0%",stopColor:"#22d3ee"}),S.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]})}),S.jsx("path",{d:`${gC(mC)} L100,200 L0,200 Z`,fill:"rgba(34, 211, 238, 0.25)"})]})})]}),S.jsxs("div",{className:"glass-panel rounded-3xl border border-white/10 p-6 flex flex-col gap-4",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("div",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"Recent Transactions"}),S.jsx("button",{className:"text-[0.6rem] uppercase tracking-[0.4em] text-neon-cyan",children:"View All"})]}),S.jsx("div",{className:"space-y-3 overflow-y-auto",children:I8.map(t=>S.jsxs("div",{className:"rounded-2xl border border-white/5 bg-black/40 px-4 py-3 flex items-center justify-between gap-4",children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold",children:t.client}),S.jsx("div",{className:"text-[0.65rem] text-white/40",children:t.id})]}),S.jsx("div",{className:"text-sm text-neon-green",children:t.amount}),S.jsx("div",{className:"text-[0.65rem] uppercase tracking-[0.3em] text-white/60",children:t.status}),S.jsx("div",{className:"text-[0.65rem] text-white/50",children:t.time})]},t.id))})]})]})]})]})]})}const ix=e=>Number(e||0).toLocaleString("en-US",{style:"currency",currency:"USD"}),R8=e=>e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0}):"--";function D8(){var ve,Ee,_e;const e=qr(),[t,i]=Ue.useState([]),[o,h]=Ue.useState(null),[m,f]=Ue.useState(null),[c,E]=Ue.useState(!1),[C,R]=Ue.useState(!1),[L,B]=Ue.useState(""),[X,W]=Ue.useState(""),[te,G]=Ue.useState(null),J=Ue.useCallback(async()=>{var we,Ge,Je;E(!0),W("");try{const At=((we=(await y$()).data)==null?void 0:we.sellers)||[];i(At),At.length&&h(kt=>kt||At[0].user_id)}catch(ft){W(((Je=(Ge=ft==null?void 0:ft.response)==null?void 0:Ge.data)==null?void 0:Je.error)||(ft==null?void 0:ft.message)||"Failed to load personnel.")}finally{E(!1)}},[]),H=Ue.useCallback(async we=>{if(we){R(!0),B("");try{const Ge=await _$(we);f(Ge.data)}catch{B("Unable to load dossier.")}finally{R(!1)}}},[]);Ue.useEffect(()=>{J()},[J]),Ue.useEffect(()=>{o&&H(o)},[o,H]);const Q=async we=>{var ft,At;if(!(we!=null&&we.id))return;const Ge=window.prompt("Enter payout amount (leave blank to keep current):",we.commission_amount||we.deal_amount);if(Ge===null)return;let Je=null;if(Ge.trim().length&&(Je=Number(Ge.replace(/[^0-9.]/g,"")),Number.isNaN(Je))){B("Invalid override value.");return}G(we.id);try{await v$(we.id,{overrideAmount:Je}),B("Payout approved."),await H(o)}catch(kt){B(((At=(ft=kt==null?void 0:kt.response)==null?void 0:ft.data)==null?void 0:At.error)||(kt==null?void 0:kt.message)||"Approve failed.")}finally{G(null)}},le=t.find(we=>we.user_id===o);return S.jsxs("div",{className:"min-h-screen w-full bg-void-black text-white relative overflow-hidden font-sans",children:[S.jsx(xs,{}),S.jsx("div",{className:"absolute inset-0 bg-grid-lines opacity-40"}),S.jsxs("div",{className:"relative z-10 flex w-full h-screen",children:[S.jsx(go,{eligibleNewAgent:!0,onUpgrade:()=>e("/billing"),onNewAgent:()=>e("/wizard?new=1"),billingStatus:"admin",tier:"admin",agentLive:!0,lastUpdated:new Date,isAdmin:!0}),S.jsxs("div",{className:"flex-1 px-6 py-8 space-y-6 overflow-y-auto",children:[S.jsxs(Ft.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6},className:"glass-panel rounded-3xl border border-white/10 p-6 flex items-center justify-between gap-4",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-neon-cyan/70",children:"Personnel Command"}),S.jsx("h1",{className:"mt-2 text-4xl font-semibold",children:"The Boiler Room"}),S.jsx("p",{className:"text-sm text-white/60 mt-1",children:"Live telemetry for every seller. Approve payouts and audit activity in one frame."})]}),S.jsxs("div",{className:"flex items-center gap-3",children:[S.jsx(S1,{className:"text-neon-green",size:28}),S.jsxs("div",{className:"text-right",children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:"Security"}),S.jsx("p",{className:"text-lg text-neon-green font-semibold",children:"Locked"})]})]})]}),S.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[S.jsxs(Ft.div,{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-4 shadow-glow",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.05},children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"Roster"}),S.jsx("h2",{className:"text-3xl font-semibold",children:"Sales Operators"})]}),S.jsx(X$,{className:"text-neon-cyan",size:28})]}),X&&S.jsx("div",{className:"text-neon-pink text-sm",children:X}),S.jsxs("div",{className:"grid grid-cols-[2fr_0.8fr_0.9fr_0.9fr_0.9fr_0.9fr] gap-4 text-[0.65rem] uppercase tracking-[0.4em] text-white/40 border-b border-white/10 pb-3",children:[S.jsx("div",{children:"Name"}),S.jsx("div",{children:"Status"}),S.jsx("div",{children:"Calls Today"}),S.jsx("div",{children:"Deals MTD"}),S.jsx("div",{children:"Commission"}),S.jsx("div",{children:"Conversion"})]}),S.jsx("div",{className:"space-y-2 max-h-[420px] overflow-y-auto pr-2",children:c?S.jsx("div",{className:"text-white/60",children:"Loading sellers..."}):t.length?t.map(we=>{const Ge=we.user_id===o,Je=we.status==="active";return S.jsxs("button",{type:"button",className:`grid grid-cols-[2fr_0.8fr_0.9fr_0.9fr_0.9fr_0.9fr] gap-4 items-start rounded-2xl border px-4 py-3 text-left transition ${Ge?"border-neon-cyan/60 bg-neon-cyan/5":"border-white/5 bg-black/30 hover:border-neon-cyan/40 hover:bg-cyan-900/10"}`,onClick:()=>h(we.user_id),children:[S.jsxs("div",{children:[S.jsx("div",{className:"text-sm font-semibold text-white",children:we.full_name||we.business_name||we.user_id}),S.jsx("div",{className:"text-[0.7rem] text-white/40 mt-1",children:we.business_name||we.user_id})]}),S.jsx("div",{children:S.jsx("span",{className:`px-2 py-0.5 text-[0.65rem] uppercase rounded-full border ${Je?"border-neon-green/70 bg-neon-green/10 text-neon-green":"border-white/20 bg-white/5 text-white/60"}`,children:Je?"Online":"Offline"})}),S.jsx("div",{className:"text-base font-semibold",children:we.callsToday||0}),S.jsx("div",{className:"text-base font-semibold",children:we.dealsClosed||0}),S.jsx("div",{className:"text-base font-semibold text-neon-cyan",children:ix(we.commissionOwed||0)}),S.jsxs("div",{className:"text-base font-semibold text-white",children:[Number(we.conversionRate||0).toFixed(1),"%"]})]},we.user_id)}):S.jsx("div",{className:"text-white/60",children:"No sellers yet."})})]}),S.jsxs(Ft.div,{className:"glass-panel rounded-3xl border border-white/10 p-6 space-y-5 flex flex-col",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"Agent Dossier"}),S.jsx("h2",{className:"text-2xl font-semibold",children:le?le.full_name||le.business_name:"Select an operator"})]}),S.jsx($$,{className:"text-neon-cyan/80",size:26})]}),L?S.jsx("div",{className:"text-sm text-neon-green/80",children:L}):null,S.jsxs("div",{className:"space-y-4 flex-1 overflow-hidden",children:[S.jsxs("div",{className:"space-y-3",children:[S.jsx("div",{className:"text-xs uppercase tracking-[0.4em] text-white/50",children:"Activity Feed"}),S.jsx("div",{className:"max-h-[170px] overflow-y-auto space-y-3 border border-white/5 rounded-2xl p-3 bg-black/40",children:C?S.jsx("div",{className:"text-white/60 text-sm",children:"Fetching activity..."}):(ve=m==null?void 0:m.activity)!=null&&ve.length?m.activity.map(we=>S.jsxs("div",{className:"border-b border-white/5 pb-2 text-sm last:border-0",children:[S.jsx("div",{className:"text-white/80 font-semibold",children:we.action_type||we.action}),S.jsx("div",{className:"text-white/50 text-[0.7rem]",children:R8(we.created_at)}),we.metadata?S.jsx("div",{className:"text-[0.7rem] text-white/40 mt-1",children:JSON.stringify(we.metadata)}):null]},we.id)):S.jsx("div",{className:"text-white/50 text-sm",children:"No recorded activity."})})]}),S.jsxs("div",{className:"space-y-3",children:[S.jsx("div",{className:"flex items-center justify-between",children:S.jsxs("div",{children:[S.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/50",children:"Commission Ledger"}),S.jsx("p",{className:"text-sm text-white/60 mt-1",children:"Deal value & payout status."})]})}),S.jsxs("div",{className:"grid grid-cols-[1.1fr_1fr_0.8fr_0.6fr] gap-3 text-[0.65rem] uppercase tracking-[0.4em] text-white/40",children:[S.jsx("div",{children:"Deal Value"}),S.jsx("div",{children:"Payout"}),S.jsx("div",{children:"Status"}),S.jsx("div",{})]}),S.jsx("div",{className:"space-y-2 max-h-[180px] overflow-y-auto",children:(Ee=m==null?void 0:m.commissions)!=null&&Ee.length?m.commissions.map(we=>S.jsxs("div",{className:"grid grid-cols-[1.1fr_1fr_0.8fr_0.6fr] gap-3 items-center rounded-2xl border border-white/5 bg-black/40 px-3 py-2",children:[S.jsx("div",{className:"text-sm font-semibold",children:ix(we.deal_amount)}),S.jsx("div",{className:"text-sm text-neon-cyan font-semibold",children:ix(we.commission_amount)}),S.jsx("div",{children:S.jsx("span",{className:`px-2 py-0.5 text-[0.65rem] uppercase rounded-full border ${we.status==="paid"?"border-neon-green/70 bg-neon-green/10 text-neon-green":"border-neon-cyan/60 bg-neon-cyan/10 text-neon-cyan"}`,children:we.status})}),S.jsx("div",{children:we.status!=="paid"?S.jsx("button",{type:"button",className:"glow-button text-[0.6rem] px-3 py-1",onClick:()=>Q(we),disabled:te===we.id,children:te===we.id?"Processing...":"Approve Payout"}):S.jsx("span",{className:"text-[0.65rem] text-white/50",children:"Settled"})})]},we.id)):S.jsx("div",{className:"text-sm text-white/50",children:"Awaiting commissions."})})]}),S.jsxs("div",{className:"space-y-2",children:[S.jsx("div",{className:"text-xs uppercase tracking-[0.4em] text-white/50",children:"Security Audit"}),S.jsx("div",{className:"flex flex-wrap gap-2",children:(_e=m==null?void 0:m.ipLog)!=null&&_e.length?m.ipLog.map(we=>S.jsx("span",{className:"px-3 py-1 rounded-full border border-white/10 text-[0.75rem] text-white/70",children:we.ip},we.ip)):S.jsx("span",{className:"text-[0.75rem] text-white/40",children:"No IPs recorded."})})]})]})]})]})]})]})]})}function As({children:e}){const[t,i]=Ue.useState(!0),[o,h]=Ue.useState(null),m=qr();return Ue.useEffect(()=>{let f=!0;zt.auth.getSession().then(({data:E})=>{f&&(h(E.session||null),i(!1))});const{data:c}=zt.auth.onAuthStateChange((E,C)=>{f&&h(C)});return()=>{var E;f=!1,(E=c==null?void 0:c.subscription)==null||E.unsubscribe()}},[]),Ue.useEffect(()=>{if(!o)return;if(!window.sessionStorage.getItem("kryonex_session_ok")){zt.auth.signOut(),m("/login",{replace:!0});return}let f=null;const c=30*60*1e3,E=()=>{f&&clearTimeout(f),f=setTimeout(async()=>{await zt.auth.signOut(),m("/login",{replace:!0})},c)},C=["mousemove","mousedown","keydown","touchstart","scroll"];return C.forEach(R=>window.addEventListener(R,E,!0)),E(),()=>{f&&clearTimeout(f),C.forEach(R=>window.removeEventListener(R,E,!0))}},[o,m]),t?S.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",color:"#8b5cf6",letterSpacing:"0.2rem"},children:"INITIALIZING..."}):o?e:S.jsx(Hh,{to:"/login",replace:!0})}function sx({children:e}){const[t,i]=Ue.useState(!0),[o,h]=Ue.useState(!1);return Ue.useEffect(()=>{let m=!0;return(async()=>{var L;const{data:c}=await zt.auth.getSession(),E=(L=c==null?void 0:c.session)==null?void 0:L.user;if(!E){m&&(h(!1),i(!1));return}const{data:C,error:R}=await zt.from("profiles").select("business_name, industry").eq("user_id",E.id).maybeSingle();if(m){if(R||!C)h(!1);else{const B=!!C.business_name,X=!!C.industry;h(B&&X)}i(!1)}})(),()=>{m=!1}},[]),t?S.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",color:"#10b981",letterSpacing:"0.2rem"},children:"SCANNING PROFILE..."}):o?e:S.jsx(Hh,{to:"/wizard",replace:!0})}function Tc({children:e}){const[t,i]=Ue.useState(!0),[o,h]=Ue.useState(!1);return Ue.useEffect(()=>{let m=!0;return(async()=>{var R;const{data:c}=await zt.auth.getSession(),E=(R=c==null?void 0:c.session)==null?void 0:R.user;if(!E){m&&(h(!1),i(!1));return}const{data:C}=await zt.from("profiles").select("role").eq("user_id",E.id).maybeSingle();if(m){const L=window.localStorage.getItem("kryonex_admin_mode")||"user";h((C==null?void 0:C.role)==="admin"&&L==="admin"),i(!1)}})(),()=>{m=!1}},[]),t?S.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",color:"#22d3ee",letterSpacing:"0.2rem"},children:"AUTHORIZING ADMIN..."}):o?e:S.jsx(Hh,{to:"/dashboard",replace:!0})}function j8({roles:e,children:t,fallback:i="/dashboard"}){const[o,h]=Ue.useState(!0),[m,f]=Ue.useState(!1);return Ue.useEffect(()=>{let c=!0;return(async()=>{var B;const{data:C}=await zt.auth.getSession(),R=(B=C==null?void 0:C.session)==null?void 0:B.user;if(!R){c&&(f(!1),h(!1));return}const{data:L}=await zt.from("profiles").select("role").eq("user_id",R.id).maybeSingle();if(c){const X=(L==null?void 0:L.role)||"";f(Array.isArray(e)?e.includes(X):X===e),h(!1)}})(),()=>{c=!1}},[e]),o?S.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",color:"#22d3ee",letterSpacing:"0.2rem"},children:"AUTHORIZING..."}):m?t:S.jsx(Hh,{to:i,replace:!0})}function N8(){return S.jsxs(cO,{children:[S.jsx(Vr,{path:"/",element:S.jsx(K5,{})}),S.jsx(Vr,{path:"/login",element:S.jsx(x$,{})}),S.jsx(Vr,{path:"/wizard",element:S.jsx(As,{children:S.jsx(n8,{})})}),S.jsx(Vr,{path:"/dashboard",element:S.jsx(As,{children:S.jsx(sx,{children:S.jsx(r8,{})})})}),S.jsx(Vr,{path:"/billing",element:S.jsx(As,{children:S.jsx(sx,{children:S.jsx(a8,{})})})}),S.jsx(Vr,{path:"/calendar",element:S.jsx(As,{children:S.jsx(sx,{children:S.jsx(s8,{})})})}),S.jsx(Vr,{path:"/admin",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(c8,{})})})}),S.jsx(Vr,{path:"/admin/call-center",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(h8,{})})})}),S.jsx(Vr,{path:"/admin/wizard/create",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(f8,{})})})}),S.jsx(Vr,{path:"/admin/users",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(E8,{})})})}),S.jsx(Vr,{path:"/admin/logs",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(k8,{})})})}),S.jsx(Vr,{path:"/admin/financials",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(M8,{})})})}),S.jsx(Vr,{path:"/admin/sellers",element:S.jsx(As,{children:S.jsx(Tc,{children:S.jsx(D8,{})})})}),S.jsx(Vr,{path:"/admin/client-wizard",element:S.jsx(Hh,{to:"/admin/wizard/create",replace:!0})}),S.jsx(Vr,{path:"/console/dialer",element:S.jsx(As,{children:S.jsx(j8,{roles:["seller","admin"],fallback:"/dashboard",children:S.jsx(_8,{})})})}),S.jsx(Vr,{path:"/track/:token",element:S.jsx(b8,{})}),S.jsx(Vr,{path:"/tech/track/:token",element:S.jsx(w8,{})}),S.jsx(Vr,{path:"*",element:S.jsx(Hh,{to:"/",replace:!0})})]})}IA(document.getElementById("root")).render(S.jsx(Ue.StrictMode,{children:S.jsx(yO,{children:S.jsx(N8,{})})}));
